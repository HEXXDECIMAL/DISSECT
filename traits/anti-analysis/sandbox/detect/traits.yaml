# Sandbox Detection
# MBC: OB0001 (Anti-Behavioral Analysis) â†’ B0007 (Sandbox Detection)
# ATT&CK: T1497.001 (Virtualization/Sandbox Evasion: System Checks)

traits:
  # === Sandbox hostname atomic indicators ===
  - id: hostname-19olltd
    description: DESKTOP-19OLLTD sandbox hostname
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.7
    condition:
      type: string
      exact: "DESKTOP-19OLLTD"

  - id: hostname-b0t93d6
    description: DESKTOP-B0T93D6 sandbox hostname
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.7
    condition:
      type: string
      exact: "DESKTOP-B0T93D6"

  - id: hostname-vrsqlag
    description: DESKTOP-VRSQLAG sandbox hostname
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.7
    condition:
      type: string
      exact: "DESKTOP-VRSQLAG"

  - id: hostname-john-pc
    description: JOHN-PC sandbox hostname
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.7
    condition:
      type: string
      exact: "JOHN-PC"

  - id: hostname-julia-pc
    description: JULIA-PC sandbox hostname
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.7
    condition:
      type: string
      exact: "JULIA-PC"

  - id: hostname-lisa-pc
    description: LISA-PC sandbox hostname
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.7
    condition:
      type: string
      exact: "LISA-PC"

  - id: username-sandbox
    description: Common sandbox usernames
    criticality: suspicious
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.8
    condition:
      type: string
      # Use word boundaries and require username-like context
      # Excludes legitimate uses like "entering sandbox" or "sandbox.sb" profiles
      regex: "\\b(user|USER|username|USERNAME|User|Username)\\s*[=:]\\s*(malware|sandbox|virus|sample|test|admin)\\b"
      case_insensitive: true

  - id: sleep-accel
    description: Sleep acceleration detection (sandbox evasion)
    criticality: suspicious
    mbc: "B0007"
    attack: "T1497.003"
    confidence: 0.9
    file_types: [elf, macho, so, dylib, pe, dll, c]
    condition:
      type: symbol
      pattern: sleep|Sleep|usleep

  # === Sandbox artifact file path atomic indicators ===
  - id: path-c-analysis
    description: C:\analysis sandbox path
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.6
    condition:
      type: string
      exact: "C:\\analysis"

  - id: path-c-sandbox
    description: C:\sandbox sandbox path
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.6
    condition:
      type: string
      exact: "C:\\sandbox"

  - id: path-tmp-analysis
    description: /tmp/analysis sandbox path
    criticality: notable
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.6
    condition:
      type: string
      exact: "/tmp/analysis"

composite_rules:
  # Sandbox hostname composite
  - id: hostname-sandbox
    description: Common sandbox hostnames
    criticality: suspicious
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.8
    requires_count: 1
    conditions:
      - id: hostname-19olltd
      - id: hostname-b0t93d6
      - id: hostname-vrsqlag
      - id: hostname-john-pc
      - id: hostname-julia-pc
      - id: hostname-lisa-pc

  # Sandbox file path composite
  - id: file-check-sandbox
    description: Sandbox artifact file checks
    criticality: suspicious
    mbc: "B0007"
    attack: "T1497.001"
    confidence: 0.7
    requires_count: 1
    conditions:
      - id: path-c-analysis
      - id: path-c-sandbox
      - id: path-tmp-analysis
