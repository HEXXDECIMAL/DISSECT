# Virtual Machine Detection
# MBC: B0009 (Virtual Machine Detection)
# ATT&CK: T1497.001

traits:
  - id: anti-analysis/vm
    description: VM detection techniques
    criticality: notable
    confidence: 0.5
    mbc: "B0009"
    attack: "T1497.001"
    condition:
      type: yara
      source: |
        rule vm_detect {
          strings:
            // VM product names - require word boundaries to avoid false positives
            // Single vendor string is notable; multiple is suspicious (see composite)
            $vmware = "VMware" nocase fullword
            $virtualbox = "VirtualBox" nocase fullword
            $vbox = "VBOX" fullword
            $qemu = "QEMU" fullword
            $xen = "XEN" fullword
            $hyperv = "Hyper-V" nocase
            $kvm = "KVM" fullword
            $parallels = "Parallels" nocase fullword
          condition:
            any of them
        }

  - id: anti-analysis/vm/multi-vendor
    description: Multiple VM vendor detection (evasion technique)
    criticality: suspicious
    confidence: 0.8
    mbc: "B0009"
    attack: "T1497.001"
    condition:
      type: yara
      source: |
        rule vm_detect_multi {
          strings:
            $vmware = "VMware" nocase fullword
            $virtualbox = "VirtualBox" nocase fullword
            $vbox = "VBOX" fullword
            $qemu = "QEMU" fullword
            $xen = "XEN" fullword
            $hyperv = "Hyper-V" nocase
            $kvm = "KVM" fullword
            $parallels = "Parallels" nocase fullword
          condition:
            2 of them
        }
