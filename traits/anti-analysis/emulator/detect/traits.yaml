# VM/Emulator Detection
# MBC: OB0001 (Anti-Behavioral Analysis) â†’ B0009 (Virtual Machine Detection)
# ATT&CK: T1497.001 (Virtualization/Sandbox Evasion: System Checks)

traits:
  # Single VM vendor strings are notable - network tools legitimately know about VMware
  # Multiple vendor checks indicate deliberate VM detection (see combos.yaml)
  - id: anti-analysis/emulator/detect/vmware-string
    description: VMware vendor string detection
    criticality: notable
    mbc: "B0009"
    attack: "T1497.001"
    confidence: 0.6
    condition:
      type: string
      exact: "VMware"

  - id: anti-analysis/emulator/detect/virtualbox-string
    description: VirtualBox vendor string detection
    criticality: notable
    mbc: "B0009"
    attack: "T1497.001"
    confidence: 0.6
    condition:
      type: string
      regex: "(VirtualBox|VBOX)"
      case_insensitive: true

  - id: anti-analysis/emulator/detect/qemu-string
    description: QEMU vendor string detection
    criticality: notable
    mbc: "B0009"
    attack: "T1497.001"
    confidence: 0.6
    condition:
      type: string
      regex: "(QEMU|qemu)"

  - id: anti-analysis/emulator/detect/vm-hardware
    description: VM-specific hardware strings
    criticality: notable
    mbc: "B0009"
    attack: "T1497.001"
    confidence: 0.6
    condition:
      type: string
      regex: "(VMXH|VBox|virtio|vmmouse)"
      case_insensitive: true

  # Removed: sysctl is a standard system API, not inherently VM detection
  # macOS tools legitimately use sysctl for system information

  - id: anti-analysis/emulator/detect/cpu-vendor
    description: CPU vendor string checks (Intel/AMD vs VM)
    criticality: notable
    mbc: "B0009"
    confidence: 0.5
    condition:
      type: string
      regex: "(GenuineIntel|AuthenticAMD)"
