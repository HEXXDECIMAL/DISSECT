---
# Ruby obfuscation and encoding techniques
traits:
  - id: anti-analysis/obfuscation/code/ruby-base64-decode
    description: "Base64 decode (potential obfuscation)"
    criticality: notable
    confidence: 0.88
    platforms:
      - all
    file_types:
      - ruby
    condition:
      type: symbol_or_string
      any:
        - Base64.decode64
        - Base64.strict_decode64

  - id: anti-analysis/obfuscation/code/ruby-base64-encode
    description: "Base64 encode"
    criticality: notable
    confidence: 0.88
    platforms:
      - all
    file_types:
      - ruby
    condition:
      type: symbol_or_string
      any:
        - Base64.encode64
        - Base64.strict_encode64

  - id: anti-analysis/obfuscation/code/ruby-marshal-load
    description: "Marshal deserialization (RCE risk)"
    criticality: notable
    confidence: 0.93
    platforms:
      - all
    file_types:
      - ruby
    condition:
      type: symbol_or_string
      any:
        - Marshal.load
        - Marshal.restore

  - id: anti-analysis/obfuscation/code/ruby-yaml-unsafe-load
    description: "YAML unsafe deserialization"
    criticality: notable
    confidence: 0.90
    platforms:
      - all
    file_types:
      - ruby
    condition:
      type: symbol_or_string
      any:
        - YAML.load
      none:
        - YAML.safe_load

  - id: anti-analysis/obfuscation/code/ruby-reflection-send
    description: "Dynamic method invocation"
    criticality: notable
    confidence: 0.85
    platforms:
      - all
    file_types:
      - ruby
    condition:
      type: symbol_or_string
      any:
        - .send(
        - .send

  - id: anti-analysis/obfuscation/code/ruby-const-get
    description: "Dynamic constant access"
    criticality: notable
    confidence: 0.90
    platforms:
      - all
    file_types:
      - ruby
    condition:
      type: symbol_or_string
      any:
        - const_get

  - id: anti-analysis/obfuscation/code/ruby-const-set
    description: "Dynamic constant definition"
    criticality: notable
    confidence: 0.90
    platforms:
      - all
    file_types:
      - ruby
    condition:
      type: symbol_or_string
      any:
        - const_set

  - id: anti-analysis/obfuscation/code/ruby-define-method
    description: "Dynamic method definition"
    criticality: notable
    confidence: 0.90
    platforms:
      - all
    file_types:
      - ruby
    condition:
      type: symbol_or_string
      any:
        - define_method
