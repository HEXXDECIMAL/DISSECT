# Debugger Detection
# MBC: OB0001 (Anti-Behavioral Analysis) â†’ B0001 (Debugger Detection)
# ATT&CK: T1622 (Debugger Evasion)

traits:
  # Unix/Linux
  - id: ptrace
    description: ptrace system call (debugging/tracing)
    criticality: medium
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.7
    condition:
      type: symbol
      pattern: ptrace
    platforms: [linux, unix, macos]

  - id: isatty
    description: Detect if running in terminal
    criticality: low
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.5
    condition:
      type: symbol
      pattern: isatty
    platforms: [all]

  - id: proc-status
    description: Reading /proc/self/status for TracerPid
    criticality: medium
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.8
    condition:
      type: string
      exact: "/proc/self/status"
    platforms: [linux]

  - id: ld-debug
    description: LD_DEBUG environment variable check
    criticality: low
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.6
    condition:
      type: string
      exact: "LD_DEBUG"
    platforms: [linux]

  # Windows
  - id: win-isdebuggerpresent
    description: Windows IsDebuggerPresent API
    criticality: medium
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.9
    condition:
      type: string
      exact: "IsDebuggerPresent"
    platforms: [windows]
    file_types: [pe, dll]

  - id: win-checkremotedebugger
    description: Windows CheckRemoteDebuggerPresent API
    criticality: medium
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.9
    condition:
      type: string
      exact: "CheckRemoteDebuggerPresent"
    platforms: [windows]

  - id: win-ntqueryinfo
    description: NtQueryInformationProcess for debugger detection
    criticality: medium
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.85
    condition:
      type: string
      exact: "NtQueryInformationProcess"
    platforms: [windows]

  - id: win-unhandledexception
    description: UnhandledExceptionFilter for anti-debugging
    criticality: low
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.7
    condition:
      type: string
      exact: "UnhandledExceptionFilter"
    platforms: [windows]

  - id: win-queryperformance
    description: QueryPerformanceCounter timing check
    criticality: low
    mbc: "B0001"
    attack: "T1622"
    confidence: 0.6
    condition:
      type: string
      exact: "QueryPerformanceCounter"
    platforms: [windows]
