traits:
  - id: srw-lock-acquire
    desc: SRW lock acquisition
    crit: notable
    conf: 0.65
    platforms:
      - windows
    for:
      - pe
    if:
      type: symbol
      exact: AcquireSRWLockExclusive
    attack: T1129
  - id: srw-lock-release
    desc: SRW lock release
    crit: notable
    conf: 0.65
    platforms:
      - windows
    for:
      - pe
    if:
      type: symbol
      exact: ReleaseSRWLockExclusive
    attack: T1129
  - id: srw-lock-shared
    desc: SRW shared lock read
    crit: notable
    conf: 0.65
    platforms:
      - windows
    for:
      - pe
    if:
      type: symbol
      regex: (^AcquireSRWLockShared$|^ReleaseSRWLockShared$)
    attack: T1129
  - id: condition-variable-wait
    desc: Condition variable wait
    crit: notable
    conf: 0.65
    platforms:
      - windows
    for:
      - pe
    if:
      type: symbol
      regex: (^SleepConditionVariableSRW$|^SleepConditionVariableCS$)
    attack: T1129
  - id: condition-variable-signal
    desc: Condition variable signal
    crit: notable
    conf: 0.65
    platforms:
      - windows
    for:
      - pe
    if:
      type: symbol
      regex: (^WakeConditionVariable$|^WakeAllConditionVariable$)
    attack: T1129
composite_rules:
  # Combined slist operations
  - id: slist-operations
    desc: Interlocked SList operations
    crit: notable
    conf: 0.65
    platforms: [windows]
    for: [pe]
    any:
      - id: micro-behaviors/mem/sync/mutex::interlocked-flush-slist
      - id: micro-behaviors/mem/sync/mutex::interlocked-push-entry-slist
      - id: micro-behaviors/mem/sync/mutex::interlocked-pop-entry-slist
    attack: T1129
  - id: srw-lock-ops
    desc: SRW lock operations
    crit: suspicious
    conf: 0.7
    platforms:
      - windows
    for:
      - pe
    attack: T1129
    needs: 2
    any:
      - id: srw-lock-acquire
      - id: srw-lock-release
      - id: srw-lock-shared
    downgrade:
      any:
        - id: metadata/quality/versioned
  - id: condition-variable-ops
    desc: Condition variable ops
    crit: suspicious
    conf: 0.7
    platforms:
      - windows
    for:
      - pe
    attack: T1129
    any:
      - id: condition-variable-wait
      - id: condition-variable-signal
  - id: slist-sync-ops
    desc: Interlocked SList sync
    crit: suspicious
    conf: 0.7
    platforms:
      - windows
    for:
      - pe
    attack: T1129
    all:
      - id: micro-behaviors/mem/sync/mutex::initialize-slist-head
      - id: slist-operations
  - id: advanced-sync-primitives
    desc: Advanced sync primitives
    crit: suspicious
    conf: 0.75
    platforms:
      - windows
    for:
      - pe
    attack: T1129
    needs: 2
    any:
      - id: srw-lock-ops
      - id: condition-variable-ops
      - id: slist-sync-ops
  - id: advanced-sync-server
    desc: Advanced server infrastructure
    crit: suspicious
    conf: 0.8
    platforms:
      - windows
    for:
      - pe
    attack: T1129
    mbc: E1030
    all:
      - id: micro-behaviors/process/create
      - id: advanced-sync-primitives
