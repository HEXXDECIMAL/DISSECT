# JScript/WSH Synchronous Wait Loop (ReadyState)
# Detects 'while (readyState < 4) { Sleep(...) }' pattern common in synchronous downloaders

defaults:
  crit: suspicious
  conf: 0.8
  for: [javascript]

traits:
  - id: wsh-wait-loop-readystate
    desc: "Synchronous wait loop for XMLHTTP readyState completion"
    if:
      type: raw
      # while (obj.readyState < 4) { WScript.Sleep(1000); }
      # Regex matches: while (... < 4) { ...WScript... }
      regex: 'while\s*\([^)]{0,120}<\s*4\s*\)\s*\{[^}]{0,120}WScript[^}]{0,120}\}'
