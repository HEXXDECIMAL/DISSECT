defaults:
  for:
  - all
traits:
- id: npm-config-discovery
  desc: Shell command accesses NPM configuration
  conf: 0.8
  crit: suspicious
  attack: T1082
  if:
    type: raw
    regex: npm config list

composite_rules:
- id: network-discovery
  desc: Shell command performs network discovery
  conf: 0.6
  crit: notable
  attack: T1016
  any:
    - id: micro-behaviors/os/network/interface::ip-a
    - id: micro-behaviors/os/network/interface::ifconfig
    - id: micro-behaviors/os/network/status::netstat-an

- id: network-discovery-extra
  desc: Shell command performs network discovery (extra)
  conf: 0.6
  crit: notable
  attack: T1016
  any:
    - id: micro-behaviors/os/network/interface::ip-link # Wait, ip link is in interface
    - id: micro-behaviors/os/network/status::ss # ss is in status

- id: network-discovery-any
  desc: Shell command performs network discovery
  conf: 0.6
  crit: notable
  attack: T1016
  any:
  - id: network-discovery
  - id: network-discovery-extra

- id: process-discovery
  desc: Shell command performs process discovery
  conf: 0.6
  crit: notable
  attack: T1057
  any:
  - id: micro-behaviors/process/enumerate/shell::ps-aux
  - id: micro-behaviors/process/enumerate/shell::ps-ef
  - id: micro-behaviors/process/enumerate/shell::tasklist

- id: sys-info-discovery
  desc: Shell command performs system information discovery
  conf: 0.6
  crit: notable
  attack: T1082
  unless:
  - id: metadata/dev/testing::is-test
  any:
  - id: micro-behaviors/process/user/query::whoami-cmd
  - id: micro-behaviors/fs/path/os::uname-a-cmd
  - id: network-discovery
  - id: process-discovery
  - id: micro-behaviors/os/env/vars::printenv
  - id: micro-behaviors/process/user/query::id-cmd
  - id: micro-behaviors/os/env/vars::env-cmd
