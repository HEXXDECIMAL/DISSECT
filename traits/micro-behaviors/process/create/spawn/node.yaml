# Node.js Process Spawning Capabilities
# Capabilities related to child_process.spawn() and process management

defaults:
  for: [javascript, typescript]

traits:
  # === Detached spawn execution indicators ===

  - id: detached-true
    desc: Detached process spawn option
    crit: notable
    conf: 0.85
    mbc: "F0011"
    attack: "T1059"
    if:
      type: raw
      regex: 'detached\s*:\s*true'

  - id: windowshide-option
    desc: windowsHide option
    crit: inert
    conf: 0.85
    if:
      type: raw
      regex: 'windowsHide\s*:\s*true'

  - id: shell-false
    desc: "shell: false option"
    crit: inert
    conf: 0.85
    if:
      type: raw
      regex: 'shell\s*:\s*false'

  # === Silent I/O patterns ===

  - id: stdio-ignore
    desc: stdio set to ignore
    crit: notable
    conf: 0.85
    mbc: "F0005"
    if:
      type: raw
      regex: "stdio\\s*:\\s*(\\[[^\\]]{0,220}['\"]ignore['\"]|['\"]ignore['\"])"

  # === Orphan process patterns ===

  - id: child-unref-call
    desc: child.unref() orphan process call
    crit: notable
    conf: 0.85
    mbc: "F0011"
    if:
      type: raw
      substr: ".unref()"

  # === Node.js self-execution ===

  - id: process-execpath-spawn
    desc: Spawn using process.execPath
    crit: notable
    conf: 0.9
    mbc: "B0024"
    attack: "T1059.007"
    if:
      type: raw
      substr: "process.execPath"
