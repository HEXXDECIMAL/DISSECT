# Shell Piped Execution
# ATT&CK: T1059.004 (Unix Shell)

defaults:
  for: [all]
  crit: notable
  conf: 0.6
  attack: "T1059.004"

traits:
  - id: pipe-sh
    desc: "pipe to sh"
    if:
      type: string
      regex: ' \|\s*sh\b'

  - id: pipe-bash
    desc: "pipe to bash"
    if:
      type: string
      regex: ' \|\s*bash\b'

  - id: output-pipe-sh
    desc: "-O- | sh pattern"
    crit: suspicious
    conf: 0.85
    mbc: "B0024"
    if:
      type: string
      regex: '-[Oo]-?\s*\|\s*sh\b'

composite_rules:
  - id: pipe-sh-or-bash
    desc: "Pipe to shell (sh or bash)"
    any:
      - id: pipe-sh
      - id: pipe-bash
