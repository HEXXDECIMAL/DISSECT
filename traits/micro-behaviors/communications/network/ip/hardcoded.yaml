# Hardcoded IP Address Detection
# Detects hardcoded external IPv4 addresses in any file type
# This is a capability/observation - intent is inferred in objectives/ layer

traits:
  - id: external-ipv4-binary
    desc: Hardcoded external IPv4 address
    crit: notable
    conf: 0.85
    size_max: 1500000
    for: [elf, macho, pe]
    if:
      type: string
      regex: '^([0-9]{1,3}\.){3}[0-9]{1,3}$'
      external_ip: true

  - id: external-ipv4-script
    desc: Hardcoded external IPv4 address
    crit: notable
    conf: 0.85
    for: [scripts]
    size_max: 5000
    if:
      type: string
      regex: '^([0-9]{1,3}\.){3}[0-9]{1,3}$'
      external_ip: true
    not:
      - regex: '^8\.8\.[84]\.[84]$'
      - exact: "1.1.1.1"
      - exact: "9.9.9.9"
      - regex: '^208\.67\.22[20]\.22[20]$'
      - exact: "123.123.123.123"
    unless:
      - type: raw
        regex: "pytest|def test_"

  - id: http-ip-url
    desc: HTTP URL with IP address
    crit: suspicious
    conf: 0.95
    for: [elf, macho, pe, scripts]
    if:
      type: string
      regex: 'https?://[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'
      external_ip: true
