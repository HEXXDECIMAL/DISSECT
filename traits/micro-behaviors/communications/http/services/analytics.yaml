defaults:
  mbc: T1071.001
  attack: T1071.001
  for: [all]

traits:
  - id: histats-domain
    desc: Histats analytics domain
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: histats\.com
  
  - id: statcounter-domain
    desc: StatCounter analytics domain
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: statcounter\.com

composite_rules:
  - id: histats-suspicious-activity
    desc: Histats domain with suspicious Referer
    crit: suspicious
    conf: 0.8
    for: [javascript, typescript]
    all:
      - id: histats-domain
    any:
      - id: micro-behaviors/communications/http/headers::referer-dynamic-concatenation
      - id: micro-behaviors/communications/http/headers::referer-dummy-url-pattern

  - id: statcounter-suspicious-activity
    desc: StatCounter domain with suspicious Referer
    crit: suspicious
    conf: 0.8
    for: [javascript, typescript]
    all:
      - id: statcounter-domain
    any:
      - id: micro-behaviors/communications/http/headers::referer-dynamic-concatenation
      - id: micro-behaviors/communications/http/headers::referer-dummy-url-pattern

  - id: suspicious-analytics-usage
    desc: Suspicious usage of analytics services (potential exfil)
    crit: suspicious
    conf: 0.85
    for: [javascript, typescript]
    any:
      - id: histats-suspicious-activity
      - id: statcounter-suspicious-activity
