defaults:
  for: [all]

traits:
  - id: dispatcher-signature-op
    desc: DOS dispatcher check op
    crit: inert
    conf: 0.9
    if:
      type: raw
      regex: '(?i)(cmp|mov)\s+'

  - id: dispatcher-signature-8b2e-reg
    desc: DOS dispatcher check register/signature (8B2E)
    crit: suspicious
    conf: 0.9
    if:
      type: raw
      regex: '(?i)(bx|ax|cx|dx),\s*8b2eh'

  - id: dispatcher-signature-9f-reg
    desc: DOS dispatcher check register/signature (9F)
    crit: suspicious
    conf: 0.9
    if:
      type: raw
      regex: '(?i)(al|bl|cl|dl),\s*9fh'

  - id: check-command-com
    desc: Check for COMMAND.COM execution (COMM)
    crit: notable
    conf: 0.8
    for: ["!javascript", "!typescript", "!python", "!ruby", "!shell", "!php", "!go", "!rust", "!java", "!scala"]
    if:
      type: string
      regex: '(?i)\bCOMMAND\.COM\b'

  - id: check-com-extension
    desc: Check for .COM file extension
    crit: notable
    conf: 0.8
    for: ["!javascript", "!typescript", "!python", "!ruby", "!shell", "!php", "!go", "!rust", "!java", "!scala"]
    if:
      type: string
      regex: '(?i)^(\*|[a-z0-9]{1,8})\.com$'

  - id: darth-vader-string
    desc: Darth Vader signature string
    crit: suspicious
    conf: 0.99
    if:
      type: string
      substr: "Darth Vader"

composite_rules:
  - id: dispatcher-signature-8b2e
    desc: DOS internal dispatcher signature check (8B2E)
    crit: suspicious
    conf: 0.9
    all:
      - id: dispatcher-signature-op
      - id: dispatcher-signature-8b2e-reg

  - id: dispatcher-signature-9f
    desc: DOS internal dispatcher signature check (9F)
    crit: suspicious
    conf: 0.9
    all:
      - id: dispatcher-signature-op
      - id: dispatcher-signature-9f-reg
