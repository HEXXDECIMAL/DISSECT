defaults:
  for:
  - all
traits:
- id: infected-marker
  desc: "References being infected"
  crit: notable
  conf: 0.7
  attack: T1204
  for:
  - all
  if:
    type: string
    regex: '(?i)\binfected\b'
- id: infection-marker
  desc: "References infection"
  crit: notable
  conf: 0.7
  attack: T1204
  for:
  - all
  if:
    type: string
    substr: infection
- id: virus-marker
  desc: "Virus reference"
  crit: notable
  conf: 0.7
  attack: T1204
  for:
  - all
  if:
    type: string
    regex: '(?i)\bvirus\b'
- id: worm-marker
  desc: "Worm malware type reference"
  crit: notable
  conf: 0.7
  attack: T1204
  for:
  - all
  if:
    type: string
    regex: '(?i)\bworm\b'
- id: trojan-marker
  desc: "Trojan reference"
  crit: notable
  conf: 0.7
  attack: T1204
  for:
  - all
  if:
    type: string
    regex: '(?i)\btrojan\b'
- id: cyber-warfare-marker
  desc: "Cyber warfare reference"
  crit: notable
  conf: 0.8
  if:
    type: raw
    regex: '(?i)cyber.?warfare'

# === Malware type atomic indicators ===
- id: grabber-word
  desc: "grabber keyword"
  if:
    type: string
    word: "grabber"
    case_insensitive: true

- id: stealer-word
  desc: "stealer keyword"
  if:
    type: string
    word: "stealer"
    case_insensitive: true

- id: rat-word
  desc: "RAT keyword (Remote Access Trojan)"
  if:
    type: string
    regex: '\b[Rr][Aa][Tt]\b'

- id: suspicious-repo-name-trojan
  desc: "Suspicious repository name"
  crit: notable
  conf: 0.75
  if:
    type: string
    word: trojan
    case_insensitive: true

# === Suffix patterns for repo names ===
- id: malware-bot-tool-suffix
  desc: "bot/tool suffix"
  if:
    type: raw
    regex: '[_-]?(bot|tool)\b'
    case_insensitive: true

- id: malware-kit-py-suffix
  desc: "kit/py suffix"
  if:
    type: string
    regex: '[_-](kit|py)\b'
    case_insensitive: true

- id: malware-lang-suffix
  desc: "go/rs language suffix"
  if:
    type: string
    regex: '[a-z]{3,}[_-](go|rs)\b'
    case_insensitive: true

- id: backdoor-word
  desc: "backdoor keyword"
  if:
    type: string
    word: "backdoor"
    case_insensitive: true

- id: malware-infrastructure-suffix
  desc: "Common malware infrastructure suffixes"
  if:
    type: string
    regex: '[_-](shell|c2|trojan|server)\b'
    case_insensitive: true

composite_rules:
- id: malware-type-word
  desc: "Common malware type keywords"
  any:
    - id: grabber-word
    - id: stealer-word
    - id: micro-behaviors/hardware/input/keyboard::keylogger-string
    - id: rat-word

- id: malware-repo-suffix
  desc: "Common malware repository suffixes"
  any:
    - id: malware-bot-tool-suffix
    - id: malware-kit-py-suffix
    - id: malware-lang-suffix

- id: suspicious-repo-name-a
  desc: "Suspicious repository name keywords"
  crit: notable
  conf: 0.75
  any:
    - id: grabber-word
    - id: stealer-word
    - id: micro-behaviors/hardware/input/keyboard::keylogger-string

- id: suspicious-repo-name
  desc: "Suspicious repository name"
  crit: notable
  conf: 0.75
  any:
  - id: suspicious-repo-name-a
  - id: suspicious-repo-name-trojan

- id: suspicious-repo-name-suffixed-type-match
  desc: "Malware type word with malware suffix"
  all:
    - id: malware-type-word
    - id: malware-repo-suffix

- id: suspicious-repo-name-suffixed-trojan-match
  desc: "Trojan repo name with language suffix"
  all:
    - id: suspicious-repo-name-trojan
    - id: malware-lang-suffix

- id: suspicious-repo-name-suffixed
  desc: "Suspicious repository name with common malware suffix"
  crit: notable
  conf: 0.75
  any:
    - id: suspicious-repo-name-suffixed-type-match
    - id: suspicious-repo-name-suffixed-trojan-match

- id: suspicious-backdoor-repo-name
  desc: "Backdoor-focused suspicious repository name"
  crit: notable
  conf: 0.75
  all:
    - id: backdoor-word
    - id: malware-infrastructure-suffix
