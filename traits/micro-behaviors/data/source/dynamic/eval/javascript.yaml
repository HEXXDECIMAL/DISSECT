traits:
  - id: js-eval-assignment
    desc: Assignment or return of 'eval' function reference
    crit: suspicious
    conf: 0.8
    for: [javascript]
    if:
      type: raw
      regex: '\b(return|var|const|let|=)\s*eval\b'

  - id: new-function-iife
    desc: Immediate invocation of new Function (dynamic execution)
    crit: suspicious
    conf: 0.9
    attack: T1027
    mbc: B0032
    for: [javascript]
    if:
      type: ast
      query: |
        (call_expression
          function: [
            (new_expression
              constructor: (identifier) @name
            )
            (parenthesized_expression
              (new_expression
                constructor: (identifier) @name
              )
            )
          ]
          (#eq? @name "Function")
        )
