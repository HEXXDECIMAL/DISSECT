# NOTE: Go runtime and standard library use these syscalls legitimately for
# any network operations. The atomic traits are downgraded to inert, and
# the composites are downgraded to notable since network servers are common.

traits:
  - id: syscall-socket
    desc: Creates network socket
    crit: inert
    conf: 0.4
    if:
      type: syscall
      name: ["socket", "socketcall"]

  - id: syscall-bind
    desc: Binds socket to address/port
    crit: inert
    conf: 0.4
    if:
      type: syscall
      name: ["bind"]

  - id: syscall-listen
    desc: Listens for incoming connections
    crit: inert
    conf: 0.4
    if:
      type: syscall
      name: ["listen"]

  - id: syscall-accept
    desc: Accepts incoming connections
    crit: inert
    conf: 0.4
    if:
      type: syscall
      name: ["accept", "accept4"]

composite_rules:
  - id: server
    desc: Network server - binds and
    conf: 0.6
    crit: inert
    platforms: [linux]
    for: [elf]
    all:
      - id: syscall-socket
      - id: syscall-bind
      - id: syscall-listen

  - id: server-accept
    desc: Network server accepting connections
    conf: 0.6
    crit: inert
    platforms: [linux]
    for: [elf]
    all:
      - id: syscall-socket
      - id: syscall-bind
      - id: syscall-listen
      - id: syscall-accept
