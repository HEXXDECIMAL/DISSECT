# Network Diagnostic Tools Detection
# Benign baseline for ML differentiation

defaults:
  criticality: benign
  confidence: 0.9

traits:
  # === Ping/traceroute ===
  - id: ping
    description: ping command
    condition:
      type: string
      regex: '\bping\s+'

  - id: ping6
    description: ping6 command
    condition:
      type: string
      regex: '\bping6\b'

  - id: traceroute
    description: traceroute command
    condition:
      type: string
      regex: '\btraceroute\b'

  - id: tracepath
    description: tracepath command
    condition:
      type: string
      regex: '\btracepath\b'

  - id: mtr
    description: mtr network diagnostic
    condition:
      type: string
      regex: '\bmtr\b'

  # === DNS tools ===
  - id: nslookup
    description: nslookup command
    condition:
      type: string
      regex: '\bnslookup\b'

  - id: dig
    description: dig DNS command
    condition:
      type: string
      regex: '\bdig\s+'

  - id: host
    description: host DNS command
    condition:
      type: string
      regex: '\bhost\s+'

  # === Connection testing ===
  - id: nc
    description: nc/netcat command
    condition:
      type: string
      regex: '\bnc\s+'

  - id: netcat
    description: netcat command
    condition:
      type: string
      regex: '\bnetcat\b'

  - id: telnet
    description: telnet command
    condition:
      type: string
      regex: '\btelnet\s+'

  # === Traffic capture ===
  - id: tcpdump
    description: tcpdump packet capture
    condition:
      type: string
      exact: tcpdump

  - id: wireshark
    description: Wireshark analyzer
    condition:
      type: string
      exact: wireshark

  - id: tshark
    description: tshark CLI analyzer
    condition:
      type: string
      exact: tshark

  # === Connection info ===
  - id: netstat
    description: netstat command
    condition:
      type: string
      exact: netstat

  - id: ss
    description: ss socket statistics
    condition:
      type: string
      exact: "ss "

  - id: lsof-i
    description: lsof network listing
    condition:
      type: string
      exact: "lsof -i"

  # === Interface info ===
  - id: ifconfig
    description: ifconfig command
    condition:
      type: string
      exact: ifconfig

  - id: ip-addr
    description: ip addr command
    condition:
      type: string
      exact: "ip addr"

  - id: ip-link
    description: ip link command
    condition:
      type: string
      exact: "ip link"

  # === Bandwidth testing ===
  - id: iperf
    description: iperf bandwidth test
    condition:
      type: string
      exact: iperf

  - id: iperf3
    description: iperf3 bandwidth test
    condition:
      type: string
      exact: iperf3

  - id: speedtest
    description: speedtest utility
    condition:
      type: string
      exact: speedtest

  # === Latency testing ===
  - id: hping
    description: hping packet tool
    condition:
      type: string
      exact: hping

  - id: fping
    description: fping fast ping
    condition:
      type: string
      exact: fping

  # === HTTP testing ===
  - id: curl
    description: curl HTTP client
    condition:
      type: string
      exact: "curl "

  - id: wget
    description: wget download utility
    condition:
      type: string
      exact: "wget "

  - id: ab
    description: Apache Bench (ab) tool
    condition:
      type: string
      exact: "ab "

  - id: wrk
    description: wrk HTTP benchmark
    condition:
      type: string
      exact: "wrk "

  # === Firewall: iptables ===
  - id: iptables
    description: iptables command
    condition:
      type: string
      exact: iptables

  - id: ip6tables
    description: ip6tables command
    condition:
      type: string
      exact: ip6tables

  - id: iptables-save
    description: iptables-save command
    condition:
      type: string
      exact: iptables-save

  # === Firewall: nftables ===
  - id: nft
    description: nft command
    condition:
      type: string
      exact: "nft "

  - id: nftables
    description: nftables reference
    condition:
      type: string
      exact: nftables

  # === Firewall: firewalld/ufw ===
  - id: firewall-cmd
    description: firewall-cmd utility
    condition:
      type: string
      exact: firewall-cmd

  - id: firewalld
    description: firewalld service
    condition:
      type: string
      exact: firewalld

  - id: ufw
    description: ufw firewall
    condition:
      type: string
      exact: "ufw "

composite_rules:
  # Network troubleshooting tools
  - id: troubleshoot
    description: Network troubleshooting utilities
    requires_count: 1
    conditions:
      - id: ping
      - id: ping6
      - id: traceroute
      - id: tracepath
      - id: mtr
      - id: nslookup
      - id: dig
      - id: host
      - id: nc
      - id: netcat
      - id: telnet

  # Network monitoring
  - id: monitoring
    description: Network monitoring utilities
    requires_count: 1
    conditions:
      - id: tcpdump
      - id: wireshark
      - id: tshark
      - id: netstat
      - id: ss
      - id: lsof-i
      - id: ifconfig
      - id: ip-addr
      - id: ip-link

  # Network performance
  - id: performance
    description: Network performance testing
    requires_count: 1
    conditions:
      - id: iperf
      - id: iperf3
      - id: speedtest
      - id: hping
      - id: fping
      - id: curl
      - id: wget
      - id: ab
      - id: wrk

  # Firewall management
  - id: firewall
    description: Firewall management utilities
    requires_count: 1
    conditions:
      - id: iptables
      - id: ip6tables
      - id: iptables-save
      - id: nft
      - id: nftables
      - id: firewall-cmd
      - id: firewalld
      - id: ufw
