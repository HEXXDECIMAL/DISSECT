# HTTP Headers
# MBC: C0002 (HTTP Communication)
# ATT&CK: T1071.001

defaults:
  mbc: "C0002"
  attack: "T1071.001"

traits:
  # === User-Agent indicators ===
  - id: ua-mozilla-old
    desc: Old Mozilla 4.0 User-Agent
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "Mozilla/4.0"

  - id: ua-curl
    desc: curl User-Agent
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: '\bcurl/'

  - id: ua-wget
    desc: wget User-Agent
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: '\bWget/'

  - id: ua-python-urllib
    desc: Python urllib User-Agent
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: "Python-urllib"

  # === Authorization header atomic indicators ===
  - id: auth-header
    desc: Authorization header
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "Authorization:"

  - id: bearer-token
    desc: Bearer token authentication
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "Bearer "

  - id: basic-auth
    desc: Basic authentication
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "Basic "

  - id: headers-encoding
    desc: Accept-Encoding header
    crit: inert
    conf: 0.66
    if:
      type: string
      exact: Accept-Encoding

composite_rules:
  - id: headers-auth
    desc: HTTP Authorization header
    crit: notable
    conf: 0.66
    count: 1
    any:
      - id: auth-header
      - id: bearer-token
      - id: basic-auth

  - id: headers-useragent-fake
    desc: Fake or suspicious User-Agent
    crit: suspicious
    conf: 0.66
    count: 1
    any:
      - id: ua-mozilla-old
      - id: ua-curl
      - id: ua-wget
      - id: ua-python-urllib
