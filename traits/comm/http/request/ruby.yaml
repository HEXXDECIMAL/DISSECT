# HTTP Request Operations - Ruby
# MBC: C0002 (HTTP Communication)
# ATT&CK: T1071.001

traits:
  # === Ruby HTTP atomic indicators ===
  - id: net-http
    desc: Net::HTTP module
    crit: notable
    conf: 0.6
    mbc: "C0002"
    attack: "T1071.001"
    if:
      type: string
      exact: "Net::HTTP"

  - id: http-get-ruby
    desc: HTTP.get call
    crit: notable
    conf: 0.6
    mbc: "C0002"
    attack: "T1071.001"
    if:
      type: string
      regex: "HTTP\\.get"

  - id: open-uri
    desc: open-uri module
    crit: notable
    conf: 0.6
    mbc: "C0002"
    attack: "T1071.001"
    if:
      type: string
      exact: "open-uri"

  - id: ruby-http-get-response
    desc: HTTP GET request
    crit: notable
    conf: 0.92
    platforms: [all]
    for: [ruby]
    if:
      type: string
      regex: 'Net::HTTP\.get_response|Net::HTTP\.get'

  - id: ruby-http-client
    desc: HTTP client usage
    crit: notable
    conf: 0.88
    platforms: [all]
    for: [ruby]
    if:
      type: string
      regex: 'Net::HTTP'

composite_rules:
  - id: request-ruby
    desc: HTTP requests (Ruby)
    crit: notable
    conf: 0.75
    mbc: "C0002"
    attack: "T1071.001"
    count_min: 1
    any:
      - id: net-http
      - id: http-get-ruby
      - id: open-uri

  - id: ruby-http-request-notable
    desc: HTTP client with notable confidence
    crit: notable
    conf: 0.90
    count_min: 1
    any:
      - id: ruby-http-get-response
      - id: ruby-http-client
