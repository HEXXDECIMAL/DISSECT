# DNS Lookup Operations
# MBC: C0011 (DNS Communication)
# ATT&CK: T1071.004

defaults:
  for: [elf, macho, so, dylib, c]

traits:
  - id: lookup
    desc: Uses DNS (Domain Name Service)
    crit: inert
    conf: 0.66
    mbc: "C0011"
    attack: "T1071.004"
    if:
      type: symbol
      pattern: res_query|res_search|getaddrinfo|gethostbyname

  - id: lookup-resolv
    desc: Reads DNS resolver configuration
    crit: inert
    conf: 0.66
    if:
      type: string
      exact: resolv.conf

  # === Reverse lookup atomic indicators ===
  - id: in-addr-arpa
    desc: in-addr.arpa reverse lookup
    crit: inert
    conf: 0.56
    if:
      type: string
      exact: ".in-addr.arpa"

  - id: ip6-arpa
    desc: ip6.arpa reverse lookup
    crit: inert
    conf: 0.56
    if:
      type: string
      exact: "ip6.arpa"

  - id: lookup-txt
    desc: DNS TXT record queries
    crit: notable
    conf: 0.66
    if:
      type: yara
      source: |
        rule dns_txt {
          strings:
            // DNS TXT record type constant or query patterns
            $txt_query1 = "TXT record" ascii nocase
            $txt_query2 = "query TXT" ascii nocase
            $txt_query3 = "DNS_TYPE_TXT" ascii
            $txt_query4 = "T_TXT" ascii
            $txt_query5 = "ns_t_txt" ascii
          condition:
            any of ($txt_query*)
        }

composite_rules:
  # Reverse lookup composite
  - id: lookup-reverse
    desc: Reverse DNS lookup
    crit: inert
    conf: 0.66
    count: 1
    any:
      - id: in-addr-arpa
      - id: ip6-arpa
