# DNS Lookup Operations
# MBC: C0011 (DNS Communication)
# ATT&CK: T1071.004

defaults:
  file_types: [elf, macho, so, dylib, c]

traits:
  - id: lookup
    description: Uses DNS (Domain Name Service)
    criticality: inert
    confidence: 0.66
    mbc: "C0011"
    attack: "T1071.004"
    condition:
      type: symbol
      pattern: res_query|res_search|getaddrinfo|gethostbyname

  - id: lookup-resolv
    description: Reads DNS resolver configuration
    criticality: inert
    confidence: 0.66
    condition:
      type: string
      exact: resolv.conf

  # === Reverse lookup atomic indicators ===
  - id: in-addr-arpa
    description: in-addr.arpa reverse lookup
    criticality: inert
    confidence: 0.56
    condition:
      type: string
      exact: ".in-addr.arpa"

  - id: ip6-arpa
    description: ip6.arpa reverse lookup
    criticality: inert
    confidence: 0.56
    condition:
      type: string
      exact: "ip6.arpa"

  - id: lookup-txt
    description: DNS TXT record queries
    criticality: notable
    confidence: 0.66
    condition:
      type: yara
      source: |
        rule dns_txt {
          strings:
            // DNS TXT record type constant or query patterns
            $txt_query1 = "TXT record" ascii nocase
            $txt_query2 = "query TXT" ascii nocase
            $txt_query3 = "DNS_TYPE_TXT" ascii
            $txt_query4 = "T_TXT" ascii
            $txt_query5 = "ns_t_txt" ascii
          condition:
            any of ($txt_query*)
        }

composite_rules:
  # Reverse lookup composite
  - id: lookup-reverse
    description: Reverse DNS lookup
    criticality: inert
    confidence: 0.66
    requires_count: 1
    conditions:
      - id: in-addr-arpa
      - id: ip6-arpa
