defaults:
  for:
  - all
traits:
- id: repo
  desc: Chisel repository URL
  crit: suspicious
  conf: 1.0
  attack: T1090
  if:
    type: string
    substr: github.com/jpillora/chisel
    case_insensitive: true
- id: func
  desc: Chisel function name
  crit: suspicious
  conf: 0.9
  attack: T1090
  if:
    type: string
    regex: Chisel(Client|Server)
- id: keyword
  desc: Chisel keyword
  crit: notable
  conf: 0.6
  if:
    type: string
    word: chisel
    case_insensitive: true
- id: mode-1
  desc: Chisel mode (reverse/socks5 with tunnel/proxy/forward)
  if:
    type: string
    regex: (?i)(reverse|socks5)[_-]?(tunnel|proxy|forward)
- id: mode-2
  desc: Chisel mode (reverse/socks5 with server/port/mode)
  if:
    type: string
    regex: (?i)(reverse|socks5)[_-]?(server|port|mode)
- id: mode-3
  desc: Chisel mode (proxy with tunnel/proxy/forward)
  if:
    type: string
    regex: (?i)proxy[_-]?(tunnel|proxy|forward)
- id: mode-4
  desc: Chisel mode (proxy with server/port/mode)
  if:
    type: string
    regex: (?i)proxy[_-]?(server|port|mode)
composite_rules:
- id: mode
  desc: Chisel mode indicators
  crit: inert
  any:
    - id: mode-1
    - id: mode-2
    - id: mode-3
    - id: mode-4
- id: keyword-with-mode
  desc: Chisel keyword with tunneling mode
  crit: suspicious
  conf: 0.8
  attack: T1090
  all:
  - id: keyword
  - id: mode
- id: chisel-detected
  desc: Chisel tunneling tool detected
  crit: notable
  conf: 0.95
  attack: T1090
  any:
  - id: repo
  - id: func
  - id: keyword-with-mode
