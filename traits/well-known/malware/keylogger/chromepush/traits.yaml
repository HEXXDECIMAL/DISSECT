# CHROMEPUSH Keylogger Detection
# UNC1069 keylogger with clipboard capture
# Source: Google Threat Intelligence Group (GTIG)

defaults:
  platforms: [macos]
  for: [macho]

traits:
  # Atomic indicators
  - id: data-js-success
    desc: Data.js file creation success message
    crit: suspicious
    conf: 0.85
    if:
      type: string
      exact: "OK: Create data.js success"

composite_rules:
  # Strict CHROMEPUSH detection
  - id: chromepush-strict
    desc: CHROMEPUSH keylogger (exact match)
    crit: hostile
    conf: 1.0
    attack: "T1056.001"
    needs: 5
    all:
      - id: micro-behaviors/hardware/input/keylog::keylog-filename-pattern
      - id: micro-behaviors/hardware/input/keylog::clipboard-capture-pattern
      - id: micro-behaviors/hardware/input/keylog::mouse-state-tracking
      - id: micro-behaviors/hardware/input/keylog::evt-marker-file
      - id: data-js-success

  # Generalized keylogger with clipboard
  - id: keylogger-clipboard-stealer
    desc: Keylogger with clipboard and mouse tracking
    crit: hostile
    conf: 0.95
    attack: "T1056.001"
    all:
      - id: micro-behaviors/hardware/input/keylog::keylogger-with-clipboard
      - id: micro-behaviors/hardware/input/keylog::evt-marker-file
    any:
      - id: micro-behaviors/fs/path/library::hidden-library-caches
      - id: micro-behaviors/fs/path/temp::tmp-hidden-file

  # Keylogger with structured data output
  - id: structured-keylogger
    desc: Keylogger with structured timestamped output
    crit: hostile
    conf: 0.95
    attack: "T1056.001"
    needs: 2
    any:
      - id: micro-behaviors/hardware/input/keylog::keylog-filename-pattern
      - id: micro-behaviors/hardware/input/keylog::clipboard-capture-pattern
      - id: micro-behaviors/hardware/input/keylog::mouse-state-tracking
