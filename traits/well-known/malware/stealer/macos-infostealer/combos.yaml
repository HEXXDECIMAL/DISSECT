# macOS Information Stealer Detection
# Detects macOS-specific information stealer patterns
# Combines hardware fingerprinting, credential targeting, and network exfiltration

composite_rules:
  # Hardware fingerprint + network = tracking/identification
  - id: fingerprint-with-exfil
    desc: "macOS hardware fingerprinting network exfiltration"
    crit: suspicious
    conf: 0.9
    attack: "T1082"
    mbc: "B0001.009"
    for: [macho]
    all:
      - id: objectives/discovery/host/fingerprint::macos-hardware-uuid
    any:
      - id: micro-behaviors/communications/socket/create
      - id: micro-behaviors/communications/download/curl

  # Credential targeting + hardware fingerprinting = stealer
  - id: credential-stealer-macos
    desc: "macOS credential stealer"
    crit: hostile
    conf: 0.95
    attack: "T1555"
    mbc: "B0028"
    for: [macho]
    all:
      - id: objectives/discovery/host/fingerprint::macos-hardware-uuid
      - id: objectives/credential-access/validation/check::csidentity-password-auth
      - id: objectives/collection/file-targeting/filter::credential-files
      - id: micro-behaviors/communications/socket/create

  # Full stealer pattern: fingerprint + targeting + obfuscation + network
  - id: comprehensive-stealer-macos
    desc: "Comprehensive macOS information stealer"
    crit: hostile
    conf: 0.98
    attack: "T1555"
    mbc: "B0028"
    for: [macho]
    all:
      - id: objectives/discovery/host/fingerprint::macos-hardware-uuid
      - id: objectives/anti-static/obfuscation/encoding::string-decrypt
      - id: objectives/credential-access/validation/check::csidentity-password-auth
      - id: objectives/collection/file-targeting/filter::credential-files
