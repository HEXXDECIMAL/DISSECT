traits:
  - id: evil-bpf-struct
    desc: EvilBPF data_event structure definition
    crit: suspicious
    conf: 0.95
    for: [c]
    if:
      type: raw
      regex: '(?s)struct\s+data_event\s*\{.*?ssl_op_t\s+op;.*?char\s+data\[MAX_DATA_LEN\];'

  - id: evil-bpf-header-guard
    desc: EvilBPF header guard
    crit: suspicious
    conf: 0.8
    for: [c]
    if:
      type: raw
      regex: '#ifndef\s+__STRUCTS_BPF_H'

  - id: evil-bpf-comment
    desc: EvilBPF specific comment
    crit: suspicious
    conf: 0.95
    for: [c]
    if:
      type: raw
      regex: '(?i)Struct for passing data from kernel to user space'

composite_rules:
  - id: evil-bpf-sniffer
    desc: EvilBPF SSL Sniffer
    crit: hostile
    conf: 0.98
    for: [c]
    any:
      - id: evil-bpf-struct
      - id: evil-bpf-comment
    all:
      - id: evil-bpf-header-guard
