defaults:
  for: [all]

traits:
  - id: package-marker
    desc: VXShell-specific Go package marker
    crit: suspicious
    conf: 1.0
    for: [macho, elf]
    if:
      type: symbol
      regex: "vxshell/src/common"

  - id: resolve-ip
    desc: VXShell IP resolution ticker function
    crit: suspicious
    conf: 1.0
    for: [macho, elf]
    if:
      type: symbol
      exact: "_vxshell/src/common.TickerResolveIP"

  - id: c2-ip
    desc: VXShell C2 server IP address
    crit: suspicious
    conf: 0.9
    if:
      type: string
      substr: "167.99.64.84"

  - id: shell-start
    desc: VXShell shell start function
    crit: suspicious
    conf: 1.0
    for: [macho, elf]
    if:
      type: symbol
      regex: "vxshell/src/common/shell.{0,50}Start"

  - id: socks-start
    desc: VXShell SOCKS start function
    crit: suspicious
    conf: 1.0
    for: [macho, elf]
    if:
      type: symbol
      regex: "vxshell/src/common/socks.{0,50}Start"

composite_rules:
  - id: indicators
    desc: VXShell operational indicators
    any:
      - id: resolve-ip
      - id: c2-ip

  - id: detected
    desc: VXShell multi-functional backdoor detected
    crit: hostile
    mbc: "B0030" # Remote Access
    attack: "T1071" # Application Layer Protocol
    all:
      - id: package-marker
      - id: indicators
      - id: shell-start
      - id: socks-start