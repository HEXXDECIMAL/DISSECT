# Kinsing Competing Malware Elimination
# Detects patterns where Kinsing targets and kills competing malware
# Indicates botnet turf wars and exclusive infection strategy
# ATT&CK: T1531 (Account Access Removal)
# MBC: B0025 (Execution)

traits:
  # === Malware Family Identifiers ===
  # Removed malware-xmrig-target duplicate - use xmrig::xmrig-lower
  # Removed malware-minerd-target duplicate - use dropper/hadooken::minerd-tool
  # Removed malware-cpuminer-target duplicate - use dropper/hadooken::cpuminer-tool

  - id: malware-watchdog-target
    desc: Watchdog botnet targeting
    crit: inert
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      regex: "watchdog\\s+(process|service|daemon)"

  - id: malware-mirai-target
    desc: Mirai botnet targeting
    crit: inert
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "mirai"

  - id: malware-update-agent-target
    desc: Update agent/software targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "sysupdate"

  # Removed malware-generic-crypto-target duplicate - use micro-traits/data/text/keywords::crypto-word

  # === Kill Command Patterns ===
  - id: systemctl-grep-malware
    desc: Systemd service targeting
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl list-units"
    attack: "T1531"

  # === Systemd Service Targeting ===
  - id: systemd-stop-xmrig
    desc: Systemd stop XMRig service
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl stop"
    attack: "T1531"

  - id: systemd-disable-malware
    desc: Systemd disable malware services
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl disable"
    attack: "T1531"

composite_rules:
  - id: malware-target-list
    desc: List of competing malware targets
    for: [elf, shell]
    any:
      - id: well-known/malware/miner/xmrig::xmrig-lower
      - id: well-known/malware/dropper/hadooken::minerd-tool
      - id: well-known/malware/dropper/hadooken::cpuminer-tool
      - id: malware-watchdog-target
      - id: malware-mirai-target
      - id: malware-update-agent-target
      - id: micro-traits/data/text/keywords::crypto-word

  - id: process-kill-methods
    desc: Methods for killing processes
    any:
      - id: objectives/anti-forensics/self-delete/process::pkill-deleted-pattern
      - id: objectives/anti-forensics/self-delete/process::proc-exe-deleted-search

  - id: systemd-service-targeting
    desc: Systemd service stop/disable patterns
    all:
      - id: systemd-stop-xmrig
      - id: systemd-disable-malware

  - id: kinsing-eliminate-xmrig
    desc: Kinsing killing XMRig/competing miners
    crit: suspicious
    conf: 0.95
    for: [elf, shell]
    attack: "T1531"
    mbc: "B0025"
    all:
      - id: kinsing-identifier
      - id: malware-target-list
        needs: 3
      - id: process-kill-methods

  - id: kinsing-service-elimination
    desc: Kinsing eliminating competing malware services
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1531"
    all:
      - id: systemctl-grep-malware
      - id: malware-target-list
        needs: 2

  - id: kinsing-aggressive-cleanup
    desc: Kinsing aggressive process cleanup with service targeting
    crit: hostile
    conf: 0.9
    for: [elf, shell]
    attack: "T1531"
    mbc: "B0025"
    all:
      - id: kinsing-identifier
      - id: objectives/anti-forensics/self-delete/process::proc-exe-deleted-search
      - id: systemctl-grep-malware
      - id: malware-target-list
        needs: 4
