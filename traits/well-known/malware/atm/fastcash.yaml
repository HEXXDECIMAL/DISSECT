# FastCash ATM Malware
# Detects FastCash malware used in ATM cashout schemes (Hidden Cobra/Lazarus)
# ATT&CK: T1083 (File and Directory Discovery), T1055 (Process Injection)
# MBC: B0022 (Process Injection)

defaults:
  for: [all]
  attack: "T1055"
  mbc: "B0022"

traits:
  - id: iso8583-msg-ref
    desc: ISO 8583 financial transaction library reference
    crit: suspicious
    if:
      type: string
      exact: "DL_ISO8583_MSG_"

  - id: iso8583-defs-ref
    desc: ISO 8583 financial transaction library reference
    crit: suspicious
    if:
      type: string
      exact: "DL_ISO8583_DEFS_"

  - id: fastcash-myfc-class
    desc: FastCash MyFc C++ class symbol
    crit: suspicious
    conf: 0.95
    if:
      type: string
      regex: 'ZN4MyFc'

  - id: fastcash-log-transaction
    desc: FastCash transaction logging string
    crit: suspicious
    conf: 0.9
    if:
      type: string
      regex: 'LogTransactionPhS'

  - id: subhook-lib-ref
    desc: Subhook hooking library reference
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: 'subhook_(install|remove|new|free)'

composite_rules:
  - id: iso8583-lib-ref
    desc: ISO 8583 financial transaction library reference
    crit: suspicious
    any:
      - id: iso8583-msg-ref
      - id: iso8583-defs-ref

  - id: fastcash-atm-injector
    desc: FastCash ATM malware injector
    crit: hostile
    conf: 1.0
    all:
      - id: iso8583-lib-ref
      - id: fastcash-myfc-class
      - id: fastcash-log-transaction
      - id: subhook-lib-ref
