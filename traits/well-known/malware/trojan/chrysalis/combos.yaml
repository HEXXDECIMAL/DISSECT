# Known Malware: Chrysalis Detection
# Composite rules for identifying Chrysalis trojan

composite_rules:
  - id: detected
    desc: Chrysalis trojan detected
    crit: hostile
    conf: 0.85
    for: ["pe", "dll"]
    all:
      - id: well-known/malware/trojan/chrysalis::log-init-export
      - id: objectives/execution/native/runtime::debugger-detect-api
      - id: micro-traits/process/terminate/kill::terminate-process
      - id: objectives/execution/reflection/class::dynamic-load-pattern

  - id: detected-minimal
    desc: Chrysalis trojan minimal signature
    crit: suspicious
    conf: 0.75
    for: ["pe", "dll"]
    all:
      - id: well-known/malware/trojan/chrysalis::log-init-export
      - id: well-known/malware/trojan/chrysalis::log-track-event-export
      - id: well-known/malware/trojan/chrysalis::log-write-export

  - id: full-chain
    desc: Chrysalis with anti-analysis and payload
    crit: hostile
    conf: 0.90
    for: ["pe", "dll"]
    all:
      - id: well-known/malware/trojan/chrysalis::detected-minimal
      - id: objectives/anti-static/obfuscation/packing::payload-unpacking
