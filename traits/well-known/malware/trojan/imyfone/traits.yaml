defaults:
  for: [all]

traits:
  - id: imyfone-bundle-id
    desc: iMyFone bundle identifier
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: 'MF\.iMyFone|com\.imyfone'

  - id: imyfone-pid-key
    desc: iMyFone PID configuration key
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: '<key>PID</key>\s*<string>p\d+</string>'

  - id: imyfone-first-enter-key
    desc: iMyFone FirstEnter configuration key
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: '<key>FirstEnter</key>\s*<string>1</string>'

  - id: qt-framework-id-1
    desc: Qt Framework Bundle ID (Core/Gui/Network/PrintSupport)
    if:
      type: raw
      regex: 'org\.qt-project\.Qt(Core|Gui|Network|PrintSupport)'

  - id: qt-framework-id-2
    desc: Qt Framework Bundle ID (Svg/Widgets/Xml)
    if:
      type: raw
      regex: 'org\.qt-project\.Qt(Svg|Widgets|Xml)'

  - id: qt-legacy-version-5-6
    desc: Qt Legacy Version 5.6 (EOL 2019)
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: '<string>5\.6\.3?</string>'

  - id: qt-qmake-generator
    desc: Qt/QMake generator string
    crit: inert
    conf: 1.0
    if:
      type: raw
      regex: 'Created by Qt/QMake'

  - id: apple-build-info
    desc: Apple Build Information (DTPlatformBuild/DTXcode)
    crit: inert
    conf: 1.0
    if:
      type: raw
      regex: '(DTPlatformBuild|DTXcode)'

  - id: imyfone-feedback-bundle-id
    desc: iMyFone Feedback bundle identifier
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: 'MF\.iMyFone Feedback'

  - id: imyfone-removedir-bundle-id
    desc: iMyFone RemoveDir bundle identifier
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: 'MF\.RemoveDir'

  - id: imyfone-crashreport-bundle-id
    desc: iMyFone CrashReport bundle identifier
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: 'iMyfone\.crashReport'

  - id: imyfone-hidden-agent-config
    desc: iMyFone Hidden Agent Configuration
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: '<key>LSUIElement</key>\s*<true/>'

  - id: imyfone-app-delegate
    desc: iMyFone Application Delegate Class
    crit: notable
    conf: 1.0
    if:
      type: raw
      regex: 'MFAppDelegate'

  - id: imyfone-exploit-string
    desc: iMyFone Exploit String (limera1n)
    crit: suspicious
    conf: 1.0
    if:
      type: raw
      regex: 'exploiting with limera1n'

composite_rules:
  - id: qt-framework-id
    desc: Qt Framework Bundle ID
    crit: inert
    any:
      - id: qt-framework-id-1
      - id: qt-framework-id-2

  - id: imyfone-app-detected
    desc: Suspicious iMyFone Application (Riskware/PUA)
    crit: notable
    conf: 0.8
    any:
      - id: imyfone-bundle-id
      - id: imyfone-removedir-bundle-id
      - id: imyfone-crashreport-bundle-id
      - id: metadata/signed/developer::K889Z3PDP3
      - id: imyfone-pid-key
      - id: imyfone-app-delegate
      - id: imyfone-exploit-string

  - id: imyfone-ui-nib
    desc: iMyFone UI Component (NIB)
    crit: notable
    conf: 1.0
    all:
      - id: imyfone-app-delegate
      - id: metadata/format/magic::bplist

  - id: trojan-qt-framework-signed-imyfone
    desc: Trojanized Qt Framework (Signed by iMyFone)
    crit: suspicious
    conf: 1.0
    for: [macho]
    all:
      - id: qt-framework-id
      - id: metadata/signed/developer::K889Z3PDP3

  - id: suspicious-qt-plist-legacy-qmake
    desc: Suspicious Legacy Qt Info.plist (Qt 5.6 + QMake + No Build Info)
    crit: suspicious
    conf: 0.6
    all:
      - id: qt-framework-id
      - id: qt-legacy-version-5-6
      - id: qt-qmake-generator
    not:
      - id: apple-build-info

  - id: imyfone-feedback-agent
    desc: iMyFone Feedback Agent (Hidden Component)
    crit: suspicious
    conf: 1.0
    all:
      - id: imyfone-feedback-bundle-id
      - id: imyfone-hidden-agent-config

  - id: imyfone-removedir-agent
    desc: iMyFone RemoveDir Agent (Hidden Component)
    crit: suspicious
    conf: 1.0
    all:
      - id: imyfone-removedir-bundle-id
      - id: imyfone-hidden-agent-config

  - id: imyfone-crashreport-agent
    desc: iMyFone CrashReport Agent (Hidden Component)
    crit: suspicious
    conf: 1.0
    all:
      - id: imyfone-crashreport-bundle-id
      - id: imyfone-hidden-agent-config

  - id: imyfone-fixos-tool
    desc: iMyFone FixOS Tool (Exploit Capability)
    crit: suspicious
    conf: 1.0
    all:
      - id: metadata/signed/developer::K889Z3PDP3
      - id: imyfone-exploit-string
