# Detection for specific macOS C++ Stealer family
# Sample: e934c1cbb... (Application.app)

defaults:
  for: [macho]
  platforms: [macos]
  crit: hostile
  conf: 0.95

composite_rules:
  - id: macos-cpp-stealer-copy-logic
    desc: "MacOS C++ Stealer with custom directory copying logic"
    all:
      - id: objectives/credential-access/stealer/native/symbols::copy-directory-with-exclusions
    any:
      - id: micro-traits/process/create/shell::shell-execution
      - id: objectives/persist/daemon/init::unix-daemon-persistence
      - id: objectives/lateral-movement/social-engineering/masquerading::generic-bundle-id-pattern
      - id: metadata/signed/id::com.utils.application
      - id: metadata/entitlements::highly-privileged

  - id: macos-cpp-stealer-masquerade
    desc: "MacOS C++ Stealer masquerading as generic utility"
    all:
      - id: metadata/signed/id::com.utils.application
      - id: metadata/signed/adhoc::unsigned
      - id: objectives/credential-access/stealer/native/symbols::copy-directory-with-exclusions
