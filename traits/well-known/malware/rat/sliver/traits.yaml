# Malware Family - Sliver C2 Framework
# Reference: https://github.com/BishopFox/sliver
# ATT&CK: T1071 (Application Layer Protocol)

defaults:
  for: [all]

traits:
  # === Atomic Traits (for ML decomposition) ===

  - id: sliverpb
    desc: Sliver protobuf package reference
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    platforms: [all]
    for: [elf, macho, pe, go]
    if:
      type: string
      substr: "sliverpb"

  - id: bishopfox
    desc: BishopFox vendor reference
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    platforms: [all]
    for: [elf, macho, pe, go]
    if:
      type: string
      substr: "bishopfox"

  - id: proto-ref
    desc: Sliver proto definition reference
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    platforms: [all]
    for: [elf, macho, pe, go]
    if:
      type: string
      substr: "sliver.proto"

  - id: implant-builds
    desc: Sliver implant build function
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    platforms: [all]
    for: [elf, macho, pe, go]
    if:
      type: string
      substr: "GetImplantBuilds"

  - id: beacon-jitter
    desc: Sliver beacon jitter function
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    platforms: [all]
    for: [elf, macho, pe, go]
    if:
      type: string
      substr: "GetBeaconJitter"

  - id: obfuscate-symbols
    desc: Sliver symbol obfuscation function
    crit: suspicious
    conf: 0.9
    attack: "T1027"
    platforms: [all]
    for: [elf, macho, pe, go]
    if:
      type: string
      substr: "GetObfuscateSymbols"

  - id: beacon-id
    desc: Sliver beacon ID function
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    platforms: [all]
    for: [elf, macho, pe, go]
    if:
      type: string
      substr: "GetBeaconID"

  # === Obfuscated variant traits ===

  - id: coredump
    desc: Sliver CoreDump reference
    crit: suspicious
    conf: 0.6
    attack: "T1071"
    platforms: [linux]
    for: [elf]
    if:
      type: string
      substr: ".CoreDump"

  - id: gvisor-gso
    desc: Sliver gVisor GSO capability check
    crit: suspicious
    conf: 0.7
    attack: "T1071"
    platforms: [linux]
    for: [elf]
    if:
      type: string
      substr: "HasGvisorGSOCapability"

  - id: set-spoofing
    desc: Sliver spoofing function
    crit: suspicious
    conf: 0.7
    attack: "T1090"
    platforms: [all]
    if:
      type: string
      substr: "SetSpoofing"

composite_rules:
  # Main Sliver detection via explicit markers
  - id: sliver-detected
    desc: Sliver C2 framework implant
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    mbc: "B0030"
    for: [elf, macho, pe, go]
    needs: 2
    any:
      - id: sliverpb
      - id: bishopfox
      - id: proto-ref
      - id: implant-builds
      - id: beacon-jitter
      - id: beacon-id

  # Sliver functions detection
  - id: functions-detected
    desc: Sliver C2 implant functions
    crit: suspicious
    conf: 0.95
    mbc: "B0030"
    attack: "T1071"
    for: [elf, macho, pe, go]
    needs: 2
    any:
      - id: implant-builds
      - id: beacon-jitter
      - id: obfuscate-symbols
      - id: beacon-id

  # Obfuscated variant detection via YARA (needs filesize constraints)
  - id: obfuscated-detected
    desc: Sliver C2 obfuscated Linux implant
    crit: suspicious
    conf: 0.9
    mbc: "B0030"
    attack: "T1071"
    platforms: [linux]
    for: [elf]
    all:
      - id: coredump
      - id: gvisor-gso
      - id: micro-behaviors/comm/proxy/library::proxy-func
      - id: set-spoofing
