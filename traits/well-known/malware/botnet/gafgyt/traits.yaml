# Malware Family - Gafgyt IoT Botnet
# Reference: https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/gafgyt
# ATT&CK: T1583.005 (Botnet)

traits:
  # Removed botkill-string duplicate - use objectives/command-and-control/botkill/competitor::botkill
  # Removed cpu-sysfs-path duplicate - use micro-behaviors/hw/cpu/info::sys-devices
  # Removed udp-flood-string duplicate - use objectives/impact/ddos/udp::udp-flood

  - id: syn-flood-string
    desc: syn_flood function name
    crit: notable
    conf: 0.7
    for: [elf]
    if:
      type: string
      substr: "syn_flood"

  - id: ack-flood-string
    desc: ack_flood function name
    crit: notable
    conf: 0.7
    for: [elf]
    if:
      type: string
      substr: "ack_flood"

composite_rules:
  - id: flood-functions
    desc: DDoS flood function names
    crit: notable
    conf: 0.7
    for: [elf]
    attack: T1498
    any:
      - id: objectives/impact/ddos/udp::udp-flood
      - id: objectives/impact/ddos/tcp::tcpraw-flood
      - id: syn-flood-string
      - id: ack-flood-string

  - id: gafgyt-strings
    desc: Gafgyt botnet string indicators (3+
    crit: suspicious
    conf: 0.8
    for: [elf]
    needs: 3
    any:
      - id: objectives/command-and-control/botkill/competitor::botkill
      - id: micro-behaviors/process/create/shell::bin-bash
      - id: micro-behaviors/hw/cpu/info::sys-devices
      - id: objectives/impact/ddos/udp::udp-flood
      - id: objectives/impact/ddos/tcp::tcpraw-flood
      - id: syn-flood-string
      - id: ack-flood-string

  - id: detected
    desc: Gafgyt IoT botnet detection (botkill
    crit: suspicious
    conf: 0.95
    for: [elf]
    attack: T1583.005
    mbc: OB0004
    all:
      - id: objectives/command-and-control/botkill/competitor::botkill
      - id: gafgyt-strings
      - id: metadata/format::small-elf-binary

  - id: ddos-capability
    desc: Gafgyt DDoS capability
    crit: suspicious
    conf: 0.95
    for: [elf]
    attack: T1498
    mbc: B0008
    needs: 2
    any:
      - id: objectives/impact/ddos/udp::udp-flood
      - id: objectives/impact/ddos/tcp::tcpraw-flood
      - id: syn-flood-string
      - id: ack-flood-string
