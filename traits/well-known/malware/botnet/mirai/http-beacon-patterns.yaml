# Mirai HTTP C2 Beacon Patterns
# Detects Mirai-specific HTTP communication patterns including
# malformed HTTP requests and command strings

defaults:
  crit: suspicious
  for: [elf]
  platforms: [linux]

traits:
  # Mirai "GET/dlr" downloader beacon - highly specific
  - id: get-dlr-beacon
    desc: Mirai downloader beacon pattern
    crit: suspicious
    conf: 0.92
    attack: "T1071.001"
    mbc: "C0002"
    if:
      type: string
      exact: "GET/dlr."

  # Mirai TAKE command - bot acknowledgment
  - id: take-command
    desc: Mirai TAKE command string
    crit: suspicious
    conf: 0.85
    if:
      type: string
      exact: "TAKE"

  # Malformed HTTP GET patterns (no space after method)
  - id: malformed-http-get
    desc: Malformed HTTP GET request
    crit: notable
    conf: 0.75
    if:
      type: string
      regex: "GET/[a-z]{2,8}\\."

composite_rules:
  - id: mirai-http-c2-beacon
    desc: Mirai HTTP C2 beacon
    crit: hostile
    conf: 0.95
    mbc: "C0002"
    attack: "T1071.001"
    all:
      - id: get-dlr-beacon
      - id: micro-traits/fs/proc/info::proc-net-tcp

  - id: mirai-command-protocol
    desc: Mirai C2 command protocol
    crit: suspicious
    conf: 0.88
    mbc: "C0002"
    attack: "T1071.001"
    needs: 2
    any:
      - id: take-command
      - id: get-dlr-beacon
      - id: malformed-http-get
