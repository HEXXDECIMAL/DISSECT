# File Open Operations - Python
# MBC: C0046 (Create File)
# ATT&CK: T1005

traits:
  - id: generic
    desc: "Opens a file"
    crit: inert
    conf: 0.9
    for: [python]
    if:
      type: string
      regex: '\bopen\('

  # In-place binary file modification (common in ransomware)
  - id: binary-rw
    desc: "In-place binary file modification"
    crit: notable
    conf: 0.85
    for: [python]
    if:
      type: content
      regex: "open\\([^)]*['\"]r\\+b['\"]"

  # Sensitive file paths (browser/wallet)
  - id: cookies-path
    desc: Browser cookies file
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "Cookies"

  - id: key4-db-path
    desc: Firefox key database
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "key4.db"

  - id: exodus-wallet-path
    desc: Exodus cryptocurrency wallet
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "exodus.wallet"

  - id: wallet-dat-path
    desc: Bitcoin wallet.dat file
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "wallet.dat"

composite_rules:
  # Helper: Any sensitive file path
  - id: sensitive-paths
    desc: Browser or wallet file paths
    any:
      - id: obj/creds/browser/chromium/login-data
      - id: cookies-path
      - id: key4-db-path
      - id: exodus-wallet-path
      - id: wallet-dat-path

  - id: sensitive-path
    desc: Accesses sensitive browser or wallet
    crit: suspicious
    conf: 0.95
    for: [python]
    all:
      - id: generic
      - id: sensitive-paths
