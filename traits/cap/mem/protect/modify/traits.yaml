# Memory Protection Modification
# Memory protection and access control changes

defaults:
  for: ["pe", "dll"]
  platforms: ["windows"]

traits:
  # === Memory Protection Changes ===
  - id: virtual-protect
    desc: Modify memory page protection
    crit: suspicious
    conf: 0.95
    attack: "T1222.001"
    mbc: "C0021"
    if:
      type: symbol
      exact: "VirtualProtect"

  - id: virtual-protect-ex
    desc: Extended memory protection modification
    crit: suspicious
    conf: 0.95
    attack: "T1222.001"
    if:
      type: symbol
      exact: "VirtualProtectEx"
    downgrade:
      any:
        - type: string
          substr: "Valve Corp."

  - id: virtual-alloc
    desc: Allocate virtual memory
    crit: notable
    conf: 0.90
    attack: "T1587.001"
    if:
      type: symbol
      exact: "VirtualAlloc"

  - id: virtual-alloc-ex
    desc: Allocate virtual memory in process
    crit: notable
    conf: 0.90
    attack: "T1587.001"
    if:
      type: symbol
      exact: "VirtualAllocEx"

  - id: virtual-free
    desc: Free virtual memory
    crit: inert
    conf: 0.90
    if:
      type: symbol
      exact: "VirtualFree"

  # virtual-query: use cap/mem/query/info::virtualquery (canonical namespace)
