# macOS Hardware Discovery
# ATT&CK: T1082 (System Information Discovery)
# MBC: E1082

defaults:
  platforms: [macos]
  for: [shell, macho]
  attack: "T1082"
  mbc: "E1082"

traits:
  - id: sysctl-hw-model
    desc: Query hardware model via sysctl
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: "sysctl\\s+-n\\s+hw\\.model"

  - id: sysctl-cpu-brand
    desc: Query CPU brand string via sysctl
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: "sysctl\\s+-n\\s+machdep\\.cpu\\.brand_string"

  - id: sw-vers-product
    desc: Query macOS version via sw_vers
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: "sw_vers\\s+--?ProductVersion"

  - id: ioreg-screen-lock
    desc: Check screen lock status via ioreg
    crit: suspicious
    conf: 0.85
    if:
      type: string
      substr: "CGSSessionScreenIsLocked"

composite_rules:
  - id: system-profiling
    desc: Comprehensive macOS system profiling
    crit: suspicious
    conf: 0.9
    needs: 2
    any:
      - id: sysctl-hw-model
      - id: sysctl-cpu-brand
      - id: sw-vers-product
