traits:
    - id: random-code-generation
      desc: Detects random code generation via Math.random
      crit: suspicious
      conf: 1.0
      attack: T1027
      mbc: B0032
      if:
        type: raw
        regex: "(?s)(Math\\.random\\(\\).*?new Function|new Function.*?Math\\.random\\(\\)|Math\\.random\\(\\).*?eval\\(|eval\\(.*?Math\\.random\\(\\))"
  
    - id: math-random-index
      desc: Math.random used for indexing (probabilistic character selection)
      crit: suspicious
      conf: 1.0
      attack: T1027
      mbc: B0032
      if:
        type: ast
        language: javascript
        query: |
          (subscript_expression
            index: (call_expression
              function: (member_expression
                object: (identifier) @math
                property: (property_identifier) @floor
                (#eq? @math "Math")
                (#eq? @floor "floor")
              )
              arguments: (arguments
                (binary_expression
                  left: (call_expression
                    function: (member_expression
                      object: (identifier) @math2
                      property: (property_identifier) @random
                      (#eq? @math2 "Math")
                      (#eq? @random "random")
                    )
                  )
                )
              )
            )
          )
  