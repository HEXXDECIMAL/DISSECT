# macOS HTTP Dropper Patterns (NSURLSession-based)
# Detects download framework patterns used for payload staging
# ATT&CK: T1105 (Ingress Tool Transfer)
# MBC: E1105 (Ingress Tool Transfer)

defaults:
  for: [macho, dylib]
  attack: "T1105"
  mbc: "E1105"

composite_rules:
  # macOS download framework with file staging
  # Downloads content via NSURLSession and writes/moves files to disk
  - id: macos-download-stager
    desc: macOS download framework with file staging
    crit: notable
    conf: 0.80
    for: [macho, dylib]
    all:
      - id: cap/comm/http/lib/nsurlsession::nsurlsession-download-task
      - id: cap/fs/file/write::nsfilehandle-write
      - id: cap/fs/file/write::nsfilemanager-move
