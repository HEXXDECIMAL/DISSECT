# Windows MSHTA LOLBin Traits
# Detects abuse of mshta.exe for remote code execution
# MBC: E1218.005 (System Binary Proxy Execution: Mshta)
# ATT&CK: T1218.005

defaults:
  for: [batch, shell, powershell]
  attack: "T1218.005"

traits:
  - id: mshta-invoke
    desc: MSHTA execution invocation
    crit: notable
    conf: 0.85
    if:
      type: content
      regex: '(?i)\bmshta\b'

  - id: mshta-remote-url
    desc: MSHTA remote payload fetch
    crit: suspicious
    conf: 0.95
    mbc: "E1218.005"
    if:
      type: content
      regex: '(?i)\bmshta\s+https?://'

  - id: mshta-inline-vbscript
    desc: MSHTA inline VBScript execution
    crit: suspicious
    conf: 0.9
    mbc: "E1218.005"
    if:
      type: content
      regex: '(?i)\bmshta\s+[''"]?vbscript:'

  - id: mshta-inline-javascript
    desc: MSHTA inline JavaScript execution
    crit: suspicious
    conf: 0.9
    mbc: "E1218.005"
    if:
      type: content
      regex: '(?i)\bmshta\s+[''"]?javascript:'
