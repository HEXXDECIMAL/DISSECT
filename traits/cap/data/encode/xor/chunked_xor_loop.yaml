traits:
  - id: js-parseint
    desc: parseInt call
    crit: inert
    if:
      type: string
      regex: 'parseInt\s*\('

  - id: js-fromcharcode
    desc: String.fromCharCode call
    crit: inert
    if:
      type: string
      regex: 'String\.fromCharCode\s*\('

  - id: js-xor-op
    desc: XOR operator
    crit: inert
    if:
      type: string
      substr: "^"

  - id: js-substring
    desc: Substring call
    crit: inert
    if:
      type: string
      regex: '\b(substring|substr|slice)\s*\('

  - id: js-charat
    desc: charAt call
    crit: inert
    if:
      type: string
      regex: '\bcharAt\s*\('

  - id: js-loop
    desc: Loop structure
    crit: inert
    if:
      type: string
      regex: '\b(while|for)\s*\('

composite_rules:
  - id: js-chunked-xor-loop
    desc: "Detects JScript decoding logic using chunked parsing (usually 3 digits) and XOR."
    crit: suspicious
    all:
      - id: js-parseint
      - id: js-fromcharcode
      - id: js-xor-op
      - id: js-loop
    any:
      - id: js-substring
      - id: js-charat