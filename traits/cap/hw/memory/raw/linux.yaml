# Raw Memory Access - Linux
# ATT&CK: T1003 (OS Credential Dumping)

traits:
  - id: kmem
    desc: Access raw kernel memory (/dev/kmem)
    crit: notable
    conf: 0.9
    attack: "T1003"
    platforms: [linux, unix]
    if:
      type: string
      exact: "/dev/kmem"
    # /dev/kmem is notable - it has legitimate uses for graphics/video access
    # Only becomes suspicious in malware context (handled by composites)

  - id: dev-mem
    desc: Access raw system memory (/dev/mem)
    crit: notable
    conf: 0.9
    attack: "T1003"
    platforms: [linux, unix]
    if:
      type: string
      exact: "/dev/mem"
    # /dev/mem is notable - it has legitimate uses for graphics/video access
    # Only becomes suspicious in malware context (handled by composites)

  # === Memdump atomic indicators ===
  - id: memdump-cmd
    description: memdump command reference
    crit: notable
    conf: 0.65
    attack: "T1003"
    platforms: [all]
    if:
      type: string
      word: "memdump"

  - id: dumpmem-cmd
    description: dumpmem command reference
    crit: notable
    conf: 0.65
    attack: "T1003"
    platforms: [all]
    if:
      type: string
      word: "dumpmem"

composite_rules:
  # Memdump composite
  - id: memdump-ref
    desc: Memory dump utility reference
    crit: suspicious
    conf: 0.75
    attack: "T1003"
    platforms: [all]
    count_min: 1
    any:
      - id: memdump-cmd
      - id: dumpmem-cmd

  # Raw memory access becomes suspicious when NOT in a graphics/video context
  # This catches malware that accesses /dev/mem for credential dumping or rootkit behavior
  - id: raw-mem-suspicious
    desc: Raw memory access (non-graphics)
    crit: suspicious
    conf: 0.8
    attack: "T1003"
    platforms: [linux, unix]
    any:
      - id: dev-mem
      - id: kmem
    none:
      # Legitimate graphics/video libraries that need /dev/mem
      - id: cap/exec/load/x11-dga-marker
      - id: cap/exec/load/graphics-lib-marker
      - id: cap/exec/load/video-lib-marker
      - id: cap/exec/load/drm-driver-ref
      - id: cap/exec/load/x11-ref
