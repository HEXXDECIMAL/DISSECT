# Java Bytecode Manipulation
# Traits for detecting manual manipulation of Java class file structures

traits:
  - id: constant-pool-tag-check
    desc: Manual parsing of Java Class Constant Pool tags
    crit: notable
    conf: 0.8
    if:
      type: raw
      regex: 'tag\s*==\s*(?:7|9|10|11|12|18)\b'

  - id: class-magic-check
    desc: Check for Java Class Magic (CAFEBABE) in code logic
    crit: notable
    conf: 0.8
    if:
      type: raw
      regex: 'CAFEBABE'

  - id: manual-opcode-injection
    desc: Manual injection of Java Opcodes (e.g. invokestatic=184)
    crit: suspicious
    conf: 0.8
    if:
      type: raw
      regex: '(?:\(byte\)\s*184|\[\d+\]\s*=\s*\(byte\)\s*184)'