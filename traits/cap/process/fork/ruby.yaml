# Process Lifecycle - Ruby

traits:
  # === Ruby fork atomic indicators ===
  - id: process-fork
    desc: Process.fork call
    crit: inert
    conf: 0.7
    platforms: [all]
    r#for: [ruby]
    if:
      type: string
      substr: "Process.fork"

  - id: fork-brace-block
    desc: fork with brace block
    crit: inert
    conf: 0.6
    platforms: [all]
    r#for: [ruby]
    if:
      type: string
      regex: "\\bfork\\s*\\{"

  - id: fork-do-block
    desc: fork with do block
    crit: inert
    conf: 0.6
    platforms: [all]
    r#for: [ruby]
    if:
      type: string
      regex: "\\bfork\\s*do\\b"

  - id: fork-paren
    desc: fork with parenthesis
    crit: inert
    conf: 0.6
    platforms: [all]
    r#for: [ruby]
    if:
      type: string
      regex: "\\bfork\\s*\\("

composite_rules:
  # Fork block composite
  - id: fork-block
    desc: fork with block/do
    crit: notable
    conf: 0.7
    platforms: [all]
    r#for: [ruby]
    count_min: 1
    any:
      - id: fork-brace-block
      - id: fork-do-block
      - id: fork-paren

  - id: ruby-fork
    desc: Fork process
    crit: notable
    conf: 0.88
    platforms: [all]
    r#for: [ruby]
    count_min: 1
    any:
      - id: process-fork
      - id: fork-block
