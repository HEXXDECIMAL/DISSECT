# Command Injection via Format Strings
# Detects patterns where system() is called with dynamically constructed strings
# containing unvalidated input (typically from snprintf/sprintf)
# MBC: E1059 (Command and Scripting Interpreter)
# ATT&CK: T1059
# NOTE: unsafe-string-format moved to cap/data/format/string/ (not a shell indicator)

traits:
  - id: format-string-injection
    desc: Format string with user input
    crit: suspicious
    conf: 0.80
    mbc: "E1059"
    attack: "T1059"
    platforms: [unix, linux, macos]
    for: [c]
    if:
      type: raw
      regex: '(?:snprintf|sprintf)[\s\S]{0,50}%s[\s\S]{0,50}(?:system\s*\(|popen\s*\(|execl\s*\(|execv\s*\(|/bin/sh|sh\s+-c|cmd\.exe)'

  # Removed system-call-symbol duplicate - use cap/process/create/shell::system-fn

composite_rules:
