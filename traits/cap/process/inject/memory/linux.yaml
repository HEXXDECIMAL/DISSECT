# Process Injection Detection - Linux
# MBC: B0033 (Process Injection)
# ATT&CK: T1055

defaults:
  for: [elf]
  platforms: [linux]

traits:
  # === Ptrace-based injection ===
  - id: ptrace-attach
    desc: PTRACE_ATTACH for process injection
    crit: suspicious
    conf: 0.75
    mbc: "B0033"
    attack: "T1055"
    if:
      type: string
      substr: "PTRACE_ATTACH"

  - id: ptrace-poketext
    desc: PTRACE_POKETEXT for code injection
    crit: suspicious
    conf: 0.85
    mbc: "B0033"
    attack: "T1055"
    if:
      type: string
      substr: "PTRACE_POKETEXT"

  # === Process VM operations ===
  - id: process-vm-writev
    desc: process_vm_writev for memory injection
    crit: notable
    conf: 0.85
    mbc: "B0033"
    attack: "T1055"
    size_max: 2097152
    if:
      type: symbol
      regex: "process_vm_writev"

composite_rules:
  # Process injection via ptrace (migrated from YARA)
  - id: process-inject-ptrace
    desc: Process injection via ptrace
    crit: notable
    conf: 0.66
    mbc: "B0033"
    attack: "T1055"
    needs: 1
    any:
      - id: ptrace-attach
      - id: ptrace-poketext
      - id: process-vm-writev
