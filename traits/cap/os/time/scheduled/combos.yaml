# Time-based Trigger Composite Rules
# Logic bombs and time-triggered malware

composite_rules:
  # Self-termination: GetCurrentProcess + Kill
  - id: self-termination
    desc: "Self-destruct: terminates own process"
    crit: suspicious
    mbc: "E1562"
    attack: "T1562"
    conf: 0.95
    r#for: [all]
    all:
      - id: cap/exec/process/current-process
      - id: cap/exec/process/terminate

  # Probabilistic execution: Random number decides whether to execute
  - id: probabilistic-execution
    desc: "Probabilistic execution: uses randomness to"
    crit: suspicious
    mbc: "B0009"
    attack: "T1497"
    conf: 0.9
    r#for: [all]
    all:
      - id: instantiation

  # Logic bomb with self-destruct
  - id: logic-bomb-self-destruct
    desc: "Logic bomb: time-triggered self-destruct with"
    crit: suspicious
    mbc: "B0003"
    attack: "T1480.001"
    conf: 0.95
    r#for: [all]
    all:
      - id: hardcoded-datetime
      - id: cap/exec/process/current-process
      - id: cap/exec/process/terminate

  # Logic bomb with probabilistic self-destruct
  - id: logic-bomb-probabilistic-self-destruct
    desc: "Logic bomb: time-triggered probabilistic self-destruct"
    crit: suspicious
    mbc: "B0003"
    attack: "T1480.001"
    conf: 0.95
    r#for: [all]
    all:
      - id: hardcoded-datetime
      - id: instantiation
      - id: cap/exec/process/current-process
      - id: cap/exec/process/terminate

  # Supply chain: SQL library with malicious payload
  - id: supply-chain-sql-backdoor
    desc: "Supply chain attack: malicious code"
    crit: suspicious
    mbc: "B0003"
    attack: "T1195.001"
    conf: 0.95
    r#for: [all]
    all:
      - id: sqlcommand
    any:
      - id: cap/exec/process/terminate
      - id: cap/exec/process/start
      - id: cap/exec/reflection/assembly-load

  # Concentrated malicious code: all behaviors within 30 lines (tight proximity)
  - id: concentrated-logic-bomb
    desc: "Concentrated logic bomb: all malicious"
    crit: suspicious
    mbc: "B0003"
    attack: "T1480.001"
    conf: 0.98
    r#for: [all]
    near_lines: 30 # All patterns must be within 30 lines
    all:
      - id: hardcoded-datetime
      - id: cap/exec/process/terminate
