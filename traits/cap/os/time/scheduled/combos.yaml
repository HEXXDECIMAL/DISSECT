# Time-based Trigger Composite Rules
# Logic bombs and time-triggered malware

composite_rules:
  # Self-termination: GetCurrentProcess + Kill
  - id: self-termination
    desc: "Self-destruct: terminates own process"
    crit: suspicious
    mbc: "E1562"
    attack: "T1562"
    conf: 0.95
    for: [all]
    all:
      - id: cap/exec/process/spawn/
      - id: cap/process/terminate/

  # Logic bomb with self-destruct
  - id: logic-bomb-self-destruct
    desc: "Logic bomb: time-triggered self-destruct with"
    crit: suspicious
    mbc: "B0003"
    attack: "T1480.001"
    conf: 0.95
    for: [all]
    all:
      - id: hardcoded-datetime
      - id: cap/exec/process/spawn/
      - id: cap/process/terminate/

  # Logic bomb with probabilistic self-destruct
  - id: logic-bomb-probabilistic-self-destruct
    desc: "Logic bomb: time-triggered probabilistic self-destruct"
    crit: suspicious
    mbc: "B0003"
    attack: "T1480.001"
    conf: 0.95
    for: [all]
    all:
      - id: hardcoded-datetime
      - id: cap/os/random/prng::random-instantiation
      - id: cap/exec/process/spawn/
      - id: cap/process/terminate/

  # Supply chain: SQL library with malicious payload
  - id: supply-chain-sql-backdoor
    desc: "Supply chain attack: malicious code"
    crit: suspicious
    mbc: "B0003"
    attack: "T1195.001"
    conf: 0.95
    for: [all]
    all:
      - id: cap/data/sql/query::sqlcommand
    any:
      - id: cap/process/terminate/
      - id: cap/exec/eval/invoke/
      - id: cap/exec/reflection/invoke::assembly-load

  # Concentrated malicious code: all behaviors within 30 lines (tight proximity)
  - id: concentrated-logic-bomb
    desc: "Concentrated logic bomb: all malicious"
    crit: suspicious
    mbc: "B0003"
    attack: "T1480.001"
    conf: 0.98
    for: [all]
    near_lines: 30 # All patterns must be within 30 lines
    all:
      - id: hardcoded-datetime
      - id: cap/process/terminate/
