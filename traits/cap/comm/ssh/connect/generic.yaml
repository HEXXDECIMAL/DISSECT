# SSH Operations
# MBC: C0001 (Socket Communication)
# ATT&CK: T1021.004

traits:
  # === SSH Indicators ===
  # NOTE: Matching just "ssh" is too broad - matches LLVM tools (clang-ssh),
  # compiler paths, openssh references, etc. Require SSH-specific context.
  - id: ssh-string
    desc: ssh string
    crit: inert
    conf: 0.4
    attack: "T1021.004"
    if:
      type: string
      regex: "\\bssh\\b"
    not:
      # LLVM/compiler references
      - "openssh"
      - "OpenSSH"
      - "libssh"
      - regex: "clang.*ssh"
      - regex: "llvm.*ssh"
      # Common false positives
      - regex: "ssh[-_]?keygen"
      - regex: "ssh[-_]?agent"
      - regex: "ssh[-_]?add"
      - regex: "/usr/.*ssh"
      - regex: "known_hosts"

  - id: paramiko
    desc: paramiko Python SSH library
    crit: notable
    conf: 0.75
    attack: "T1021.004"
    if:
      type: string
      substr: "paramiko"

  - id: libssh
    desc: libssh library
    crit: notable
    conf: 0.75
    attack: "T1021.004"
    if:
      type: string
      substr: "libssh"

  - id: openssh
    desc: OpenSSH string
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "OpenSSH"

  - id: ssh-client
    desc: SSHClient class
    crit: notable
    conf: 0.75
    attack: "T1021.004"
    if:
      type: string
      substr: "SSHClient"

composite_rules:
  # SSH connection (migrated from YARA)
  - id: connect
    desc: SSH connection
    crit: notable
    conf: 0.66
    attack: "T1021.004"
    count_min: 1
    any:
      - id: ssh-string
      - id: paramiko
      - id: libssh
      - id: openssh
      - id: ssh-client
