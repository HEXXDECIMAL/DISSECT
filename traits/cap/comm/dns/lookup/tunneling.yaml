# DNS Tunneling Indicators
# Detects suspicious DNS lookup patterns indicative of data exfiltration

defaults:
  crit: suspicious
  conf: 0.8
  for: [javascript]

traits:
  - id: dns-lookup-loop
    desc: DNS lookup inside a loop (potential tunneling)
    crit: suspicious
    if:
      type: raw
      regex: 'for\s*\([^)]+\)\s*\{[\s\S]{0,200}dns\.lookup'

  - id: dns-hex-encoding
    desc: Hex encoding for DNS (custom helper)
    crit: notable
    if:
      type: raw
      regex: 'Buffer\.from\([^,]+,\s*[''"]utf8[''"]\)\.toString\([''"]hex[''"]\)'
