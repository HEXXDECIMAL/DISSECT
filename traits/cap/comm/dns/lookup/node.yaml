# DNS Lookup Operations (Node.js)
# MBC: C0011 (DNS Communication)
# ATT&CK: T1071.004
#
# Type-specific lookups are in subdirectories:
#   txt/     - TXT record lookups
#   reverse/ - Reverse DNS lookups

defaults:
  for: [javascript, typescript]
  mbc: "C0011"
  attack: "T1071.004"
  crit: notable
  conf: 0.7

traits:
  - id: dns-lookup-call
    desc: dns.lookup() call
    conf: 0.65
    if:
      type: string
      regex: "dns\\.lookup\\("

  - id: dns-resolve-call
    desc: dns.resolve() call
    conf: 0.7
    if:
      type: string
      regex: "dns\\.resolve\\("

  - id: dns-resolve4
    desc: dns.resolve4() call (A record)
    conf: 0.7
    if:
      type: string
      regex: "dns\\.resolve4\\("

  - id: dns-resolve6
    desc: dns.resolve6() call (AAAA record)
    conf: 0.7
    if:
      type: string
      regex: "dns\\.resolve6\\("

  - id: dns-promises-lookup
    desc: dns.promises.lookup() call
    conf: 0.7
    if:
      type: string
      regex: "dns\\.promises\\.lookup\\("

  - id: require-dns
    desc: require('dns') import
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "require\\(['\"]dns['\"]\\)"

composite_rules:
  - id: node-dns-lookup
    desc: Node.js DNS lookup operations
    crit: notable
    conf: 0.7
    needs: 1
    any:
      - id: dns-lookup-call
      - id: dns-resolve-call
      - id: dns-resolve4
      - id: dns-resolve6
      - id: dns-promises-lookup
