# PHP cURL HTTP Client Traits
# MBC: C0002 (HTTP Communication)
# ATT&CK: T1071.001

traits:
  - id: init
    desc: cURL session initialization
    crit: notable
    conf: 0.8
    mbc: "C0002"
    attack: "T1071.001"
    for: [php]
    if:
      type: ast
      kind: call
      exact: "curl_init"

  - id: exec
    desc: cURL request execution
    crit: notable
    conf: 0.8
    mbc: "C0002"
    attack: "T1071.001"
    for: [php]
    if:
      type: ast
      kind: call
      exact: "curl_exec"

  - id: setopt
    desc: cURL option configuration
    crit: inert
    conf: 0.7
    for: [php]
    if:
      type: ast
      kind: call
      exact: "curl_setopt"

  - id: ssl-verify-disable
    desc: SSL certificate verification disabled (security
    crit: suspicious
    conf: 0.9
    mbc: "B0032"
    attack: "T1553"
    for: [php]
    if:
      type: ast
      kind: call
      regex: "curl_setopt\\s*\\([^,]+,\\s*CURLOPT_SSL_VERIFYPEER\\s*,\\s*(false|0|FALSE)"

  - id: ssl-host-disable
    desc: SSL host verification disabled (security
    crit: suspicious
    conf: 0.9
    mbc: "B0032"
    attack: "T1553"
    for: [php]
    if:
      type: ast
      kind: call
      regex: "curl_setopt\\s*\\([^,]+,\\s*CURLOPT_SSL_VERIFYHOST\\s*,\\s*(0|false|FALSE)"

  - id: follow-redirects
    desc: cURL follows HTTP redirects
    crit: inert
    conf: 0.6
    for: [php]
    if:
      type: string
      substr: CURLOPT_FOLLOWLOCATION

  - id: file-upload
    desc: cURL file upload capability (CURLFile)
    crit: notable
    conf: 0.85
    mbc: "B0030"
    attack: "T1041"
    for: [php]
    if:
      type: string
      word: "CURLFile"

  - id: post-data
    desc: cURL POST data configuration
    crit: notable
    conf: 0.7
    for: [php]
    if:
      type: string
      substr: CURLOPT_POSTFIELDS

  - id: user-agent-set
    desc: Custom User-Agent header configuration
    crit: notable
    conf: 0.75
    for: [php]
    if:
      type: string
      substr: CURLOPT_USERAGENT

  - id: referer-set
    desc: Custom Referer header configuration
    crit: notable
    conf: 0.7
    for: [php]
    if:
      type: string
      substr: CURLOPT_REFERER
