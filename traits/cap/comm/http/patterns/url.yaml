# HTTP URL Pattern Detection
# Detects suspicious URL patterns in HTTP requests
# ATT&CK: T1105 (Ingress Tool Transfer), T1041 (Exfiltration Over C2)

defaults:
  crit: notable
  conf: 0.8

traits:
  - id: payload-path
    desc: URL path suggesting payload download
    crit: suspicious
    attack: "T1105"
    if:
      type: string
      regex: "(?:GET|POST|PUT)\\s+/[a-zA-Z0-9_./-]*\\.(bin|exe|sh|elf|dll|so|dat|payload|bot|drop)"

  - id: php-collect
    desc: PHP collection endpoint
    attack: "T1041"
    if:
      type: string
      regex: "\\.php\\?.*(?:collect|data|info)"

  - id: php-log
    desc: PHP logging endpoint
    attack: "T1041"
    if:
      type: string
      regex: "\\.php\\?.*log"

  - id: php-report
    desc: PHP reporting endpoint
    attack: "T1041"
    if:
      type: string
      regex: "\\.php\\?.*report"

  - id: php-beacon
    desc: PHP beacon endpoint
    attack: "T1041"
    if:
      type: string
      regex: "\\.php\\?.*beacon"

composite_rules:
  - id: php-collector
    desc: Contacts PHP data collection endpoint
    crit: notable
    conf: 0.85
    attack: "T1041"
    needs: 1
    any:
      - id: php-collect
      - id: php-log
      - id: php-report
      - id: php-beacon
