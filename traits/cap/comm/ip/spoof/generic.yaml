# IP Spoofing
# MBC: C0001 (Socket Communication)
# ATT&CK: T1071

defaults:
  attack: "T1071"
  mbc: "C0001"

traits:
  # === IP spoofing keywords ===
  - id: spoof-keyword
    desc: spoof keyword
    crit: inert
    conf: 0.65
    for: [c, cpp, go, rust, python, shell, elf, macho]
    if:
      type: string
      word: "spoof"

  - id: forge-keyword
    desc: forge keyword
    crit: inert
    conf: 0.6
    for: [c, cpp, go, rust, python, shell, elf, macho]
    if:
      type: string
      word: "forge"

  - id: ip-hdrincl-constant
    desc: IP_HDRINCL socket option
    crit: inert
    conf: 0.75
    for: [c, cpp, go, rust, python, shell, elf, macho]
    if:
      type: string
      substr: "IP_HDRINCL"

  - id: ipproto-raw-constant
    desc: IPPROTO_RAW socket type
    crit: inert
    conf: 0.75
    for: [c, cpp, go, rust, python, shell, elf, macho]
    if:
      type: string
      substr: "IPPROTO_RAW"

  - id: sock-raw-constant
    desc: SOCK_RAW socket type
    crit: inert
    conf: 0.7
    for: [c, cpp, go, rust, python, shell, elf, macho]
    if:
      type: string
      substr: "SOCK_RAW"

  - id: raw-socket-keyword
    desc: raw socket keyword
    crit: inert
    conf: 0.65
    for: [c, cpp, go, rust, python, shell, elf, macho]
    if:
      type: string
      regex: "raw.?socket"

  # === SYN cookie atomic indicators ===
  - id: syncookie-word
    desc: syncookie word
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "syncookie"

  - id: syn-cookie-lower
    desc: syn_cookie or syncookie
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "syn.?cookie"

  - id: syn-cookie-upper
    desc: SYN_cookie or SYNcookie
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "SYN.?cookie"

composite_rules:
  # Migrated from YARA
  - id: spoof
    desc: IP address spoofing capabilities
    crit: suspicious
    conf: 0.7
    for: [c, cpp, go, rust, python, shell, elf, macho]
    any:
      - {id: spoof-keyword}
      - {id: forge-keyword}
      - {id: ip-hdrincl-constant}
      - {id: ipproto-raw-constant}

  - id: syncookie
    desc: SYN cookie manipulation
    crit: suspicious
    conf: 0.66
    count_min: 1
    any:
      - {id: syncookie-word}
      - {id: syn-cookie-lower}
      - {id: syn-cookie-upper}
