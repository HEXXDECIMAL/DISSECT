# IP-based Services (C2 channels)
# MBC: B0030 (C2 Communication)
# ATT&CK: T1567.001

traits:
  # NOTE: Telegram traits are defined in comm/messaging/telegram/
  # NOTE: Discord traits are defined in comm/messaging/discord/
  # Use those directory references in composite rules

  - id: services-tor
    desc: Contains TOR onion address
    crit: suspicious
    conf: 0.66
    mbc: "B0030"
    if:
      type: string
      regex: "[a-z0-9]{56}\\.onion"

  # === ICMP atomic indicators ===
  - id: icmp-upper
    desc: ICMP uppercase
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "ICMP"

  - id: icmp-lower
    desc: icmp lowercase
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "icmp"

  - id: ipproto-icmp
    desc: IPPROTO_ICMP constant
    crit: inert
    conf: 0.6
    if:
      type: string
      substr: "IPPROTO_ICMP"

composite_rules:
  - id: services-icmp
    desc: ICMP communication
    crit: notable
    conf: 0.66
    needs: 1
    any:
      - id: icmp-upper
      - id: icmp-lower
      - id: ipproto-icmp
