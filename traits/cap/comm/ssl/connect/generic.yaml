# SSL/TLS Operations
# MBC: C0001 (Socket Communication)
# ATT&CK: T1071

traits:
  # === SSL/TLS Connection ===
  - id: connect
    desc: SSL/TLS connection
    crit: inert
    conf: 0.66
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      regex: SSL_connect|SSL_new|SSL_CTX_new|TLS_client_method

  # === Certificate Verification Skip ===
  - id: insecure-skip-verify
    desc: InsecureSkipVerify (Go)
    crit: suspicious
    conf: 0.8
    for: [go]
    if:
      type: string
      substr: "InsecureSkipVerify"

  - id: cert-none
    desc: cert_reqs set to CERT_NONE (Python)
    crit: notable
    conf: 0.75
    for: [python]
    if:
      type: content
      regex: "\\bcert_reqs\\s*=\\s*(?:ssl\\.)?CERT_NONE\\b"

  - id: verify-mode-none
    desc: verify_mode = ssl.CERT_NONE (Python)
    crit: notable
    conf: 0.85
    for: [python]
    if:
      type: content
      regex: "\\bverify_mode\\s*=\\s*(?:ssl\\.)?CERT_NONE\\b"
    unless:
      - type: string
        regex: "urllib3|requests|botocore"

  - id: reject-unauthorized-false
    desc: rejectUnauthorized false (Node.js)
    crit: notable
    conf: 0.8
    for: [javascript, typescript]
    if:
      type: string
      substr: "rejectUnauthorized: false"

composite_rules:
  # Skip SSL certificate verification (migrated from YARA)
  - id: verify-skip
    desc: Skip SSL certificate verification
    crit: suspicious
    conf: 0.66
    # Small binaries/scripts skipping verification are more suspicious
    size_max: 10000
    needs: 1
    any:
      - id: insecure-skip-verify
      - id: verify-mode-none
      - id: reject-unauthorized-false
