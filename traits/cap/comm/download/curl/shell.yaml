# File Download Operations
# MBC: C0002 (HTTP Communication)
# ATT&CK: T1105

defaults:
  attack: "T1105"

traits:
  # === curl atomic indicators ===
  - id: curl-cmd
    desc: curl command
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "curl\\s"

  - id: libcurl-ref
    desc: libcurl library
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "libcurl"

  - id: curlopt-ref
    desc: CURLOPT constant
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "CURLOPT"

  # === wget atomic indicators ===
  - id: wget-cmd
    desc: wget command
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "wget\\s"

  - id: wget-path
    desc: wget binary path
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "/usr/bin/wget"

  # === fetch atomic indicators ===
  # NOTE: "fetch(" is too generic for binaries - matches C++ method names like
  # llvm::Fetcher::fetch(). Restrict to shell/script contexts.
  - id: fetch-call
    desc: fetch function call
    crit: inert
    conf: 0.5
    for: [shell, javascript, typescript, python]
    if:
      type: string
      exact: "fetch("

  - id: urllib-urlretrieve
    desc: urllib urlretrieve
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "urllib.request.urlretrieve"

composite_rules:
  - id: curl
    desc: Download via curl
    crit: notable
    conf: 0.66
    count_min: 1
    any:
      - id: curl-cmd
      - id: libcurl-ref
      - id: curlopt-ref

  - id: wget
    desc: Download via wget
    crit: notable
    conf: 0.66
    count_min: 1
    any:
      - id: wget-cmd
      - id: wget-path

  - id: fetch
    desc: Download via fetch
    crit: notable
    conf: 0.66
    count_min: 1
    any:
      - id: fetch-call
      - id: urllib-urlretrieve
