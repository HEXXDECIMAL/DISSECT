# Network Diagnostic Tools Detection
# Benign baseline for ML differentiation

defaults:
  crit: benign
  conf: 0.9

traits:
  # === Ping/traceroute ===
  - id: ping
    desc: ping command
    if:
      type: string
      regex: '\bping\s+'

  - id: ping6
    desc: ping6 command
    if:
      type: string
      regex: '\bping6\b'

  - id: traceroute
    desc: traceroute command
    if:
      type: string
      regex: '\btraceroute\b'

  - id: tracepath
    desc: tracepath command
    if:
      type: string
      regex: '\btracepath\b'

  - id: mtr
    desc: mtr network diagnostic
    if:
      type: string
      regex: '\bmtr\b'

  # === DNS tools ===
  - id: nslookup
    desc: nslookup command
    if:
      type: string
      regex: '\bnslookup\b'

  - id: dig
    desc: dig DNS command
    if:
      type: string
      regex: '\bdig\s+'

  - id: host
    desc: host DNS command
    if:
      type: string
      regex: '\bhost\s+'

  # === Connection testing ===
  - id: nc
    desc: nc/netcat command
    if:
      type: string
      regex: '\bnc\s+'

  - id: netcat
    desc: netcat command
    if:
      type: string
      regex: '\bnetcat\b'

  - id: telnet
    desc: telnet command
    if:
      type: string
      regex: '\btelnet\s+'

  # === Traffic capture ===
  - id: tcpdump
    desc: tcpdump packet capture
    if:
      type: string
      substr: tcpdump

  - id: wireshark
    desc: Wireshark analyzer
    if:
      type: string
      substr: wireshark

  - id: tshark
    desc: tshark CLI analyzer
    if:
      type: string
      substr: tshark

  # === Connection info ===
  - id: netstat
    desc: netstat command
    if:
      type: string
      substr: netstat

  - id: ss
    desc: ss socket statistics
    if:
      type: string
      # Must be command-like context with typical ss flags
      regex: "\\bss\\s+-[atnlup]"

  - id: lsof-i
    desc: lsof network listing
    if:
      type: string
      substr: "lsof -i"

  # === Interface info ===
  - id: ifconfig
    desc: ifconfig command
    if:
      type: string
      substr: ifconfig

  - id: ip-addr
    desc: ip addr command
    if:
      type: string
      substr: "ip addr"

  - id: ip-link
    desc: ip link command
    if:
      type: string
      substr: "ip link"

  # === Bandwidth testing ===
  - id: iperf
    desc: iperf bandwidth test
    if:
      type: string
      substr: iperf

  - id: iperf3
    desc: iperf3 bandwidth test
    if:
      type: string
      substr: iperf3

  - id: speedtest
    desc: speedtest utility
    if:
      type: string
      substr: speedtest

  # === Latency testing ===
  - id: hping
    desc: hping packet tool
    if:
      type: string
      substr: hping

  - id: fping
    desc: fping fast ping
    if:
      type: string
      substr: fping

  # === HTTP testing ===
  - id: curl
    desc: curl HTTP client
    if:
      type: string
      exact: "curl "

  - id: wget
    desc: wget download utility
    if:
      type: string
      exact: "wget "

  - id: ab
    desc: Apache Bench (ab) tool
    if:
      type: string
      # Match ab command with typical flags like -n, -c, -t, -k, or URL patterns
      regex: "\\bab\\s+-[nctkvVhwixpTrsHX]"

  - id: wrk
    desc: wrk HTTP benchmark
    if:
      type: string
      exact: "wrk "

  # === Firewall: iptables ===
  - id: iptables
    desc: iptables command
    if:
      type: string
      substr: iptables

  - id: ip6tables
    desc: ip6tables command
    if:
      type: string
      substr: ip6tables

  - id: iptables-save
    desc: iptables-save command
    if:
      type: string
      substr: iptables-save

  # === Firewall: nftables ===
  - id: nft
    desc: nft command
    if:
      type: string
      exact: "nft "

  - id: nftables
    desc: nftables reference
    if:
      type: string
      substr: nftables

  # === Firewall: firewalld/ufw ===
  - id: firewall-cmd
    desc: firewall-cmd utility
    if:
      type: string
      substr: firewall-cmd

  - id: firewalld
    desc: firewalld service
    if:
      type: string
      substr: firewalld

  - id: ufw
    desc: ufw firewall
    if:
      type: string
      exact: "ufw "

composite_rules:
  # Network troubleshooting tools
  - id: troubleshoot
    desc: Network troubleshooting utilities
    count_min: 1
    any:
      - id: ping
      - id: ping6
      - id: traceroute
      - id: tracepath
      - id: mtr
      - id: nslookup
      - id: dig
      - id: host
      - id: nc
      - id: netcat
      - id: telnet

  # Network monitoring
  - id: monitoring
    desc: Network monitoring utilities
    count_min: 1
    any:
      - id: tcpdump
      - id: wireshark
      - id: tshark
      - id: netstat
      - id: ss
      - id: lsof-i
      - id: ifconfig
      - id: ip-addr
      - id: ip-link

  # Network performance
  - id: performance
    desc: Network performance testing
    count_min: 1
    any:
      - id: iperf
      - id: iperf3
      - id: speedtest
      - id: hping
      - id: fping
      - id: curl
      - id: wget
      - id: ab
      - id: wrk

  # Firewall management
  - id: firewall
    desc: Firewall management utilities
    count_min: 1
    any:
      - id: iptables
      - id: ip6tables
      - id: iptables-save
      - id: nft
      - id: nftables
      - id: firewall-cmd
      - id: firewalld
      - id: ufw
