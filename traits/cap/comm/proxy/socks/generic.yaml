# SOCKS Proxy
# MBC: C0001 (Socket Communication)
# ATT&CK: T1090

defaults:
  mbc: "C0001"
  attack: "T1090"

traits:
  - id: socks4-proto
    desc: SOCKS4 protocol reference
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: SOCKS4

  - id: socks5-proto
    desc: SOCKS5 protocol reference
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: SOCKS5

  - id: socks5-string
    desc: socks5 string
    crit: inert
    conf: 0.5
    if:
      type: string
      word: "socks5"

  - id: socks4-string
    desc: socks4 string
    crit: inert
    conf: 0.5
    if:
      type: string
      word: "socks4"

  - id: socks-url
    desc: SOCKS URL scheme
    crit: notable
    conf: 0.7
    if:
      type: string
      exact: "socks://"

  # NOTE: Removed standalone "1080" pattern - too many false positives.
  # "1080" appears in 1080p resolution, font metrics, timestamps, etc.
  # SOCKS port is only meaningful in network/proxy context.
  - id: socks-port
    desc: SOCKS port 1080 reference
    crit: inert
    conf: 0.5
    if:
      type: string
      # Require SOCKS/proxy context around port number
      regex: "(?:socks|proxy)[:/].{0,30}1080|:1080(?:\\b|$)|port[=:\\s]+1080"
      case_insensitive: true

composite_rules:
  - id: socks
    desc: SOCKS proxy usage
    crit: notable
    conf: 0.66
    count_min: 1
    any:
      - id: socks4-proto
      - id: socks5-proto
      - id: socks5-string
      - id: socks4-string
      - id: socks-url
      - id: socks-port
