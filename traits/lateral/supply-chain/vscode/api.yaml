traits:
  # VSCode Extension API Usage
  - id: workspace-findFiles
    description: VSCode workspace.findFiles API call (file
    crit: notable
    confidence: 0.85
    file_types: [javascript, typescript]
    condition:
      type: ast_pattern
      node_type: call_expression
      pattern: "workspace.findFiles"

  - id: fs-readFile
    description: VSCode workspace.fs.readFile API call (file
    crit: notable
    confidence: 0.85
    file_types: [javascript, typescript]
    condition:
      type: ast_pattern
      node_type: call_expression
      pattern: "workspace.fs.readFile"

  - id: openTextDocument
    description: VSCode workspace.openTextDocument API call
    crit: notable
    confidence: 0.8
    file_types: [javascript, typescript]
    condition:
      type: ast_pattern
      node_type: call_expression
      pattern: "openTextDocument"

  - id: globalState
    description: VSCode extension globalState access
    crit: notable
    confidence: 0.7
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "globalState"

  # === Extension Activation atomic indicators ===
  - id: function-activate
    description: function activate definition
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "function activate"

  - id: async-function-activate
    description: async function activate definition
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "async function activate"

  - id: export-activate
    description: export activate pattern
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: "export.{0,30}activate"

  # === Extension Deactivation atomic indicators ===
  - id: function-deactivate
    description: function deactivate definition
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "function deactivate"

  - id: export-deactivate
    description: export deactivate pattern
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: "export.{0,30}deactivate"

  # === VSCode context atomic indicators ===
  - id: vscode-commands
    description: vscode.commands reference
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "vscode.commands"

  - id: vscode-window
    description: vscode.window reference
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "vscode.window"

  - id: vscode-workspace
    description: vscode.workspace reference
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "vscode.workspace"

  - id: vscode-extensions
    description: vscode.extensions reference
    crit: inert
    confidence: 0.9
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "vscode.extensions"

  # === process.env atomic indicator ===
  - id: process-env
    description: process.env reference
    crit: inert
    confidence: 0.6
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "process.env"

  - id: clipboard-write
    description: VSCode clipboard write access
    crit: notable
    confidence: 0.8
    file_types: [javascript, typescript]
    condition:
      type: ast_pattern
      node_type: call_expression
      pattern: "clipboard.writeText"

  - id: clipboard-read
    description: VSCode clipboard read access
    crit: notable
    confidence: 0.8
    file_types: [javascript, typescript]
    condition:
      type: ast_pattern
      node_type: call_expression
      pattern: "clipboard.readText"

  - id: telemetry-event
    description: VSCode telemetry event sending
    crit: notable
    confidence: 0.7
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: "sendTelemetryEvent"

composite_rules:
  # VSCode context helpers
  - id: vscode-context
    description: VSCode API context markers
    crit: notable
    confidence: 0.9
    file_types: [javascript, typescript]
    count_min: 1
    any:
      - id: vscode-commands
      - id: vscode-window
      - id: vscode-workspace
      - id: vscode-extensions
      - id: function-activate

  # HTTP helpers
  - id: http-request-libs
    description: HTTP request libraries
    crit: notable
    confidence: 0.7
    file_types: [javascript, typescript]
    count_min: 1
    any:
      - id: comm/http/request/javascript/https-request
      - id: comm/http/request/javascript/http-request
      - id: comm/http/request/javascript/axios
      - id: comm/http/request/javascript/node-fetch-import
      - id: comm/http/request/javascript/fetch-string

  # Suspicious VSCode Extension Behaviors
  # IMPORTANT: Requires VSCode markers to avoid FPs on regular npm packages
  - id: env-access
    description: Access to process.env in VSCode
    crit: suspicious
    confidence: 0.85
    mbc: "E1592"
    attack: "T1082"
    file_types: [javascript, typescript]
    all:
      - id: vscode-context
      - id: process-env

  # Telemetry/Exfiltration Patterns
  # IMPORTANT: Requires VSCode markers to avoid FPs on regular npm packages
  - id: external-request
    description: HTTP request in VSCode extension
    crit: suspicious
    confidence: 0.7
    file_types: [javascript, typescript]
    all:
      - id: vscode-context
      - id: http-request-libs

  # Activate composite
  - id: activate
    description: VSCode extension activate function
    crit: inert
    confidence: 1.0
    file_types: [javascript, typescript]
    count_min: 1
    any:
      - id: function-activate
      - id: async-function-activate
      - id: export-activate

  # Deactivate composite
  - id: deactivate
    description: VSCode extension deactivate function
    crit: inert
    confidence: 1.0
    file_types: [javascript, typescript]
    count_min: 1
    any:
      - id: function-deactivate
      - id: export-deactivate
