# Suspicious Package Structure Patterns
# These patterns indicate potentially malicious package structure
# Useful for differential ML analysis - absence of legitimate patterns

traits:
  # No README content
  - id: no-readme
    description: Package has no README (suspicious for published package)
    criticality: notable
    confidence: 0.7
    file_types: [packagejson]
    condition:
      type: yara
      source: |
        rule no_readme {
          strings:
            $readme1 = "readme" ascii nocase
            $readme2 = "README" ascii
          condition:
            not any of them
        }

  # Very short description
  - id: short-description
    description: Package has very short or empty description
    criticality: notable
    confidence: 0.65
    file_types: [packagejson]
    condition:
      type: string
      regex: '"description":\\s*"[^"]{0,10}"'

  # No repository URL
  - id: no-repository
    description: Package has no repository URL
    criticality: notable
    confidence: 0.6
    file_types: [packagejson]
    condition:
      type: yara
      source: |
        rule no_repository {
          strings:
            $repo1 = "\"repository\":" ascii
            $repo2 = "\"repository\"" ascii
          condition:
            not any of them
        }

  # No license specified
  - id: no-license
    description: Package has no license specified
    criticality: notable
    confidence: 0.6
    file_types: [packagejson]
    condition:
      type: yara
      source: |
        rule no_license {
          strings:
            $lic1 = "\"license\":" ascii
            $lic2 = "\"license\"" ascii
          condition:
            not any of them
        }

  # No dependencies but has install hooks
  - id: no-deps-with-hooks
    description: Package has install hooks but no dependencies
    criticality: suspicious
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: yara
      source: |
        rule no_deps_with_hooks {
          strings:
            $deps = "\"dependencies\":" ascii
            $hook1 = "\"preinstall\":" ascii
            $hook2 = "\"postinstall\":" ascii
            $hook3 = "\"install\":" ascii
          condition:
            any of ($hook*) and not $deps
        }

  # Single file package with dangerous APIs
  - id: single-file-dangerous
    description: Single file package using dangerous Node APIs
    criticality: suspicious
    confidence: 0.85
    file_types: [javascript]
    condition:
      type: yara
      source: |
        rule single_file_dangerous {
          strings:
            $os = "require('os')" ascii
            $os2 = "require(\"os\")" ascii
            $cp = "require('child_process')" ascii
            $cp2 = "require(\"child_process\")" ascii
            $https = "require('https')" ascii
            $https2 = "require(\"https\")" ascii
            $fs = "require('fs')" ascii
            $fs2 = "require(\"fs\")" ascii
          condition:
            filesize < 5KB and 3 of them
        }

  # Scoped package with generic name
  - id: scoped-generic
    description: Scoped package with suspiciously generic name
    criticality: notable
    confidence: 0.7
    file_types: [packagejson]
    condition:
      type: string
      regex: '"name":\\s*"@[^/]+/(test|demo|utils|helper|common|core|lib|pkg|module)[0-9]*"'

  # Package name with random suffix
  - id: random-suffix
    description: Package name with random-looking suffix
    criticality: notable
    confidence: 0.7
    file_types: [packagejson]
    condition:
      type: string
      regex: '"name":\\s*"[a-z-]+-[a-z0-9]{8,}"'

  # Very new version (0.0.1) with install hooks
  - id: new-version-hooks
    description: Brand new version (0.0.1) with install hooks
    criticality: suspicious
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: yara
      source: |
        rule new_version_with_hooks {
          strings:
            $ver = "\"version\": \"0.0.1\"" ascii
            $hook1 = "\"preinstall\":" ascii
            $hook2 = "\"postinstall\":" ascii
          condition:
            $ver and any of ($hook*)
        }

  # Multiple install hooks
  - id: multiple-hooks
    description: Package has multiple install lifecycle hooks
    criticality: suspicious
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: yara
      source: |
        rule multiple_hooks {
          strings:
            $hook1 = "\"preinstall\":" ascii
            $hook2 = "\"postinstall\":" ascii
            $hook3 = "\"install\":" ascii
            $hook4 = "\"prepare\":" ascii
          condition:
            2 of them
        }

  # Only index.js with immediate execution
  - id: index-only-exec
    description: Package with only index.js that executes immediately
    criticality: notable
    confidence: 0.75
    file_types: [packagejson]
    condition:
      type: yara
      source: |
        rule index_only {
          strings:
            $main = "\"main\": \"index.js\"" ascii
            $main2 = "\"main\":\"index.js\"" ascii
            $files = "\"files\":" ascii
          condition:
            any of ($main*) and not $files
        }

  # Package mimicking popular library pattern
  - id: popular-mimic
    description: Package name mimics popular library pattern
    criticality: notable
    confidence: 0.75
    file_types: [packagejson]
    condition:
      type: string
      regex: '"name":\\s*"[a-z]*(lodash|axios|express|react|vue|angular|webpack|babel|eslint|prettier|jest|mocha)[a-z0-9-]*"'

