# npm Package Metadata Patterns
# Detects suspicious metadata patterns in package.json
# These patterns often indicate malicious or typosquatting packages

traits:
  # VSCode extension detection
  - id: vscode-extension
    description: Package is a VSCode extension
    crit: inert
    confidence: 0.95
    file_types: [packagejson]
    condition:
      type: content

      case_insensitive: true

# === Composite Rules ===
composite_rules:
  # Install hook group
  - id: install-hooks
    description: Package has install hook (preinstall,
    crit: inert
    conf: 0.6
    file_types: [packagejson]
    any:
      - id: preinstall-hook-key
      - id: postinstall-hook-key
      - id: install-hook-key

  # Version 1.0.0 with install hooks
  - id: version-1.0.0-with-hooks
    description: Version 1.0.0 with install hooks
    crit: suspicious
    conf: 0.75
    file_types: [packagejson]
    all:
      - id: version-1.0.0
      - id: install-hooks

  # npm URL as homepage/repository
  - id: npm-as-homepage
    description: Package uses npmjs.com as homepage
    crit: notable
    conf: 0.8
    file_types: [packagejson]
    any:
      - id: npm-homepage-url
      - id: npm-repo-url

  # Repository presence check
  - id: has-repository
    description: Package has repository URL
    crit: inert
    conf: 0.5
    file_types: [packagejson]
    any:
      - id: repository-key
      - id: repo-url-git-host

  # Missing repository with install hooks
  - id: no-repo-with-hooks
    description: Package has install hooks but
    crit: suspicious
    conf: 0.85
    file_types: [packagejson]
    all:
      - id: install-hooks
    none:
      - id: has-repository

  # Generic descriptions group
  - id: generic-descriptions
    description: Package has generic marketing descriptions
    crit: inert
    conf: 0.5
    file_types: [packagejson]
    count_min: 2
    any:
      - id: desc-lightweight
      - id: desc-modern-web-apps
      - id: desc-universal
      - id: desc-powerful-library
      - id: desc-simple-easy

  # Generic description with hooks
  - id: generic-desc-with-hooks
    description: Generic description combined with install
    crit: suspicious
    conf: 0.8
    file_types: [packagejson]
    all:
      - id: generic-descriptions
      - id: install-hooks
