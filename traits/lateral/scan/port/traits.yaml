# Lateral Movement - Network Scanning
# ATT&CK: T1046 (Network Service Discovery)
# MBC: E1046

traits:
  # === Atomic: Network Scanning Indicators ===

  - id: ip-format
    description: IP address format string (scanning indicator)
    criticality: notable
    confidence: 0.6
    attack: "T1046"
    platforms: [all]
    condition:
      type: string
      exact: "%d.%d.%d.%d"

  - id: target-ip-ref
    description: References target IP concept
    criticality: suspicious
    confidence: 0.75
    attack: "T1046"
    platforms: [all]
    condition:
      type: string
      regex: "[Tt]arget[_\\s]?[Ii][Pp]|targetIP"

  - id: random-target
    description: Random target/IP generation
    criticality: suspicious
    confidence: 0.8
    attack: "T1046"
    platforms: [all]
    condition:
      type: string
      regex: "[Rr]andom[_\\s]?[Tt]arget|[Rr]andom[_\\s]?IP|getrandip"

  - id: port-ref
    description: Port scanning terminology
    criticality: notable
    confidence: 0.5
    attack: "T1046"
    platforms: [all]
    condition:
      type: string
      regex: "\\b[Pp]ort[Ss]can|scan[_\\s]?[Pp]ort|[Pp]ort[_\\s]?[Ss]can"

  - id: probe-ref
    description: Network probing terminology
    criticality: notable
    confidence: 0.6
    attack: "T1046"
    platforms: [all]
    condition:
      type: string
      regex: "\\b[Pp]robe\\b|[Bb]anner[_\\s]?[Gg]rab"

  - id: target-ref
    description: Scan target terminology
    criticality: notable
    confidence: 0.6
    attack: "T1046"
    platforms: [all]
    condition:
      type: string
      # Require scanning context, not just standalone "target"
      regex: "target[_\\s]*(host|ip|port|range|list|addr)|scan[_\\s]*target"

  # === Atomic: Brute Force Indicators ===

  - id: brute-force-ref
    description: Brute force attack reference
    criticality: suspicious
    confidence: 0.85
    attack: "T1110"
    platforms: [all]
    condition:
      type: string
      regex: "[Bb]rute[_\\-\\s]?[Ff]orce"

  # NOTE: IoT credentials are defined in lateral/brute-force/iot-creds/traits.yaml

  # === Atomic: Common Weak Passwords ===

  - id: weak-pass-root123
    description: Weak password root123
    criticality: suspicious
    confidence: 0.7
    attack: "T1110.001"
    platforms: [all]
    condition:
      type: string
      exact: "root123"

  - id: weak-pass-admin123
    description: Weak password admin123
    criticality: suspicious
    confidence: 0.7
    attack: "T1110.001"
    platforms: [all]
    condition:
      type: string
      regex: "[Aa]dmin123"

  - id: weak-pass-passw0rd
    description: Weak password Passw0rd
    criticality: suspicious
    confidence: 0.7
    attack: "T1110.001"
    platforms: [all]
    condition:
      type: string
      exact: "Passw0rd"

  - id: weak-pass-qwerty
    description: Weak password qwerty variants
    criticality: suspicious
    confidence: 0.7
    attack: "T1110.001"
    platforms: [all]
    condition:
      type: string
      regex: "qwerty123|qwerty"

  # === Atomic: Root/Exploit Terminology ===

  - id: root-exploit-ref
    description: Root exploitation terminology (leetspeak/hacker slang)
    criticality: suspicious
    confidence: 0.85
    attack: "T1068"
    platforms: [all]
    condition:
      type: string
      # "root the " = hacker slang for compromising a device
      # "r00t" = leetspeak for root (clearly malicious intent)
      # Note: "get_root" removed - legitimate function name in system utilities
      regex: "root the |r00t[^a-zA-Z]"
