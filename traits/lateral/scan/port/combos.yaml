# Lateral Movement - Scanning Composite Rules
# ATT&CK: T1046 (Network Service Discovery)

composite_rules:
  # === Network Scanner Detection ===

  - id: generic-scanner
    description: Generic network scanning tool
    criticality: suspicious
    confidence: 0.85
    attack: "T1046"
    mbc: "E1046"
    file_types: [all]
    requires_all:
      - type: trait
        id: sym-hostname-resolve
      - type: trait
        id: sym-socket-connect
    requires_count: 2
    conditions:
      - type: trait
        id: ip-format
      - type: trait
        id: port-ref
      - type: trait
        id: probe-ref
      - type: trait
        id: target-ref

  - id: root-scanner
    description: Root exploitation scanner
    criticality: suspicious
    confidence: 0.9
    attack: "T1046"
    mbc: "E1046"
    file_types: [all]
    requires_all:
      - type: trait
        id: root-exploit-ref
    requires_any:
      - type: trait
        id: target-ip-ref
      - type: trait
        id: random-target

  # === IoT Credential Brute Force ===
  # NOTE: IoT credential attack detection is defined in lateral/brute-force/iot-creds/traits.yaml

  - id: router-brute-force
    description: Router credential brute force attack
    criticality: suspicious
    confidence: 0.85
    attack: "T1110.001"
    file_types: [all]
    requires_all:
      - type: trait
        id: ssh-dir-ref
      - type: trait
        id: etc-hosts-ref
    requires_count: 2
    conditions:
      - type: trait
        id: weak-pass-root123
      - type: trait
        id: weak-pass-admin123
      - type: trait
        id: weak-pass-passw0rd
      - type: trait
        id: weak-pass-qwerty

  # === Random IP Scanning ===

  - id: random-ip-scanner
    description: Random IP address scanning
    criticality: suspicious
    confidence: 0.8
    attack: "T1046"
    file_types: [all]
    requires_all:
      - type: trait
        id: random-target
    requires_any:
      - type: trait
        id: sym-socket-connect
      - type: trait
        id: ip-format
