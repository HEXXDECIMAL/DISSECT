# Lateral Movement - Scanning Composite Rules
# ATT&CK: T1046 (Network Service Discovery)

composite_rules:
  # === Network Scanner Detection ===

  - id: generic-scanner
    description: Generic network scanning tool
    crit: suspicious
    confidence: 0.85
    attack: "T1046"
    mbc: "E1046"
    file_types: [all]
    requires_all:
      - id: sym-hostname-resolve
      - id: sym-socket-connect
    requires_count: 2
    any:
      - id: ip-format
      - id: port-ref
      - id: probe-ref
      - id: target-ref

  - id: root-scanner
    description: Root exploitation scanner
    crit: suspicious
    confidence: 0.9
    attack: "T1046"
    mbc: "E1046"
    file_types: [all]
    requires_all:
      - id: root-exploit-ref
    requires_any:
      - id: target-ip-ref
      - id: random-target

  # === IoT Credential Brute Force ===
  # NOTE: IoT credential attack detection is defined in lateral/brute-force/iot-creds/traits.yaml

  - id: router-brute-force
    description: Router credential brute force attack
    crit: suspicious
    confidence: 0.85
    attack: "T1110.001"
    file_types: [all]
    requires_all:
      - id: ssh-dir-ref
      - id: etc-hosts-ref
    requires_count: 2
    any:
      - id: weak-pass-root123
      - id: weak-pass-admin123
      - id: weak-pass-passw0rd
      - id: weak-pass-qwerty

  # === Random IP Scanning ===

  - id: random-ip-scanner
    description: Random IP address scanning
    crit: suspicious
    confidence: 0.8
    attack: "T1046"
    file_types: [all]
    requires_all:
      - id: random-target
    requires_any:
      - id: sym-socket-connect
      - id: ip-format
