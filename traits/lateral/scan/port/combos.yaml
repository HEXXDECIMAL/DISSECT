# Lateral Movement - Scanning Composite Rules
# ATT&CK: T1046 (Network Service Discovery)

composite_rules:
  # === Network Scanner Detection ===

  - id: lateral/scan/generic-scanner
    description: Generic network scanning tool
    criticality: suspicious
    confidence: 0.85
    attack: "T1046"
    mbc: "E1046"
    file_types: [all]
    requires_all:
      - type: symbol
        pattern: "^_?(gethostbyname|getaddrinfo)$"
      - type: symbol
        pattern: "^_?(socket|connect)$"
    requires_count: 2
    conditions:
      - type: trait
        id: lateral/scan/ip-format
      - type: trait
        id: lateral/scan/port-ref
      - type: trait
        id: lateral/scan/probe-ref
      - type: trait
        id: lateral/scan/target-ref

  - id: lateral/scan/root-scanner
    description: Root exploitation scanner
    criticality: suspicious
    confidence: 0.9
    attack: "T1046"
    mbc: "E1046"
    file_types: [all]
    requires_all:
      - type: trait
        id: lateral/scan/root-exploit-ref
    requires_any:
      - type: trait
        id: lateral/scan/target-ip-ref
      - type: trait
        id: lateral/scan/random-target

  # === IoT Credential Brute Force ===

  - id: lateral/scan/iot-credential-attack
    description: IoT device credential attack (multiple default passwords)
    criticality: suspicious
    confidence: 0.9
    attack: "T1110.001"
    mbc: "E1110"
    file_types: [all]
    requires_count: 3
    conditions:
      - type: trait
        id: lateral/scan/iot-cred-hikvision
      - type: trait
        id: lateral/scan/iot-cred-xmhdipc
      - type: trait
        id: lateral/scan/iot-cred-cuadmin
      - type: trait
        id: lateral/scan/iot-cred-jvbzd
      - type: trait
        id: lateral/scan/iot-cred-tsgoingon
      - type: trait
        id: lateral/scan/iot-cred-lnadmin
      - type: trait
        id: lateral/scan/iot-cred-zte521
      - type: trait
        id: lateral/scan/iot-cred-oelinux
      - type: trait
        id: lateral/scan/iot-cred-xc3511
      - type: trait
        id: lateral/scan/iot-cred-vizxv

  - id: lateral/scan/router-brute-force
    description: Router credential brute force attack
    criticality: suspicious
    confidence: 0.85
    attack: "T1110.001"
    file_types: [all]
    requires_all:
      - type: string
        exact: ".ssh"
      - type: string
        exact: "/etc/hosts"
    requires_count: 2
    conditions:
      - type: trait
        id: lateral/scan/weak-pass-root123
      - type: trait
        id: lateral/scan/weak-pass-admin123
      - type: trait
        id: lateral/scan/weak-pass-passw0rd
      - type: trait
        id: lateral/scan/weak-pass-qwerty

  # === Random IP Scanning ===

  - id: lateral/scan/random-ip-scanner
    description: Random IP address scanning
    criticality: suspicious
    confidence: 0.8
    attack: "T1046"
    file_types: [all]
    requires_all:
      - type: trait
        id: lateral/scan/random-target
    requires_any:
      - type: symbol
        pattern: "^_?(socket|connect)$"
      - type: trait
        id: lateral/scan/ip-format
