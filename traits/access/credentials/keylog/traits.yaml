# Keylogging Detection
# MBC: OB0005 (Credential Access) â†’ B0015 (Keylogging)
# ATT&CK: T1056.001 (Input Capture: Keylogging)

traits:
  # Windows
  - id: windows-hook
    description: Windows keyboard hooking via SetWindowsHookEx
    criticality: hostile
    mbc: "B0015.001"
    attack: "T1056.001"
    confidence: 1.0
    condition:
      type: symbol
      pattern: SetWindowsHookEx
    platforms: [windows]
    file_types: [pe, dll]

  - id: windows-rawinput
    description: Windows raw input API for keyboard access
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 1.0
    condition:
      type: symbol
      pattern: GetRawInputData
    platforms: [windows]

  - id: windows-getasynckey
    description: Windows GetAsyncKeyState for key polling
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 0.9
    condition:
      type: symbol
      pattern: GetAsyncKeyState
    platforms: [windows]

  # Linux
  - id: linux-input
    description: Direct access to Linux input devices
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 1.0
    condition:
      type: string
      regex: "/dev/input/event[0-9]+"
    platforms: [linux]

  - id: linux-x11-grab
    description: X11 key grabbing for keylogging
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 0.9
    condition:
      type: symbol
      pattern: XGrabKey
    platforms: [linux, unix]

  # macOS
  - id: macos-eventtap
    description: macOS CGEventTap for key interception
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 1.0
    condition:
      type: symbol
      pattern: CGEventTapCreate
    platforms: [macos]

  # Language-specific
  - id: go-robotn
    description: Go robotn/gohook keyboard capture library
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 1.0
    language: go
    condition:
      type: string
      exact: "github.com/robotn/gohook"

  - id: python-pynput
    description: Python pynput keyboard listener
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 1.0
    language: python
    condition:
      type: string
      regex: "from pynput import keyboard|from pynput.keyboard"

  - id: js-iohook
    description: Node.js iohook global keyboard hook library
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 1.0
    language: javascript
    condition:
      type: string
      regex: "require\\(['\"]iohook['\"]\\)|from ['\"]iohook['\"]"

  - id: rust-rdev
    description: Rust rdev keyboard event library
    criticality: hostile
    mbc: "B0015"
    attack: "T1056.001"
    confidence: 0.9
    language: rust
    condition:
      type: string
      regex: "use rdev::|extern crate rdev"
