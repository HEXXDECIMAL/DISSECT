# Remote Shell Detection
# MBC: OB0004 (Command & Control) â†’ B0030 (C2 Communication)
# ATT&CK: T1059 (Command and Scripting Interpreter)

traits:
  # Reverse shell components
  - id: c2/shells/reverse/socket-connect
    description: Network socket connection (potential reverse shell)
    criticality: notable
    mbc: "B0030.002"
    attack: "T1071"
    confidence: 0.6
    condition:
      type: symbol
      pattern: connect
    platforms: [all]

  - id: c2/shells/reverse/dup2-redirect
    description: File descriptor duplication (I/O redirection)
    criticality: notable
    mbc: "B0030.002"
    confidence: 0.5
    condition:
      type: symbol
      pattern: dup2
    platforms: [unix, linux, macos]

  - id: c2/shells/reverse/python-socket-connect
    description: Python socket connection
    criticality: notable
    confidence: 0.8
    file_types: [python]
    condition:
      type: ast_pattern
      node_type: call
      pattern: ".connect("

  - id: c2/shells/reverse/python-dup2
    description: Python file descriptor duplication (os.dup2)
    criticality: notable
    confidence: 0.85
    file_types: [python]
    condition:
      type: ast_pattern
      node_type: call
      pattern: "os.dup2"

  - id: c2/shells/reverse/python-pty-spawn
    description: Python PTY spawn (interactive shell)
    criticality: suspicious
    confidence: 0.9
    file_types: [python]
    condition:
      type: ast_pattern
      node_type: call
      pattern: "pty.spawn"

  # Bind shell components
  - id: c2/shells/reverse/socket-bind
    description: Socket binding (potential bind shell)
    criticality: notable
    mbc: "B0030.003"
    attack: "T1071"
    confidence: 0.6
    condition:
      type: symbol
      pattern: bind
    platforms: [all]

  - id: c2/shells/reverse/socket-listen
    description: Socket listening (potential bind shell)
    criticality: notable
    mbc: "B0030.003"
    confidence: 0.6
    condition:
      type: symbol
      pattern: listen
    platforms: [all]


