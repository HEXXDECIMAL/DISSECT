# IRC Bot/C2 Detection Patterns
# ATT&CK: T1071.001 (Application Layer Protocol: Web Protocols)

defaults:
  attack: "T1071.001"

traits:
  # === IRC protocol indicators ===
  - id: irc-privmsg
    desc: IRC PRIVMSG command
    crit: notable
    conf: 0.5
    if:
      type: string
      exact: PRIVMSG

  - id: irc-nick
    desc: IRC NICK command
    crit: notable
    conf: 0.4
    if:
      type: string
      exact: "NICK "

  - id: irc-user
    desc: IRC USER command
    crit: notable
    conf: 0.4
    if:
      type: string
      exact: "USER "

  # === Bot command indicators ===
  - id: cmd-login
    desc: Bot login command
    crit: notable
    conf: 0.6
    if:
      type: string
      exact: ".login"

  - id: cmd-udp
    desc: Bot UDP attack command
    crit: suspicious
    conf: 0.8
    if:
      type: string
      exact: ".udp"

  - id: cmd-tcp
    desc: Bot TCP attack command
    crit: suspicious
    conf: 0.8
    if:
      type: string
      exact: ".tcp"

  - id: cmd-shell
    desc: Bot shell command
    crit: suspicious
    conf: 0.8
    if:
      type: string
      exact: ".shell"

  # === Tsunami/Kaiten identifiers ===
  - id: tsunami-name
    desc: Tsunami bot name
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: '\btsunami\b'
      case_insensitive: true

  - id: kaiten-name
    desc: Kaiten bot name
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: '\bkaiten\b'
      case_insensitive: true

  # === DDoS indicators ===
  - id: attack-pan
    desc: PAN attack type indicator
    crit: notable
    conf: 0.5
    if:
      type: string
      word: "PAN"

  - id: attack-udp
    desc: UDP attack type indicator
    crit: notable
    conf: 0.5
    if:
      type: string
      regex: "\\bUDP[_-]?ATTACK\\b|\\bUDP[_-]?FLOOD\\b"
      case_insensitive: true

  - id: ddos-flood
    desc: Flood attack terminology
    crit: notable
    conf: 0.5
    if:
      type: string
      exact: flood
      case_insensitive: true

  - id: ddos-attack
    desc: Attack terminology
    crit: notable
    conf: 0.4
    if:
      type: string
      exact: attack
      case_insensitive: true

composite_rules:
  # Helper: IRC protocol
  - id: irc-protocol
    desc: IRC protocol commands
    any:
      - id: irc-privmsg
      - id: irc-nick
      - id: irc-user

  # Helper: DDoS terms
  - id: ddos-attack-terms
    desc: DDoS attack terminology
    any:
      - id: attack-pan
      - id: attack-udp
      - id: ddos-flood
      - id: ddos-attack

  # Tsunami/Kaiten identifier
  - id: tsunami-artifact
    desc: Tsunami/Kaiten IRC bot identifier
    crit: notable
    conf: 0.7
    count_min: 1
    any:
      - id: tsunami-name
      - id: kaiten-name

  # IRC bot C2 (IRC protocol + any command)
  - id: bot-logic
    desc: IRC-based command and control logic
    crit: suspicious
    conf: 0.8
    all:
      - id: irc-protocol
    any:
      - id: cmd-login
      - id: cmd-udp
      - id: cmd-tcp
      - id: cmd-shell

  # IRC DDoS (IRC protocol + DDoS attack terminology)
  - id: irc-ddos
    desc: IRC-controlled DDoS attack logic
    crit: suspicious
    conf: 0.9
    all:
      - id: irc-protocol
      - id: ddos-attack-terms

  # Tsunami IRC bot with C2 logic
  - id: tsunami-irc-bot
    desc: Tsunami/Kaiten IRC bot with C2
    crit: suspicious
    conf: 0.85
    all:
      - id: c2/irc/tsunami-artifact
      - id: c2/irc/bot-logic

  # Tsunami DDoS bot
  - id: tsunami-ddos-bot
    desc: Tsunami/Kaiten IRC bot with DDoS
    crit: suspicious
    conf: 0.9
    all:
      - id: c2/irc/tsunami-artifact
      - id: c2/irc/irc-ddos

  # IRC bot with DDoS
  - id: irc-bot-ddos
    desc: IRC bot with DDoS attack
    crit: suspicious
    conf: 0.85
    all:
      - id: c2/irc/bot-logic
      - id: c2/irc/irc-ddos
