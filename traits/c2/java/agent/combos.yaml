# Java RAT Behavior Detection
# Composite rules that combine traits to detect RAT capabilities

composite_rules:
  # Full-featured Java RAT (STRRat-style)
  - id: java-rat-comprehensive
    description: Comprehensive Java RAT with multiple capabilities
    criticality: suspicious
    mbc: "B0022"
    attack: "T1219"
    confidence: 0.98
    file_types: [class]
    requires_count: 4
    conditions:
      # Credential access
      - type: trait
        id: chrome-pass-string
      - type: trait
        id: firefox-pass-string
      - type: trait
        id: keylogger-string
      - type: trait
        id: all-pass-string
      # C2 commands
      - type: trait
        id: remote-cmd-string
      - type: trait
        id: power-shell-string
      - type: trait
        id: down-n-exec-string
      - type: trait
        id: up-n-exec-string
      - type: trait
        id: remote-screen-string
      # Impact
      - type: trait
        id: reboot-string
      - type: trait
        id: uninstall-string

  # Java credential stealer
  - id: java-credential-stealer
    description: Java-based credential stealing capability
    criticality: suspicious
    mbc: "T1555"
    attack: "T1555"
    confidence: 0.95
    file_types: [class]
    requires_count: 2
    conditions:
      - type: trait
        id: chrome-pass-string
      - type: trait
        id: firefox-pass-string
      - type: trait
        id: ie-pass-string
      - type: trait
        id: outlook-pass-string
      - type: trait
        id: thunderbird-pass-string
      - type: trait
        id: foxmail-pass-string
      - type: trait
        id: all-pass-string
      - type: trait
        id: save-all-pass-string

  # Java keylogger
  - id: java-keylogger
    description: Java keylogging capability
    criticality: suspicious
    mbc: "T1056.001"
    attack: "T1056.001"
    confidence: 0.95
    file_types: [class]
    requires_any:
      - type: trait
        id: keylogger-string
      - type: trait
        id: o-keylogger-string

  # Java remote access
  - id: java-remote-access
    description: Java remote access capability
    criticality: suspicious
    mbc: "B0022"
    attack: "T1021"
    confidence: 0.95
    file_types: [class]
    requires_count: 2
    conditions:
      - type: trait
        id: remote-screen-string
      - type: trait
        id: hrdp-new-string
      - type: trait
        id: hrdp-res-string
      - type: trait
        id: remote-cmd-string
      - type: trait
        id: power-shell-string

  # Java dropper/downloader
  - id: java-dropper
    description: Java download and execute capability
    criticality: suspicious
    mbc: "B0025"
    attack: "T1105"
    confidence: 0.95
    file_types: [class]
    requires_any:
      - type: trait
        id: down-n-exec-string
      - type: trait
        id: up-n-exec-string

  # Java ransomware indicators
  - id: java-ransomware
    description: Java ransomware capability
    criticality: suspicious
    mbc: "B0031"
    attack: "T1486"
    confidence: 0.95
    file_types: [class]
    requires_all:
      - type: trait
        id: rw-encrypt-string
      - type: trait
        id: rw-decrypt-string

  # Allatori obfuscated Java (likely malware)
  - id: java-allatori-obfuscated
    description: Java obfuscated with Allatori (common in malware)
    criticality: suspicious
    confidence: 0.9
    mbc: "B0032"
    attack: "T1027"
    file_types: [class]
    requires_all:
      - type: string
        exact: "ALLATORIxDEMO"
