# Java RAT Behavior Detection
# Composite rules that combine traits to detect RAT capabilities

capabilities:
  # Full-featured Java RAT (STRRat-style)
  - id: java-rat-comprehensive
    description: Comprehensive Java RAT with multiple capabilities
    criticality: suspicious
    mbc: "B0022"
    attack: "T1219"
    confidence: 0.98
    file_types: [class]
    requires_count: 4
    conditions:
      # Credential access
      - type: trait
        id: credential/java/chrome-pass-string
      - type: trait
        id: credential/java/firefox-pass-string
      - type: trait
        id: credential/java/keylogger-string
      - type: trait
        id: credential/java/all-pass-string
      # C2 commands
      - type: trait
        id: c2/java/remote-cmd-string
      - type: trait
        id: c2/java/power-shell-string
      - type: trait
        id: c2/java/down-n-exec-string
      - type: trait
        id: c2/java/up-n-exec-string
      - type: trait
        id: c2/java/remote-screen-string
      # Impact
      - type: trait
        id: impact/java/reboot-string
      - type: trait
        id: impact/java/uninstall-string

  # Java credential stealer
  - id: java-credential-stealer
    description: Java-based credential stealing capability
    criticality: suspicious
    mbc: "T1555"
    attack: "T1555"
    confidence: 0.95
    file_types: [class]
    requires_count: 2
    conditions:
      - type: trait
        id: credential/java/chrome-pass-string
      - type: trait
        id: credential/java/firefox-pass-string
      - type: trait
        id: credential/java/ie-pass-string
      - type: trait
        id: credential/java/outlook-pass-string
      - type: trait
        id: credential/java/thunderbird-pass-string
      - type: trait
        id: credential/java/foxmail-pass-string
      - type: trait
        id: credential/java/all-pass-string
      - type: trait
        id: credential/java/save-all-pass-string

  # Java keylogger
  - id: java-keylogger
    description: Java keylogging capability
    criticality: suspicious
    mbc: "T1056.001"
    attack: "T1056.001"
    confidence: 0.95
    file_types: [class]
    requires_any:
      - type: trait
        id: credential/java/keylogger-string
      - type: trait
        id: credential/java/o-keylogger-string

  # Java remote access
  - id: java-remote-access
    description: Java remote access capability
    criticality: suspicious
    mbc: "B0022"
    attack: "T1021"
    confidence: 0.95
    file_types: [class]
    requires_count: 2
    conditions:
      - type: trait
        id: c2/java/remote-screen-string
      - type: trait
        id: c2/java/hrdp-new-string
      - type: trait
        id: c2/java/hrdp-res-string
      - type: trait
        id: c2/java/remote-cmd-string
      - type: trait
        id: c2/java/power-shell-string

  # Java dropper/downloader
  - id: java-dropper
    description: Java download and execute capability
    criticality: suspicious
    mbc: "B0025"
    attack: "T1105"
    confidence: 0.95
    file_types: [class]
    requires_any:
      - type: trait
        id: c2/java/down-n-exec-string
      - type: trait
        id: c2/java/up-n-exec-string

  # Java ransomware indicators
  - id: java-ransomware
    description: Java ransomware capability
    criticality: suspicious
    mbc: "B0031"
    attack: "T1486"
    confidence: 0.95
    file_types: [class]
    requires_all:
      - type: trait
        id: c2/java/rw-encrypt-string
      - type: trait
        id: c2/java/rw-decrypt-string

  # Allatori obfuscated Java (likely malware)
  - id: java-allatori-obfuscated
    description: Java obfuscated with Allatori (common in malware)
    criticality: suspicious
    confidence: 0.9
    file_types: [class]
    requires_all:
      - type: string
        exact: "ALLATORIxDEMO"
