# IoT Botnet Detection
# Patterns common to Mirai, Gafgyt, and similar IoT malware
# ATT&CK: T1059.004, T1110.001

traits:
  # NOTE: Individual "/bin/busybox" string is notable, not suspicious
  # Real IoT malware detection requires multiple indicators (see composite rules)
  - id: c2/botnet/iot/busybox
    description: "BusyBox reference (IoT device targeting)"
    criticality: notable
    confidence: 0.5
    attack: "T1059.004"
    file_types: [elf]
    platforms: [linux]
    condition:
      type: string
      exact: "/bin/busybox"

  - id: c2/botnet/iot/busybox-wget
    description: "BusyBox wget payload download"
    criticality: suspicious
    confidence: 0.9
    attack: "T1105"
    file_types: [elf]
    platforms: [linux]
    condition:
      type: string
      regex: "busybox wget"

  - id: c2/botnet/iot/busybox-tftp
    description: "BusyBox tftp payload download"
    criticality: suspicious
    confidence: 0.9
    attack: "T1105"
    file_types: [elf]
    platforms: [linux]
    condition:
      type: string
      regex: "busybox tftp"

  - id: c2/botnet/iot/busybox-ftpget
    description: "BusyBox ftpget payload download"
    criticality: suspicious
    confidence: 0.9
    attack: "T1105"
    file_types: [elf]
    platforms: [linux]
    condition:
      type: string
      regex: "busybox ftpget"

  - id: c2/botnet/iot/pipe-to-shell
    description: "Download and pipe to shell execution"
    criticality: suspicious
    confidence: 0.95
    mbc: "B0024"
    attack: "T1059.004"
    file_types: [elf]
    platforms: [linux]
    condition:
      type: string
      regex: "\\| *sh|sh;|-o- \\| sh|-O- \\| sh"

  - id: c2/botnet/iot/mirai-credential
    description: "Mirai botnet default credential (7ujMko0admin)"
    criticality: suspicious
    confidence: 0.99
    attack: "T1110.001"
    file_types: [elf]
    platforms: [linux]
    condition:
      type: string
      exact: "7ujMko0admin"

  - id: c2/botnet/iot/telnet-target
    description: "Telnet service targeting"
    criticality: suspicious
    confidence: 0.8
    attack: "T1021.007"
    file_types: [elf]
    platforms: [linux]
    condition:
      type: string
      regex: "telnetadmin|:23[^0-9]"

  - id: c2/botnet/iot/self-propagate
    description: "Read own executable for propagation"
    criticality: suspicious
    confidence: 0.8
    mbc: "E1036"
    attack: "T1105"
    file_types: [elf]
    platforms: [linux]
    condition:
      type: string
      exact: "/proc/self/exe"

composite_rules:
  - id: c2/botnet/mirai-variant
    description: "Mirai-like IoT botnet (credential brute-force + shell dropper)"
    criticality: suspicious
    confidence: 0.95
    mbc: "B0030"
    attack: "T1110.001"
    file_types: [elf]
    platforms: [linux]
    requires_count: 2
    conditions:
      - type: trait
        id: mirai-credential
      - type: trait
        id: busybox
      - type: trait
        id: pipe-to-shell

  - id: c2/botnet/multi-protocol
    description: "Multi-protocol payload dropper (wget/tftp/ftpget/curl)"
    criticality: suspicious
    confidence: 0.9
    mbc: "B0024"
    attack: "T1105"
    file_types: [elf]
    platforms: [linux]
    requires_count: 2
    conditions:
      - type: trait
        id: busybox-wget
      - type: trait
        id: busybox-tftp
      - type: trait
        id: busybox-ftpget
      - type: string
        exact: "curl http://"
