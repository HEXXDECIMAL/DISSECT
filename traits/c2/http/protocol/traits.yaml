# HTTP C2 Protocol Detection
# Detects HTTP protocol strings and patterns in binaries
# ATT&CK: T1071.001 (Application Layer Protocol: Web Protocols)

defaults:
  file_types: [elf, pe, macho]
  attack: "T1071.001"
  criticality: notable

composite_rules:
  - id: http-protocol-string
    description: "HTTP protocol version string"
    confidence: 0.3
    condition:
      type: string
      regex: "HTTP/[012]\\.[0-9]"

  - id: http-method-get
    description: "HTTP GET method string"
    confidence: 0.25
    condition:
      type: string
      regex: "GET /[^ ]+ HTTP"

  - id: http-method-post
    description: "HTTP POST method string"
    confidence: 0.35
    condition:
      type: string
      regex: "POST /[^ ]+ HTTP"

  - id: http-user-agent
    description: "HTTP User-Agent header"
    confidence: 0.3
    condition:
      type: string
      regex: "User-Agent:"

  - id: http-content-type
    description: "HTTP Content-Type header"
    confidence: 0.25
    condition:
      type: string
      regex: "Content-Type:"

  - id: http-delimiter
    description: "HTTP header/body delimiter (CRLF CRLF)"
    confidence: 0.2
    condition:
      type: string
      exact: "\r\n\r\n"

  - id: hardcoded-request
    description: "Hardcoded HTTP request in binary"
    criticality: suspicious
    confidence: 0.7
    requires_all:
      - type: trait
        id: http-protocol-string
    requires_any:
      - type: trait
        id: http-method-get
      - type: trait
        id: http-method-post

  - id: custom-client
    description: "Custom HTTP client implementation"
    criticality: suspicious
    confidence: 0.65
    requires_all:
      - type: trait
        id: http-protocol-string
      - type: trait
        id: http-delimiter
    requires_any:
      - type: trait
        id: http-user-agent
      - type: trait
        id: http-content-type
