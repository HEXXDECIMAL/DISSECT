# Composite Shell Capabilities

composite_rules:
  - id: reverse-shell
    description: Classic reverse shell pattern (socket + dup2 + shell)
    criticality: suspicious
    mbc: "B0030.002"
    attack: "T1059"
    confidence: 0.95
    platforms: [linux, macos, unix]
    requires_all:
      - type: trait
        id: comm/socket/connect/connect
      - type: trait
        id: dup2-redirect
    requires_any:
      - type: trait
        id: exec/command/shell/bin-sh
      - type: trait
        id: exec/command/shell/bin-bash

  - id: bind-shell
    description: Bind shell pattern (socket + bind + listen + shell)
    criticality: suspicious
    mbc: "B0030.003"
    attack: "T1059"
    confidence: 0.95
    requires_all:
      - type: trait
        id: comm/socket/bind/bind
      - type: trait
        id: comm/socket/listen/listen
    requires_any:
      - type: trait
        id: exec/command/shell/bin-sh
      - type: trait
        id: exec/command/shell/bin-bash

  - id: python-reverse-shell
    description: "Python reverse shell detected (socket + pty/dup2)"
    criticality: hostile
    mbc: "B0022"
    attack: "T1059"
    confidence: 0.98
    file_types: [python]
    near_lines: 20
    requires_all:
      - type: trait
        id: python-socket-connect
      - type: trait
        id: c2/reverse-shell/python-redirection

  - id: python-redirection
    description: "Python shell redirection (pty/dup2)"
    criticality: suspicious
    requires_any:
      - type: trait
        id: python-pty-spawn
      - type: trait
        id: python-dup2


