# Reverse Shell Detection - Ruby
# MBC: B0033 (Adversary-in-the-Middle)
# ATT&CK: T1059

traits:
  - id: reverse-shell-ruby
    description: Reverse shell in Ruby
    criticality: suspicious
    confidence: 0.66
    attack: "T1059"
    condition:
      type: yara
      source: |
        rule ruby_reverse_shell {
          strings:
            $spawn = /spawn\(["']\/bin\/sh["'],.{0,64}TCPSocket/
            $popen = /TCPSocket.{0,64}IO.popen/
            $tcp_sh = /TCPSocket.{0,64}\/bin\/sh -i/
          condition:
            filesize < 64KB and any of them
        }
