# Remote Shell Detection
# MBC: OB0004 (Command & Control) â†’ B0030 (C2 Communication)
# ATT&CK: T1059 (Command and Scripting Interpreter)
# NOTE: Socket connect/bind/listen are defined in comm/socket/*/unix.yaml

traits:
  # Reverse shell components - dup2 for I/O redirection
  - id: dup2-redirect
    description: File descriptor duplication (I/O redirection)
    criticality: notable
    mbc: "B0030.002"
    confidence: 0.5
    file_types: [elf, macho, so, dylib, c]
    condition:
      type: symbol
      pattern: dup2
    platforms: [unix, linux, macos]

  # Python-specific reverse shell patterns
  - id: python-socket-connect
    description: Python socket connection
    criticality: notable
    confidence: 0.8
    file_types: [python]
    condition:
      type: ast_pattern
      node_type: call
      pattern: ".connect("

  - id: python-dup2
    description: Python file descriptor duplication (os.dup2)
    criticality: notable
    confidence: 0.85
    file_types: [python]
    condition:
      type: ast_pattern
      node_type: call
      pattern: "os.dup2"

  - id: python-pty-spawn
    description: Python PTY spawn (interactive shell)
    criticality: suspicious
    confidence: 0.9
    file_types: [python]
    condition:
      type: ast_pattern
      node_type: call
      pattern: "pty.spawn"


