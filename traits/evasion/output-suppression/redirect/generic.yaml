# Output Suppression Detection Traits
# Detects patterns that hide command output
# Note: /dev/null redirects are common in legitimate scripts for suppressing noise
# ATT&CK: T1564.001 (Hide Artifacts: Hidden Files and Directories)

defaults:
  mbc: "F0005"
  attack: "T1564"
  for: [all]

traits:
  # === stdout redirect atomic indicators ===
  - id: redirect-devnull-nospace
    desc: ">/dev/null redirect (no space)"
    crit: inert
    conf: 0.4
    if:
      type: string
      exact: ">/dev/null"
      search_raw: true

  - id: redirect-devnull-space
    desc: '"> /dev/null" redirect (with space)'
    crit: inert
    conf: 0.4
    if:
      type: string
      exact: "> /dev/null"
      search_raw: true

  # === stderr redirect atomic indicators ===
  - id: stderr-devnull-nospace
    desc: 2>/dev/null redirect
    crit: inert
    conf: 0.4
    if:
      type: string
      exact: "2>/dev/null"
      search_raw: true

  - id: stderr-devnull-space
    desc: '"2> /dev/null" redirect'
    crit: inert
    conf: 0.4
    if:
      type: string
      exact: "2> /dev/null"
      search_raw: true

  - id: stderr-stdout-devnull
    desc: 2>&1 combined with /dev/null
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "2>&1.{0,30}>/dev/null"
      search_raw: true

  # === all output suppression atomic indicators ===
  - id: stdout-then-stderr
    desc: ">/dev/null 2>&1 pattern"
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: ">/dev/null 2>&1"
      search_raw: true

  - id: ampersand-devnull
    desc: '"&>/dev/null" bash pattern'
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "&>/dev/null"
      search_raw: true

  - id: stderr-then-stdout
    desc: '"2>&1 >/dev/null" pattern'
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "2>&1 >/dev/null"
      search_raw: true

composite_rules:
  - id: redirect-to-devnull
    desc: Output redirected to /dev/null
    crit: notable
    conf: 0.5
    count: 1
    any:
      - id: redirect-devnull-nospace
      - id: redirect-devnull-space

  - id: stderr-to-devnull
    desc: Standard error redirected to /dev/null
    crit: notable
    conf: 0.5
    count: 1
    any:
      - id: stderr-devnull-nospace
      - id: stderr-devnull-space
      - id: stderr-stdout-devnull

  - id: all-output-suppressed
    desc: All output suppressed (stdout and stderr to /dev/null)
    crit: notable
    conf: 0.6
    count: 1
    any:
      - id: stdout-then-stderr
      - id: ampersand-devnull
      - id: stderr-then-stdout
