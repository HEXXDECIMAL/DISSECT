# Log Clearing Detection - Linux
# MBC: F0005 (Indicator Blocking)
# ATT&CK: T1070.001

traits:
  # === System Log Paths ===
  - id: var-log-wtmp
    desc: /var/log/wtmp login records
    crit: notable
    conf: 0.7
    if:
      type: string
      exact: "/var/log/wtmp"

  - id: var-log-btmp
    desc: /var/log/btmp failed logins
    crit: notable
    conf: 0.7
    if:
      type: string
      exact: "/var/log/btmp"

  - id: var-log-lastlog
    desc: /var/log/lastlog last login
    crit: notable
    conf: 0.7
    if:
      type: string
      exact: "/var/log/lastlog"

  - id: var-log-auth
    desc: /var/log/auth authentication log
    crit: notable
    conf: 0.7
    if:
      type: string
      exact: "/var/log/auth"

  - id: var-log-secure
    desc: /var/log/secure security log
    crit: notable
    conf: 0.7
    if:
      type: string
      exact: "/var/log/secure"

  - id: var-log-messages
    desc: /var/log/messages system messages
    crit: notable
    conf: 0.7
    if:
      type: string
      exact: "/var/log/messages"

  # === Log Clearing Commands ===
  - id: redirect-var-log
    desc: ">/var/log/ redirect to log file"
    crit: suspicious
    conf: 0.85
    mbc: "F0005"
    attack: "T1070.001"
    if:
      type: string
      exact: ">/var/log/"

  - id: history-c
    desc: history -c clear history command
    crit: suspicious
    conf: 0.85
    mbc: "F0005"
    attack: "T1070.003"
    if:
      type: string
      exact: "history -c"

  - id: history-r
    desc: history -r reload history command
    crit: notable
    conf: 0.7
    mbc: "F0005"
    if:
      type: string
      exact: "history -r"

  - id: unset-histfile
    desc: unset HISTFILE command
    crit: suspicious
    conf: 0.85
    mbc: "F0005"
    attack: "T1070.003"
    if:
      type: string
      exact: "unset HISTFILE"

  - id: truncate-var-log
    desc: truncate /var/log command
    crit: suspicious
    conf: 0.9
    mbc: "F0005"
    attack: "T1070.001"
    if:
      type: string
      regex: 'truncate\s+(-s\s*0\s+)?/var/log'

composite_rules:
  # System log paths (migrated from YARA)
  - id: system-log
    desc: Reference to system log file
    crit: notable
    conf: 0.66
    count: 1
    any:
      - id: var-log-wtmp
      - id: var-log-btmp
      - id: var-log-lastlog
      - id: var-log-auth
      - id: var-log-secure
      - id: var-log-messages

  # Log clearing (migrated from YARA)
  - id: log-clear
    desc: Clear system logs or history
    crit: suspicious
    conf: 0.8
    mbc: "F0005"
    attack: "T1070.001"
    count: 1
    any:
      - id: redirect-var-log
      - id: history-c
      - id: history-r
      - id: unset-histfile
      - id: truncate-var-log
