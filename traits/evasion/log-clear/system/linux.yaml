# Log Clearing Detection - Linux
# MBC: F0005 (Indicator Blocking)
# ATT&CK: T1070.001

traits:
  - id: system-log
    desc: Reference to system log file
    crit: notable
    conf: 0.66
    if:
      type: yara
      source: |
        rule system_log_paths {
          strings:
            $wtmp = "/var/log/wtmp" ascii fullword
            $btmp = "/var/log/btmp" ascii fullword
            $lastlog = "/var/log/lastlog" ascii fullword
            $auth_log = "/var/log/auth" ascii fullword
            $secure_log = "/var/log/secure" ascii fullword
            $messages = "/var/log/messages" ascii fullword
          condition:
            any of them
        }

  - id: log-clear
    desc: Clear system logs or history
    crit: suspicious
    conf: 0.8
    mbc: "F0005"
    attack: "T1070.001"
    if:
      type: yara
      source: |
        rule log_clear {
          strings:
            // Redirect to log file (shell command)
            $var_log = ">/var/log/"
            // History clearing commands
            $history_clear = "history -c"
            $history_r = "history -r"
            $unset_history = "unset HISTFILE"
            // Truncate command with log paths
            $truncate_log = /truncate\s+(-s\s*0\s+)?\/var\/log/
          condition:
            any of them
        }
