# Hidden File Detection Traits
# Detects creation of hidden dotfiles often used to hide malware
# ATT&CK: T1564.001 (Hide Artifacts: Hidden Files and Directories)

defaults:
  for: [all]

traits:
  # === Hidden file write atomic indicators ===
  - id: curl-o-hidden
    desc: curl -O to hidden dotfile
    crit: inert
    conf: 0.7
    mbc: "F0005"
    attack: "T1564.001"
    if:
      type: content


composite_rules:
  - id: hidden-file-write
    desc: Writing to hidden dotfile (malware
    crit: suspicious
    conf: 0.85
    mbc: "F0005"
    attack: "T1564.001"
    count_min: 1
    any:
      - id: curl-o-hidden
      - id: redirect-hidden-space
      - id: redirect-hidden-nospace

  - id: hidden-file-execute
    desc: Executing hidden dotfile
    crit: suspicious
    conf: 0.9
    mbc: "B0024"
    attack: "T1059"
    count_min: 1
    any:
      - id: exec-hidden-space
      - id: exec-hidden-eol
      - id: exec-hidden-semi

  - id: chmod-hidden-file
    desc: Making hidden file executable
    crit: suspicious
    conf: 0.9
    mbc: "C0047"
    attack: "T1222.002"
    count_min: 1
    any:
      - id: chmod-x-hidden
      - id: chmod-7xx-hidden
