defaults:
  for:
  - javascript
  - typescript
  attack: T1027
  mbc: B0032
traits:
- id: js-arrow-function-abuse
  desc: Excessive anonymous arrow functions (obfuscation
  crit: notable
  conf: 0.8
  if:
    type: metrics
    field: functions.anonymous
    min: 100
    min_size: 2048
  unless:
  - type: string
    regex: MathJax|wgxpath|trix|actiontext
  - id: metadata/dev/testing::is-test
- id: js-deep-callback-nesting
  desc: Deep function nesting (callback hell
  crit: notable
  conf: 0.75
  if:
    type: metrics
    field: functions.max_nesting_depth
    min: 6
- id: js-sphinx-searchindex
  desc: Sphinx documentation search index
  crit: notable
  conf: 0.9
  attack: ''
  mbc: ''
  if:
    type: raw
    substr: Search.setIndex
- id: js-iife-heavy
  desc: Repeated immediately invoked function expressions
  crit: notable
  conf: 0.85
  size_min: 2048
  if:
    type: raw
    count_min: 5
    regex: \(\s*(?:async\s+)?function\s*\([^)]{0,50}\)\s*\{|\(\s*[^)]{0,50}\)\s*=>
composite_rules:
- id: js-obfuscator-pattern
  desc: JavaScript obfuscator tool output
  crit: suspicious
  conf: 0.9
  needs: 3
  any:
  - id: objectives/anti-static/obfuscation/code-metrics/source::high-entropy-identifiers
  - id: objectives/anti-static/obfuscation/code-metrics::js-arrow-function-abuse
  - id: objectives/anti-static/obfuscation/code-metrics/strings::high-entropy-strings
  - id: objectives/anti-static/obfuscation/code-metrics/structure::no-comments
  none:
  - id: micro-traits/crypto/cert/operations::pem-begin
- id: js-npm-malware-pattern
  desc: npm malware obfuscation pattern (install
  crit: suspicious
  conf: 0.9
  size_max: 50000
  all:
  - id: objectives/anti-static/obfuscation/code-metrics/source::high-entropy-identifiers
  - id: objectives/anti-static/obfuscation/code-metrics/structure::no-comments
  - id: objectives/anti-static/obfuscation/code-metrics/structure::very-long-lines
  none:
  - id: js-sphinx-searchindex
  - id: micro-traits/crypto/cert/operations::pem-begin
