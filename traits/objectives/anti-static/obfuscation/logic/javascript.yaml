traits:
- id: js-eval-self-string
  desc: Eval executing function with self-toString check
  crit: suspicious
  conf: 0.9
  for:
  - javascript
  if:
    type: raw
    regex: eval\s*\(\s*["']\(function\s+\w+\([^)]{0,120}\)\s*\{.{0,200}\.toString\(\)
- id: js-mixed-hex-octal-math
  desc: Mixed hex and octal arithmetic (obfuscation)
  crit: suspicious
  conf: 0.95
  for:
  - javascript
  if:
    type: raw
    regex: (?:0[oO][0-7]+|0x[\da-fA-F]+)\s*[-+*/&|^%]\s*(?:0[oO][0-7]+|0x[\da-fA-F]+)
composite_rules:
- id: js-complex-obfuscation
  desc: Complex JavaScript obfuscation (hex/octal math + eval)
  crit: hostile
  conf: 0.95
  attack: T1027
  for:
  - javascript
  all:
  - id: js-mixed-hex-octal-math
  - id: objectives/execution/interpreter/eval/dynamic::eval-call-js
