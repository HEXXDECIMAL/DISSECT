traits:
- id: while-not-not-array
  desc: while(!![]) infinite loop pattern
  crit: notable
  conf: 0.85
  attack: T1027
  for:
  - javascript
  if:
    type: raw
    regex: while\(!!\[\]\)
- id: while-not-zero
  desc: while(0x0) infinite loop pattern
  crit: notable
  conf: 0.85
  attack: T1027
  for:
  - javascript
  if:
    type: raw
    regex: while\(0x0\)
- id: while-not-space-zero
  desc: while(!![]) with space infinite loop
  crit: notable
  conf: 0.85
  attack: T1027
  for:
  - javascript
  if:
    type: raw
    regex: while\(\s*!!\s*\[\]\s*\)
- id: push-shift-pattern
  desc: Array push/shift rotation pattern
  crit: notable
  conf: 0.8
  attack: T1027
  for:
  - javascript
  if:
    type: raw
    regex: \.push\([^)]*?\.shift\(\)\)
- id: shift-push-pattern
  desc: Array unshift/pop rotation pattern
  crit: notable
  conf: 0.8
  attack: T1027
  for:
  - javascript
  if:
    type: raw
    regex: \.unshift\([^)]*?\.pop\(\)\)
- id: array-shuffle-algorithm
  desc: Array shuffle algorithm in infinite loop
  crit: suspicious
  conf: 0.88
  attack: T1027
  for:
  - javascript
  if:
    type: raw
    regex: while\(!!\[\]\).*?try.*?parseInt.*?\.push.*?\.shift
- id: array-swap-elements
  desc: Array element swap pattern
  crit: notable
  conf: 0.75
  attack: T1027
  for:
  - javascript
  if:
    type: raw
    regex: \w+\[\w+\]\s*=\s*\w+\[\w+\];\s*\w+\[\w+\]\s*=\s*\w+\[\w+\];\s*\w+\[\w+\]\s*=\s*\w+
composite_rules:
- id: infinite-loop
  desc: Obfuscated infinite loop (while(!![]) pattern)
  crit: notable
  conf: 0.9
  attack: T1027
  for:
  - javascript
  any:
  - id: while-not-not-array
  - id: while-not-zero
  - id: while-not-space-zero
- id: string-array-rotation
  desc: String array with rotation decoder
  crit: notable
  conf: 0.9
  attack: T1027
  for:
  - javascript
  any:
  - id: push-shift-pattern
  - id: shift-push-pattern
  - id: array-shuffle-algorithm
- id: advanced-array-shuffling
  desc: Advanced array shuffling algorithm
  crit: hostile
  conf: 0.95
  attack: T1027.002
  for:
  - javascript
  all:
  - id: infinite-loop
  - id: string-array-rotation
  any:
  - id: array-swap-elements
  - id: string-array-rotation
