# PHP Impersonation/Evasion Traits
# Bot and User-Agent impersonation for evasion
# MBC: B0032 (Obfuscated Files or Information)
# ATT&CK: T1036

traits:
  - id: googlebot
    desc: Googlebot User-Agent impersonation
    crit: suspicious
    conf: 0.9
    mbc: "B0032"
    attack: "T1036"
    for: [php]
    if:
      type: string
      regex: "Googlebot/\\d"

  - id: bingbot
    desc: Bingbot User-Agent impersonation
    crit: suspicious
    conf: 0.9
    mbc: "B0032"
    attack: "T1036"
    for: [php]
    if:
      type: string
      regex: "bingbot/\\d"

  - id: ua-array
    desc: User-Agent string array (rotation for
    crit: suspicious
    conf: 0.85
    mbc: "B0032"
    attack: "T1036"
    for: [php]
    if:
      type: string
      regex: "Mozilla/5\\.0.{0,50}Mozilla/5\\.0.{0,50}Mozilla/5\\.0"

  # === array-rand UA atomic indicators ===
  - id: array-rand-mozilla
    desc: array_rand followed by Mozilla
    crit: notable
    conf: 0.7
    mbc: "B0032"
    for: [php]
    if:
      type: string
      regex: "array_rand.{0,50}Mozilla"

  - id: mozilla-array-rand
    desc: Mozilla followed by array_rand
    crit: notable
    conf: 0.7
    mbc: "B0032"
    for: [php]
    if:
      type: string
      regex: "Mozilla.{0,50}array_rand"

composite_rules:
  # array-rand UA composite
  - id: array-rand-ua
    desc: Random User-Agent selection
    crit: suspicious
    conf: 0.8
    mbc: "B0032"
    for: [php]
    any:
      - id: array-rand-mozilla
      - id: mozilla-array-rand
