# NPM Recon and Exfiltration Patterns
# High-confidence malicious patterns combining info gathering and exfil

composite_rules:
  - id: npm-exfil-method
    desc: Network tools used for exfiltration in NPM package
    crit: notable
    conf: 0.7
    any:
      - id: objectives/lateral-movement/supply-chain/npm/install::script-curl
      - id: objectives/lateral-movement/supply-chain/npm/install::script-wget
      - id: micro-behaviors/comm/http/post::post

  - id: npm-victim-id-recon
    desc: NPM package collects victim identifiers
    crit: suspicious
    conf: 0.9
    all:
      - id: objectives/discovery/host/system/hardware-fingerprint::js-victim-id
      - id: objectives/lateral-movement/supply-chain/npm/behavior::small-file-5k

  - id: npm-victim-stealer-hostile
    desc: Hostile NPM victim identifier stealer (Recon + Exfil)
    crit: hostile
    conf: 0.98
    attack: T1020
    mbc: E1041
    all:
      - id: npm-victim-id-recon
      - id: npm-exfil-method
