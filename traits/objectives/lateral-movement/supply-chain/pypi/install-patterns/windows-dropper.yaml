defaults:
  crit: hostile
  attack: T1195.002
  mbc: E1195
  for: [python]

composite_rules:
  # Helper: Any start process method
  - id: win32-start-process-combo
    desc: Windows start process method
    crit: notable
    conf: 0.8
    any:
      - id: micro-traits/process/create/launch::python-start-process
      - id: micro-traits/process/create/launch::os-startfile-call

  # Helper: Any network activity
  - id: python-network-combo
    desc: Python network activity
    crit: notable
    conf: 0.8
    any:
      - id: micro-traits/comm/http/request::request-python
      - id: micro-traits/comm/http/lib/requests::requests-python
      - id: micro-traits/comm/socket/connect::socket-data-transfer

  # Helper: Install context
  - id: pypi-install-context-combo
    desc: PyPI install context
    crit: notable
    conf: 1.0
    any:
      - id: objectives/lateral-movement/supply-chain/pypi/install-patterns::setup-py-file
      - id: objectives/lateral-movement/supply-chain/pypi/install-patterns::py-basename

  # Main Rule
  - id: windows-target-dropper
    desc: PyPI setup/init script targeting Windows with payload delivery
    conf: 0.95
    all:
      - id: micro-traits/os/sysinfo/platform::python-win32-check
      - id: win32-start-process-combo
      - id: python-network-combo
      - id: pypi-install-context-combo
