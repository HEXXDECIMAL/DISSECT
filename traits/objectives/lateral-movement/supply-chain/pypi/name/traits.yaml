defaults:
  crit: suspicious
  attack: T1036.005
  mbc: F0004
  for:
    - all

traits:
  - id: pkginfo-name-contains-requests
    desc: Package name contains requests library name
    crit: notable
    conf: 0.7
    attack: T1036.005
    if:
      type: kv
      path: name
      regex: (^|[_-])requests([_-]|$)

  - id: messaging-impersonation-discord
    desc: Discord platform impersonation in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)discord' }

  - id: messaging-impersonation-telegram
    desc: Telegram platform impersonation in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)telegram' }

  - id: messaging-impersonation-whatsapp
    desc: WhatsApp platform impersonation in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)whatsapp' }

  - id: messaging-impersonation-signal
    desc: Signal platform impersonation in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)signal' }

  - id: messaging-security-suffix
    desc: Security-related suffix in package name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)[-_.]?(safe|secur|auth|token)' }

  - id: module-fragment-http
    desc: HTTP module fragment in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)http' }

  - id: module-fragment-api
    desc: API module fragment in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)api' }

  - id: module-fragment-web
    desc: Web module fragment in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)web' }

  - id: module-fragment-crypto
    desc: Crypto module fragment in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)crypto' }

  - id: module-fragment-token
    desc: Token module fragment in name
    crit: notable
    conf: 0.7
    if: { type: kv, path: name, regex: '(?i)token' }

  - id: pyproject-module-fragment-http
    desc: pyproject.toml HTTP fragment
    crit: notable
    conf: 0.7
    if: { type: kv, path: project.name, regex: '(?i)http' }

  - id: pyproject-module-fragment-api
    desc: pyproject.toml API fragment
    crit: notable
    conf: 0.7
    if: { type: kv, path: project.name, regex: '(?i)api' }

  - id: pyproject-module-fragment-web
    desc: pyproject.toml Web fragment
    crit: notable
    conf: 0.7
    if: { type: kv, path: project.name, regex: '(?i)web' }

  - id: pyproject-module-fragment-crypto
    desc: pyproject.toml Crypto fragment
    crit: notable
    conf: 0.7
    if: { type: kv, path: project.name, regex: '(?i)crypto' }

  - id: pyproject-module-fragment-token
    desc: pyproject.toml Token fragment
    crit: notable
    conf: 0.7
    if: { type: kv, path: project.name, regex: '(?i)token' }

  - id: pkginfo-name-malware-term
    desc: PKG-INFO name malware term set A
    crit: suspicious
    conf: 0.85
    attack: T1036.005
    if:
      type: kv
      path: name
      case_insensitive: true
      regex: \b(hack|exploit|trojan|malware)\b

  - id: pkginfo-name-malware-term-b
    desc: PKG-INFO name malware term set B
    crit: suspicious
    conf: 0.85
    attack: T1036.005
    if:
      type: kv
      path: name
      case_insensitive: true
      regex: \b(inject|keylog|stealer|ransomware)\b

  - id: pkginfo-name-malware-term-c
    desc: PKG-INFO name malware term set C
    crit: suspicious
    conf: 0.85
    attack: T1036.005
    if:
      type: kv
      path: name
      case_insensitive: true
      exact: backdoor

composite_rules:
  - id: pkginfo-name-messaging-security-lure-1
    desc: Messaging security lure (Discord/Telegram)
    crit: suspicious
    conf: 0.85
    all:
      - id: messaging-security-suffix
    any:
      - id: messaging-impersonation-discord
      - id: messaging-impersonation-telegram

  - id: pkginfo-name-messaging-security-lure-2
    desc: Messaging security lure (WhatsApp/Signal)
    crit: suspicious
    conf: 0.85
    all:
      - id: messaging-security-suffix
    any:
      - id: messaging-impersonation-whatsapp
      - id: messaging-impersonation-signal

  - id: pkginfo-name-messaging-security-lure
    desc: Package name impersonates messaging platform security tool
    crit: suspicious
    conf: 0.85
    any:
      - id: pkginfo-name-messaging-security-lure-1
      - id: pkginfo-name-messaging-security-lure-2

  - id: pkginfo-name-module-fragments-any-abc
    desc: Module fragments set A (http/api/web)
    any: [id: module-fragment-http, id: module-fragment-api, id: module-fragment-web]

  - id: pkginfo-name-module-fragments-any-all
    desc: Module fragments set B (all fragments)
    any: [id: module-fragment-http, id: module-fragment-api, id: module-fragment-web, id: module-fragment-crypto, id: module-fragment-token]

  - id: pkginfo-name-module-fragments-any-crypto
    desc: Module fragments set C (crypto/token)
    any: [id: module-fragment-crypto, id: module-fragment-token]

  - id: pkginfo-name-module-fragments-1
    desc: PKG-INFO concatenated fragments profile 1
    crit: notable
    conf: 0.75
    all:
      - id: pkginfo-name-module-fragments-any-abc
      - id: pkginfo-name-module-fragments-any-all

  - id: pkginfo-name-module-fragments-2
    desc: PKG-INFO concatenated fragments profile 2
    crit: notable
    conf: 0.75
    all:
      - id: pkginfo-name-module-fragments-any-crypto
      - id: pkginfo-name-module-fragments-any-all

  - id: pkginfo-name-module-fragments
    desc: Package name with concatenated module name fragments
    crit: notable
    conf: 0.75
    any:
      - id: pkginfo-name-module-fragments-1
      - id: pkginfo-name-module-fragments-2

  - id: pyproject-name-module-fragments-any-abc
    desc: pyproject fragments set A (http/api/web)
    any: [id: pyproject-module-fragment-http, id: pyproject-module-fragment-api, id: pyproject-module-fragment-web]

  - id: pyproject-name-module-fragments-any-all
    desc: pyproject fragments set B (all fragments)
    any: [id: pyproject-module-fragment-http, id: pyproject-module-fragment-api, id: pyproject-module-fragment-web, id: pyproject-module-fragment-crypto, id: pyproject-module-fragment-token]

  - id: pyproject-name-module-fragments-any-crypto
    desc: pyproject fragments set C (crypto/token)
    any: [id: pyproject-module-fragment-crypto, id: pyproject-module-fragment-token]

  - id: pyproject-name-module-fragments-1
    desc: pyproject concatenated fragments profile 1
    crit: notable
    conf: 0.75
    all:
      - id: pyproject-name-module-fragments-any-abc
      - id: pyproject-name-module-fragments-any-all

  - id: pyproject-name-module-fragments-2
    desc: pyproject concatenated fragments profile 2
    crit: notable
    conf: 0.75
    all:
      - id: pyproject-name-module-fragments-any-crypto
      - id: pyproject-name-module-fragments-any-all

  - id: pyproject-name-module-fragments
    desc: pyproject.toml name with concatenated module fragments
    crit: notable
    conf: 0.75
    any:
      - id: pyproject-name-module-fragments-1
      - id: pyproject-name-module-fragments-2

  - id: pkginfo-name-malware-term-any
    desc: PKG-INFO package name contains malware/offensive term
    crit: suspicious
    conf: 0.85
    attack: T1036.005
    any:
      - id: pkginfo-name-malware-term
      - id: pkginfo-name-malware-term-b
      - id: pkginfo-name-malware-term-c
