# Trojanized React Library Detection
# ATT&CK: T1195.002 (Compromise Software Supply Chain)
# Detects React libraries modified to include malicious capabilities

defaults:
  attack: "T1195.002"
  mbc: "B0024"
  for: [javascript]

composite_rules:
  # React + ActiveXObject = HOSTILE (complexity >= 4)
  - id: trojanized-activex
    desc: "React library with ActiveXObject (trojanized"
    crit: hostile
    conf: 0.98
    all:
      - { id: metadata/library/react::library }
      - { id: metadata/library/react::version-banner }
      - { id: objectives/execution/activex/com::activex-object-create }
  # React + Reverse Shell = HOSTILE
  - id: trojanized-reverse-shell
    desc: "React library with reverse shell"
    crit: hostile
    conf: 0.98
    all:
      - { id: metadata/library/react::library }
      - { id: metadata/library/react::version-banner }
      - { id: objectives/command-and-control/reverse-shell/socket::socket-with-exec }
  # React + Base64 Eval = HOSTILE (hidden payload)
  - id: trojanized-base64-eval
    desc: "React library with base64+eval payload"
    crit: hostile
    conf: 0.95
    all:
      - { id: metadata/library/react::library }
      - { id: metadata/library/react::version-banner }
      - { id: objectives/anti-static/obfuscation/payload::decode-exec-js }
  # React + Credential Access = HOSTILE
  - id: trojanized-credential-access
    desc: "React library with credential access"
    crit: hostile
    conf: 0.98
    all:
      - { id: metadata/library/react::library }
      - { id: metadata/library/react::version-banner }
    any:
      - { id: micro-behaviors/fs/path/sensitive/browser::login-data }
      - { id: objectives/credential-access/browser/firefox::cookies }
  # React + Command Execution = HOSTILE
  - id: trojanized-exec
    desc: "React library with command execution"
    crit: hostile
    conf: 0.98
    all:
      - { id: metadata/library/react::library }
      - { id: metadata/library/react::version-banner }
    any:
      - { id: micro-behaviors/process/create/shell }
      - { id: micro-behaviors/process/create/shell/lang::child-process-exec }
  # React + Network Backdoor = HOSTILE
  - id: trojanized-backdoor
    desc: "React library with network backdoor"
    crit: hostile
    conf: 0.95
    all:
      - { id: metadata/library/react::library }
      - { id: metadata/library/react::version-banner }
      - {
          id: objectives/command-and-control/infrastructure/domain::hardcoded-domain-suspicious-pattern,
        }
