composite_rules:
  - id: extconf-process-replacement
    desc: "extconf.rb replaces process via exec() (hostile behavior)"
    crit: hostile
    conf: 1.0
    for: [ruby]
    all:
      - id: objectives/lateral-movement/supply-chain/rubygems::extconf-file
      - id: micro-traits/process/create/shell/lang::ruby-exec

  - id: extconf-shell-exec
    desc: "extconf.rb performs shell execution (suspicious in build scripts)"
    crit: suspicious
    for: [ruby]
    all:
      - id: objectives/lateral-movement/supply-chain/rubygems::extconf-file
    any:
      - id: micro-traits/process/create/shell/lang::ruby-system
      - id: objectives/lateral-movement/supply-chain/rubygems::backtick-exec
      - id: objectives/lateral-movement/supply-chain/rubygems::percent-x-exec
      - id: objectives/lateral-movement/supply-chain/rubygems::io-popen-exec
      - id: objectives/lateral-movement/supply-chain/rubygems::open3-exec
