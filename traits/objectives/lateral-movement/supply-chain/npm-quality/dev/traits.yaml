# Development Workflow Scripts and Tools

traits:
  - id: pkg-build-script-field
    desc: '"build": script in package.json'
    crit: notable
    conf: 0.6
    for: [package.json]
    if:
      type: string
      substr: '"build":'

  - id: pkg-lint-script-field
    desc: '"lint": script in package.json'
    crit: notable
    conf: 0.6
    for: [package.json]
    if:
      type: string
      substr: '"lint":'

  - id: pkg-format-script-field
    desc: '"format": script in package.json'
    crit: notable
    conf: 0.6
    for: [package.json]
    if:
      type: string
      substr: '"format":'

  - id: pkg-dev-script-field
    desc: '"dev": script in package.json'
    crit: notable
    conf: 0.6
    for: [package.json]
    if:
      type: string
      substr: '"dev":'

  - id: pkg-start-script-field
    desc: '"start": script in package.json'
    crit: notable
    conf: 0.6
    for: [package.json]
    if:
      type: string
      substr: '"start":'

  - id: has-release-scripts
    desc: Package has release management scripts
    crit: notable
    conf: 0.85
    for: [package.json]
    if:
      type: string
      regex: '"(?:release|publish|version|prepublishOnly|postversion)":'

  - id: has-typescript
    desc: Package has TypeScript support
    crit: notable
    conf: 0.9
    for: [package.json]
    if:
      type: string
      regex: '"typescript"|"@types/|"\.d\.ts"|"tsconfig"'

  - id: has-build-script
    desc: Package has build script (compiled)
    crit: notable
    conf: 0.85
    for: [package.json]
    if:
      type: string
      regex: '"build":\s*"[^"]{0,120}(?:tsc|rollup|webpack|esbuild|babel|vite)'

  - id: has-lint-script
    desc: Package has linting configured
    crit: notable
    conf: 0.9
    for: [package.json]
    if:
      type: string
      regex: '"lint":\s*"|"eslint"|"prettier"|"biome"'

  - id: has-prepublish-only
    desc: Package has prepublishOnly script
    crit: notable
    conf: 0.85
    for: [package.json]
    if:
      type: string
      substr: '"prepublishOnly":'

  - id: uses-bin-scripts
    desc: Scripts reference node_modules binaries
    crit: notable
    conf: 0.8
    for: [package.json]
    if:
      type: string
      regex: 'node_modules/\.bin/|npx |npm run '

  - id: has-git-hooks
    desc: Package uses git hooks tooling
    crit: notable
    conf: 0.9
    for: [package.json]
    if:
      type: string
      regex: '"husky"|"lint-staged"|"pre-commit"|"simple-git-hooks"'

composite_rules:
  - id: has-dev-workflow
    desc: Package has development workflow scripts
    crit: notable
    conf: 0.85
    for: [package.json]
    needs: 3
    any:
      - id: objectives/lateral-movement/supply-chain/npm/testing::pkg-test-script-field
      - id: pkg-build-script-field
      - id: pkg-lint-script-field
      - id: pkg-format-script-field
      - id: pkg-dev-script-field
      - id: pkg-start-script-field
