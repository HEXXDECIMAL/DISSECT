traits:
- id: xmrig-targeting
  desc: XMRig miner targeting
  crit: notable
  conf: 0.8
  for:
  - elf
  - shell
  if:
    type: string
    regex: (xmrigCC|xmrig-proxy)
  attack: T1561
- id: minerd-targeting
  desc: minerd miner targeting
  crit: notable
  conf: 0.8
  for: [elf, shell]
  if:
    type: string
    word: minerd
- id: cpuminer-targeting
  desc: cpuminer miner targeting
  crit: notable
  conf: 0.8
  for: [elf, shell]
  if:
    type: string
    word: cpuminer
- id: mirai-targeting
  desc: Mirai botnet targeting
  crit: suspicious
  conf: 0.8
  for:
  - elf
  - shell
  if:
    type: string
    substr: "mirai-variant"
  attack: T1561
- id: watchdog-targeting
  desc: Watchdog malware targeting
  crit: suspicious
  conf: 0.8
  for:
  - elf
  - shell
  if:
    type: string
    regex: (^|\s)(watchdog|wd_watchdog)\b
  attack: T1561
- id: update-process-targeting
  desc: Fake update process targeting
  crit: notable
  conf: 0.7
  for:
  - elf
  - shell
  if:
    type: string
    regex: killall.{0,100}(update|updater)
- id: pkill-process-targeting
  desc: pkill force kill pattern
  crit: suspicious
  conf: 0.8
  for:
  - elf
  - shell
  if:
    id: micro-behaviors/process/terminate/commands/linux::pkill-force
  attack: T1070.003
- id: ps-grep-targeting
  desc: ps/grep process targeting
  crit: notable
  conf: 0.7
  for:
  - elf
  - shell
  if:
    type: string
    regex: (ps -eo|ps aux \| grep|ps\s+[a-z]*\s*\|\s*grep)
  attack: T1057
- id: deleted-process-targeting
  desc: Target deleted/hidden processes
  crit: suspicious
  conf: 0.85
  for:
  - elf
  - shell
  if:
    type: string
    regex: \| grep -E '/tmp/\|/dev/shm/'
  attack: T1070.003
composite_rules:
- id: competing-miner-targeting
  desc: Competing cryptocurrency miner targeting
  crit: suspicious
  conf: 0.85
  for:
  - elf
  - shell
  attack: T1561
  needs: 2
  any:
  - id: xmrig-targeting
  - id: objectives/impact/cryptojacking/miner::cryptonight-str
- id: competing-botnet-targeting
  desc: Competing botnet targeting
  crit: suspicious
  conf: 0.85
  for:
  - elf
  - shell
  attack: T1561
  any:
  - id: mirai-targeting
  - id: watchdog-targeting
- id: malware-killing-activity
  desc: Generic malware killing activity
  crit: suspicious
  conf: 0.8
  for:
  - elf
  - shell
  attack: T1070.003
  needs: 2
  any:
  - id: pkill-process-targeting
  - id: deleted-process-targeting
- id: comprehensive-malware-elimination
  desc: Comprehensive competing malware elimination
  crit: hostile
  conf: 0.9
  for:
  - elf
  - shell
  attack: T1561
  mbc: E1001
  needs: 3
  any:
  - id: ps-grep-targeting
  - id: competing-miner-targeting
  - id: competing-botnet-targeting
  - id: malware-killing-activity
