defaults:
  for: [macho]

# Network service password cracking (macOS)
# ATT&CK: T1110.001 (Brute Force: Password Guessing)
# MBC: E1110 (Brute Force)

traits:
  - id: crack-passwords-protocol-1
    desc: Protocol password cracking wording (pop3/ftp/hotline)
    if:
      type: encoded
      encoding: base64
      regex: "(?i)uses (?:pop3|ftp|hotline) protocol to crack passwords"

  - id: crack-passwords-protocol-2
    desc: Protocol password cracking wording (msn/icq)
    if:
      type: encoded
      encoding: base64
      regex: "(?i)uses (?:msn|aim/icq2000) protocol to crack passwords"

  - id: username-dictionary-file
    desc: Username dictionary file for attack
    crit: suspicious
    conf: 0.8
    for: [macho]
    attack: "T1110.001"
    mbc: "E1110"
    if:
      type: encoded
      encoding: base64
      substr: "username dictionary file"

  - id: password-dictionary-file
    desc: Password dictionary file for attack
    crit: suspicious
    conf: 0.8
    for: [macho]
    attack: "T1110.001"
    mbc: "E1110"
    if:
      type: encoded
      encoding: base64
      substr: "password dictionary file"

  - id: login-attempts-series
    desc: Login attempts per series wording
    crit: notable
    conf: 0.75
    for: [macho]
    attack: "T1110.001"
    mbc: "E1110"
    if:
      type: encoded
      encoding: base64
      substr: "login attempts per series"

  - id: attack-power-string
    desc: Attack power indicator
    crit: notable
    conf: 0.7
    for: [macho]
    if:
      type: string
      substr: "attack power"

  - id: attack-progress-string
    desc: Attack progress indicator
    crit: notable
    conf: 0.7
    for: [macho]
    if:
      type: string
      substr: "attack progress"

  - id: attack-log-string
    desc: Attack log indicator
    crit: notable
    conf: 0.7
    for: [macho]
    if:
      type: string
      substr: "attack log"

  - id: sockets-status-string
    desc: Socket status UI wording
    crit: notable
    conf: 0.7
    for: [macho]
    if:
      type: string
      substr: "sockets status"

  - id: proxy-sock-server
    desc: Proxy/sock server wording
    crit: notable
    conf: 0.7
    for: [macho]
    attack: "T1090"
    if:
      type: encoded
      encoding: base64
      regex: "(?i)proxy/sock server"

composite_rules:
  - id: crack-passwords-protocol
    desc: Protocol password cracking wording
    crit: suspicious
    conf: 0.85
    for: [macho]
    attack: "T1110.001"
    mbc: "E1110"
    any:
      - id: crack-passwords-protocol-1
      - id: crack-passwords-protocol-2

  - id: dictionary-attack-inputs
    desc: Username and password dictionaries
    crit: suspicious
    conf: 0.85
    attack: "T1110.001"
    mbc: "E1110"
    all:
      - id: username-dictionary-file
      - id: password-dictionary-file

  - id: attack-control-ui
    desc: Attack control and monitoring strings
    crit: suspicious
    conf: 0.8
    needs: 2
    any:
      - id: attack-power-string
      - id: attack-progress-string
      - id: attack-log-string

  - id: multi-socket-attack-ui
    desc: Multi-socket attack status strings
    crit: suspicious
    conf: 0.8
    any:
      - id: sockets-status-string
      - id: proxy-sock-server

  - id: credential-bruteforce-tool
    desc: Network service password cracking tool
    crit: suspicious
    conf: 0.9
    attack: "T1110.001"
    mbc: "E1110"
    all:
      - id: crack-passwords-protocol
      - id: dictionary-attack-inputs
      - id: login-attempts-series
      - id: attack-control-ui
      - id: multi-socket-attack-ui
