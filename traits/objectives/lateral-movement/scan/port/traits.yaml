defaults:
  for:
  - all
  attack: T1046
  mbc: E1046
traits:
- id: ip-format
  desc: IP address format string (scanning
  crit: notable
  conf: 0.6
  platforms:
  - all
  if:
    type: string
    substr: '%d.%d.%d.%d'
- id: target-ip
  desc: Target IP (case variants)
  crit: notable
  conf: 0.5
  platforms:
  - all
  if:
    type: string
    regex: (Target|target)[_\s]?[Ii][Pp]
- id: target-ip-camel
  desc: targetIP camelCase
  crit: notable
  conf: 0.5
  platforms:
  - all
  if:
    type: string
    substr: targetIP
- id: random-target-word
  desc: Random target (case variants)
  crit: notable
  conf: 0.6
  platforms:
  - all
  if:
    type: string
    regex: (Random|random)[_\s]?[Tt]arget
- id: random-ip
  desc: Random IP (case variants)
  crit: notable
  conf: 0.6
  platforms:
  - all
  if:
    type: string
    regex: (Random|random)[_\s]?IP
- id: getrandip
  desc: getrandip function
  crit: notable
  conf: 0.6
  platforms:
  - all
  if:
    type: string
    substr: getrandip
- id: portscan-word
  desc: PortScan keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: \b[Pp]ort[Ss]can\b
- id: scan-port
  desc: scan port keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: scan[_\s]?[Pp]ort
- id: port-scan
  desc: port scan keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: '[Pp]ort[_\s]?[Ss]can'
- id: banner-grab
  desc: Banner grab keyword
  crit: notable
  conf: 0.5
  platforms:
  - all
  if:
    type: string
    regex: '[Bb]anner[_\s]?[Gg]rab'
- id: target-host
  desc: target host keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: target[_\s]*host
    case_insensitive: true
- id: target-port
  desc: target port keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: target[_\s]*port
    case_insensitive: true
- id: target-range
  desc: target range keyword
  crit: notable
  conf: 0.5
  platforms:
  - all
  if:
    type: string
    regex: target[_\s]*range
    case_insensitive: true
- id: target-list
  desc: target list keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: target[_\s]*list
    case_insensitive: true
- id: target-addr
  desc: target addr keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: target[_\s]*addr
    case_insensitive: true
- id: scan-target
  desc: scan target keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: scan[_\s]*target
    case_insensitive: true
- id: brute-force-ref
  desc: Brute force attack reference
  crit: notable
  conf: 0.85
  attack: T1110
  platforms:
  - all
  for:
  - scripts
  if:
    type: string
    regex: '[Bb]rute[_\-\s]?[Ff]orce'
- id: weak-pass-root123
  desc: Weak password root123
  crit: suspicious
  conf: 0.7
  attack: T1110.001
  platforms:
  - all
  if:
    type: string
    substr: root123
- id: weak-pass-admin123-upper
  desc: Weak password Admin123
  crit: notable
  conf: 0.5
  attack: T1110.001
  platforms:
  - all
  if:
    type: string
    substr: Admin123
- id: weak-pass-admin123-lower
  desc: Weak password admin123
  crit: notable
  conf: 0.5
  attack: T1110.001
  platforms:
  - all
  if:
    type: string
    substr: admin123
- id: weak-pass-passw0rd
  desc: Weak password Passw0rd
  crit: suspicious
  conf: 0.7
  attack: T1110.001
  platforms:
  - all
  if:
    type: string
    substr: Passw0rd
- id: weak-pass-qwerty123
  desc: Weak password qwerty123
  crit: notable
  conf: 0.5
  attack: T1110.001
  platforms:
  - all
  if:
    type: string
    substr: qwerty123
- id: weak-pass-qwerty
  desc: Weak password qwerty
  crit: notable
  conf: 0.5
  attack: T1110.001
  platforms:
  - all
  if:
    type: string
    substr: qwerty
- id: root-the-phrase
  desc: Root the phrase (hacker slang)
  crit: notable
  conf: 0.6
  attack: T1068
  platforms:
  - all
  if:
    type: string
    substr: 'root the '
- id: r00t-leet
  desc: r00t leetspeak
  crit: notable
  conf: 0.6
  attack: T1068
  platforms:
  - all
  if:
    type: string
    regex: r00t[^a-zA-Z]
- id: sym-gethostbyname
  desc: gethostbyname function symbol
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: symbol
    regex: ^_?gethostbyname$
- id: sym-getaddrinfo
  desc: getaddrinfo function symbol
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: symbol
    regex: ^_?getaddrinfo$
- id: sym-socket
  desc: socket function symbol
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: symbol
    regex: ^_?socket$
- id: sym-connect
  desc: connect function symbol
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: symbol
    regex: ^_?connect$
- id: probing-keyword
  desc: Probing keyword (explicit scanning intent)
  crit: notable
  conf: 0.75
  platforms:
  - all
  if:
    type: string
    regex: \b[Pp]robing\b
- id: port-number-ftp
  desc: FTP port number (21)
  crit: notable
  conf: 0.6
  platforms:
  - all
  for:
  - scripts
  if:
    type: string
    regex: (?i)(?:ftp|port|connect).{0,20}[:\s]21\b
- id: port-number-ssh
  desc: SSH port number (22)
  crit: notable
  conf: 0.6
  platforms:
  - all
  for:
  - scripts
  if:
    type: string
    regex: (?i)ssh.{0,20}[:\\s]22\b
- id: port-number-http
  desc: HTTP port number (80)
  crit: notable
  conf: 0.6
  platforms:
  - all
  for:
  - scripts
  if:
    type: string
    regex: (?i)(?:http|port|web|connect).{0,20}[:\s]80\b
- id: port-number-https-1
  desc: HTTPS port (443) variants (https/port/ssl)
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: (?i)(?:https|port|ssl).{0,20}[:\s]443\b
- id: port-number-https-2
  desc: HTTPS port (443) variants (tls/connect)
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: (?i)(?:tls|connect).{0,20}[:\s]443\b
- id: cidr-range
  desc: CIDR network range notation
  crit: notable
  conf: 0.6
  platforms:
  - all
  if:
    type: string
    regex: \d+\.\d+\.\d+\.\d+/\d+
- id: rpc-enum-pmap
  desc: RPC portmapper enumeration function
  crit: suspicious
  conf: 0.95
  platforms:
  - all
  if:
    type: symbol
    regex: ^_?pmap_(getmaps|clnt_call|getport)$
- id: probe-word-core-prefix
  desc: Generic probe keyword (network probe)
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: \bnetwork[_\-\s]?probe\b
    case_insensitive: true
- id: probe-word-core-suffix-1
  desc: Generic probe keyword (probe port/host/target)
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: \bprobe[_\-\s]?(port|host|target)\b
    case_insensitive: true
- id: probe-word-core-suffix-2
  desc: Generic probe keyword (probe scan/packet)
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: \bprobe[_\-\s]?(scan|packet)\b
    case_insensitive: true
- id: probe-word-proto
  desc: Protocol probe keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  if:
    type: string
    regex: \b(?:tcp|udp|icmp)[_\-\s]?probe\b
    case_insensitive: true
composite_rules:
- id: port-number-https
  desc: HTTPS port number (443)
  crit: notable
  conf: 0.6
  any:
    - id: port-number-https-1
    - id: port-number-https-2
- id: probe-word-core
  desc: Generic probe keyword
  crit: notable
  conf: 0.4
  any:
    - id: probe-word-core-prefix
    - id: probe-word-core-suffix-1
    - id: probe-word-core-suffix-2
- id: target-ip-ref
  desc: References target IP concept
  crit: notable
  conf: 0.75
  platforms:
  - all
  any:
  - id: target-ip
  - id: target-ip-camel
- id: random-target
  desc: Random target/IP generation
  crit: notable
  conf: 0.8
  platforms:
  - all
  any:
  - id: random-target-word
  - id: random-ip
  - id: getrandip
- id: port-ref
  desc: Port scanning terminology
  crit: notable
  conf: 0.5
  platforms:
  - all
  any:
  - id: portscan-word
  - id: scan-port
  - id: port-scan
- id: probe-ref
  desc: Network probing terminology
  crit: notable
  conf: 0.6
  platforms:
  - all
  any:
  - id: probe-word
  - id: banner-grab
- id: probe-word
  desc: Probe keyword
  crit: notable
  conf: 0.4
  platforms:
  - all
  any:
  - id: probe-word-core
  - id: probe-word-proto
- id: target-ref
  desc: Scan target terminology
  crit: notable
  conf: 0.6
  platforms:
  - all
  any:
  - id: target-host
  - id: target-port
  - id: target-range
  - id: target-list
  - id: target-addr
  - id: scan-target
- id: weak-pass-admin123
  desc: Weak password admin123
  crit: notable
  conf: 0.7
  attack: T1110.001
  platforms:
  - all
  any:
  - id: weak-pass-admin123-upper
  - id: weak-pass-admin123-lower
- id: weak-pass-qwerty-variants
  desc: Weak password qwerty variants
  crit: notable
  conf: 0.7
  attack: T1110.001
  platforms:
  - all
  any:
  - id: weak-pass-qwerty123
  - id: weak-pass-qwerty
  downgrade:
    any:
    - id: micro-behaviors/dylib/library::graphics-lib-marker
    - id: micro-behaviors/dylib/load/x11-ref
- id: root-exploit-ref
  desc: Root exploitation terminology (leetspeak/hacker slang)
  crit: notable
  conf: 0.85
  attack: T1068
  platforms:
  - all
  any:
  - id: root-the-phrase
  - id: r00t-leet
- id: sym-hostname-resolve
  desc: Hostname resolution function symbols
  crit: notable
  conf: 0.6
  platforms:
  - all
  any:
  - id: sym-gethostbyname
  - id: sym-getaddrinfo
- id: sym-socket-connect
  desc: Socket connection function symbols
  crit: notable
  conf: 0.6
  platforms:
  - all
  any:
  - id: sym-socket
  - id: sym-connect
- id: service-port
  desc: Common service port numbers
  crit: notable
  conf: 0.6
  platforms:
  - all
  any:
  - id: port-number-ftp
  - id: port-number-ssh
  - id: port-number-http
  - id: port-number-https
- id: probing-with-ports
  desc: Probing script with service ports
  crit: suspicious
  conf: 0.8
  attack: T1046
  mbc: E1046
  for:
  - shell
  all:
  - id: probing-keyword
  - id: service-port
