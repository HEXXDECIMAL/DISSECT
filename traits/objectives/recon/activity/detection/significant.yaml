composite_rules:
  - id: significant-recon
    desc: Significant system reconnaissance activity
    crit: suspicious
    any:
      - id: objectives/discovery/host/system/hardware-fingerprint::js-sysinfo-multi
      - id: micro-traits/fs/enumerate/directory::fs-readdir
      - id: objectives/impact/ransomware/behavior::readdir-sync
      - id: objectives/lateral-movement/supply-chain/npm/behavior::npm-victim-exfil
    unless:
      - id: metadata/library::commander
      - id: metadata/library/nodeunit::nodeunit
      - id: metadata/library/nodeunit::nodeunit-require
      - id: metadata/dev/testing::node-common-require
    downgrade:
      any:
        - id: objectives/lateral-movement/supply-chain/npm/testing::test-fixtures
        - id: objectives/lateral-movement/supply-chain/npm/testing::has-assertions
        - id: metadata/library/nodeunit::nodeunit
        - id: metadata/library/nodeunit::nodeunit-require
