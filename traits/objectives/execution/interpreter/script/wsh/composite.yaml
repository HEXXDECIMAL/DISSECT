# WScript Obfuscation Composite Rules
# Detects fragmented WScript usage

defaults:
  crit: notable
  conf: 0.8

composite_rules:
  - id: wscript-shell-fragments-composite
    desc: WScript.Shell fragments detected
    any:
      - id: objectives/execution/interpreter/script/wsh::wscript-shell-fragment
      - id: objectives/execution/interpreter/script/wsh::wscript-shell-fragment-short
      - id: objectives/execution/interpreter/script/wsh::wscript-shell-fragment-tiny-2
      - id: objectives/execution/interpreter/script/wsh::wscript-shell-fragment-tiny-exact

  - id: wscript-dropper-fragments-composite
    desc: WScript dropper fragments detected (ADODB/XMLHTTP)
    any:
      - id: objectives/execution/interpreter/script/wsh::adodb-fragment
      - id: micro-behaviors/net/http/client::http-client-msxml-fragment
      - id: objectives/execution/interpreter/script/wsh::xmlhttp-fragment-tiny-2
      - id: objectives/execution/interpreter/script/wsh::response-body-fragment
      - id: objectives/execution/interpreter/script/wsh::adodb-fragment-tiny-exact
      - id: objectives/execution/interpreter/script/wsh::xmlhttp-fragment-tiny-exact
      - id: objectives/execution/interpreter/script/wsh::payload-handling-fragment-tiny-exact

  - id: wscript-dropper-full-composite
    desc: WScript dropper (ADODB + XMLHTTP)
    all:
      - id: objectives/execution/interpreter/script/wsh::adodb-fragment
      - id: micro-behaviors/net/http/client::http-client-msxml-fragment
