# Download to /tmp, chmod, execute pattern
# MBC: B0024 (Dropper)
# ATT&CK: T1059 (Command and Scripting Interpreter)

defaults:
  for: [all]
  mbc: "B0024"
  attack: "T1059.006"

traits:
  - id: tmp-path
    desc: Reference to /tmp directory for
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: '/tmp/[a-zA-Z_][a-zA-Z0-9_]*'

  - id: tmp-path-short
    desc: Reference to /tmp directory path
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: '/tmp/[a-zA-Z_]+$'

  - id: os-remove
    desc: Python os.remove call to delete
    crit: notable
    conf: 0.7
    for: [python]
    if:
      type: raw
      regex: "os\\.remove\\("

composite_rules:
  - id: python
    desc: Download to /tmp, chmod, execute
    conf: 0.95
    crit: suspicious
    for: [python]
    needs: 3
    any:
      - id: tmp-path-short
      - id: micro-behaviors/fs/chmod/commands::python-os-chmod
      - id: micro-behaviors/process/create/subprocess/
      - id: os-remove
