# Obfuscated JScript Proxy Dropper
# Detects JScript malware using identity function proxies and fragmented strings.

defaults:
  crit: hostile
  conf: 1.0

composite_rules:
  - id: jscript-proxy-dropper
    desc: Obfuscated JScript Dropper using proxy functions
    mbc: "B0032"
    attack: "T1027"
    # ref: "report:7b05e5f325822740fc28bf8cd9bd527088d2df4f820fcbafd12a710bace575a7"
    all:
      - id: objectives/anti-static/obfuscation/source/proxy::identity-function-proxy
    any:
      - id: objectives/anti-static/obfuscation/strings/encoding::js-interspersed-hex-escapes
      - id: objectives/execution/interpreter/script/wsh
    unless:
      - id: metadata/library::js-module-exports
      - id: metadata/library/structure::js-umd-wrapper
      - id: metadata/quality::versioned
