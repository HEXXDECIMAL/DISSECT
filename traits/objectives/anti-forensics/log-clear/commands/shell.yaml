defaults:
  crit: suspicious
  attack: T1070
  mbc: F0006
  for:
  - shell
traits:
- id: history-clear
  desc: Clears shell history
  crit: suspicious
  conf: 0.85
  attack: T1070.003
  if:
    type: raw
    regex: \bhistory\s+-c\b|>\s*/root/\.bash_history|echo\s*>\s*[^\n]{0,30}\.bash_history
- id: wtmp-clear
  desc: Clears wtmp login records
  crit: suspicious
  conf: 0.9
  attack: T1070.002
  if:
    type: raw
    regex: echo\s*>\s*/var/log/wtmp|>\s*/var/log/wtmp|rm\s+-[rf]+\s+/var/log/wtmp
- id: secure-log-clear
  desc: Clears secure/auth log
  crit: suspicious
  conf: 0.9
  attack: T1070.002
  if:
    type: raw
    regex: echo\s*>\s*/var/log/(?:secure|auth\.log)|>\s*/var/log/(?:secure|auth\.log)
- id: syslog-clear
  desc: Clears system syslog file
  crit: suspicious
  conf: 0.9
  attack: T1070.002
  if:
    type: raw
    regex: echo\s*>\s*/var/log/syslog|rm\s+-[rf]+\s+/var/log/syslog|>\s*/var/log/syslog
- id: mail-spool-clear
  desc: Clears mail spool
  crit: suspicious
  conf: 0.8
  attack: T1070.002
  if:
    type: raw
    regex: echo\s*>\s*/var/spool/mail/|>\s*/var/spool/mail/
- id: mass-log-clear
  desc: Mass log file clearing
  crit: suspicious
  conf: 0.9
  attack: T1070.002
  if:
    type: raw
    regex: rm\s+-[rf]+\s+/var/log/\*|for\s+[^;]{0,30}in\s+/var/log/|find\s+/var/log
- id: find-exec-rm-log
  desc: Find-exec mass log deletion
  crit: suspicious
  conf: 0.95
  attack: T1070.002
  if:
    type: raw
    regex: find\s+[^\n]{0,30}-name\s+[^\n]{0,30}\.log[^\n]{0,30}-exec\s+rm
- id: bash-history-wipe
  desc: Wipes bash_history file
  crit: suspicious
  conf: 0.85
  attack: T1070.003
  if:
    type: raw
    regex: echo\s*>\s*(?:/root/|~/|\$HOME/)\.bash_history|rm\s+-[rf]+\s+[^\n]{0,20}\.bash_history
composite_rules:
- id: anti-forensics-cleanup
  desc: Anti-forensics log and history cleanup
  crit: hostile
  conf: 0.95
  attack: T1070
  all:
  - id: history-clear
  - id: wtmp-clear
  - id: secure-log-clear
- id: miner-anti-forensics
  desc: Miner anti-forensics cleanup
  crit: hostile
  conf: 0.95
  attack: T1070
  all:
  - id: history-clear
  - id: wtmp-clear
  - id: mail-spool-clear
