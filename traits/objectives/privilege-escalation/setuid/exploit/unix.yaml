# Setuid Privilege Escalation - Exploit Patterns
# MBC: E1548 (Abuse Elevation Control Mechanism)
# ATT&CK: T1548.001
#
# NOTE: Raw setuid/setgid capabilities are now in micro-behaviors/process/identity/setuid/unix.yaml
# This file contains composite rules that detect exploitation patterns.

defaults:
  for: [elf, macho, so, dylib, c]

composite_rules:
  # Suspicious setuid pattern: setuid combined with shell execution
  - id: setuid-shell-exec
    desc: Setuid with shell execution
    crit: suspicious
    conf: 0.85
    attack: "T1548.001"
    all:
      - id: micro-behaviors/process/identity/setuid::setuid
      - id: micro-behaviors/process/create/shell::bin-sh
    unless:
      - id: metadata/signed/platform::apple

  # Suspicious setgid pattern: setgid combined with shell execution
  - id: setgid-shell-exec
    desc: Setgid with shell execution
    crit: suspicious
    conf: 0.85
    attack: "T1548.001"
    all:
      - id: micro-behaviors/process/identity/setuid::setgid
      - id: micro-behaviors/process/create/shell::bin-sh
    unless:
      - id: metadata/signed/platform::apple
