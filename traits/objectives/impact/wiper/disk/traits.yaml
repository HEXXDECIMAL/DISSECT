traits:
- id: recursive-delete
  desc: Recursive directory deletion function
  crit: notable
  conf: 0.85
  attack: T1485
  for:
  - javascript
  - typescript
  if:
    type: yara
    source: "rule node_recursive_delete {\n  strings:\n    $readdir = \"readdirSync\"\
      \ ascii\n    $unlink = \"unlinkSync\" ascii\n    $rmdir = \"rmdirSync\" ascii\n\
      \    $rmrf = \"rm -rf\" ascii\n    $rimraf = \"rimraf\" ascii\n  condition:\n\
      \    ($readdir and ($unlink or $rmdir)) or $rmrf or $rimraf\n}\n"
- id: target-dev-dirs
  desc: Targets development directories for deletion
  crit: notable
  conf: 0.9
  attack: T1485
  for:
  - javascript
  - typescript
  - python
  if:
    type: yara
    source: "rule target_dev_directories {\n  strings:\n    $dir1 = \".git\" ascii\n\
      \    $dir2 = \".svn\" ascii\n    $dir3 = \"node_modules\" ascii\n    $dir4 =\
      \ \".vscode\" ascii\n    $dir5 = \"/src\" ascii\n    $dir6 = \"/public\" ascii\n\
      \    $delete1 = \"unlink\" ascii\n    $delete2 = \"rmdir\" ascii\n    $delete3\
      \ = \"rm -rf\" ascii\n    $delete4 = \"rmtree\" ascii\n    $delete5 = \"shutil.rmtree\"\
      \ ascii\n  condition:\n    3 of ($dir*) and any of ($delete*)\n}\n"
- id: target-git
  desc: Targets .git directory (version control)
  crit: notable
  conf: 0.85
  attack: T1485
  for:
  - javascript
  - typescript
  - python
  - shell
  if:
    type: string
    regex: '["'']\\./?\\.git["'']'
- id: target-node-modules
  desc: Targets node_modules directory
  crit: notable
  conf: 0.8
  attack: T1485
  for:
  - javascript
  - typescript
  if:
    type: string
    regex: '["'']/?(\\./)?node_modules["'']'
- id: target-src
  desc: Targets source code directory
  crit: notable
  conf: 0.85
  attack: T1485
  for:
  - javascript
  - typescript
  - python
  if:
    type: string
    regex: '["'']/?(\\./)?src["'']'
- id: target-vscode-dir
  desc: Targets .vscode directory
  crit: notable
  conf: 0.7
  attack: T1485
  for:
  - javascript
  - typescript
  if:
    type: string
    regex: '["'']/?(\\./)?\\.(vscode)["'']'
- id: target-idea-dir
  desc: Targets .idea directory
  crit: notable
  conf: 0.7
  attack: T1485
  for:
  - javascript
  - typescript
  if:
    type: string
    regex: '["'']/?(\\./)?\\.(idea)["'']'
- id: conditional-destroy
  desc: Conditional destruction based on environment
  crit: suspicious
  conf: 0.95
  attack: T1485
  for:
  - javascript
  - typescript
  if:
    type: yara
    source: "rule conditional_destruction {\n  strings:\n    $env_check = /process\\\
      .env\\[[^\\]]+\\]\\s*(!=|!==|==|===)/ ascii\n    $node_env = \"NODE_ENV\" ascii\n\
      \    $destroy1 = \"unlinkSync\" ascii\n    $destroy2 = \"rmdirSync\" ascii\n\
      \    $destroy3 = \"rm -rf\" ascii\n  condition:\n    ($env_check or $node_env)\
      \ and any of ($destroy*)\n}\n"
- id: target-android-storage
  desc: Targets Android storage directories
  crit: suspicious
  conf: 0.95
  attack: T1485
  for:
  - javascript
  - typescript
  - shell
  if:
    type: yara
    source: "rule target_android_storage {\n  strings:\n    $sdcard = \"/sdcard\"\
      \ ascii\n    $storage = \"/storage/emulated\" ascii\n    $dcim = \"DCIM\" ascii\n\
      \    $pictures = \"Pictures\" ascii\n    $downloads = \"Download\" ascii\n \
      \   $rm = \"rm \" ascii\n    $rmrf = \"rm -rf\" ascii\n    $spawn = \"spawn(\"\
      \ ascii\n  condition:\n    ($sdcard or $storage) and any of ($dcim, $pictures,\
      \ $downloads) and any of ($rm, $rmrf, $spawn)\n}\n"
- id: mass-delete
  desc: Mass file deletion pattern
  crit: suspicious
  conf: 0.85
  attack: T1485
  for:
  - javascript
  - typescript
  - python
  - shell
  if:
    type: raw
    regex: (fs\.readdirSync|os\.walk|find\s+\.)[\s\S]{0,50}(unlinkSync|os\.remove|os\.unlink|-delete|rm\s+-rf)
composite_rules:
- id: target-vscode
  desc: Targets .vscode configuration directory
  crit: notable
  conf: 0.85
  attack: T1485
  for:
  - javascript
  - typescript
  any:
  - id: target-vscode-dir
  - id: target-idea-dir
- id: protestware
  desc: Protestware pattern - conditional destruction
  crit: suspicious
  conf: 0.98
  attack: T1485
  mbc: B0031
  for:
  - javascript
  - typescript
  all:
  - id: objectives/impact/wiper/disk::conditional-destroy
  - id: objectives/impact/wiper/disk::target-dev-dirs
- id: with-callback
  desc: Wiper with HTTP callback (potential
  crit: suspicious
  conf: 0.95
  attack: T1485
  mbc: B0031
  for:
  - javascript
  - typescript
  all:
  - id: objectives/impact/wiper/disk::recursive-delete
  - id: micro-traits/comm/http/request/
