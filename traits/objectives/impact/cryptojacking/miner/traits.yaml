defaults:
  for:
  - all
traits:
- id: stratum-tcp
  desc: stratum+tcp protocol
  crit: notable
  conf: 0.8
  mbc: B0041
  attack: T1496
  if:
    type: string
    substr: "stratum+tcp://"

- id: stratum-ssl
  desc: stratum+ssl protocol
  crit: notable
  conf: 0.8
  mbc: B0041
  attack: T1496
  if:
    type: string
    substr: "stratum+ssl://"

- id: pool-subdomain
  desc: pool. subdomain prefix
  crit: notable
  conf: 0.7
  if:
    type: string
    regex: 'pool\.[a-z0-9-]+\.[a-z]{2,10}'

- id: pool-url
  desc: Mining pool URL reference
  crit: notable
  conf: 0.7
  if:
    type: string
    regex: '(https?|stratum\+tcp|stratum\+ssl)://[^\s]{1,120}pool'

- id: miner-word
  desc: miner keyword
  crit: notable
  conf: 0.4
  if:
    type: string
    word: miner
- id: hashrate-str
  desc: hashrate keyword
  crit: notable
  conf: 0.5
  if:
    type: string
    substr: hashrate
- id: wallet-ref
  desc: wallet keyword
  crit: notable
  conf: 0.4
  if:
    type: string
    word: wallet
- id: coinhive-str
  desc: coinhive reference
  crit: notable
  conf: 0.6
  if:
    type: string
    substr: coinhive
- id: cryptonight-str
  desc: cryptonight algorithm
  crit: notable
  conf: 0.6
  if:
    type: string
    word: cryptonight
- id: monero-lower
  desc: monero cryptocurrency reference
  crit: notable
  conf: 0.5
  if:
    type: string
    exact: monero

composite_rules:
- id: miner
  desc: Cryptocurrency mining patterns
  crit: suspicious
  conf: 0.66
  mbc: B0041
  attack: T1496
  needs: 2
  any:
  - id: stratum-tcp
  - id: stratum-ssl
  - id: pool-subdomain
  - id: pool-url
  - id: miner-word
  - id: well-known/malware/miner/xmrig::xmrig-name
  - id: monero-lower
  - id: hashrate-str
  - id: wallet-ref
  - id: coinhive-str
  - id: cryptonight-str
