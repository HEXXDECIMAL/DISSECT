defaults:
  for:
  - all
  attack: T1485
  crit: suspicious
traits:
- id: linux-etc-delete
  desc: Linux /etc directory deletion attempt
  conf: 0.95
  platforms:
  - linux
  if:
    type: string
    regex: rm\s+-rf\s+/etc|shutil\.rmtree.{0,50}["']/etc
- id: linux-usr-delete
  desc: Linux /usr directory deletion attempt
  conf: 0.95
  platforms:
  - linux
  if:
    type: string
    regex: rm\s+-rf\s+/usr|shutil\.rmtree.{0,50}["']/usr
- id: linux-boot-delete
  desc: Linux /boot directory deletion attempt
  conf: 0.95
  platforms:
  - linux
  if:
    type: string
    regex: rm\s+-rf\s+/boot|shutil\.rmtree.{0,50}["']/boot
- id: root-wipe
  desc: Root filesystem wipe attempt
  conf: 0.95
  attack: T1561
  if:
    type: string
    regex: rm\s+-rf\s+/\s|rm\s+-rf\s+/\*|shutil\.rmtree.{0,50}["']/["']
- id: macos-system-delete
  desc: macOS system directory deletion
  conf: 0.95
  platforms:
  - macos
  if:
    type: string
    regex: rm\s+-rf.{0,50}(/System|/Library/System)|shutil\.rmtree.{0,50}/System
- id: physical-drive0
  desc: Windows PhysicalDrive0 reference
  conf: 0.9
  attack: T1561.002
  if:
    type: string
    substr: PhysicalDrive0
- id: physical-drive-unc
  desc: Windows \\.\PhysicalDrive UNC path reference
  conf: 0.9
  attack: T1561.002
  if:
    type: string
    substr: \\.\PhysicalDrive
- id: rmtree-call
  desc: rmtree function call
  crit: notable
  conf: 0.6
  if:
    type: string
    substr: rmtree
- id: rm-rf-cmd
  desc: rm -rf command
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: rm\s+-rf
- id: rmdir-recursive
  desc: rmdir recursive command
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: (?:rmdir|rd).{0,30}(/s|/q)
- id: windows-dir-ref
  desc: Windows directory reference
  crit: notable
  conf: 0.5
  if:
    type: string
    regex: '[A-Za-z]:\\\\Windows(?:\\\\System32)?|\\\\Windows\\\\System32|/Windows/System32'
- id: system32-ref
  desc: System32 directory reference
  crit: notable
  conf: 0.6
  if:
    type: string
    substr: System32
- id: etc-dir-ref
  desc: /etc directory reference
  crit: notable
  conf: 0.5
  if:
    type: string
    exact: /etc
- id: boot-dir-ref
  desc: /boot directory reference
  crit: notable
  conf: 0.6
  if:
    type: string
    substr: /boot
- id: usr-dir-ref
  desc: /usr directory reference
  crit: notable
  conf: 0.5
  if:
    type: string
    exact: /usr
- id: windows-system32-delete
  desc: Windows System32 directory deletion
  conf: 0.95
  platforms:
  - windows
  if:
    type: string
    regex: (rmdir|del|remove).{0,50}[Ss]ystem32|[Ss]ystem32.{0,50}(rmdir|del|remove)
- id: windows-recursive-delete
  desc: Windows system directory recursive deletion
  conf: 0.9
  platforms:
  - windows
  if:
    type: string
    regex: (?:r(?:d|mdir)\s+/s|del\s+/f\s+/q).{0,50}(?:Windows|%WINDIR%|%SYSTEMROOT%)
composite_rules:
- id: mbr-target
  desc: MBR/Boot sector targeting
  crit: suspicious
  conf: 0.95
  attack: T1561.002
  any:
  - id: micro-traits/fs/path/device/storage::dev-sda
  - id: micro-traits/fs/path/device/storage::dev-hda
  - id: physical-drive0
  - id: physical-drive-unc
  downgrade:
    any:
    - id: metadata/library::botocore-lib
    - id: metadata/import/python::boto3
    - id: micro-traits/comm/ssh/connect::paramiko
- id: recursive-delete-cmd
  desc: Recursive deletion command pattern
  crit: notable
  conf: 0.8
  any:
  - id: rmtree-call
  - id: rm-rf-cmd
  - id: rmdir-recursive
- id: system-dir-reference
  desc: Reference to critical system directories
  crit: notable
  conf: 0.4
  any:
  - id: windows-dir-ref
  - id: system32-ref
  - id: etc-dir-ref
  - id: boot-dir-ref
  - id: usr-dir-ref
- id: mass-deletion
  desc: Mass system file deletion
  conf: 0.95
  all:
  - id: recursive-delete-cmd
  - id: micro-traits/data/control-flow/analysis::iteration-loop-pattern
  - id: system-dir-reference
