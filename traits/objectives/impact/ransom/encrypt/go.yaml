traits:
- id: go-encrypt-files-func
  desc: Go EncryptFiles function symbol
  crit: suspicious
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \)\.(Encrypt|encrypt)Files(\.|$)
- id: go-obfuscated-encrypt-method
  desc: Obfuscated Go Encrypt/Decrypt methods
  crit: suspicious
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: '[A-Za-z][A-Za-z0-9_]{6,14}\.\(\*[A-Za-z][A-Za-z0-9_]{6,14}\)\.(Encrypt|Decrypt)$'
- id: go-obfuscated-xor-stream
  desc: Obfuscated Go XOR stream cipher
  crit: suspicious
  conf: 0.85
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: '[A-Za-z][A-Za-z0-9_]{5,14}\.\(\*[A-Za-z][A-Za-z0-9_]{6,14}\)\.XORKeyStream'
- id: go-encrypt-filename-func
  desc: Go EncryptFilename function symbol
  crit: suspicious
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \)\.(Encrypt|Decrypt)Filename(\.|$)
- id: go-kill-nonroot-func
  desc: Go KillNonRoot function symbol
  crit: suspicious
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \)\.KillNonRoot(\.|$)
- id: go-scan-export-paths
  desc: Go ScanPaths/ExportPaths function symbols
  crit: notable
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \)\.(Scan|Export)(Files|Paths)(\.|$)
- id: go-wipe-paths-func
  desc: Go WipePaths function symbol
  crit: suspicious
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \)\.WipePaths(\.|$)
- id: go-erase-key-func
  desc: Go EraseKey function symbol
  crit: suspicious
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \)\.EraseKey(\.|$)
- id: go-export-key-func
  desc: Go ExportKey function symbol
  crit: notable
  conf: 0.85
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \)\.(Export|Import)(Key|PublicKey)(\.|$)
- id: go-try-fix-file-func
  desc: Go TryToFixFile function symbol
  crit: suspicious
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \)\.TryToFixFile(\.|$)
- id: go-obfuscated-pkg
  desc: Go obfuscated package names
  crit: suspicious
  conf: 0.85
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: \b[a-z][a-z0-9]{6,9}\.\(\*[A-Z][a-zA-Z0-9]{6,9}\)\.
- id: go-rsa-encrypt-oaep
  desc: Go RSA OAEP encryption
  crit: notable
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    substr: crypto/rsa.EncryptOAEP
- id: go-main-encrypt-data
  desc: Go main.encryptData function
  crit: suspicious
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.(encrypt|decrypt)Data(\.|$)
- id: go-main-payment-check
  desc: Go main payment check functions
  crit: suspicious
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.(isPay|getHasPay|checkPay)
- id: go-main-self-remove
  desc: Go main.selfRemove function
  crit: suspicious
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.selfRemove(\.|$)
- id: go-main-show-message
  desc: Go main ransom message function
  crit: suspicious
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.(createAndShowMessage|showRansomNote|displayMessage)(\.|$)
- id: go-main-autorun
  desc: Go main autorun persistence
  crit: suspicious
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.(makeAutoRun|setupAutoStart|installPersistence)(\.|$)
- id: go-main-debugger-check
  desc: Go main debugger detection
  crit: suspicious
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.(debuggerPresent|doSomeThingElseWithDebugger|checkDebugger)(\.|$)
- id: go-main-run-connection
  desc: Go main C2 connection function
  crit: suspicious
  conf: 0.9
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.(runConnection|connectToServer|startBeacon)(\.|$)
- id: go-main-remove-all-files
  desc: Go main remove all files
  crit: suspicious
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.(removeAllFiles|deleteAllFiles|wipeFiles)(\.|$)
- id: go-main-get-key
  desc: Go main getKey function
  crit: notable
  conf: 0.85
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: main\.(getKey|getKeyAndIV|retrieveKey)(\.|$)
- id: go-ransomware-source-path
  desc: Go ransomware source path
  crit: suspicious
  conf: 0.99
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: /ransomware[_-]?(thesis|poc|test|dev)?/
    case_insensitive: true
- id: go-obfuscated-keygen
  desc: Obfuscated Go key generation
  crit: notable
  conf: 0.85
  for:
  - elf
  - macho
  - pe
  if:
    type: string
    regex: '[A-Za-z]\w{5,14}\.\(\*[A-Za-z]\w{5,14}\)\.(?:GenerateKey|NewPrivateKey)'
composite_rules:
- id: go-ransomware-encrypt
  desc: Go ransomware encryption pattern
  crit: hostile
  conf: 0.98
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-encrypt-files-func
  - id: go-encrypt-filename-func
  - id: go-scan-export-paths
  - id: go-rsa-encrypt-oaep
- id: go-ransomware-with-kill
  desc: Go ransomware with process kill
  crit: hostile
  conf: 0.97
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-encrypt-files-func
  - id: go-kill-nonroot-func
  - id: go-rsa-encrypt-oaep
  any:
  - id: go-encrypt-filename-func
  - id: go-scan-export-paths
  - id: go-erase-key-func
- id: go-ransomware-key-mgmt
  desc: Go ransomware with key management
  crit: hostile
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-encrypt-files-func
  - id: go-erase-key-func
  - id: go-export-key-func
  - id: go-rsa-encrypt-oaep
- id: go-ransomware-obfuscated
  desc: Go obfuscated ransomware
  crit: hostile
  conf: 0.95
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-obfuscated-pkg
  - id: go-encrypt-files-func
  - id: go-rsa-encrypt-oaep
  any:
  - id: go-encrypt-filename-func
  - id: go-kill-nonroot-func
  - id: go-scan-export-paths
- id: go-garble-crypto-malware
  desc: Garble-obfuscated Go crypto malware
  crit: hostile
  conf: 0.92
  mbc: B0032
  attack: T1027
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-obfuscated-pkg
  - id: go-obfuscated-encrypt-method
  - id: go-obfuscated-keygen
  any:
  - id: micro-traits/crypto/symmetric/stream::chacha-salsa-constant
  - id: go-obfuscated-xor-stream
  - id: objectives/command-and-control/implant/binary/capabilities::go-xor-encoding
- id: go-simple-ransomware
  desc: Simple Go ransomware pattern
  crit: hostile
  conf: 0.98
  mbc: B0040
  attack: T1486
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-main-encrypt-data
  - id: go-main-payment-check
  - id: objectives/impact/ransom/encrypt::ransom-note-text
  any:
  - id: go-main-self-remove
  - id: go-main-show-message
  - id: go-main-autorun
  - id: go-main-get-key
- id: go-ransomware-encrypt-payment
  desc: Go ransomware with payment check
  crit: hostile
  conf: 0.97
  mbc: B0040
  attack: T1486
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-main-encrypt-data
  - id: go-main-payment-check
  any:
  - id: go-main-remove-all-files
  - id: go-main-self-remove
  - id: go-main-run-connection
  - id: go-main-debugger-check
- id: go-ransomware-c2
  desc: Go ransomware with C2 connection
  crit: hostile
  conf: 0.96
  mbc: B0040
  attack: T1486
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-main-encrypt-data
  - id: go-main-run-connection
  - id: go-main-get-key
  any:
  - id: go-main-payment-check
  - id: go-main-self-remove
  - id: go-main-show-message
  - id: micro-traits/crypto/symmetric/stream::chacha-salsa-constant
- id: go-ransomware-antiforensics
  desc: Go ransomware with cleanup
  crit: hostile
  conf: 0.97
  mbc: B0040
  attack: T1486
  for:
  - elf
  - macho
  - pe
  all:
  - id: go-main-encrypt-data
  - id: go-main-self-remove
  - id: go-main-remove-all-files
  any:
  - id: go-main-payment-check
  - id: go-main-run-connection
  - id: objectives/impact/ransom/encrypt::ransom-note-text
