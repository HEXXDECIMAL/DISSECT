# Network Interface Fingerprinting (MAC addresses)
# ATT&CK: T1082 (System Information Discovery)
# NOTE: Neutral /sys/class/net path moved to micro-behaviors/os/network/interface/

defaults:
  for: [all]
  attack: "T1082"

traits:

  - id: hwaddr
    desc: HWaddr MAC prefix
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "HWaddr"

  - id: ether-prefix
    desc: '"ether " MAC prefix'
    crit: notable
    conf: 0.6
    for: [shell, python, ruby, perl, go]
    if:
      type: string
      regex: "ether\\s+[0-9a-fA-F]{2}[:-][0-9a-fA-F]{2}[:-][0-9a-fA-F]{2}"

  - id: getifaddrs-func
    desc: getifaddrs function
    crit: notable
    conf: 0.6
    if:
      type: symbol
      regex: "getifaddrs"

  - id: siocgifhwaddr
    desc: SIOCGIFHWADDR ioctl
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "SIOCGIFHWADDR"

composite_rules:
  # Network interface composite
  - id: network-interfaces
    desc: Network interface fingerprinting (MAC address)
    crit: notable
    conf: 0.75
    any:
      - id: micro-behaviors/os/network/interface::sys-class-net
      - id: hwaddr
      - id: ether-prefix
      - id: getifaddrs-func
      - id: siocgifhwaddr
      - id: micro-behaviors/os/network/interface::ip-link
      - id: micro-behaviors/os/network/interface::ifconfig
