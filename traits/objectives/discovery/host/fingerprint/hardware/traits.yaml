# Hardware Information Collection (DMI/SMBIOS, CPU)
# ATT&CK: T1082 (System Information Discovery)
# NOTE: Neutral hardware paths/fields (dmi paths, bios_version, cpu fields, lscpu) moved to micro-behaviors/os/sysinfo/hardware/

defaults:
  for: [all]
  attack: "T1082"

traits:
  # === DMI/SMBIOS micro-behaviors ===
  # NOTE: product_serial and board_serial kept here - have suspicion (used for device tracking)
  - id: product-serial
    desc: product_serial DMI field
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "product_serial"

  - id: board-serial
    desc: board_serial DMI field
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "board_serial"

  # Removed fp-dmidecode-cmd duplicate - use micro-behaviors/os/sysinfo/dmi::dmidecode

composite_rules:
  # DMI fields helper
  - id: dmi-fields
    desc: DMI/SMBIOS fields
    crit: notable
    conf: 0.5
    needs: 2
    any:
      - id: micro-behaviors/os/sysinfo/hardware::dmi-class-path
      - id: micro-behaviors/os/sysinfo/hardware::dmi-devices-path
      - id: micro-behaviors/os/sysinfo/dmi::dmi-vendor-product
      - id: product-serial
      - id: board-serial
      - id: micro-behaviors/os/sysinfo/hardware::bios-version

  # DMI/SMBIOS composite
  - id: dmi-smbios
    desc: DMI/SMBIOS hardware information collection
    crit: notable
    conf: 0.75
    any:
      - id: dmi-fields
      - id: micro-behaviors/os/sysinfo/dmi::dmidecode

  # CPU info helper
  - id: cpu-fields
    desc: CPU info fields
    crit: notable
    conf: 0.4
    any:
      - id: micro-behaviors/os/sysinfo/hardware::cpu-model-name
      - id: micro-behaviors/os/sysinfo/hardware::cpu-family
      - id: micro-behaviors/os/sysinfo/hardware::cpu-cores

  # CPU info composite
  - id: cpu-info
    desc: CPU information fingerprinting
    crit: notable
    conf: 0.4
    any:
      - id: cpu-proc-cpuinfo
      - id: micro-behaviors/os/sysinfo/hardware::lscpu-cmd

  # Helper: /proc/cpuinfo + fields
  - id: cpu-proc-cpuinfo
    desc: /proc/cpuinfo with fields
    crit: notable
    conf: 0.4
    all:
      - id: micro-behaviors/fs/proc/system::system-cpuinfo
      - id: cpu-fields
