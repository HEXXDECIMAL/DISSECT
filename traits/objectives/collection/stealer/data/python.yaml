# Python Infostealer and Staging Detection
# Aggregates micro-behaviors into high-level stealer narratives

composite_rules:
  - id: infostealer
    desc: "Python infostealer behavior"
    crit: suspicious
    conf: 0.95
    mbc: "OB0003"
    attack: "T1041"
    for: [python]
    needs: 3
    all:
      - id: objectives/discovery/system/
      - id: micro-traits/comm/http/request
    any:
      - id: micro-traits/fs/file/write
      - id: objectives/credential-access/
      - id: objectives/collection/

  - id: dynamic-dropper
    desc: "Dynamic Python dropper behavior"
    crit: suspicious
    conf: 0.98
    mbc: "B0023"
    attack: "T1059"
    for: [python]
    needs: 4
    all:
      - id: objectives/anti-static/obfuscation/strings
      - id: objectives/lateral-movement/supply-chain
      - id: objectives/execution/

  - id: evasive-profiler
    desc: "Evasive Python system profiler"
    crit: suspicious
    conf: 0.95
    mbc: "E1082"
    attack: "T1082"
    for: [python]
    needs: 3
    all:
      - id: objectives/anti-analysis/aliasing/dynamic::python-std-alias
      - id: objectives/discovery/system/
      - id: micro-traits/comm/http/request

  - id: data-staging
    desc: "Data staging for exfiltration"
    crit: suspicious
    conf: 0.98
    mbc: "B0030"
    attack: "T1074"
    for: [python]
    near_lines: 100
    needs: 3
    all:
      - id: objectives/discovery/system/
    any:
      - id: micro-traits/fs/file/write
      - id: objectives/collection/archive
      - id: objectives/exfiltration/http
