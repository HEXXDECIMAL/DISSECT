# Collection - Database Access
# ATT&CK: T1005 (Data from Local System)

defaults:
  for: [all]

traits:
  # === Atomic: SQLite ===

  - id: sqlite
    desc: SQLite database access
    crit: notable
    conf: 0.7
    attack: "T1005"
    platforms: [all]
    if:
      id: micro-behaviors/data/db/conn/sqlite::sqlite

  # === Atomic: MySQL ===

  - id: mysql
    desc: MySQL database access
    crit: notable
    conf: 0.7
    attack: "T1005"
    platforms: [all]
    if:
      type: string
      substr: "mysql"

  # === PostgreSQL atomic indicators ===

  - id: postgresql-str
    desc: postgresql string
    crit: notable
    conf: 0.6
    attack: "T1005"
    platforms: [all]
    if:
      type: string
      substr: "postgresql"

  - id: go-pg-import
    desc: github.com/go-pg import
    crit: notable
    conf: 0.6
    attack: "T1005"
    platforms: [all]
    if:
      type: string
      substr: "github.com/go-pg"

  # === Atomic: LevelDB ===

  - id: leveldb
    desc: LevelDB database access
    crit: notable
    conf: 0.7
    attack: "T1005"
    platforms: [all]
    if:
      type: string
      regex: "\\b[Ll]evel[Dd][Bb]\\b"

composite_rules:
  # PostgreSQL composite
  - id: postgresql
    desc: PostgreSQL database access
    crit: notable
    conf: 0.7
    attack: "T1005"
    platforms: [all]
    any:
      - id: postgresql-str
      - id: go-pg-import
