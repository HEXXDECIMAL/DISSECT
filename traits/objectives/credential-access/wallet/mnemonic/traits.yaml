defaults:
  for:
  - all
  attack: T1555
  mbc: B0028
  crit: suspicious
traits:
- id: derivation-path
  desc: HD wallet derivation path (BIP-44/49/84)
  conf: 0.8
  if:
    type: string
    regex: m/44'/|m/49'/|m/84'/|m/86'/|derivation_?path|derivationPath
- id: mnemonic-word
  desc: mnemonic term
  crit: notable
  conf: 0.5
  for:
  - python
  - javascript
  - csharp
  - java
  - go
  if:
    type: string
    substr: mnemonic
- id: seed-phrase-underscore
  desc: seed_phrase term
  crit: notable
  conf: 0.5
  if:
    type: string
    substr: seed_phrase
- id: seedphrase-word
  desc: seedphrase term
  crit: notable
  conf: 0.5
  if:
    type: string
    substr: seedphrase
- id: recovery-phrase-word
  desc: recovery_phrase term
  crit: notable
  conf: 0.5
  if:
    type: string
    substr: recovery_phrase
- id: secret-words-word
  desc: secret_words term
  crit: notable
  conf: 0.5
  if:
    type: string
    substr: secret_words
- id: metamask-word
  desc: MetaMask reference
  crit: notable
  conf: 0.5
  if:
    type: string
    word: metamask
- id: phantom-word
  desc: Phantom wallet reference
  crit: notable
  conf: 0.5
  if:
    type: string
    word: phantom
  not:
  - PhantomJS
  - phantomjs
- id: browser-word
  desc: browser wallet context
  crit: notable
  conf: 0.4
  if:
    type: string
    regex: \bbrowser[_-]?(wallet|extension|addon)\b
- id: word-count-check
  desc: Mnemonic word count validation (12/15/18/21/24)
  conf: 0.85
  crit: suspicious
  if:
    type: string
    regex: split\([^)]{0,120}\)\s*\.\s*length\s*[=!<>]+\s*(12|15|18|21|24)|len\([^)]{0,120}split[^)]{0,120}\)\s*[=!<>]+\s*(12|15|18|21|24)|words?_?count\s*[=!<>]+\s*(12|15|18|21|24)
- id: bip39-wordlist
  desc: BIP-39 wordlist reference
  conf: 0.85
  if:
    type: string
    regex: bip39|bip-39|wordlist|word_list|english\.txt.{0,30}mnemonic|mnemonic.{0,30}english\.txt
- id: validation-pattern
  desc: Mnemonic phrase validation logic
  conf: 0.85
  crit: suspicious
  if:
    type: string
    regex: validate.{0,20}mnemonic|mnemonic.{0,20}valid|check.{0,20}seed.{0,20}phrase|verify.{0,20}recovery
- id: private-key-hex
  desc: Wallet private key extraction
  conf: 0.85
  crit: suspicious
  size_max: 1000000
  if:
    type: string
    regex: \b(wallet|eth|btc|crypto|metamask|phantom)\b.{0,50}\bprivate_?key\b|\bexport\b.{0,30}\b(wallet|crypto|eth|btc)\b.{0,30}\bkey\b
- id: bitcoin-wif
  desc: Bitcoin WIF private key format
  conf: 0.85
  crit: suspicious
  if:
    type: string
    regex: wallet_import_format|WIF.{0,20}key|WIF.{0,20}private|bitcoin.{0,20}wif|wif.{0,20}bitcoin|decode.{0,20}wif|encode.{0,20}wif|to_?wif|from_?wif
- id: keystore-file
  desc: Ethereum keystore file reference
  conf: 0.8
  if:
    type: string
    regex: UTC--.{0,50}--[a-fA-F0-9]{40}|ethereum.{0,30}keystore|keystore.{0,30}ethereum|web3.{0,30}keystore|\.json.{0,30}wallet
- id: variable-names
  desc: Mnemonic-related variable or function names
  conf: 0.8
  if:
    type: string
    regex: \bmnemonic\s*[=:]|\bseed_phrase\s*[=:]|\bseedphrase\s*[=:]|\brecovery_phrase\s*[=:]|\brecoveryPhrase\s*[=:]|\bsecret_words\s*[=:]|\bsecretWords\s*[=:]|\bwallet_words\s*[=:]|\bwalletWords\s*[=:]
composite_rules:
- id: mnemonic-terms
  desc: Mnemonic or seed phrase terminology
  crit: notable
  conf: 0.7
  needs: 2
  any:
  - id: mnemonic-word
  - id: seed-phrase-underscore
  - id: seedphrase-word
  - id: recovery-phrase-word
  - id: secret-words-word
- id: wallet-context
  desc: Wallet or cryptocurrency context
  crit: notable
  conf: 0.7
  needs: 2
  any:
  - id: objectives/impact/cryptojacking/miner::wallet-ref
  - id: micro-traits/data/text/keywords::crypto-word
  - id: metamask-word
  - id: phantom-word
  - id: browser-word
- id: stealer-pattern
  desc: Mnemonic phrase theft (extraction +
  crit: hostile
  conf: 0.95
  attack: T1555
  mbc: B0028
  for:
  - python
  - javascript
  all:
  - id: mnemonic-terms
  - id: micro-traits/comm/http/request::http-client
  - id: wallet-context
- id: comprehensive-stealer
  desc: Comprehensive wallet credential theft
  crit: hostile
  conf: 0.95
  attack: T1555
  mbc: B0028
  for:
  - python
  - javascript
  - elf
  - pe
  - macho
  needs: 3
  any:
  - id: mnemonic-terms
  - id: private-key-hex
  - id: keystore-file
  - id: derivation-path
  - id: bip39-wordlist
