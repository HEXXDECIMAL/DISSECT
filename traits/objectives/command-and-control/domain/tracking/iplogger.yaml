defaults:
  for: [all]

traits:
  - id: iplogger-domain-a
    desc: "Detects iplogger tracking domains"
    crit: suspicious
    if:
      type: string
      regex: "iplogger\\.(?:org|com|net|ru)"

  - id: iplogger-domain-b
    desc: "Detects iplogger tracking domains"
    crit: suspicious
    if:
      type: string
      regex: "2no\\.co|yip\\.su"

  - id: tracking-services-domain-a
    desc: "Detects tracking domains in malware beacons"
    crit: suspicious
    if:
      type: string
      regex: "(grabify\\.link|blasze\\.com|canarytokens\\.com)"

  - id: tracking-services-domain-b
    desc: "Detects tracking domains in malware beacons"
    crit: suspicious
    if:
      type: string
      regex: "(bitly\\.com|tinyurl\\.com)"

composite_rules:
  - id: iplogger-domain
    desc: "Detects iplogger tracking domains"
    crit: suspicious
    any:
      - id: iplogger-domain-a
      - id: iplogger-domain-b

  - id: tracking-services-domain
    desc: "Detects tracking domains in malware beacons"
    crit: suspicious
    any:
      - id: tracking-services-domain-a
      - id: tracking-services-domain-b

  - id: iplogger-keyword-context
    desc: "Detects 'iplogger' keyword with HTTP indicators"
    crit: suspicious
    all:
      - id: objectives/discovery/network/scan::iplogger-keyword
      - id: iplogger-http

  - id: fragmented-tracking-beacon
    desc: "Detects fragmented tracking/logging URL construction"
    crit: suspicious
    all:
      - id: micro-behaviors/communications/http/lib/netlib
    any:
      - id: objectives/discovery/network/scan::iplogger-keyword
      - id: iplogger-domain
      - id: tracking-services-domain

  - id: iplogger-http
    desc: "Detects HTTP indicators often with iplogger"
    crit: notable
    any:
      - id: micro-behaviors/communications/http/protocol/
      - id: micro-behaviors/communications/http/get/
      - id: micro-behaviors/communications/http/post/
      - id: micro-behaviors/communications/http/request/
