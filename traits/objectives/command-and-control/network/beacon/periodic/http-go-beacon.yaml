defaults:
  crit: suspicious
  attack: T1071.001
  mbc: B0030
  for:
  - elf
  - macho
  - pe
  platforms:
  - all
traits:
- id: http-versions
  desc: HTTP protocol versions in strings
  crit: notable
  conf: 0.75
  if:
    type: string
    regex: HTTP/(1\.0|1\.1|2\.0)
- id: http-methods-main
  desc: HTTP method (PUT)
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: '^PUT '
- id: http-methods-other
  desc: HTTP methods (HEAD, DELETE, PATCH)
  crit: notable
  conf: 0.6
  if:
    type: string
    regex: '^(HEAD|DELETE|PATCH) '
- id: go-dial-string
  desc: Network dial pattern in strings
  crit: notable
  conf: 0.85
  if:
    id: micro-behaviors/communications/socket/connect/go::go-dial-methods
# go-listen-string removed - use micro-behaviors/communications/socket/listen/go composite instead
- id: domain-keyword
  desc: Domain configuration keyword
  crit: suspicious
  conf: 0.8
  if:
    type: string
    substr: ; Domain
- id: http-config-keyword
  desc: HTTP configuration keyword
  crit: suspicious
  conf: 0.8
  if:
    type: string
    substr: ; HttpOnL
- id: callback-pattern
  desc: Callback function pattern
  crit: notable
  conf: 0.75
  if:
    type: string
    regex: (callback|Callback|CallBack).{0,50}Handler
- id: polling-pattern-a
  desc: Polling/beacon loop pattern
  crit: notable
  conf: 0.7
  if:
    type: string
    regex: (poll|beacon|heartbeat|tick).{0,50}loop
    case_insensitive: true
- id: polling-pattern-b
  desc: Polling/beacon loop pattern
  crit: notable
  conf: 0.7
  if:
    type: string
    regex: loop.{0,50}(poll|beacon|heartbeat)
    case_insensitive: true
- id: c2-marker
  desc: C2 identifier in strings
  crit: suspicious
  conf: 0.75
  if:
    type: string
    regex: (?i)\b(c2Handler|c2Server|c2Beacon)\b|c2\s*=\s*https?://

- id: go-http-do
  desc: "Go http.Do call"
  if:
    type: string
    substr: "http.Do"

composite_rules:
- id: go-http-client
  desc: Go HTTP client pattern
  crit: notable
  conf: 0.85
  any:
    - id: micro-behaviors/communications/http/get::http-get
    - id: micro-behaviors/communications/http/post::http-post
    - id: objectives/command-and-control/beacon/markers::http-client
    - id: go-http-do
- id: http-methods
  desc: HTTP methods (GET, POST, HEAD)
  crit: notable
  conf: 0.6
  any:
  - id: http-methods-main
  - id: http-methods-other
- id: polling-pattern
  desc: Polling/beacon loop pattern
  crit: notable
  conf: 0.7
  any:
  - id: polling-pattern-a
  - id: polling-pattern-b
- id: http-beacon-network
  desc: HTTP beacon network comms
  crit: suspicious
  conf: 0.9
  attack: T1071.001
  for:
  - elf
  - macho
  - pe
  needs: 2
  all:
  - id: http-versions
  - id: go-dial-string
- id: http-beacon-configured
  desc: HTTP beacon C2 config
  crit: suspicious
  conf: 0.92
  attack: T1071.001
  for:
  - elf
  - macho
  - pe
  needs: 2
  all:
  - id: http-versions
  - id: domain-keyword
- id: http-c2-beacon-detected
  desc: HTTP-based C2 beacon
  crit: hostile
  conf: 0.95
  attack: T1071.001
  mbc: B0030
  for:
  - elf
  - macho
  - pe
  needs: 2
  all:
  - id: http-beacon-network
  - id: go-http-client
