# macOS InputManager Persistence
# Detects InputManager bundle persistence mechanism (pre-Lion macOS)
# ATT&CK: T1547.015 (Boot or Logon Autostart Execution: Login Items)
# InputManagers auto-load bundles into Cocoa applications at launch

defaults:
  for: [all]
  platforms: [macos]

traits:
  - id: load-bundle-on-launch
    desc: InputManager LoadBundleOnLaunch key
    crit: suspicious
    conf: 0.9
    attack: "T1547.015"
    if:
      type: raw
      substr: "LoadBundleOnLaunch"

  - id: no-menu-entry
    desc: InputManager NoMenuEntry key
    crit: notable
    conf: 0.8
    attack: "T1547.015"
    if:
      type: raw
      substr: "NoMenuEntry"

composite_rules:
  - id: input-manager-persistence
    desc: macOS InputManager bundle persistence
    crit: suspicious
    conf: 0.9
    attack: "T1547.015"
    all:
      - id: load-bundle-on-launch
      - id: no-menu-entry
