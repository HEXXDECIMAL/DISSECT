# Legitimate Logging Framework Detection
# Useful for ML baseline and differential analysis

traits:
  # syslog logging
  - id: lib/logging/syslog
    description: Standard syslog logging
    criticality: benign
    confidence: 0.9
    condition:
      type: yara
      source: |
        rule syslog_logging {
          strings:
            $syslog1 = "openlog" ascii
            $syslog2 = "syslog" ascii
            $syslog3 = "closelog" ascii
            $facility1 = "LOG_USER" ascii
            $facility2 = "LOG_DAEMON" ascii
            $facility3 = "LOG_LOCAL" ascii
          condition:
            2 of ($syslog*) or (any of ($syslog*) and any of ($facility*))
        }

  # Log4j (Java)
  - id: lib/logging/log4j
    description: Log4j logging framework (legitimate use)
    criticality: benign
    confidence: 0.85
    condition:
      type: yara
      source: |
        rule log4j_logging {
          strings:
            $log4j1 = "org.apache.log4j" ascii
            $log4j2 = "org.apache.logging.log4j" ascii
            $log4j3 = "log4j.properties" ascii
            $log4j4 = "log4j2.xml" ascii
            $level1 = "Logger.getLogger" ascii
            $level2 = "LogManager.getLogger" ascii
          condition:
            any of ($log4j*) or any of ($level*)
        }

  # SLF4J (Java)
  - id: lib/logging/slf4j
    description: SLF4J logging facade
    criticality: benign
    confidence: 0.9
    condition:
      type: yara
      source: |
        rule slf4j_logging {
          strings:
            $slf4j1 = "org.slf4j" ascii
            $slf4j2 = "LoggerFactory" ascii
            $slf4j3 = "slf4j-api" ascii
          condition:
            any of them
        }

  # Python logging
  - id: lib/logging/python
    description: Python logging module
    criticality: benign
    confidence: 0.9
    condition:
      type: yara
      source: |
        rule python_logging {
          strings:
            $py1 = "import logging" ascii
            $py2 = "logging.getLogger" ascii
            $py3 = "logging.basicConfig" ascii
            $py4 = "logging.Handler" ascii
            $level1 = "logging.DEBUG" ascii
            $level2 = "logging.INFO" ascii
            $level3 = "logging.WARNING" ascii
          condition:
            any of ($py*) or 2 of ($level*)
        }

  # Go logging libraries
  - id: lib/logging/go
    description: Go logging libraries (log, logrus, zap)
    criticality: benign
    confidence: 0.9
    condition:
      type: yara
      source: |
        rule go_logging {
          strings:
            $std1 = "log.Print" ascii
            $std2 = "log.Fatal" ascii
            $std3 = "log.Panic" ascii
            $logrus1 = "logrus" ascii
            $logrus2 = "WithFields" ascii
            $zap1 = "go.uber.org/zap" ascii
            $zap2 = "zap.Logger" ascii
            $zerolog = "zerolog" ascii
          condition:
            2 of ($std*) or any of ($logrus*) or any of ($zap*) or $zerolog
        }

  # Rust logging (log, tracing)
  - id: lib/logging/rust
    description: Rust logging crates (log, tracing, env_logger)
    criticality: benign
    confidence: 0.9
    condition:
      type: yara
      source: |
        rule rust_logging {
          strings:
            $log1 = "log::" ascii
            $log2 = "env_logger" ascii
            $tracing1 = "tracing::" ascii
            $tracing2 = "tracing_subscriber" ascii
            $level1 = "log::info!" ascii
            $level2 = "log::debug!" ascii
          condition:
            any of them
        }

  # systemd journal
  - id: lib/logging/journald
    description: systemd journal logging
    criticality: benign
    confidence: 0.9
    condition:
      type: yara
      source: |
        rule journald_logging {
          strings:
            $journal1 = "sd_journal_print" ascii
            $journal2 = "sd_journal_send" ascii
            $journal3 = "libsystemd" ascii
            $journal4 = "systemd-journal" ascii
          condition:
            any of them
        }

  # Structured logging (JSON)
  - id: lib/logging/structured
    description: Structured/JSON logging
    criticality: benign
    confidence: 0.8
    condition:
      type: yara
      source: |
        rule structured_logging {
          strings:
            $json1 = "\"level\":" ascii
            $json2 = "\"message\":" ascii
            $json3 = "\"timestamp\":" ascii
            $json4 = "\"logger\":" ascii
            $json5 = "\"severity\":" ascii
          condition:
            3 of them
        }

  # Winston (Node.js)
  - id: lib/logging/winston
    description: Winston logging library (Node.js)
    criticality: benign
    confidence: 0.9
    condition:
      type: yara
      source: |
        rule winston_logging {
          strings:
            $winston1 = "winston" ascii
            $winston2 = "createLogger" ascii
            $winston3 = "transports" ascii
          condition:
            $winston1 and any of ($winston2, $winston3)
        }

  # Log rotation patterns
  - id: lib/logging/rotation
    description: Log rotation patterns
    criticality: benign
    confidence: 0.85
    condition:
      type: yara
      source: |
        rule log_rotation {
          strings:
            $rot1 = "logrotate" ascii
            $rot2 = ".log.1" ascii
            $rot3 = ".log.gz" ascii
            $rot4 = "maxsize" ascii
            $rot5 = "maxbackups" ascii
            $rot6 = "rotate" ascii nocase
          condition:
            any of them
        }
