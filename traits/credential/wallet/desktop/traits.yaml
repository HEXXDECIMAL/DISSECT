# Desktop Cryptocurrency Wallet Theft Detection
# Detects targeting of desktop wallet application data
# ATT&CK: T1555 (Credentials from Password Stores)
# MBC: B0028 (Credential Theft)

defaults:
  attack: "T1555"
  mbc: "B0028"
  criticality: suspicious
  platforms: [macos, windows, linux]

traits:
  # Electrum wallet paths
  - id: credential/wallet/desktop/electrum
    description: "Electrum wallet data path"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "\\.electrum/wallets?|\\.electrum.*wallet|electrum.*default_wallet"

  # Coinomi wallet paths
  - id: credential/wallet/desktop/coinomi
    description: "Coinomi wallet data path"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "Coinomi/wallets?|Coinomi.*wallet\\.dat|com\\.coinomi"

  # Exodus wallet
  - id: credential/wallet/desktop/exodus
    description: "Exodus wallet data path"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "Exodus/exodus\\.wallet|exodus.*passphrase|com\\.exodus"

  # Atomic Wallet
  - id: credential/wallet/desktop/atomic
    description: "Atomic Wallet data path"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "atomic/Local Storage|Atomic Wallet|com\\.atomicwallet"

  # Wasabi wallet (Bitcoin privacy)
  - id: credential/wallet/desktop/wasabi
    description: "Wasabi Bitcoin wallet data path"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "\\.walletwasabi|\\.WalletWasabi|WasabiWallet"

  # Binance desktop
  - id: credential/wallet/desktop/binance
    description: "Binance desktop app data"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "Binance/app-store\\.json|@aspect-binance|com\\.binance"

  # TonKeeper (TON blockchain)
  - id: credential/wallet/desktop/tonkeeper
    description: "TonKeeper wallet data"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "@tonkeeper/desktop|tonkeeper.*config\\.json|com\\.ton-keeper"

  # Ledger Live
  - id: credential/wallet/desktop/ledger
    description: "Ledger Live application data"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "Ledger Live/|@ledgerhq|ledger.*accounts"

  # Trezor Suite
  - id: credential/wallet/desktop/trezor
    description: "Trezor Suite application data"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "@trezor/suite-desktop|trezor.*suite"

  # Guarda wallet
  - id: credential/wallet/desktop/guarda
    description: "Guarda wallet data path"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "Guarda/Local Storage|com\\.guarda"

  # Bitcoin Core/Qt
  - id: credential/wallet/desktop/bitcoin-core
    description: "Bitcoin Core wallet data"
    confidence: 0.85
    criticality: hostile
    condition:
      type: string
      regex: "\\.bitcoin/wallet\\.dat|\\.bitcoin/wallets|Bitcoin/wallets"

  # Ethereum Mist (deprecated but still targeted)
  - id: credential/wallet/desktop/mist
    description: "Ethereum Mist/Wallet data"
    confidence: 0.8
    criticality: hostile
    condition:
      type: string
      regex: "Ethereum/keystore|Mist/keystore|\\.ethereum/keystore"

composite_rules:
  # Multiple desktop wallet targets = stealer
  - id: credential/wallet/desktop/stealer
    description: "Desktop cryptocurrency wallet stealer"
    criticality: hostile
    confidence: 0.95
    requires_count: 2
    conditions:
      - type: trait
        id: credential/wallet/desktop/electrum
      - type: trait
        id: credential/wallet/desktop/coinomi
      - type: trait
        id: credential/wallet/desktop/exodus
      - type: trait
        id: credential/wallet/desktop/atomic
      - type: trait
        id: credential/wallet/desktop/binance
      - type: trait
        id: credential/wallet/desktop/tonkeeper
