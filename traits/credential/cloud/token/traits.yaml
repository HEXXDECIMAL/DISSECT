# Credential Access - Cloud Provider Credentials
# ATT&CK: T1552.001 (Unsecured Credentials: Credentials In Files)

defaults:
  attack: "T1552.001"
  criticality: suspicious

composite_rules:
  # === Atomic: AWS ===
  - id: credential/cloud/aws-config
    description: AWS configuration directory
    confidence: 0.75
    condition:
      type: string
      exact: ".aws"

  - id: credential/cloud/aws-credentials-file
    description: AWS credentials file path
    confidence: 0.8
    condition:
      type: string
      regex: "\\.aws/credentials"

  - id: credential/cloud/aws-access-key
    description: AWS access key ID pattern
    confidence: 0.85
    condition:
      type: string
      regex: "AKIA[0-9A-Z]{16}"

  # === Atomic: GCP ===
  - id: credential/cloud/gcloud-config
    description: GCloud configuration directory
    confidence: 0.75
    condition:
      type: string
      exact: ".config/gcloud"

  - id: credential/cloud/gcp-default-credentials
    description: GCP application default credentials
    confidence: 0.8
    condition:
      type: string
      exact: "application_default_credentials.json"

  # === Atomic: Azure ===
  - id: credential/cloud/azure-config
    description: Azure CLI configuration directory
    confidence: 0.75
    condition:
      type: string
      exact: ".azure"

  # === Atomic: Environment Files ===
  - id: credential/cloud/dotenv-request
    description: HTTP request for .env file
    confidence: 0.85
    condition:
      type: string
      exact: "GET /.env"

  - id: credential/cloud/dotenv-file
    description: .env file reference
    criticality: notable
    confidence: 0.5
    condition:
      type: string
      regex: "\\.env\\b"

  # === Composite Rules ===
  - id: credential/cloud/aws-credential-theft
    description: AWS credential theft
    confidence: 0.85
    requires_any:
      - type: trait
        id: credential/cloud/aws-credentials-file
      - type: trait
        id: credential/cloud/aws-access-key
    requires_all:
      - type: trait
        id: credential/cloud/aws-config

  - id: credential/cloud/gcp-credential-theft
    description: GCP credential theft
    confidence: 0.85
    requires_all:
      - type: trait
        id: credential/cloud/gcloud-config
    requires_any:
      - type: trait
        id: credential/cloud/gcp-default-credentials
