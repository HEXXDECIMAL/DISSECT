# Credential Access - Browser Data Theft (Generic/Cross-browser)
# Cookie theft libraries and multi-browser targeting
# ATT&CK: T1555.003 (Credentials from Password Stores: Credentials from Web Browsers)

traits:
  # === Cookie Theft Libraries ===

  - id: credential/browser/pycookiecheat
    description: Python cookie theft library (pycookiecheat)
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    file_types: [python]
    condition:
      type: string
      exact: "pycookiecheat"

  - id: credential/browser/kooky
    description: Go cookie theft library (kooky)
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    condition:
      type: string
      exact: "browserutils/kooky"

  - id: credential/browser/browser-cookie3
    description: Python browser-cookie3 library
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    file_types: [python]
    condition:
      type: string
      exact: "browser_cookie3"

  - id: credential/browser/hackbrowserdata
    description: HackBrowserData tool reference
    criticality: hostile
    confidence: 0.95
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      regex: "\\bhackbrowserdata\\b|HackBrowserData"
      case_insensitive: true

composite_rules:
  # Multi-browser targeting detection
  - id: credential/browser/multi-browser-theft
    description: Multi-browser credential theft
    criticality: hostile
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: yara
      source: |
        rule multi_browser_credential_theft {
          meta:
            description = "Targets multiple browsers for credential theft"
          strings:
            // Chromium-based
            $chrome = "Google/Chrome" ascii
            $chromium = "Chromium" ascii
            $edge = "Microsoft/Edge" ascii
            $brave = "BraveSoftware" ascii
            $opera = "Opera" ascii
            $vivaldi = "Vivaldi" ascii
            // Firefox-based
            $firefox = "Firefox" ascii
            $thunderbird = "Thunderbird" ascii
            // Safari
            $safari = "Safari" ascii
            // Common data files
            $login_data = "Login Data" ascii
            $cookies_sqlite = "cookies.sqlite" ascii
            $local_state = "Local State" ascii
          condition:
            // At least 2 browser refs + 1 data file
            2 of ($chrome, $chromium, $edge, $brave, $opera, $vivaldi, $firefox, $safari) and
            1 of ($login_data, $cookies_sqlite, $local_state)
        }
