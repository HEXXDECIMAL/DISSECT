# Credential Access - Chromium Browser Data Theft
# Covers Chrome, Chromium, Edge, Brave, Opera, Vivaldi, and other Chromium-based browsers
# ATT&CK: T1555.003 (Credentials from Password Stores: Credentials from Web Browsers)

traits:
  # === Path/File References ===

  - id: credential/browser/chromium/chrome-path
    description: Chrome browser profile path
    criticality: suspicious
    confidence: 0.7
    attack: "T1555.003"
    condition:
      type: string
      exact: "/Google/Chrome"

  - id: credential/browser/chromium/cookies-path
    description: Chromium Cookies file path
    criticality: suspicious
    confidence: 0.75
    attack: "T1555.003"
    condition:
      type: string
      exact: "/Cookies"

  - id: credential/browser/chromium/local-state
    description: Chromium Local State file
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    condition:
      type: string
      exact: "Local State"

  - id: credential/browser/chromium/login-data
    description: Chromium Login Data file reference
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    condition:
      type: string
      exact: "Login Data"

  - id: credential/browser/chromium/web-data
    description: Chromium Web Data file (passwords, cards)
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    condition:
      type: string
      exact: "Web Data"

  # === Encryption/Decryption Keys ===

  - id: credential/browser/chromium/encrypted-key
    description: Chromium encrypted_key field
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    condition:
      type: string
      exact: "encrypted_key"

  - id: credential/browser/chromium/os-crypt
    description: Chromium os_crypt structure
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    condition:
      type: string
      exact: "os_crypt"

  # === Database Tables ===

  - id: credential/browser/chromium/credit-cards-table
    description: Chromium credit_cards table
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    condition:
      type: string
      exact: "credit_cards"

  - id: credential/browser/chromium/logins-table
    description: Chromium logins table reference
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    condition:
      type: string
      regex: "\\blogins\\b"

  # === SQL Queries (high confidence) ===

  - id: credential/browser/chromium/password-sql
    description: Chromium Login Data SQL query (password theft)
    criticality: hostile
    confidence: 0.95
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      regex: "SELECT.*origin_url.*username_value.*password_value.*FROM\\s+logins"
      case_insensitive: true

  - id: credential/browser/chromium/cookie-sql
    description: Chromium Cookies SQL query
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    condition:
      type: string
      regex: "SELECT.*host_key.*encrypted_value.*FROM\\s+(cookies|moz_cookies)"
      case_insensitive: true

  - id: credential/browser/chromium/credit-card-sql
    description: Chromium credit card SQL query
    criticality: hostile
    confidence: 0.95
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      regex: "SELECT.*card_number.*FROM\\s+credit_cards"
      case_insensitive: true

composite_rules:
  # === Composite Detections ===

  - id: credential/browser/chromium/cookie-theft
    description: Chrome cookie file access
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    requires_all:
      - type: trait
        id: credential/browser/chromium/chrome-path
      - type: trait
        id: credential/browser/chromium/cookies-path

  - id: credential/browser/chromium/master-decrypt
    description: Chromium master password decryption
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "E1003"
    requires_all:
      - type: trait
        id: credential/browser/chromium/local-state
      - type: trait
        id: credential/browser/chromium/encrypted-key
      - type: trait
        id: credential/browser/chromium/os-crypt

  - id: credential/browser/chromium/password-theft
    description: Chromium password database theft
    criticality: hostile
    confidence: 0.95
    attack: "T1555.003"
    mbc: "B0028"
    requires_any:
      - type: trait
        id: credential/browser/chromium/password-sql
      - type: trait
        id: credential/browser/chromium/login-data

  - id: credential/browser/chromium/credit-card-theft
    description: Chromium credit card data theft
    criticality: hostile
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    requires_all:
      - type: trait
        id: credential/browser/chromium/web-data
      - type: trait
        id: credential/browser/chromium/credit-cards-table
