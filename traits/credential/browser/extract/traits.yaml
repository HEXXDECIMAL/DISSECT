# Credential Access - Browser Data Theft
# ATT&CK: T1555.003 (Credentials from Password Stores: Credentials from Web Browsers)

traits:
  # === Atomic: Chrome/Chromium ===

  - id: credential/browser/chrome-path
    description: Chrome browser profile path
    criticality: suspicious
    confidence: 0.7
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "/Google/Chrome"

  - id: credential/browser/chromium-cookies-path
    description: Chromium Cookies file path
    criticality: suspicious
    confidence: 0.75
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "/Cookies"

  - id: credential/browser/chromium-local-state
    description: Chromium Local State file
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "Local State"

  - id: credential/browser/chromium-encrypted-key
    description: Chromium encrypted_key field
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "encrypted_key"

  - id: credential/browser/chromium-os-crypt
    description: Chromium os_crypt structure
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "os_crypt"

  - id: credential/browser/chromium-web-data
    description: Chromium Web Data file (passwords, cards)
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "Web Data"

  - id: credential/browser/chromium-credit-cards
    description: Chromium credit_cards table
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "credit_cards"

  # === Atomic: Firefox ===

  - id: credential/browser/firefox-path
    description: Firefox browser reference
    criticality: notable
    confidence: 0.6
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "Firefox"

  - id: credential/browser/firefox-cookies
    description: Firefox cookies.sqlite database
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "cookies.sqlite"

  - id: credential/browser/firefox-formhistory
    description: Firefox formhistory.sqlite database
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "formhistory.sqlite"

  - id: credential/browser/firefox-nss-private
    description: Firefox NSS private key database
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "nssPrivate"

  # === Atomic: macOS Safari/System ===

  - id: credential/browser/macos-cookies-path
    description: macOS system cookies path
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [macos]
    condition:
      type: string
      exact: "/Library/Cookies"

  - id: credential/browser/macos-binarycookies
    description: macOS binary cookies file
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [macos]
    condition:
      type: string
      exact: ".binarycookies"

  # === Atomic: Cookie Libraries ===

  - id: credential/browser/pycookiecheat
    description: Python cookie theft library
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [all]
    file_types: [python]
    condition:
      type: string
      exact: "pycookiecheat"

  - id: credential/browser/kooky
    description: Go cookie theft library
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [all]
    condition:
      type: string
      exact: "browserutils/kooky"

composite_rules:
  - id: credential/browser/chrome-cookie-theft
    description: Chrome cookie file access
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [all]
    requires_all:
      - type: trait
        id: credential/browser/chrome-path
      - type: trait
        id: credential/browser/chromium-cookies-path

  - id: credential/browser/chromium-master-decrypt
    description: Chromium master password decryption
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "E1003"
    platforms: [all]
    requires_all:
      - type: trait
        id: credential/browser/chromium-local-state
      - type: trait
        id: credential/browser/chromium-encrypted-key
      - type: trait
        id: credential/browser/chromium-os-crypt

  - id: credential/browser/chromium-credit-card-theft
    description: Chromium credit card data theft
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    platforms: [all]
    requires_all:
      - type: trait
        id: credential/browser/chromium-web-data
      - type: trait
        id: credential/browser/chromium-credit-cards
    requires_any:
      - type: string
        exact: "Chrome"
      - type: string
        exact: "Chromium"

  - id: credential/browser/firefox-cookie-theft
    description: Firefox cookie theft
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [all]
    requires_all:
      - type: trait
        id: credential/browser/firefox-path
      - type: trait
        id: credential/browser/firefox-cookies

  - id: credential/browser/firefox-password-theft
    description: Firefox password/form history theft
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [all]
    requires_all:
      - type: trait
        id: credential/browser/firefox-path
    requires_any:
      - type: trait
        id: credential/browser/firefox-formhistory
      - type: trait
        id: credential/browser/firefox-nss-private
