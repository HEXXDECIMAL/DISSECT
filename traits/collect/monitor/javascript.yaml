# Monitoring - JavaScript/Node.js
# ATT&CK: T1113 (Screen Capture)

traits:
  - id: js-node-screenshots
    desc: usage of node-screenshots library
    crit: suspicious
    conf: 0.95
    mbc: "B0002"
    attack: "T1113"
    for: [javascript]
    if:
      type: ast_pattern
      node_type: call_expression
      pattern: "require('node-screenshots')"

  - id: js-desktop-screenshot
    desc: usage of desktop-screenshot library
    crit: suspicious
    conf: 0.95
    mbc: "B0002"
    attack: "T1113"
    for: [javascript]
    if:
      type: ast_pattern
      node_type: call_expression
      pattern: "require('desktop-screenshot')"

  - id: js-sharp-image-processing
    desc: "Uses sharp image processing"
    crit: notable
    conf: 0.8
    for: [javascript]
    if:
      type: ast_pattern
      node_type: call_expression
      pattern: "require('sharp')"

composite_rules:
  - id: js-screenshot-exfil
    desc: "JavaScript screenshot capture exfiltration"
    crit: hostile
    conf: 0.95
    mbc: "B0002"
    attack: "T1113"
    for: [javascript]
    all:
      - id: comm/http/request/js-axios-post
    any:
      - id: collect/monitor/js-node-screenshots
      - id: collect/monitor/js-desktop-screenshot