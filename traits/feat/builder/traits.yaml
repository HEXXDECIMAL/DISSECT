# Build Tool and CI/CD Artifacts
# Useful for supply chain analysis and diff context

traits:
  # === CMake micro-traits ===
  - id: cmakefiles
    desc: CMakeFiles directory
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "CMakeFiles"

  - id: cmake-min-required
    desc: cmake_minimum_required directive
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "cmake_minimum_required"

  - id: cmake-prefix
    desc: CMAKE_ variable prefix
    crit: benign
    conf: 0.85
    if:
      type: string
      regex: "CMAKE_"

  - id: cmakelists
    desc: CMakeLists.txt file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "CMakeLists.txt"

  # === Meson micro-traits ===
  - id: meson-build
    desc: meson.build file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "meson.build"

  - id: meson-options
    desc: meson_options file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "meson_options"

  - id: meson-private
    desc: meson-private directory
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "meson-private"

  # === Bazel micro-traits ===
  - id: bazel-out
    desc: bazel-out directory
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "bazel-out"

  - id: workspace-file
    desc: WORKSPACE file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "WORKSPACE"

  - id: build-bazel
    desc: BUILD.bazel file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "BUILD.bazel"

  - id: bazel-tools
    desc: "@bazel_tools reference"
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "@bazel_tools"

  # === Autotools micro-traits ===
  - id: configure-ac
    desc: configure.ac file
    crit: benign
    conf: 0.8
    if:
      type: string
      exact: "configure.ac"

  - id: makefile-am
    desc: Makefile.am file
    crit: benign
    conf: 0.8
    if:
      type: string
      exact: "Makefile.am"

  - id: config-h-in
    desc: config.h.in file
    crit: benign
    conf: 0.8
    if:
      type: string
      exact: "config.h.in"

  - id: package-version
    desc: PACKAGE_VERSION variable
    crit: benign
    conf: 0.8
    if:
      type: string
      exact: "PACKAGE_VERSION"

  - id: ac-init
    desc: AC_INIT macro
    crit: benign
    conf: 0.8
    if:
      type: string
      exact: "AC_INIT"

  # === Cargo micro-traits ===
  - id: cargo-toml
    desc: Cargo.toml file
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "Cargo.toml"

  - id: cargo-namespace
    desc: "cargo:: namespace"
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "cargo::"

  - id: registry-src
    desc: /registry/src/ path
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "/registry/src/"

  - id: dot-cargo
    desc: .cargo/ directory
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: ".cargo/"

  # === Go modules micro-traits ===
  - id: go-mod
    desc: go.mod file
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "go.mod"

  - id: go-sum
    desc: go.sum file
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "go.sum"

  - id: go-pkg-mod
    desc: go/pkg/mod directory
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "go/pkg/mod"

  - id: gopath-env
    desc: GOPATH environment variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "GOPATH"

  # === npm/yarn micro-traits ===
  - id: package-json
    desc: package.json file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "package.json"

  - id: node-modules
    desc: node_modules directory
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "node_modules"

  - id: package-lock-json
    desc: package-lock.json file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "package-lock.json"

  - id: yarn-lock
    desc: yarn.lock file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "yarn.lock"

  # === pip/setuptools micro-traits ===
  - id: setup-py
    desc: setup.py file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "setup.py"

  - id: pyproject-toml
    desc: pyproject.toml file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "pyproject.toml"

  - id: requirements-txt
    desc: requirements.txt file
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "requirements.txt"

  - id: site-packages
    desc: site-packages directory
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "site-packages"

  # === GitHub Actions micro-traits ===
  - id: github-actions-env
    desc: GITHUB_ACTIONS environment variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "GITHUB_ACTIONS"

  - id: github-run-id
    desc: GITHUB_RUN_ID environment variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "GITHUB_RUN_ID"

  - id: github-sha
    desc: GITHUB_SHA environment variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "GITHUB_SHA"

  - id: actions-checkout
    desc: actions/checkout action
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "actions/checkout"

  - id: github-workflows
    desc: .github/workflows directory
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: ".github/workflows"

  # === GitLab CI micro-traits ===
  - id: ci-pipeline-id
    desc: CI_PIPELINE_ID variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "CI_PIPELINE_ID"

  - id: ci-job-id
    desc: CI_JOB_ID variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "CI_JOB_ID"

  - id: gitlab-ci-env
    desc: GITLAB_CI variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "GITLAB_CI"

  - id: gitlab-ci-yml
    desc: .gitlab-ci.yml file
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: ".gitlab-ci.yml"

  # === Jenkins micro-traits ===
  - id: jenkins-url
    desc: JENKINS_URL variable
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "JENKINS_URL"

  - id: build-number
    desc: BUILD_NUMBER variable
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "BUILD_NUMBER"

  - id: job-name
    desc: JOB_NAME variable
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "JOB_NAME"

  - id: jenkinsfile
    desc: Jenkinsfile
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "Jenkinsfile"

  # === CircleCI micro-traits ===
  - id: circleci-env
    desc: CIRCLECI variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "CIRCLECI"

  - id: circle-build-num
    desc: CIRCLE_BUILD_NUM variable
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: "CIRCLE_BUILD_NUM"

  - id: circleci-config
    desc: .circleci/config file
    crit: benign
    conf: 0.9
    if:
      type: string
      exact: ".circleci/config"

  # === Docker micro-traits ===
  - id: dockerfile
    desc: Dockerfile
    crit: benign
    conf: 0.8
    if:
      type: string
      exact: "Dockerfile"

  - id: docker-env-prefix
    desc: DOCKER_ environment prefix
    crit: benign
    conf: 0.8
    if:
      type: string
      regex: "DOCKER_"

  - id: dockerenv
    desc: /.dockerenv file
    crit: benign
    conf: 0.8
    if:
      type: string
      exact: "/.dockerenv"

  - id: docker-entrypoint
    desc: /docker-entrypoint path
    crit: benign
    conf: 0.8
    if:
      type: string
      exact: "/docker-entrypoint"

  # === Reproducible build micro-traits ===
  - id: source-date-epoch
    desc: SOURCE_DATE_EPOCH variable
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "SOURCE_DATE_EPOCH"

  - id: reproducible-string
    desc: REPRODUCIBLE string
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "REPRODUCIBLE"

  - id: build-id-string
    desc: build-id string
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "build-id"

  - id: debuglink-string
    desc: debuglink string
    crit: benign
    conf: 0.85
    if:
      type: string
      exact: "debuglink"

composite_rules:
  # CMake composite (migrated from YARA)
  - id: cmake
    desc: Built with CMake
    crit: benign
    conf: 0.85
    count: 1
    any:
      - id: cmakefiles
      - id: cmake-min-required
      - id: cmake-prefix
      - id: cmakelists

  # Meson composite (migrated from YARA)
  - id: meson
    desc: Built with Meson
    crit: benign
    conf: 0.85
    count: 1
    any:
      - id: meson-build
      - id: meson-options
      - id: meson-private

  # Bazel composite (migrated from YARA)
  - id: bazel
    desc: Built with Bazel
    crit: benign
    conf: 0.85
    count: 1
    any:
      - id: bazel-out
      - id: workspace-file
      - id: build-bazel
      - id: bazel-tools

  # Autotools composite (migrated from YARA)
  - id: autotools
    desc: Built with Autotools (autoconf/automake)
    crit: benign
    conf: 0.8
    count: 1
    any:
      - id: configure-ac
      - id: makefile-am
      - id: config-h-in
      - id: package-version
      - id: ac-init

  # Cargo composite (migrated from YARA)
  - id: cargo
    desc: Built with Cargo (Rust)
    crit: benign
    conf: 0.9
    count: 1
    any:
      - id: cargo-toml
      - id: cargo-namespace
      - id: registry-src
      - id: dot-cargo

  # Go modules composite (migrated from YARA)
  - id: go-modules
    desc: Built with Go modules
    crit: benign
    conf: 0.9
    count: 1
    any:
      - id: go-mod
      - id: go-sum
      - id: go-pkg-mod
      - id: gopath-env

  # npm/yarn composite (migrated from YARA)
  - id: npm
    desc: Built with npm/yarn (Node.js)
    crit: benign
    conf: 0.85
    count: 1
    any:
      - id: package-json
      - id: node-modules
      - id: package-lock-json
      - id: yarn-lock

  # pip/setuptools composite (migrated from YARA)
  - id: pip
    desc: Built with pip/setuptools (Python)
    crit: benign
    conf: 0.85
    count: 1
    any:
      - id: setup-py
      - id: pyproject-toml
      - id: requirements-txt
      - id: site-packages

  # GitHub Actions composite (migrated from YARA)
  - id: github-actions
    desc: GitHub Actions CI artifacts
    crit: benign
    conf: 0.9
    count: 1
    any:
      - id: github-actions-env
      - id: github-run-id
      - id: github-sha
      - id: actions-checkout
      - id: github-workflows

  # GitLab CI composite (migrated from YARA)
  - id: gitlab-ci
    desc: GitLab CI artifacts
    crit: benign
    conf: 0.9
    count: 1
    any:
      - id: ci-pipeline-id
      - id: ci-job-id
      - id: gitlab-ci-env
      - id: gitlab-ci-yml

  # Jenkins composite (migrated from YARA)
  - id: jenkins
    desc: Jenkins CI artifacts
    crit: benign
    conf: 0.85
    count: 2
    any:
      - id: jenkins-url
      - id: build-number
      - id: job-name
      - id: jenkinsfile

  # CircleCI composite (migrated from YARA)
  - id: circleci
    desc: CircleCI artifacts
    crit: benign
    conf: 0.9
    count: 1
    any:
      - id: circleci-env
      - id: circle-build-num
      - id: circleci-config

  # Docker composite (migrated from YARA)
  - id: docker
    desc: Built in Docker container
    crit: benign
    conf: 0.8
    count: 1
    any:
      - id: dockerfile
      - id: docker-env-prefix
      - id: dockerenv
      - id: docker-entrypoint

  # Reproducible build composite (migrated from YARA)
  - id: reproducible
    desc: Reproducible build markers
    crit: benign
    conf: 0.85
    count: 1
    any:
      - id: source-date-epoch
      - id: reproducible-string
      - id: build-id-string
      - id: debuglink-string
