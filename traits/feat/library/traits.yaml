# Library References
# Generic library string references (inert markers)

traits:
  # === Network Libraries ===
  - id: libssl-ref
    desc: libssl library reference
    crit: inert
    conf: 0.3
    if:
      type: string
      exact: "libssl"

  - id: libcrypto-ref
    desc: libcrypto library reference
    crit: inert
    conf: 0.3
    if:
      type: string
      exact: "libcrypto"

  - id: libcurl-ref
    desc: libcurl library reference
    crit: inert
    conf: 0.3
    if:
      type: string
      exact: "libcurl"

  - id: libssh-ref
    desc: libssh library reference
    crit: inert
    conf: 0.3
    if:
      type: string
      exact: "libssh"

  # === System Libraries ===
  - id: gnu-coreutils-ref
    desc: GNU coreutils reference
    crit: inert
    conf: 0.3
    if:
      type: string
      exact: "GNU coreutils"

  - id: glibc-ref
    desc: glibc reference
    crit: inert
    conf: 0.3
    if:
      type: string
      exact: "glibc"

  - id: libc-characteristic-symbols
    desc: Characteristic system library exports
    crit: inert
    conf: 0.5
    if:
      type: symbol
      regex: "^(__libc_start_main|gnu_get_libc_version|__errno_location|__atan2_finite|feenableexcept|__log_finite|exp2f)$"

  - id: systemd-ref
    desc: systemd reference
    crit: inert
    conf: 0.3
    if:
      type: string
      exact: "systemd"

  - id: system-debug-lib
    desc: System debug library
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "lib.{1,20}_debug\\.so"

  # === Compression Libraries ===
  - id: lzma-ref
    desc: lzma compression reference
    crit: inert
    conf: 0.3
    if:
      type: string
      regex: "(?i)\\blzma\\b"

  - id: xz-ref
    desc: xz compression reference
    crit: inert
    conf: 0.3
    if:
      type: string
      regex: "(?i)\\bxz\\b"

  - id: zlib-ref
    desc: zlib compression reference
    crit: inert
    conf: 0.3
    if:
      type: string
      regex: "(?i)\\bzlib\\b"

  # === Shell Interpreters ===
  - id: shell-keyword-marker
    desc: Shell interpreter keyword marker
    crit: inert
    conf: 0.9
    for: [elf, macho]
    if:
      type: string
      exact: "is a shell keyword"

  - id: shell-builtin-marker
    desc: Shell interpreter builtin marker
    crit: inert
    conf: 0.9
    for: [elf, macho]
    if:
      type: string
      contains: "shell builtin"

composite_rules:
  - id: network-lib-marker
    desc: Known network library markers
    crit: inert
    conf: 0.5
    count_min: 1
    any:
      - id: libssl-ref
      - id: libcrypto-ref
      - id: libcurl-ref
      - id: libssh-ref

  - id: system-lib-marker
    desc: Known system library markers
    crit: inert
    conf: 0.5
    count_min: 1
    any:
      - id: gnu-coreutils-ref
      - id: glibc-ref
      - id: systemd-ref
      - id: libc-characteristic-symbols
      - id: system-debug-lib

  - id: compression-lib
    desc: Compression library markers
    crit: inert
    conf: 0.4
    count_min: 1
    any:
      - id: lzma-ref
      - id: xz-ref
      - id: zlib-ref

  - id: shell-interpreter
    desc: Shell interpreter binary
    crit: inert
    conf: 0.9
    for: [elf, macho]
    count_min: 1
    any:
      - id: shell-keyword-marker
      - id: shell-builtin-marker
