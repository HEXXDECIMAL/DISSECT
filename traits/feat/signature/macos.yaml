# Apple Code Signature Detection

defaults:
  platforms: [macos]
  for: [macho]

traits:
  # === Apple signature atomic indicators ===
  - id: apple-development
    description: Apple Development certificate
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "Apple Development"

  - id: apple-distribution
    description: Apple Distribution certificate
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "Apple Distribution"

  - id: developer-id
    description: Developer ID certificate
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "Developer ID"

  # === Codesign requirement atomic indicators ===
  - id: anchor-apple
    description: anchor apple requirement
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "anchor apple"

  - id: certificate-leaf
    description: certificate leaf requirement
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "certificate leaf"

composite_rules:
  - id: signed
    description: Apple code signature markers
    crit: inert
    conf: 0.85
    requires_count: 1
    any:
      - id: apple-development
      - id: apple-distribution
      - id: developer-id

  - id: codesign-requirement
    description: Code signature requirement blob
    crit: inert
    conf: 0.9
    requires_count: 1
    any:
      - id: anchor-apple
      - id: certificate-leaf
