# Node.js System Discovery
# ATT&CK: T1082 (System Information Discovery), T1033 (System Owner/User Discovery)

traits:
  # Combined system profiling (existing)
  - id: node
    description: Extensive system profiling (user, net, host)
    criticality: suspicious
    confidence: 0.8
    file_types: [javascript, typescript]
    condition:
      type: yara
      source: |
        rule system_profiling {
          strings:
            $user = "os.userInfo"
            $net = "os.networkInterfaces"
            $host = "os.hostname"
            $plat = "os.platform"
          condition:
            3 of them
        }

  # Individual system info functions
  - id: node-hostname
    description: Collects system hostname
    criticality: notable
    confidence: 0.9
    attack: "T1082"
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'os\.hostname\(\)'

  - id: node-homedir
    description: Collects user home directory path
    criticality: notable
    confidence: 0.85
    attack: "T1082"
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'os\.homedir\(\)'

  - id: node-userinfo
    description: Collects user account information
    criticality: notable
    confidence: 0.85
    attack: "T1033"
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'os\.userInfo\(\)'

  - id: node-platform
    description: Collects operating system platform
    criticality: inert
    confidence: 0.9
    attack: "T1082"
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'os\.platform\(\)'

  - id: node-arch
    description: Collects CPU architecture
    criticality: inert
    confidence: 0.9
    attack: "T1082"
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'os\.arch\(\)'

  - id: node-release
    description: Collects OS release/version
    criticality: inert
    confidence: 0.9
    attack: "T1082"
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'os\.release\(\)'

  - id: node-tmpdir
    description: Collects temp directory path
    criticality: inert
    confidence: 0.85
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'os\.tmpdir\(\)'

  - id: node-cwd
    description: Collects current working directory
    criticality: notable
    confidence: 0.8
    attack: "T1083"
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'process\.cwd\(\)'

  - id: node-dirname
    description: Collects script directory path
    criticality: inert
    confidence: 0.75
    file_types: [javascript, typescript]
    condition:
      type: string
      exact: __dirname

  # Network interfaces
  - id: node-network
    description: Enumerates network interfaces
    criticality: notable
    confidence: 0.85
    attack: "T1016"
    file_types: [javascript, typescript]
    condition:
      type: string
      regex: 'os\.networkInterfaces\(\)'

composite_rules:
  # Data aggregation for exfil
  - id: node-data-aggregation
    description: Aggregates system data into object (pre-exfiltration)
    criticality: suspicious
    confidence: 0.9
    attack: "T1082"
    requires_count: 3
    conditions:
      - type: trait
        id: node-hostname
      - type: trait
        id: node-homedir
      - type: trait
        id: node-userinfo
      - type: trait
        id: node-platform
      - type: trait
        id: node-cwd
      - type: trait
        id: node-network
