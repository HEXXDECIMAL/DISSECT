# Intelligence Gathering - Browser Discovery
# ATT&CK: T1217 (Browser Information Discovery)
# NOTE: "Web Data" is defined in cred/browser/chromium/traits.yaml (web-data)

traits:
  - id: chrome-history
    description: Chrome browser history
    criticality: suspicious
    confidence: 0.85
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      regex: "Chrome.*(History|Cookies|Login Data)"

  - id: firefox-history
    description: Firefox browser history
    criticality: suspicious
    confidence: 0.85
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      regex: "(places\\.sqlite|cookies\\.sqlite|logins\\.json)"

  - id: safari-history
    description: Safari browser history
    criticality: suspicious
    confidence: 0.85
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      regex: "Safari.*(History|Cookies)"

  - id: edge-history
    description: Edge browser history
    criticality: suspicious
    confidence: 0.85
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      regex: "Microsoft.*Edge.*(History|Cookies)"

  - id: bookmarks
    description: Browser bookmarks access
    criticality: suspicious
    confidence: 0.8
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      regex: "(?i)(bookmarks|Bookmarks\\.plist)"

  - id: local-storage
    description: Browser local storage access
    criticality: suspicious
    confidence: 0.8
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      regex: "Local Storage|leveldb"

  - id: extensions
    description: Browser extensions access
    criticality: suspicious
    confidence: 0.8
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      # Require browser-specific extension paths, not just "Extensions"
      regex: "chrome-extension://|/Extensions/[a-z]{32}|/Google/Chrome/.*Extensions|/BrowserSupport/Extensions"

  - id: opera
    description: Opera browser data
    criticality: suspicious
    confidence: 0.85
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      regex: "Opera.*(Stable|History)"

  - id: brave
    description: Brave browser data
    criticality: suspicious
    confidence: 0.85
    attack: "T1217"
    file_types: [all]
    condition:
      type: string
      regex: "Brave.*Software"

composite_rules:
  - id: multi-browser-enum
    description: Multiple browser data access
    criticality: suspicious
    confidence: 0.9
    attack: "T1217"
    mbc: "B0046"
    file_types: [all]
    condition:
      type: yara
      source: |
        rule multi_browser_enum {
          strings:
            $chrome = "Chrome" fullword
            $firefox = "Firefox" fullword
            $safari = "Safari" fullword
            $edge = "Edge" fullword
            $opera = "Opera" fullword
            $brave = "Brave" fullword
            $history = "History" fullword
            $cookies = "Cookies" fullword
            $logins = "Login Data"
            $places = "places.sqlite"
          condition:
            filesize < 20MB and
            2 of ($chrome, $firefox, $safari, $edge, $opera, $brave) and
            any of ($history, $cookies, $logins, $places)
        }
