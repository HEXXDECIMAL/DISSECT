# Cloud Storage Exfiltration
# MBC: OB0010 (Exfiltration) â†’ E1567 (Exfiltration Over Web Service)
# ATT&CK: T1567 (Exfiltration Over Web Service)

traits:
  # === S3 upload atomic indicators ===
  - id: s3-amazonaws-domain
    description: S3 amazonaws.com domain
    criticality: inert
    mbc: "E1567.002"
    attack: "T1567.002"
    confidence: 0.8
    condition:
      type: string
      exact: "s3.amazonaws.com"

  - id: s3-upload-method
    description: S3 upload method call
    criticality: inert
    mbc: "E1567.002"
    attack: "T1567.002"
    confidence: 0.8
    condition:
      type: string
      regex: "s3.*\\.upload"

  # === Dropbox atomic indicators ===
  - id: dropbox-api-domain
    description: Dropbox API domain
    criticality: inert
    mbc: "E1567"
    attack: "T1567"
    confidence: 0.8
    condition:
      type: string
      exact: "api.dropbox.com"

  - id: dropbox-upload-method
    description: Dropbox upload method
    criticality: inert
    mbc: "E1567"
    attack: "T1567"
    confidence: 0.8
    condition:
      type: string
      regex: "dropbox.*upload"

  # === Google Drive atomic indicators ===
  - id: gdrive-domain
    description: Google Drive domain
    criticality: inert
    mbc: "E1567"
    attack: "T1567"
    confidence: 0.8
    condition:
      type: string
      exact: "drive.google.com"

  - id: googleapis-drive
    description: Google APIs drive reference
    criticality: inert
    mbc: "E1567"
    attack: "T1567"
    confidence: 0.8
    condition:
      type: string
      regex: "googleapis.*drive"

composite_rules:
  # S3 upload composite
  - id: s3-upload
    description: AWS S3 upload
    criticality: notable
    mbc: "E1567.002"
    attack: "T1567.002"
    confidence: 0.9
    requires_count: 1
    conditions:
      - id: s3-amazonaws-domain
      - id: s3-upload-method

  # Dropbox API composite
  - id: dropbox-api
    description: Dropbox API access
    criticality: notable
    mbc: "E1567"
    attack: "T1567"
    confidence: 0.9
    requires_count: 1
    conditions:
      - id: dropbox-api-domain
      - id: dropbox-upload-method

  # Google Drive API composite
  - id: gdrive-api
    description: Google Drive API access
    criticality: notable
    mbc: "E1567"
    attack: "T1567"
    confidence: 0.9
    requires_count: 1
    conditions:
      - id: gdrive-domain
      - id: googleapis-drive
