# Exfiltration - Telegram Bot API
# Reference: https://core.telegram.org/bots/api
# ATT&CK: T1567.002 (Exfiltration Over Web Service)

traits:
  - id: api-endpoint
    desc: Telegram Bot API endpoint
    crit: suspicious
    conf: 0.9
    attack: "T1567.002"
    for: [all]
    if:
      type: string
      exact: "api.telegram.org"

  - id: api-endpoint-b64
    desc: Telegram Bot API endpoint (base64)
    crit: suspicious
    conf: 0.95
    attack: "T1567.002"
    for: [all]
    if:
      type: string
      exact: "YXBpLnRlbGVncmFtLm9yZw=="

  - id: send-message
    desc: Telegram sendMessage API
    crit: suspicious
    conf: 0.85
    attack: "T1567.002"
    for: [all]
    if:
      type: string
      exact: "/sendMessage"

  - id: send-document
    desc: Telegram sendDocument API
    crit: suspicious
    conf: 0.9
    attack: "T1567.002"
    for: [all]
    if:
      type: string
      exact: "/sendDocument"

  - id: send-location
    desc: Telegram sendLocation API
    crit: suspicious
    conf: 0.9
    attack: "T1567.002"
    for: [all]
    if:
      type: string
      exact: "/sendLocation"

  - id: send-photo
    desc: Telegram sendPhoto API
    crit: suspicious
    conf: 0.9
    attack: "T1567.002"
    for: [all]
    if:
      type: string
      exact: "/sendPhoto"

  - id: bot-token
    desc: Telegram bot token pattern
    crit: suspicious
    conf: 0.95
    attack: "T1567.002"
    for: [all]
    if:
      type: string
      regex: "\\d{8,10}:[A-Za-z0-9_-]{35}"

  - id: form-data-header
    desc: HTTP multipart form-data header
    crit: notable
    conf: 0.7
    attack: "T1567.002"
    for: [all]
    if:
      type: string
      exact: "Content-Disposition: form-data"

composite_rules:
  - id: bot-exfil
    desc: Telegram bot exfiltration
    crit: suspicious
    conf: 0.9
    attack: "T1567.002"
    mbc: "B0030"
    for: [all]
    requires_any:
      - id: api-endpoint
      - id: api-endpoint-b64
      - id: bot-token
      - id: send-message
      - id: send-document
      - id: send-location
      - id: send-photo
