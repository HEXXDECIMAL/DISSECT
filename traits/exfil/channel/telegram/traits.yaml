# Exfiltration - Telegram Bot API
# Reference: https://core.telegram.org/bots/api
# ATT&CK: T1567.002 (Exfiltration Over Web Service)

traits:
  - id: api-endpoint
    description: Telegram Bot API endpoint
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      exact: "api.telegram.org"

  - id: api-endpoint-b64
    description: Telegram Bot API endpoint (base64)
    criticality: suspicious
    confidence: 0.95
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      exact: "YXBpLnRlbGVncmFtLm9yZw=="

  - id: send-message
    description: Telegram sendMessage API
    criticality: suspicious
    confidence: 0.85
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      exact: "/sendMessage"

  - id: send-document
    description: Telegram sendDocument API
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      exact: "/sendDocument"

  - id: send-location
    description: Telegram sendLocation API
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      exact: "/sendLocation"

  - id: send-photo
    description: Telegram sendPhoto API
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      exact: "/sendPhoto"

  - id: bot-token
    description: Telegram bot token pattern
    criticality: suspicious
    confidence: 0.95
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      regex: "\\d{8,10}:[A-Za-z0-9_-]{35}"

  - id: form-data-header
    description: HTTP multipart form-data header
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      exact: "Content-Disposition: form-data"

composite_rules:
  - id: bot-exfil
    description: Telegram bot exfiltration
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    mbc: "B0030"
    file_types: [all]
    requires_all:
      - type: any
        conditions:
          - type: trait
            id: api-endpoint
          - type: trait
            id: api-endpoint-b64
      - type: any
        conditions:
          - type: all
            min_count: 2
            conditions:
              - type: trait
                id: send-message
              - type: trait
                id: send-document
              - type: trait
                id: send-location
              - type: trait
                id: send-photo
          - type: trait
            id: bot-token
