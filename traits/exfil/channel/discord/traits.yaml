# Exfiltration - Discord Webhook
# ATT&CK: T1567.002 (Exfiltration Over Web Service)

traits:
  - id: exfil/discord/webhook-endpoint
    description: Discord webhook API endpoint
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      regex: "discord\\.com/api/webhooks/\\d+"

  - id: exfil/discord/webhook-endpoint-legacy
    description: Discord webhook API endpoint (legacy)
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      regex: "discordapp\\.com/api/webhooks/\\d+"

  - id: exfil/discord/lib-js
    description: Discord.js library usage
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [javascript]
    condition:
      type: string
      exact: "discord.js"

  - id: exfil/discord/lib-go
    description: DiscordGo library usage
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [elf]
    condition:
      type: string
      exact: "discordgo"

  - id: exfil/discord/lib-python
    description: Discord Python library usage
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [python]
    condition:
      type: string
      exact: "import discord"

  - id: exfil/discord/lib-disnake
    description: Disnake Python library usage
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [python]
    condition:
      type: string
      exact: "import disnake"

composite_rules:
  - id: exfil/discord/webhook-exfil
    description: Discord webhook exfiltration
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    mbc: "B0030"
    file_types: [all]
    condition:
      type: yara
      source: |
        rule discord_webhook_exfil {
          strings:
            $webhook1 = /discord\.com\/api\/webhooks\/[\d]{10,22}/
            $webhook2 = /discordapp\.com\/api\/webhooks\/[\d]{10,22}/
            $ip_ipify = "ipify.org"
            $ip_ipinfo = "ipinfo.io"
            $ip_ifconfig = "ifconfig.me"
            $ip_icanhazip = "icanhazip"
            $ip_wtfismyip = "wtfismyip"
          condition:
            filesize < 100MB and
            any of ($webhook*) and any of ($ip*)
        }
