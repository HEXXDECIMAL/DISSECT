# Exfiltration - Discord Webhook
# ATT&CK: T1567.002 (Exfiltration Over Web Service)

traits:
  - id: webhook-endpoint
    description: Discord webhook API endpoint
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      regex: "discord\\.com/api/webhooks/\\d+"

  - id: webhook-endpoint-legacy
    description: Discord webhook API endpoint (legacy)
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    file_types: [all]
    condition:
      type: string
      regex: "discordapp\\.com/api/webhooks/\\d+"

  - id: lib-js
    description: Discord.js library usage
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [javascript]
    condition:
      type: string
      exact: "discord.js"

  - id: lib-go
    description: DiscordGo library usage
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [elf]
    condition:
      type: string
      exact: "discordgo"

  - id: lib-python
    description: Discord Python library usage
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [python]
    condition:
      type: string
      exact: "import discord"

  - id: lib-disnake
    description: Disnake Python library usage
    criticality: notable
    confidence: 0.7
    attack: "T1567.002"
    file_types: [python]
    condition:
      type: string
      exact: "import disnake"

  - id: ip-lookup-ipify
    description: "ipify.org IP lookup service"
    criticality: notable
    confidence: 0.8
    file_types: [all]
    condition:
      type: string
      exact: "ipify.org"

  - id: ip-lookup-ipinfo
    description: "ipinfo.io IP lookup service"
    criticality: notable
    confidence: 0.8
    file_types: [all]
    condition:
      type: string
      exact: "ipinfo.io"

  - id: ip-lookup-ifconfig
    description: "ifconfig.me IP lookup service"
    criticality: notable
    confidence: 0.8
    file_types: [all]
    condition:
      type: string
      exact: "ifconfig.me"

  - id: ip-lookup-icanhazip
    description: "icanhazip IP lookup service"
    criticality: notable
    confidence: 0.8
    file_types: [all]
    condition:
      type: string
      exact: "icanhazip"

  - id: ip-lookup-wtfismyip
    description: "wtfismyip IP lookup service"
    criticality: notable
    confidence: 0.8
    file_types: [all]
    condition:
      type: string
      exact: "wtfismyip"

composite_rules:
  - id: webhook-exfil
    description: Discord webhook exfiltration
    criticality: suspicious
    confidence: 0.9
    attack: "T1567.002"
    mbc: "B0030"
    file_types: [all]
    condition:
      type: composite
      requires_any:
        - type: trait
          id: webhook-endpoint
        - type: trait
          id: webhook-endpoint-legacy
      requires_n:
        count: 1
        of:
          - type: trait
            id: ip-lookup-ipify
          - type: trait
            id: ip-lookup-ipinfo
          - type: trait
            id: ip-lookup-ifconfig
          - type: trait
            id: ip-lookup-icanhazip
          - type: trait
            id: ip-lookup-wtfismyip
