# Cryptojacking/Miner Detection
# MBC: B0041 (Mining)
# ATT&CK: T1496

traits:
  - id: miner
    description: Cryptocurrency mining patterns
    crit: suspicious
    conf: 0.66
    mbc: "B0041"
    attack: "T1496"
    if:
      type: yara
      source: |
        rule cryptominer {
          strings:
            $stratum = "stratum+tcp"
            $pool = "pool" fullword
            $miner = "miner" fullword
            $xmrig = "xmrig"
            $monero = "monero"
            $hashrate = "hashrate"
            $wallet = "wallet" fullword
            $coinhive = "coinhive"
            $cryptonight = "cryptonight"
          condition:
            2 of them
        }

  # === XMRig atomic indicators ===
  - id: xmrig-lower
    description: xmrig (lowercase)
    crit: notable
    conf: 0.55
    if:
      type: string
      exact: "xmrig"

  - id: xmrig-pascal
    description: XMRig (PascalCase)
    crit: notable
    conf: 0.55
    if:
      type: string
      exact: "XMRig"

  - id: miner-stratum
    description: Stratum mining protocol
    crit: suspicious
    conf: 0.66
    if:
      type: string
      regex: "stratum\\+tcp://"

composite_rules:
  # XMRig composite
  - id: miner-xmrig
    description: XMRig cryptocurrency miner reference
    crit: suspicious
    conf: 0.66
    requires_count: 1
    any:
      - id: xmrig-lower
      - id: xmrig-pascal
