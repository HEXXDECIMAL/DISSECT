# DDoS Attack Pattern Detection
# Detects various DDoS attack implementations
# ATT&CK: T1498 (Network Denial of Service)

traits:
  # SYN Flood attack
  - id: syn-flood-logic
    description: SYN flood attack implementation
    criticality: hostile
    confidence: 0.9
    attack: "T1498"
    file_types: [elf, macho, pe, so, dylib]
    condition:
      type: yara
      source: |
        rule syn_flood_logic {
          strings:
            $raw = "SOCK_RAW" ascii fullword
            $tcp = "IPPROTO_TCP" ascii fullword
            $syn = "syn_flood" ascii nocase
          condition:
            $raw and $tcp and $syn
        }

  - id: syn-flood
    description: SYN flood identifier string
    criticality: notable
    confidence: 0.7
    condition:
      type: string
      regex: "(?i)syn[ _]?flood"

  # UDP Flood attack
  - id: udp-flood-logic
    description: UDP flood attack implementation
    criticality: hostile
    confidence: 0.9
    attack: "T1498"
    file_types: [elf, macho, pe, so, dylib]
    condition:
      type: yara
      source: |
        rule udp_flood_logic {
          strings:
            $udpbuf = "udpbuf" ascii
            $sock_dgram = "SOCK_DGRAM" ascii fullword
            $sendto = "sendto" ascii fullword
          condition:
            $sock_dgram and $sendto and $udpbuf
        }

  # DNS Amplification attack
  - id: dns-amp-logic
    description: DNS amplification attack implementation
    criticality: hostile
    confidence: 0.9
    attack: "T1498"
    file_types: [elf, macho, pe, so, dylib]
    condition:
      type: yara
      source: |
        rule dns_amp_logic {
          strings:
            $amplification = "amplification" ascii nocase
            $port_53 = ":53" ascii
            $dns = "dns" ascii nocase
          condition:
            $amplification and $port_53 and $dns
        }

  - id: dns-amp
    description: DNS amplification identifier string
    criticality: notable
    confidence: 0.7
    condition:
      type: string
      regex: "(?i)dns[ _]?amp"

  # HTTP Flood (Layer 7)
  - id: http-flood-identifier
    description: Layer 7 DDoS identifier string
    criticality: notable
    confidence: 0.7
    condition:
      type: yara
      source: |
        rule l7_ddos_id {
          strings:
            $s1 = "slowloris" ascii nocase fullword
            $s2 = "layer7" ascii nocase fullword
            $s3 = "http_flood" ascii nocase fullword
          condition:
            any of them
        }

composite_rules:
  # Multi-vector DDoS tool
  - id: multi-vector
    description: Multi-vector DDoS tool (multiple attack types)
    criticality: hostile
    confidence: 0.95
    requires_any:
      - type: trait
        id: impact/ddos/syn-flood-logic
      - type: trait
        id: impact/ddos/udp-flood-logic
      - type: trait
        id: impact/ddos/dns-amp-logic