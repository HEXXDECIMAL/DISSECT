// Migrated from malcontent: impact/exploit/cdn_cgi.yara

rule cdn_cgi: medium {
  meta:
    description = "Mentions Cloudflare cdn-cgi endpoint"
    mbc         = "OB0010"
    attack      = "T1498"
    confidence  = "0.66"

  strings:
$cdn_cgi = "cdn-cgi" fullword
    $not_ct  = "https://report-uri.cloudflare.com/cdn-cgi/"
  condition:
    $cdn_cgi and not $not_ct
}

rule cdn_cgi_xor: high {
  meta:
    description = "Mentions Cloudflare cdn-cgi endpoint, XOR"
    confidence  = "0.66"

  strings:
$cdn_cgi  = "cdn-cgi" xor(1-31)
    $cdn_cgi2 = "cdn-cgi" xor(33-255)
  condition:
    any of them
}

rule cdn_cgi_captcha: high {
  meta:
    description = "Mentions Cloudflare cdn-cgi Captcha endpoint"
    confidence  = "0.66"

  strings:
$cdn_cgi     = "cdn-cgi" fullword
    $chk_captcha = "chk_captcha" fullword
  condition:
    all of them
}
