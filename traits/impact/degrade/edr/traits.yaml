# Impact - EDR/Antivirus Degradation
# ATT&CK: T1562.001 (Impair Defenses: Disable or Modify Tools)

defaults:
  attack: "T1562.001"

traits:
  - id: stopper
    description: EDR/Antivirus service stopper
    crit: suspicious
    conf: 0.95
    for: [pe, shell]
    if:
      type: string
      exact: "stopservice"

  - id: terminate-process-api
    description: Windows TerminateProcess API call
    crit: notable
    conf: 0.85
    for: [pe]
    if:
      type: string
      exact: "TerminateProcess"

  # === EDR/AV process termination verbs (atomic) ===
  - id: kill-keyword
    description: kill keyword
    crit: inert
    conf: 0.4
    for: [elf, pe]
    if:
      type: string
      exact: "kill"

  - id: terminate-keyword
    description: terminate keyword
    crit: inert
    conf: 0.4
    for: [elf, pe]
    if:
      type: string
      exact: "terminate"

  # === EDR/AV product names (atomic) ===
  - id: defender-name
    description: Windows Defender reference
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      exact: defender
      case_insensitive: true

  - id: malwarebytes-name
    description: Malwarebytes reference
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      exact: malwarebytes
      case_insensitive: true

  - id: kaspersky-name
    description: Kaspersky reference
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      exact: kaspersky
      case_insensitive: true

  - id: bitdefender-name
    description: Bitdefender reference
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      exact: bitdefender
      case_insensitive: true

  - id: avast-name
    description: Avast reference
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      exact: avast
      case_insensitive: true

  - id: norton-name
    description: Norton reference
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      exact: norton
      case_insensitive: true

  - id: mcafee-name
    description: McAfee reference
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      exact: mcafee
      case_insensitive: true

  - id: sophos-name
    description: Sophos reference
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      exact: sophos
      case_insensitive: true

  - id: eset-lower
    desc: eset reference (lowercase)
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      word: "eset"

  - id: eset-upper
    desc: ESET reference (uppercase brand name)
    crit: inert
    conf: 0.5
    for: [pe, elf]
    if:
      type: string
      word: "ESET"

composite_rules:
  # EDR/AV product names composite
  - id: edr-product-name
    description: EDR/Antivirus product name reference
    crit: notable
    conf: 0.8
    for: [pe, elf]
    count: 1
    any:
      - id: defender-name
      - id: malwarebytes-name
      - id: kaspersky-name
      - id: bitdefender-name
      - id: avast-name
      - id: norton-name
      - id: mcafee-name
      - id: sophos-name
      - id: eset-lower
      - id: eset-upper

  # EDR termination verbs composite
  - id: termination-verbs
    description: Process termination verbs
    crit: inert
    conf: 0.5
    for: [elf, pe]
    count: 1
    any:
      - id: kill-keyword
      - id: terminate-keyword

  # EDR process termination (verb + product name)
  - id: kill
    description: EDR process termination
    crit: suspicious
    conf: 0.9
    for: [elf, pe]
    all:
      - id: termination-verbs
      - id: edr-product-name

  - id: bypass-detected
    description: EDR/Antivirus bypass attempt
    crit: suspicious
    conf: 0.95
    mbc: "F0004"
    for: [pe, elf]
    any:
      - id: stopper
      - id: terminate-process-api
    all:
      - id: edr-product-name
