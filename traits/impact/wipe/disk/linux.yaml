# Disk Wiper Detection - Linux
# MBC: E1561 (Disk Wipe)
# ATT&CK: T1561

traits:
  # NOTE: "shred" alone is too generic - it's present in glibc
  # Require command-line context or disk device patterns to reduce false positives
  - id: disk
    description: Disk wiper patterns
    crit: suspicious
    conf: 0.66
    mbc: "E1561"
    attack: "T1561"
    if:
      type: yara
      source: |
        rule disk_wiper {
          strings:
            $dd_zero = "dd if=/dev/zero"
            $dd_random = "dd if=/dev/urandom"
            // shred requires command-line flags or device path to avoid glibc false positive
            $shred_cmd = "shred -" ascii
            $shred_dev = /shred.{0,20}\/dev\// ascii
            $shred_force = "shred --force" ascii
          condition:
            any of them
        }

  # === Disk device atomic indicators ===
  - id: dev-sda
    description: /dev/sda device access
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "/dev/sda"

  - id: dev-hda
    description: /dev/hda device access
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "/dev/hda"

  - id: dev-nvme
    description: /dev/nvme device access
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "/dev/nvme"

  - id: dev-vda
    description: /dev/vda device access
    crit: inert
    conf: 0.5
    if:
      type: string
      exact: "/dev/vda"

composite_rules:
  - id: disk-device
    description: Direct disk device access
    crit: suspicious
    conf: 0.66
    requires_count: 1
    any:
      - id: dev-sda
      - id: dev-hda
      - id: dev-nvme
      - id: dev-vda
