# Extended Attributes (xattr) - Shell command
# MBC: E1222 (File Permission Modification)
# ATT&CK: T1222

traits:
  - id: xattr-clear
    desc: xattr -c (clear all extended attributes)
    crit: notable
    conf: 0.7
    mbc: E1222
    attack: T1222
    if:
      type: string
      exact: "xattr -c"

  - id: xattr-delete
    desc: xattr -d (delete specific attribute)
    crit: notable
    conf: 0.7
    mbc: E1222
    attack: T1222
    if:
      type: string
      exact: "xattr -d"

  - id: xattr-write
    desc: xattr -w (write attribute value)
    crit: notable
    conf: 0.7
    mbc: E1222
    attack: T1222
    if:
      type: string
      exact: "xattr -w"

  - id: xattr-quarantine-remove-1
    desc: xattr -d -r -s com.apple.quarantine (legitimate quarantine removal)
    crit: inert
    conf: 1.0
    if:
      type: string
      exact: "xattr -d -r -s com.apple.quarantine"

  - id: xattr-quarantine-remove-2
    desc: xattr -d -r com.apple.quarantine (legitimate quarantine removal)
    crit: inert
    conf: 1.0
    if:
      type: string
      exact: "xattr -d -r com.apple.quarantine"

composite_rules:
  - id: xattr-patterns
    desc: xattr command patterns (clear, delete, or write)
    crit: notable
    conf: 0.7
    mbc: E1222
    attack: T1222
    any:
      - id: xattr-clear
      - id: xattr-delete
      - id: xattr-write

  - id: xattr-command
    desc: Modify extended filesystem attributes (excludes legitimate quarantine removal)
    crit: notable
    conf: 0.66
    mbc: E1222
    attack: T1222
    all:
      - id: xattr-patterns
    none:
      - id: xattr-quarantine-remove-1
      - id: xattr-quarantine-remove-2
