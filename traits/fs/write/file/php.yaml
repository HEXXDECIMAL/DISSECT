# PHP Filesystem Write Traits
# MBC: C0052 (Write File)
# ATT&CK: T1105 (Ingress Tool Transfer)

traits:
  - id: file-put-contents
    description: File write via file_put_contents
    crit: notable
    conf: 0.8
    mbc: "C0052"
    attack: "T1105"
    for: [php]
    if:
      type: string
      exact: file_put_contents

  - id: fwrite
    description: File write via fwrite
    crit: notable
    conf: 0.8
    mbc: "C0052"
    for: [php]
    if:
      type: string
      regex: "\\bfwrite\\s*\\("

  - id: fputs
    description: File write via fputs
    crit: notable
    conf: 0.8
    mbc: "C0052"
    for: [php]
    if:
      type: string
      regex: "\\bfputs\\s*\\("

  - id: dropper-pattern
    description: File dropper pattern (base64 decode + file write)
    crit: suspicious
    conf: 0.95
    mbc: "B0030"
    attack: "T1105"
    for: [php]
    if:
      type: string
      regex: "file_put_contents\\s*\\([^,]+,\\s*base64_decode"

  - id: move-uploaded-file
    description: Move uploaded file to destination
    crit: suspicious
    conf: 0.85
    mbc: "C0052"
    attack: "T1105"
    for: [php]
    if:
      type: string
      exact: move_uploaded_file
