// Migrated from malcontent: fs/file/file-times-set.yara

rule utimes: medium {
  meta:
    description = "change file last access and modification times"
    confidence  = "0.66"
    syscall     = "utimes"
    pledge      = "fattr"
    ref         = "https://linux.die.net/man/2/utimes"

  strings:
$ref  = "utimes" fullword
    $ref2 = "utime" fullword
  condition:
    any of them
}

rule futimes: medium {
  meta:
    description = "change file timestamps"
    confidence  = "0.66"
    syscall     = "futimes"
    pledge      = "fattr"
    ref         = "https://linux.die.net/man/3/futimes"

  strings:
$ref = "futimes" fullword
  condition:
    any of them
}

rule lutimes: medium {
  meta:
    description = "change file timestamps"
    confidence  = "0.66"
    syscall     = "lutimes"
    pledge      = "fattr"
    ref         = "https://linux.die.net/man/3/futimes"

  strings:
$ref = "lutimes" fullword
  condition:
    any of them
}

rule utimensat {
  meta:
    description = "change file timestamps with nanosecond precision"
    confidence  = "0.66"
    syscall     = "utimensat"
    pledge      = "fattr"
    ref         = "https://linux.die.net/man/3/futimens"

  strings:
$ref = "utimensat" fullword
  condition:
    any of them
}

rule futimens {
  meta:
    description = "change file timestamps with nanosecond precision"
    confidence  = "0.66"
    syscall     = "futimens"
    pledge      = "fattr"
    ref         = "https://linux.die.net/man/3/futimens"

  strings:
$ref = "futimens" fullword
  condition:
    any of them
}

rule shell_toucher: medium {
  meta:
    description = "change file timestamps"
    confidence  = "0.66"

  strings:
$ref         = /touch [\$\%\w\-\_\.\/ ]{0,24}/ fullword
    $not_touch_a = "touch a"
  condition:
    $ref and none of ($not*)
}
