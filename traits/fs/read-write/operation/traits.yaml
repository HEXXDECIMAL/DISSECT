# File System Read/Write Traits
# MBC: OB0009 (File System) â†’ E1083 (File and Directory Discovery)
# ATT&CK: T1083 (File and Directory Discovery), T1005 (Data from Local System)

traits:
  # Symbolic link operations
  - id: readlink
    description: Read value of symbolic link
    crit: inert
    mbc: "E1083"
    attack: "T1083"
    conf: 0.5
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: readlink
    platforms: [unix, linux, macos]

  - id: realpath
    description: Resolve absolute pathname (follows symlinks)
    crit: inert
    mbc: "E1083"
    attack: "T1083"
    conf: 0.5
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: realpath
    platforms: [unix, linux, macos]

  - id: symlink
    description: Create symbolic link
    crit: notable
    mbc: "E1222"
    attack: "T1222"
    conf: 0.6
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: symlink
    platforms: [unix, linux, macos]

  - id: link
    description: Create hard link to file
    crit: notable
    mbc: "E1222"
    attack: "T1222"
    conf: 0.6
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: link
    platforms: [unix, linux, macos]

  # File metadata operations
  - id: stat
    description: Get file status and metadata
    crit: inert
    mbc: "E1083"
    attack: "T1083"
    conf: 0.4
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: stat|lstat|fstat
    platforms: [unix, linux, macos]

  - id: access
    description: Check file accessibility and permissions
    crit: inert
    mbc: "E1083"
    attack: "T1083"
    conf: 0.5
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: access
    platforms: [unix, linux, macos]

  # Extended attributes (macOS/Linux)
  - id: getxattr
    description: Get extended file attributes
    crit: inert
    mbc: "E1083"
    attack: "T1083"
    conf: 0.5
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: getxattr
    platforms: [macos, linux]

  - id: listxattr
    description: List extended file attributes
    crit: inert
    mbc: "E1083"
    attack: "T1083"
    conf: 0.5
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: listxattr
    platforms: [macos, linux]

  - id: setxattr
    description: Set extended file attributes
    crit: notable
    mbc: "E1222"
    attack: "T1222"
    conf: 0.6
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: setxattr
    platforms: [macos, linux]

  - id: removexattr
    description: Remove extended file attributes
    crit: notable
    mbc: "E1222"
    attack: "T1222"
    conf: 0.6
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: removexattr
    platforms: [macos, linux]

  # File locking
  - id: flock
    description: Apply or remove advisory lock on file
    crit: inert
    mbc: "E1083"
    attack: "T1083"
    conf: 0.4
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: flock
    platforms: [unix, linux, macos]

  - id: fcntl
    description: File descriptor manipulation and control
    crit: inert
    mbc: "E1083"
    attack: "T1083"
    conf: 0.4
    for: [elf, macho, so, dylib, c]
    if:
      type: symbol
      pattern: fcntl
    platforms: [unix, linux, macos]
