# Secret/Credential Environment Variable Access - Python
# Detects access to sensitive environment variables via os.environ or os.getenv

traits:
  - id: python-os-getenv
    desc: "Accesses sensitive environment variable via os.getenv"
    crit: suspicious
    conf: 0.9
    for: [python]
    if:
      type: yara
      source: |
        rule python_os_getenv_secret {
          strings:
            $re = /os\.getenv\(['"][^'"]*(TOKEN|KEY|SECRET|PASS|AUTH|PWD|CRED)[^'"]*['"]\)/
          condition:
            $re
        }

  - id: python-os-environ
    desc: "Accesses sensitive environment variable via os.environ"
    crit: suspicious
    conf: 0.9
    for: [python]
    if:
      type: yara
      source: |
        rule python_os_environ_secret {
          strings:
            $re = /os\.environ\[['"][^'"]*(TOKEN|KEY|SECRET|PASS|AUTH|PWD|CRED)[^'"]*['"]\]/
          condition:
            $re
        }

composite_rules:
  - id: python-env-key
    desc: "Accesses sensitive environment variable"
    crit: suspicious
    any:
      - id: python-os-getenv
      - id: python-os-environ
