# Secret/Credential Environment Variable Access - Python
# Detects access to sensitive environment variables via os.environ or os.getenv

traits:
  - id: credential/environment/secret-access/python-os-getenv
    description: "Accesses sensitive environment variable via os.getenv"
    criticality: suspicious
    confidence: 0.9
    file_types: [python]
    condition:
      type: yara
      source: |
        rule python_os_getenv_secret {
          strings:
            $re = /os\.getenv\(['"][^'"]*(TOKEN|KEY|SECRET|PASS|AUTH|PWD|CRED)[^'"]*['"]\)/
          condition:
            $re
        }

  - id: credential/environment/secret-access/python-os-environ
    description: "Accesses sensitive environment variable via os.environ"
    criticality: suspicious
    confidence: 0.9
    file_types: [python]
    condition:
      type: yara
      source: |
        rule python_os_environ_secret {
          strings:
            $re = /os\.environ\[['"][^'"]*(TOKEN|KEY|SECRET|PASS|AUTH|PWD|CRED)[^'"]*['"]\]/
          condition:
            $re
        }

composite_rules:
  - id: credential/environment/secret-access/python-env-key
    description: "Accesses sensitive environment variable"
    criticality: suspicious
    requires_any:
      - type: trait
        id: credential/environment/secret-access/python-os-getenv
      - type: trait
        id: credential/environment/secret-access/python-os-environ