# Clipboard Monitoring Detection - Python
# MBC: E1510 (Clipboard Data)
# ATT&CK: T1115 (Clipboard Data)

defaults:
  file_types: [python]
  mbc: "E1510"
  attack: "T1115"
  criticality: suspicious

traits:
  # win32clipboard - Windows clipboard API
  - id: python-win32clipboard
    description: "Windows clipboard access (win32clipboard)"
    confidence: 0.8
    platforms: [windows]
    condition:
      type: string
      regex: "import win32clipboard|win32clipboard\\.(GetClipboardData|SetClipboardData|OpenClipboard)"

  # pyperclip - cross-platform clipboard
  - id: python-pyperclip
    description: "Clipboard access (pyperclip)"
    confidence: 0.7
    condition:
      type: string
      regex: "import pyperclip|pyperclip\\.(paste|copy)"

  # wx.Clipboard - wxPython clipboard
  - id: python-wx-clipboard
    description: "Clipboard access (wxPython)"
    confidence: 0.75
    condition:
      type: string
      regex: "wx\\.Clipboard|clipboard\\.GetData|wx\\.TheClipboard"

  # tkinter clipboard
  - id: python-tkinter-clipboard
    description: "Clipboard access (tkinter)"
    confidence: 0.65
    criticality: notable
    condition:
      type: string
      regex: "\\.clipboard_get\\(\\)|\\.clipboard_clear\\(\\)"

  # SetClipboardViewer - Windows clipboard chain
  - id: python-clipboard-viewer
    description: "Windows clipboard viewer chain (real-time monitoring)"
    confidence: 0.9
    criticality: hostile
    platforms: [windows]
    condition:
      type: string
      regex: "SetClipboardViewer\\("

  # WM_DRAWCLIPBOARD - clipboard change notification
  - id: python-clipboard-change
    description: "Clipboard change notification handler"
    confidence: 0.9
    criticality: hostile
    platforms: [windows]
    condition:
      type: string
      regex: "WM_DRAWCLIPBOARD|WM_CHANGECBCHAIN"

  # pynput clipboard (cross-platform)
  - id: python-pynput-clipboard
    description: "Clipboard monitoring via pynput"
    confidence: 0.75
    condition:
      type: string
      regex: "from pynput import clipboard|pynput\\.clipboard"

composite_rules:
  # Clipboard monitoring with exfiltration
  - id: python-clipboard-exfil
    description: "Clipboard theft with exfiltration"
    confidence: 0.95
    criticality: hostile
    requires_all:
      - type: string
        regex: "win32clipboard|pyperclip|wx\\.Clipboard|clipboard_get"
      - type: string
        regex: "requests\\.(post|get)|urllib|socket\\."

  # Real-time clipboard monitoring (chain viewer)
  - id: python-realtime-monitor
    description: "Real-time clipboard monitoring"
    confidence: 0.9
    criticality: hostile
    requires_all:
      - type: string
        regex: "SetClipboardViewer|WM_DRAWCLIPBOARD"
      - type: string
        regex: "GetClipboardData|clipboard\\.GetData"
