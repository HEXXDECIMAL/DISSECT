# Desktop Cryptocurrency Wallet Theft Detection
# Detects targeting of desktop wallet application data
# ATT&CK: T1555 (Credentials from Password Stores)
# MBC: B0028 (Credential Theft)

defaults:
  attack: "T1555"
  mbc: "B0028"
  criticality: suspicious
  platforms: [macos, windows, linux]

traits:
  # Electrum wallet paths
  - id: electrum
    description: "Electrum wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "\\.electrum/wallets?|\\.electrum.*wallet|electrum.*default_wallet"

  # Coinomi wallet paths
  - id: coinomi
    description: "Coinomi wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "Coinomi/wallets?|Coinomi.*wallet\\.dat|com\\.coinomi"

  # Exodus wallet
  - id: exodus
    description: "Exodus wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "Exodus/exodus\\.wallet|exodus.*passphrase|com\\.exodus"

  # Atomic Wallet
  - id: atomic
    description: "Atomic Wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "atomic/Local Storage|Atomic Wallet|com\\.atomicwallet"

  # Wasabi wallet (Bitcoin privacy)
  - id: wasabi
    description: "Wasabi Bitcoin wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "\\.walletwasabi|\\.WalletWasabi|WasabiWallet"

  # Binance desktop
  - id: binance
    description: "Binance desktop app data"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "Binance/app-store\\.json|@aspect-binance|com\\.binance"

  # TonKeeper (TON blockchain)
  - id: tonkeeper
    description: "TonKeeper wallet data"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "@tonkeeper/desktop|tonkeeper.*config\\.json|com\\.ton-keeper"

  # Ledger Live
  - id: ledger
    description: "Ledger Live application data"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "Ledger Live/|@ledgerhq|ledger.*accounts"

  # Trezor Suite
  - id: trezor
    description: "Trezor Suite application data"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "@trezor/suite-desktop|trezor.*suite"

  # Guarda wallet
  - id: guarda
    description: "Guarda wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "Guarda/Local Storage|com\\.guarda"

  # Bitcoin Core/Qt
  - id: bitcoin-core
    description: "Bitcoin Core wallet data"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "\\.bitcoin/wallet\\.dat|\\.bitcoin/wallets|Bitcoin/wallets"

  # Ethereum Mist (deprecated but still targeted)
  - id: mist
    description: "Ethereum Mist/Wallet data"
    confidence: 0.8
    criticality: suspicious
    condition:
      type: string
      regex: "Ethereum/keystore|Mist/keystore|\\.ethereum/keystore"

  # Monero wallet
  - id: monero
    description: "Monero wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "Monero/wallets|\\.bitmonero/wallets"

  # Litecoin Core
  - id: litecoin-core
    description: "Litecoin Core wallet data"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "\\.litecoin/wallet\\.dat|Litecoin/wallets"

  # Dash Core
  - id: dash-core
    description: "Dash Core wallet data"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "DashCore/wallets|\\.dashcore/wallet\\.dat"

  # Electrum-LTC
  - id: electrum-ltc
    description: "Electrum-LTC wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "\\.electrum-ltc/wallets"

  # Electron Cash (BCH)
  - id: electron-cash
    description: "Electron Cash wallet data path"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "\\.electron-cash/wallets"

  # Dogecoin Core
  - id: dogecoin-core
    description: "Dogecoin Core wallet data"
    confidence: 0.85
    criticality: suspicious
    condition:
      type: string
      regex: "Dogecoin/wallets|\\.dogecoin/wallet\\.dat"

composite_rules:
  # Multiple desktop wallet targets = stealer
  - id: stealer
    description: "Desktop cryptocurrency wallet stealer"
    criticality: hostile
    confidence: 0.95
    attack: "T1555"
    mbc: "B0028"
    file_types: [python, javascript, elf, pe, macho, applescript, shell]
    requires_count: 3
    conditions:
      - id: electrum
      - id: coinomi
      - id: exodus
      - id: atomic
      - id: binance
      - id: tonkeeper
      - id: monero
      - id: litecoin-core
      - id: dash-core
      - id: dogecoin-core
      - id: ledger
      - id: trezor
