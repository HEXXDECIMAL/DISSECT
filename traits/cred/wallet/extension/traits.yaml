# Credential Access - Browser Crypto Wallet Extension Theft
# Detects targeting of cryptocurrency wallet browser extensions by their extension IDs
# ATT&CK: T1555.003 (Credentials from Password Stores: Web Browsers)
# MBC: B0028 (Credential Theft)

traits:
  # === Popular Wallet Extensions (by Chrome Extension ID) ===

  - id: metamask
    description: MetaMask wallet extension ID
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      # MetaMask Chrome extension ID
      exact: "nkbihfbeogaeaoehlefnkodbefgpgknn"

  - id: phantom
    description: Phantom wallet extension ID (Solana)
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "bfnaelmomeimhlpmgjnjophhpkkoljpa"

  - id: trust-wallet
    description: Trust Wallet extension ID
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "egjidjbpglichdcondbcbdnbeeppgdph"

  - id: binance
    description: Binance Wallet extension ID
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "fhbohimaelbohpjbbldcngcnapndodjp"

  - id: coinbase
    description: Coinbase Wallet extension ID
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "hnfanknocfeofbddgcijnmhnfnkdnaad"

  - id: tronlink
    description: TronLink wallet extension ID
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "ibnejdfjmmkpcnlpebklmnkoeoihofec"

  - id: nami
    description: Nami wallet extension ID (Cardano)
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "lpfcbjknijpeeillifnkikgncikgfhdo"

  - id: temple
    description: Temple wallet extension ID (Tezos)
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "ookjlbkiijinhpmnjffcofjonbfbgaoc"

  - id: petra
    description: Petra wallet extension ID (Aptos)
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "ejjladinnckdgjemekebdpeokbikhfci"

  - id: martian
    description: Martian wallet extension ID (Aptos)
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "efbglgofoippbgcjepnhiblaibcnclgk"

  - id: pontem
    description: Pontem wallet extension ID (Aptos)
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "phkbamefinggmakgklpkljjmgibohnba"

  - id: exodus
    description: Exodus wallet extension ID
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "aholpfdialjgjfhomihkjbmgjidlcdno"

  - id: keplr
    description: Keplr wallet extension ID (Cosmos)
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "dmkamcknogkgcdfhhbddcghachkejeap"

  - id: rabby
    description: Rabby wallet extension ID
    criticality: suspicious
    confidence: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    condition:
      type: string
      exact: "acmacodkjbdgmoleebolmdjonilkdbch"

  # === Desktop/Universal Wallets (referenced in strings) ===

  - id: coinomi
    description: Coinomi wallet path/reference
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.005"
    condition:
      type: string
      regex: "(?i)Coinomi/wallets"

  - id: atomic
    description: Atomic Wallet path/reference
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.005"
    condition:
      type: string
      regex: "(?i)atomic/Local Storage"

  - id: electrum
    description: Electrum wallet path/reference
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.005"
    condition:
      type: string
      regex: "(?i)\\.electrum/wallets"

composite_rules:
  # Detects multiple wallet extension IDs (strong indicator of wallet stealer)
  - id: multi-wallet-targeting
    description: Multiple crypto wallet extensions targeted (wallet stealer)
    criticality: suspicious
    confidence: 0.95
    attack: "T1555.003"
    mbc: "B0028"
    file_types: [python, javascript, elf, pe, macho]
    condition:
      type: yara
      source: |
        rule multi_wallet_extension_targeting {
          meta:
            description = "Targets multiple cryptocurrency wallet browser extensions"
          strings:
            // Major wallets
            $metamask = "nkbihfbeogaeaoehlefnkodbefgpgknn" ascii
            $phantom = "bfnaelmomeimhlpmgjnjophhpkkoljpa" ascii
            $trust = "egjidjbpglichdcondbcbdnbeeppgdph" ascii
            $binance = "fhbohimaelbohpjbbldcngcnapndodjp" ascii
            $coinbase = "hnfanknocfeofbddgcijnmhnfnkdnaad" ascii
            $tronlink = "ibnejdfjmmkpcnlpebklmnkoeoihofec" ascii
            $exodus = "aholpfdialjgjfhomihkjbmgjidlcdno" ascii
            $keplr = "dmkamcknogkgcdfhhbddcghachkejeap" ascii
            // Aptos/Move ecosystem
            $petra = "ejjladinnckdgjemekebdpeokbikhfci" ascii
            $martian = "efbglgofoippbgcjepnhiblaibcnclgk" ascii
            $pontem = "phkbamefinggmakgklpkljjmgibohnba" ascii
            // Cardano/Tezos
            $nami = "lpfcbjknijpeeillifnkikgncikgfhdo" ascii
            $temple = "ookjlbkiijinhpmnjffcofjonbfbgaoc" ascii
            // Other popular wallets
            $rabby = "acmacodkjbdgmoleebolmdjonilkdbch" ascii
            $brave = "odbfpeeihdkbihmopkbjmoonfanlbfcl" ascii
          condition:
            3 of them
        }
