# Credential Access - Browser Crypto Wallet Extension Theft
# Detects targeting of cryptocurrency wallet browser extensions by their extension IDs
# ATT&CK: T1555.003 (Credentials from Password Stores: Web Browsers)
# MBC: B0028 (Credential Theft)

traits:
  # === Popular Wallet Extensions (by Chrome Extension ID) ===

  - id: metamask
    desc: MetaMask wallet extension ID
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      # MetaMask Chrome extension ID
      exact: "nkbihfbeogaeaoehlefnkodbefgpgknn"

  - id: phantom
    desc: Phantom wallet extension ID (Solana)
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "bfnaelmomeimhlpmgjnjophhpkkoljpa"

  - id: trust-wallet
    desc: Trust Wallet extension ID
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "egjidjbpglichdcondbcbdnbeeppgdph"

  - id: binance
    desc: Binance Wallet extension ID
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "fhbohimaelbohpjbbldcngcnapndodjp"

  - id: coinbase
    desc: Coinbase Wallet extension ID
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "hnfanknocfeofbddgcijnmhnfnkdnaad"

  - id: tronlink
    desc: TronLink wallet extension ID
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "ibnejdfjmmkpcnlpebklmnkoeoihofec"

  - id: nami
    desc: Nami wallet extension ID (Cardano)
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "lpfcbjknijpeeillifnkikgncikgfhdo"

  - id: temple
    desc: Temple wallet extension ID (Tezos)
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "ookjlbkiijinhpmnjffcofjonbfbgaoc"

  - id: petra
    desc: Petra wallet extension ID (Aptos)
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "ejjladinnckdgjemekebdpeokbikhfci"

  - id: martian
    desc: Martian wallet extension ID (Aptos)
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "efbglgofoippbgcjepnhiblaibcnclgk"

  - id: pontem
    desc: Pontem wallet extension ID (Aptos)
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "phkbamefinggmakgklpkljjmgibohnba"

  - id: exodus
    desc: Exodus wallet extension ID
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "aholpfdialjgjfhomihkjbmgjidlcdno"

  - id: keplr
    desc: Keplr wallet extension ID (Cosmos)
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "dmkamcknogkgcdfhhbddcghachkejeap"

  - id: rabby
    desc: Rabby wallet extension ID
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "acmacodkjbdgmoleebolmdjonilkdbch"

  - id: brave
    desc: Brave Wallet extension ID
    crit: suspicious
    conf: 0.9
    attack: "T1555.003"
    mbc: "B0028"
    if:
      type: string
      exact: "odbfpeeihdkbihmopkbjmoonfanlbfcl"

  # === Desktop/Universal Wallets (referenced in strings) ===

  - id: coinomi
    desc: Coinomi wallet path/reference
    crit: suspicious
    conf: 0.8
    attack: "T1555.005"
    if:
      type: string
      regex: "(?i)Coinomi/wallets"

  - id: atomic
    desc: Atomic Wallet path/reference
    crit: suspicious
    conf: 0.8
    attack: "T1555.005"
    if:
      type: string
      regex: "(?i)atomic/Local Storage"

  - id: electrum
    desc: Electrum wallet path/reference
    crit: suspicious
    conf: 0.8
    attack: "T1555.005"
    if:
      type: string
      regex: "(?i)\\.electrum/wallets"

  - id: multi-wallet-yara
    desc: Multiple wallet extensions via YARA
    crit: suspicious
    conf: 0.95
    attack: "T1555.003"
    mbc: "B0028"
    for: [python, javascript, elf, pe, macho]
    if:
      type: yara
      source: |
        rule multi_wallet_extension_targeting {
          meta:
            description = "Targets multiple cryptocurrency wallet browser extensions"
          strings:
            // Major wallets
            $metamask = "nkbihfbeogaeaoehlefnkodbefgpgknn" ascii
            $phantom = "bfnaelmomeimhlpmgjnjophhpkkoljpa" ascii
            $trust = "egjidjbpglichdcondbcbdnbeeppgdph" ascii
            $binance = "fhbohimaelbohpjbbldcngcnapndodjp" ascii
            $coinbase = "hnfanknocfeofbddgcijnmhnfnkdnaad" ascii
            $tronlink = "ibnejdfjmmkpcnlpebklmnkoeoihofec" ascii
            $exodus = "aholpfdialjgjfhomihkjbmgjidlcdno" ascii
            $keplr = "dmkamcknogkgcdfhhbddcghachkejeap" ascii
            // Aptos/Move ecosystem
            $petra = "ejjladinnckdgjemekebdpeokbikhfci" ascii
            $martian = "efbglgofoippbgcjepnhiblaibcnclgk" ascii
            $pontem = "phkbamefinggmakgklpkljjmgibohnba" ascii
            // Cardano/Tezos
            $nami = "lpfcbjknijpeeillifnkikgncikgfhdo" ascii
            $temple = "ookjlbkiijinhpmnjffcofjonbfbgaoc" ascii
            // Other popular wallets
            $rabby = "acmacodkjbdgmoleebolmdjonilkdbch" ascii
            $brave = "odbfpeeihdkbihmopkbjmoonfanlbfcl" ascii
          condition:
            3 of them
        }

composite_rules:
  # Detects multiple wallet extension IDs (strong indicator of wallet stealer)
  - id: multi-wallet-targeting
    desc: Multiple crypto wallet extensions targeted (wallet stealer)
    crit: suspicious
    conf: 0.95
    attack: "T1555.003"
    mbc: "B0028"
    for: [python, javascript, elf, pe, macho]
    all:
      - id: multi-wallet-yara
