# Credential Access - Safari Browser Data Theft
# macOS Safari and system cookie theft
# ATT&CK: T1555.003 (Credentials from Password Stores: Credentials from Web Browsers)

traits:
  # === Path/File References ===

  - id: cookies-path
    description: macOS system cookies path
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [macos]
    condition:
      type: string
      exact: "/Library/Cookies"

  - id: binarycookies
    description: macOS binary cookies file
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [macos]
    condition:
      type: string
      exact: ".binarycookies"

  - id: cookies-binarycookies
    description: Safari Cookies.binarycookies file
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [macos]
    condition:
      type: string
      exact: "Cookies.binarycookies"

  - id: history-db
    description: Safari History.db file
    criticality: suspicious
    confidence: 0.8
    attack: "T1555.003"
    platforms: [macos]
    condition:
      type: string
      exact: "History.db"

  - id: localstorage
    description: Safari LocalStorage path
    criticality: suspicious
    confidence: 0.75
    attack: "T1555.003"
    platforms: [macos]
    condition:
      type: string
      exact: "Safari/LocalStorage"

composite_rules:
  - id: cookie-theft
    description: Safari cookie theft
    criticality: suspicious
    confidence: 0.85
    attack: "T1555.003"
    platforms: [macos]
    requires_any:
      - type: trait
        id: credential/browser/safari/cookies-path
      - type: trait
        id: credential/browser/safari/binarycookies
      - type: trait
        id: credential/browser/safari/cookies-binarycookies
