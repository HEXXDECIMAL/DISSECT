# Obfuscation Logic Detection
# Detects common obfuscation/deobfuscation code patterns in binaries

traits:
  # XOR/stack obfuscation patterns - require multiple indicators
  # Single byte patterns are too common in any binary
  - id: string-deobfuscation
    desc: "String obfuscation/deobfuscation pattern"
    crit: inert
    conf: 0.4
    attack: "T1027"
    for: [elf, macho, pe]
    if:
      type: yara
      source: |
        rule string_obfuscation {
          strings:
            // Stack string construction - require multiple in sequence
            $stack1 = { C6 45 ?? ?? C6 45 ?? ?? C6 45 ?? ?? C6 45 ?? ?? C6 45 ?? ?? }  // 5+ mov [rbp-x], imm8
          condition:
            $stack1
        }
