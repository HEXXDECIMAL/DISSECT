# Ruby obfuscation and encoding techniques

traits:
  - id: base64-decode
    desc: "Base64 decode (potential obfuscation)"
    crit: notable
    conf: 0.88
    attack: "T1027"
    for: [ruby]
    if:
      type: symbol_or_string
      any:
        - Base64.decode64
        - Base64.strict_decode64

  - id: base64-encode
    desc: "Base64 encode"
    crit: notable
    conf: 0.88
    attack: "T1027"
    for: [ruby]
    if:
      type: symbol_or_string
      any:
        - Base64.encode64
        - Base64.strict_encode64

  - id: marshal-load
    desc: "Marshal deserialization (RCE risk)"
    crit: suspicious
    conf: 0.93
    attack: "T1059"
    for: [ruby]
    if:
      type: symbol_or_string
      any:
        - Marshal.load
        - Marshal.restore

  - id: yaml-unsafe-load
    desc: "YAML unsafe deserialization"
    crit: suspicious
    conf: 0.90
    attack: "T1059"
    for: [ruby]
    if:
      type: symbol_or_string
      any:
        - YAML.load
      none:
        - YAML.safe_load

  - id: reflection-send
    desc: "Dynamic method invocation"
    crit: notable
    conf: 0.85
    attack: "T1027"
    for: [ruby]
    if:
      type: symbol_or_string
      any:
        - .send(
        - .send

  - id: const-get
    desc: "Dynamic constant access"
    crit: notable
    conf: 0.90
    attack: "T1027"
    for: [ruby]
    if:
      type: symbol_or_string
      any:
        - const_get

  - id: const-set
    desc: "Dynamic constant definition"
    crit: notable
    conf: 0.90
    attack: "T1027"
    for: [ruby]
    if:
      type: symbol_or_string
      any:
        - const_set

  - id: define-method
    desc: "Dynamic method definition"
    crit: notable
    conf: 0.90
    attack: "T1027"
    for: [ruby]
    if:
      type: symbol_or_string
      any:
        - define_method
