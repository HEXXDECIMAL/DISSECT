# XOR Encoding Detection
# MBC: B0032 (Obfuscated Files or Information)
# ATT&CK: T1027

defaults:
  file_types: [pe, elf, macho, python, javascript, shell]

traits:
  - id: xor-key
    description: XOR key variable reference
    criticality: inert
    confidence: 0.5
    condition:
      type: string
      exact: xor_key

  - id: xor-encrypt
    description: XOR encrypt function reference
    criticality: inert
    confidence: 0.5
    condition:
      type: string
      exact: xor_encrypt

  - id: xor-decode
    description: XOR decode function reference
    criticality: inert
    confidence: 0.5
    condition:
      type: string
      exact: xor_decode

  - id: xor-loop
    description: XOR operation with hex byte constant
    criticality: notable
    confidence: 0.7
    condition:
      type: string
      regex: '\^\s*0x[0-9a-fA-F]{2}'

composite_rules:
  - id: encode
    description: XOR encoding patterns
    criticality: notable
    confidence: 0.66
    mbc: "B0032"
    attack: "T1027"
    requires_count: 1
    conditions:
      - type: trait
        id: xor-key
      - type: trait
        id: xor-encrypt
      - type: trait
        id: xor-decode
      - type: trait
        id: xor-loop
