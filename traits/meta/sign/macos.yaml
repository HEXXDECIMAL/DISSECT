# Apple Code Signature Detection

defaults:
  platforms: [macos]
  for: [macho]

traits:
  # === Apple signature atomic indicators ===
  - id: apple-development
    desc: Apple Development certificate
    crit: inert
    conf: 0.7
    if:
      type: string
      substr: "Apple Development"

  - id: apple-distribution
    desc: Apple Distribution certificate
    crit: inert
    conf: 0.7
    if:
      type: string
      substr: "Apple Distribution"

  - id: developer-id
    desc: Developer ID certificate
    crit: inert
    conf: 0.7
    if:
      type: string
      substr: "Developer ID"

  # === Codesign requirement atomic indicators ===
  - id: anchor-apple
    desc: anchor apple requirement
    crit: inert
    conf: 0.7
    if:
      type: string
      substr: "anchor apple"

  - id: certificate-leaf
    desc: certificate leaf requirement
    crit: inert
    conf: 0.7
    if:
      type: string
      substr: "certificate leaf"

composite_rules:
  - id: signed
    desc: Apple code signature markers
    crit: inert
    conf: 0.85
    needs: 1
    any:
      - id: apple-development
      - id: apple-distribution
      - id: developer-id

  - id: codesign-requirement
    desc: Code signature requirement blob
    crit: inert
    conf: 0.9
    needs: 1
    any:
      - id: anchor-apple
      - id: certificate-leaf
