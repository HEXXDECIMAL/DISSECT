# Compiler Detection Traits
# Detects GCC, Clang, MSVC, Intel, musl and other compiler toolchains

traits:
  # === GCC micro-traits ===
  - id: gcc-comment
    desc: "GCC: comment string"
    crit: notable
    conf: 0.9
    if:
      type: string
      exact: "GCC:"

  - id: gcc-prefix
    desc: gcc- prefix
    crit: notable
    conf: 0.8
    if:
      type: string
      exact: "gcc-"

  - id: gnu-c
    desc: GNU C string
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "GNU C"

  - id: gnuc-macro
    desc: __GNUC__ macro
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "__GNUC__"

  - id: libgcc
    desc: libgcc library
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "libgcc"

  # === Clang micro-traits ===
  - id: clang-string
    desc: clang string
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "clang"

  - id: llvm-string
    desc: LLVM string
    crit: notable
    conf: 0.9
    if:
      type: string
      exact: "LLVM"

  - id: clang-macro
    desc: __clang__ macro
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "__clang__"

  - id: libllvm
    desc: libLLVM library
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "libLLVM"

  # === MSVC micro-traits ===
  - id: msvc-string
    desc: MSVC string
    crit: notable
    conf: 0.9
    if:
      type: string
      exact: "MSVC"

  - id: msc-ver
    desc: _MSC_VER macro
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "_MSC_VER"

  - id: vcruntime
    desc: vcruntime library
    crit: notable
    conf: 0.9
    if:
      type: string
      regex: "(?i)vcruntime"

  - id: ms-visual
    desc: Microsoft Visual string
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "Microsoft Visual"

  # === Intel micro-traits ===
  - id: intel-r
    desc: Intel(R) string
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "Intel(R)"

  - id: intel-compiler
    desc: __INTEL_COMPILER macro
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "__INTEL_COMPILER"

  - id: icc-string
    desc: icc compiler string
    crit: notable
    conf: 0.8
    if:
      type: string
      exact: "icc"

  - id: libiomp
    desc: libiomp OpenMP library
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "libiomp"

  # === musl micro-traits ===
  - id: musl-libc
    desc: musl libc string
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "musl libc"

  - id: musl-prefix
    desc: musl- prefix
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "musl-"

  - id: musl-macro
    desc: __musl__ macro
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "__musl__"

  # === Cross-compilation micro-traits ===
  - id: arm-linux-gnu
    desc: arm-linux-gnu cross compiler
    crit: notable
    conf: 0.75
    if:
      type: string
      substr: "arm-linux-gnu"

  - id: aarch64-linux-gnu
    desc: aarch64-linux-gnu cross compiler
    crit: notable
    conf: 0.75
    if:
      type: string
      substr: "aarch64-linux-gnu"

  - id: mips-linux-gnu
    desc: mips-linux-gnu cross compiler
    crit: notable
    conf: 0.75
    if:
      type: string
      substr: "mips-linux-gnu"

  - id: powerpc-linux-gnu
    desc: powerpc-linux-gnu cross compiler
    crit: notable
    conf: 0.75
    if:
      type: string
      substr: "powerpc-linux-gnu"

  - id: x86-64-linux-musl
    desc: x86_64-linux-musl cross compiler
    crit: notable
    conf: 0.75
    if:
      type: string
      substr: "x86_64-linux-musl"

  - id: cross-suffix
    desc: -cross suffix
    crit: notable
    conf: 0.7
    if:
      type: string
      substr: "-cross"

composite_rules:
  # GCC composite
  - id: gcc
    desc: Compiled with GCC
    crit: notable
    conf: 0.9
    any:
      - id: gcc-comment
      - id: gcc-prefix
      - id: gnu-c
      - id: gnuc-macro
      - id: libgcc

  # Clang composite
  - id: clang
    desc: Compiled with Clang/LLVM
    crit: notable
    conf: 0.9
    any:
      - id: clang-string
      - id: llvm-string
      - id: clang-macro
      - id: libllvm

  # MSVC composite
  - id: msvc
    desc: Compiled with Microsoft Visual C++
    crit: notable
    conf: 0.9
    any:
      - id: msvc-string
      - id: msc-ver
      - id: vcruntime
      - id: ms-visual

  # Intel composite
  - id: intel
    desc: Compiled with Intel compiler
    crit: notable
    conf: 0.9
    any:
      - id: intel-r
      - id: intel-compiler
      - id: icc-string
      - id: libiomp

  # musl composite
  - id: musl
    desc: Linked with musl libc
    crit: notable
    conf: 0.9
    any:
      - id: musl-libc
      - id: musl-prefix
      - id: musl-macro

  # Cross-compilation composite
  - id: cross-compiled
    desc: Cross-compiled binary (different target arch)
    crit: notable
    conf: 0.75
    any:
      - id: arm-linux-gnu
      - id: aarch64-linux-gnu
      - id: mips-linux-gnu
      - id: powerpc-linux-gnu
      - id: x86-64-linux-musl
      - id: cross-suffix
