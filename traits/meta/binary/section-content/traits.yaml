# Section-specific content analysis
#
# These traits detect suspicious patterns within specific binary sections.
# Using section constraints allows precise detection of anomalies like:
# - Suspicious strings in code sections
# - Executable patterns in data sections
# - Obfuscated content in specific locations

traits:
  # Suspicious strings in executable section
  - id: url-in-text
    desc: URL string found in code section
    crit: notable
    conf: 0.75
    for: [elf, macho, pe]
    if:
      type: string
      regex: "https?://[a-zA-Z0-9]"
      section: text

  - id: shell-command-in-text
    desc: Shell command pattern in code section
    crit: suspicious
    conf: 0.8
    for: [elf, macho, pe]
    if:
      type: string
      regex: "/(bin|usr/bin)/(sh|bash|chmod|curl|wget)"
      section: text

  - id: temp-path-in-text
    desc: Temp directory path in code section
    crit: notable
    conf: 0.75
    for: [elf, macho, pe]
    if:
      type: string
      regex: "(/tmp/|/var/tmp/|/dev/shm/)[a-zA-Z0-9]"
      section: text

  # Strings in read-only data (normal location)
  - id: config-url-in-rodata
    desc: Configuration URL in read-only data
    crit: inert
    conf: 0.9
    for: [elf, macho, pe]
    if:
      type: string
      regex: "https?://[a-zA-Z0-9.-]+\\.(com|org|net|io)"
      section: rodata

  # Suspicious patterns in data sections
  - id: executable-pattern-in-data
    desc: x86 function prologue in data section
    crit: suspicious
    conf: 0.7
    for: [elf, pe]
    if:
      type: hex
      pattern: "55 89 E5"  # push ebp; mov ebp, esp
      section: data
      count_min: 3

  - id: nop-sled-in-data
    desc: NOP sled pattern in data section
    crit: suspicious
    conf: 0.85
    for: [elf, pe]
    if:
      type: hex
      pattern: "90 90 90 90 90 90 90 90"  # 8 NOPs
      section: data

  - id: shellcode-prologue-data
    desc: Common shellcode start in data section
    crit: suspicious
    conf: 0.8
    for: [elf, pe]
    if:
      type: hex
      pattern: "31 C0 50 68"  # xor eax,eax; push eax; push ...
      section: data

  # BSS section analysis
  - id: large-bss-uninitialized
    desc: Large uninitialized data section
    crit: inert
    conf: 0.9
    for: [elf, macho]
    if:
      type: section_ratio
      section: ".bss"
      min: 0.3

  # Writable code sections (self-modifying code)
  - id: strings-in-got
    desc: Readable strings in GOT section
    crit: notable
    conf: 0.7
    for: [elf]
    if:
      type: string
      regex: "[a-zA-Z]{8,}"
      section: ".got"

  # Obfuscation in specific sections
  - id: high-entropy-rodata
    desc: High entropy content in read-only data
    crit: notable
    conf: 0.75
    for: [elf, macho, pe]
    if:
      type: section_entropy
      section: ".rodata"
      min: 7.0

  - id: base64-in-rodata
    desc: Base64-encoded data in read-only section
    crit: inert
    conf: 0.8
    for: [elf, macho, pe]
    if:
      type: string
      regex: "^[A-Za-z0-9+/]{40,}={0,2}$"
      section: rodata
      count_min: 3

  - id: hex-strings-in-rodata
    desc: Dense hex string patterns in rodata
    crit: notable
    conf: 0.75
    for: [elf, macho, pe]
    if:
      type: string
      regex: "^[0-9A-Fa-f]{32,}$"
      section: rodata
      count_min: 5

  # Init/fini sections (persistence/hooks)
  - id: init-array-hooks
    desc: Content in initialization array
    crit: inert
    conf: 0.95
    for: [elf]
    if:
      type: section_ratio
      section: ".init_array"
      min: 0.0001

  - id: fini-array-hooks
    desc: Content in finalization array
    crit: notable
    conf: 0.8
    for: [elf]
    if:
      type: section_ratio
      section: ".fini_array"
      min: 0.0001

  # Dynamic section analysis
  - id: rpath-in-dynamic
    desc: RPATH/RUNPATH in dynamic section
    crit: inert
    conf: 0.9
    for: [elf]
    if:
      type: string
      regex: "(RPATH|RUNPATH)"
      section: ".dynamic"
