# macOS App Bundle Structure Analysis
# GAP #7: Detects suspicious minimal bundle structures
# Malware often has minimal bundles (just executable + icon) vs rich legitimate apps

defaults:
  for: [macho]
  platforms: [macos, ios]

traits:
  # Note: These are informational meta traits
  # Actual suspicious patterns should be in obj/ tier

  # Minimal app bundle - just executable and icon
  - id: minimal-bundle
    desc: "Minimal app bundle (executable +"
    crit: notable
    conf: 0.6
    if:
      type: metrics
      field: bundle.resource_count
      max: 3

  # No localization files
  - id: no-localization
    desc: "No localization resources"
    crit: notable
    conf: 0.5
    if:
      type: metrics
      field: bundle.localization_count
      max: 0

  # No frameworks or supporting files
  - id: no-frameworks
    desc: "No embedded frameworks"
    crit: notable
    conf: 0.4
    if:
      type: metrics
      field: bundle.framework_count
      max: 0

  # Executable size >> total bundle size = minimal wrapper
  - id: thin-bundle-wrapper
    desc: "Thin bundle wrapper around executable"
    crit: notable
    conf: 0.6
    if:
      type: metrics
      field: bundle.executable_ratio
      min: 0.9

composite_rules:
  # Very minimal bundle structure
  - id: suspicious-minimal-bundle
    desc: "Suspicious minimal bundle structure"
    crit: notable
    conf: 0.7
    all:
      - id: minimal-bundle
      - id: no-localization
      - id: no-frameworks

  # Minimal bundle + ad-hoc signature = likely malware
  - id: unsigned-minimal-bundle
    desc: "Unsigned minimal app bundle"
    crit: notable
    conf: 0.8
    all:
      - id: suspicious-minimal-bundle
      - id: meta/signed/adhoc::unsigned
