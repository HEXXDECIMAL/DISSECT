# Compression Library Detection
# Detects markers indicating this binary is a compression library
# Used for context in supply chain attack detection (e.g., XZ backdoor)

defaults:
  crit: benign
  conf: 0.8
  for: [elf, macho, pe]

traits:
  # === LZMA/XZ markers ===
  - id: lzma-marker
    desc: LZMA library marker
    if:
      type: string
      regex: "\\blzma_(stream|code|end|easy_encoder)\\b"

  - id: xz-marker
    desc: XZ Utils marker
    if:
      type: string
      regex: "\\bxz_(crc32|crc64)\\b|liblzma"

  # === zlib markers ===
  - id: zlib-marker
    desc: zlib library marker
    if:
      type: string
      regex: "\\b(inflate|deflate)(Init|End)?\\b|\\bzlib\\b"

  # === bzip2 markers ===
  - id: bzip2-marker
    desc: bzip2 library marker
    if:
      type: string
      regex: "\\bBZ2_(bz|compress|decompress)\\b|libbz2"

  # === zstd markers ===
  - id: zstd-marker
    desc: Zstandard library marker
    if:
      type: string
      regex: "\\bZSTD_(compress|decompress|createCCtx)\\b|libzstd"

composite_rules:
  - id: compression-lib
    desc: "File is a compression library"
    crit: benign
    conf: 0.85
    needs: 1
    any:
      - id: lzma-marker
      - id: xz-marker
      - id: zlib-marker
      - id: bzip2-marker
      - id: zstd-marker
