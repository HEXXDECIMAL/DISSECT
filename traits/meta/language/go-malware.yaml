# Go Language Malware Patterns
# Patterns commonly seen in Go-based malware vs legitimate Go programs

traits:
  # Go reverse shell patterns
  - id: meta/language/go-malware/reverse-shell
    description: Go reverse shell implementation patterns
    criticality: suspicious
    confidence: 0.85
    condition:
      type: yara
      source: |
        rule go_reverse_shell {
          strings:
            $conn1 = "net.Dial" ascii
            $conn2 = "net.(*Dialer).Dial" ascii
            $exec1 = "os/exec.Command" ascii
            $exec2 = "exec.(*Cmd).Start" ascii
            $exec3 = "exec.(*Cmd).Run" ascii
            $pipe1 = "StdinPipe" ascii
            $pipe2 = "StdoutPipe" ascii
            $pipe3 = "StderrPipe" ascii
            $shell1 = "/bin/sh" ascii
            $shell2 = "/bin/bash" ascii
            $shell3 = "cmd.exe" ascii
          condition:
            any of ($conn*) and any of ($exec*) and
            (any of ($pipe*) or any of ($shell*))
        }

  # Go file encryption patterns (ransomware)
  - id: meta/language/go-malware/file-encrypt
    description: Go file encryption patterns (potential ransomware)
    criticality: suspicious
    confidence: 0.8
    condition:
      type: yara
      source: |
        rule go_file_encrypt {
          strings:
            $crypto1 = "crypto/aes" ascii
            $crypto2 = "crypto/cipher" ascii
            $crypto3 = "crypto/rsa" ascii
            $walk1 = "filepath.Walk" ascii
            $walk2 = "filepath.WalkDir" ascii
            $write1 = "ioutil.WriteFile" ascii
            $write2 = "os.WriteFile" ascii
            $ext1 = ".encrypted" ascii
            $ext2 = ".locked" ascii
          condition:
            any of ($crypto*) and any of ($walk*) and
            (any of ($write*) or any of ($ext*))
        }

  # Go credential harvesting
  - id: meta/language/go-malware/credential-harvest
    description: Go credential harvesting patterns
    criticality: suspicious
    confidence: 0.85
    condition:
      type: yara
      source: |
        rule go_cred_harvest {
          strings:
            $browser1 = "Chrome" ascii
            $browser2 = "Firefox" ascii
            $browser3 = "Login Data" ascii
            $browser4 = "cookies.sqlite" ascii
            $sqlite = "go-sqlite3" ascii
            $decrypt1 = "CryptUnprotectData" ascii
            $env1 = "os.Getenv" ascii
            $env2 = "AWS_ACCESS" ascii
            $env3 = "AWS_SECRET" ascii
          condition:
            (2 of ($browser*) and $sqlite) or
            $decrypt1 or
            ($env1 and any of ($env2, $env3))
        }

  # Go process injection
  - id: meta/language/go-malware/process-inject
    description: Go process injection patterns
    criticality: suspicious
    confidence: 0.85
    condition:
      type: yara
      source: |
        rule go_process_inject {
          strings:
            $ptrace1 = "syscall.PtraceAttach" ascii
            $ptrace2 = "syscall.PtraceCont" ascii
            $ptrace3 = "PTRACE_POKETEXT" ascii
            $mem1 = "process_vm_writev" ascii
            $mem2 = "/proc/*/mem" ascii
            $dll1 = "CreateRemoteThread" ascii
            $dll2 = "VirtualAllocEx" ascii
          condition:
            any of ($ptrace*) or any of ($mem*) or all of ($dll*)
        }

  # Go keylogger patterns
  - id: meta/language/go-malware/keylogger
    description: Go keylogger implementation patterns
    criticality: suspicious
    confidence: 0.85
    condition:
      type: yara
      source: |
        rule go_keylogger {
          strings:
            $hook1 = "SetWindowsHookEx" ascii
            $hook2 = "GetAsyncKeyState" ascii
            $hook3 = "GetKeyState" ascii
            $x11_1 = "XQueryKeymap" ascii
            $x11_2 = "XOpenDisplay" ascii
            $input1 = "/dev/input" ascii
            $input2 = "evdev" ascii
          condition:
            any of ($hook*) or all of ($x11_*) or all of ($input*)
        }

  # Go anti-analysis evasion
  - id: meta/language/go-malware/anti-analysis
    description: Go anti-analysis and evasion patterns
    criticality: suspicious
    confidence: 0.8
    condition:
      type: yara
      source: |
        rule go_anti_analysis {
          strings:
            $vm1 = "VMware" ascii
            $vm2 = "VirtualBox" ascii
            $vm3 = "QEMU" ascii
            $dbg1 = "IsDebuggerPresent" ascii
            $dbg2 = "/proc/self/status" ascii
            $dbg3 = "TracerPid" ascii
            $sleep1 = "time.Sleep" ascii
            $time1 = "time.Now" ascii
          condition:
            2 of ($vm*) or any of ($dbg*) or
            ($sleep1 and $time1 and any of ($vm*))
        }

  # Go C2 beacon patterns
  - id: meta/language/go-malware/c2-beacon
    description: Go C2 beacon/implant patterns
    criticality: suspicious
    confidence: 0.8
    condition:
      type: yara
      source: |
        rule go_c2_beacon {
          strings:
            $http1 = "net/http" ascii
            $http2 = "http.Client" ascii
            $interval1 = "time.Ticker" ascii
            $interval2 = "time.Sleep" ascii
            $ua1 = "User-Agent" ascii
            $enc1 = "encoding/base64" ascii
            $enc2 = "encoding/json" ascii
            $cmd1 = "exec.Command" ascii
          condition:
            any of ($http*) and any of ($interval*) and
            ($ua1 or any of ($enc*)) and $cmd1
        }
