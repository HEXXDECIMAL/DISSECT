# Malware Family - Havoc C2 Framework
# Reference: https://github.com/HavocFramework/Havoc
# ATT&CK: T1059 (Command and Scripting Interpreter)

traits:
  - id: c2-framework/havoc/amsi-dll-xor
    desc: Havoc XOR'ed AMSI DLL reference
    crit: suspicious
    conf: 0.95
    family: true
    mbc: "B0030"
    attack: "T1562.001"
    platforms: [windows]
    r#for: [pe, dll]
    if:
      type: yara
      source: |
        rule havoc_amsi_xor {
          strings:
            $ref = "amsi.dllATVSH" ascii xor
          condition:
            any of them
        }

  # === Havoc Demon agent atomic indicators ===
  - id: havoc-demon-order1
    desc: Havoc Demon reference (havoc...demon)
    crit: notable
    conf: 0.8
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    r#for: [pe, dll]
    if:
      type: string
      regex: "(?i)havoc.{0,50}demon"

  - id: havoc-demon-order2
    desc: Havoc Demon reference (demon...havoc)
    crit: notable
    conf: 0.8
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    r#for: [pe, dll]
    if:
      type: string
      regex: "(?i)demon.{0,50}havoc"

  - id: havoc-framework-string
    desc: HavocFramework string reference
    crit: notable
    conf: 0.85
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    r#for: [pe, dll]
    if:
      type: string
      substr: "HavocFramework"

  - id: c2-framework/havoc/config
    desc: Havoc configuration patterns
    crit: suspicious
    conf: 0.85
    family: true
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    r#for: [pe, dll]
    if:
      type: yara
      source: |
        rule havoc_config {
          strings:
            $cfg1 = "Demon" ascii
            $cfg2 = "Havoc" ascii
            $teamserver = "teamserver" ascii
          condition:
            ($cfg1 and $cfg2) or $teamserver
        }

composite_rules:
  # Havoc Demon agent reference composite
  - id: c2-framework/havoc/demon-ref
    desc: Havoc Demon agent reference
    crit: suspicious
    conf: 0.9
    family: true
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    r#for: [pe, dll]
    count_min: 1
    any:
      - id: havoc-demon-order1
      - id: havoc-demon-order2
      - id: havoc-framework-string

  - id: c2-framework/havoc/detected
    desc: Havoc C2 framework implant detected
    crit: suspicious
    conf: 0.95
    family: true
    reference: "https://github.com/HavocFramework/Havoc"
    attack: "T1059"
    mbc: "B0030"
    platforms: [windows]
    r#for: [pe, dll]
    any:
      - id: c2-framework/havoc/amsi-dll-xor
      - id: c2-framework/havoc/demon-ref
      - id: c2-framework/havoc/config
