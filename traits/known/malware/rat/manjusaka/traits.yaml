# Manjusaka C2 Framework Detection
# Chinese attack framework similar to Cobalt Strike/Sliver
# Reference: https://www.cisco.com/c/en/us/products/security/talos/manjusaka.html

defaults:
  for: [elf, macho, pe, so, dylib, dll]
  mbc: "B0030"
  attack: "T1071"

traits:
  - id: brand
    desc: Manjusaka brand string
    crit: suspicious
    conf: 0.95
    if:
      type: string
      regex: "(?i)manjusaka"

  - id: prefix
    desc: Manjusaka function prefix
    crit: notable
    conf: 0.9
    if:
      type: string
      exact: "mjs_"

  - id: rust-panic
    desc: Manjusaka-style Rust panic handler
    crit: notable
    conf: 0.7
    if:
      type: string
      substr: "rust_panic"

composite_rules:
  # Detected via brand string or prefix+rust-panic combination
  - id: detected
    desc: Manjusaka C2 framework detected
    crit: suspicious
    conf: 0.95
    # REAL malware is compact (<1MB)
    size_max: 1000000
    needs: 2
    any:
      - id: known/malware/rat/manjusaka::brand
      - id: known/malware/rat/manjusaka::prefix
      - id: known/malware/rat/manjusaka::rust-panic
