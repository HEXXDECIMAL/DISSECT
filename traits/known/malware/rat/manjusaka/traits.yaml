# Manjusaka C2 Framework Detection
# Chinese attack framework similar to Cobalt Strike/Sliver
# Reference: https://www.cisco.com/c/en/us/products/security/talos/manjusaka.html

defaults:
  r#for: [elf, macho, pe, so, dylib, dll]
  mbc: "B0030"
  attack: "T1071"

traits:
  - id: brand
    desc: Manjusaka brand string
    crit: suspicious
    conf: 0.95
    if:
      type: string
      regex: "(?i)manjusaka"

  - id: prefix
    desc: Manjusaka function prefix
    crit: suspicious
    conf: 0.9
    if:
      type: string
      exact: "mjs_"

  - id: rust-panic
    desc: Manjusaka Rust panic handler
    crit: suspicious
    conf: 0.7
    if:
      type: string
      exact: "rust_panic"

composite_rules:
  # Detected via brand string or prefix+rust-panic combination
  - id: detected
    desc: Manjusaka C2 framework detected
    crit: suspicious
    conf: 0.95
    family: true
    reference: "https://blog.talosintelligence.com/manjusaka-offensive-framework/"
    count_min: 2
    any:
      - id: known/malware/rat/manjusaka/brand
      - id: known/malware/rat/manjusaka/prefix
      - id: known/malware/rat/manjusaka/rust-panic
