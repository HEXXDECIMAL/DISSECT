# Malware Family - Brute Ratel C4
# Commercial adversary simulation framework
# ATT&CK: T1059 (Command and Scripting Interpreter)

traits:
  - id: shellcode-xor
    desc: Brute Ratel XOR'ed shellcode pattern
    crit: suspicious
    conf: 0.95
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    for: [pe, dll]
    if:
      type: yara
      source: |
        rule brute_ratel_shellcode {
          strings:
            $ref = "\x48\x83\xec\x50\x4d\x63\x68\x3c\x48\x89\x4d\x10" xor
          condition:
            any of them
        }

  # === Brute Ratel atomic indicators ===
  - id: brute-ratel-str
    desc: Brute Ratel string reference
    crit: notable
    conf: 0.85
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    for: [pe, dll]
    if:
      type: string
      regex: "(?i)brute.{0,30}ratel"

  - id: brc4-str
    desc: BRC4 string reference
    crit: notable
    conf: 0.85
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    for: [pe, dll]
    if:
      type: string
      regex: "(?i)\\bbrc4\\b.{0,24}(badger|ratel|config|agent)"

  - id: badger-str
    desc: Badger string reference
    crit: notable
    conf: 0.8
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    for: [pe, dll]
    if:
      type: string
      regex: "(?i)badger"

  - id: c4-config
    desc: Brute Ratel C4 configuration patterns
    crit: suspicious
    conf: 0.85
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    for: [pe, dll]
    if:
      type: yara
      source: |
        rule brute_ratel_config {
          strings:
            $cfg1 = "badger_config" ascii nocase
            $cfg2 = "bruteratel" ascii nocase
            $cfg3 = "brute ratel" ascii nocase
            $cfg4 = "badger" ascii nocase
          condition:
            $cfg1 or ($cfg2 and any of ($cfg3, $cfg4))
        }

composite_rules:
  # Brute Ratel badger ref composite
  - id: badger-ref
    desc: Brute Ratel badger reference
    crit: suspicious
    conf: 0.9
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    for: [pe, dll]
    any:
      - id: brute-ratel-str
      - id: brc4-str
      - id: badger-str

  - id: brute-ratel-detected
    desc: Brute Ratel C4 detected
    crit: suspicious
    conf: 0.95
    attack: "T1059"
    mbc: "B0030"
    platforms: [windows]
    for: [pe, dll]
    any:
      - id: shellcode-xor
      - id: badger-ref
      - id: c4-config
