# Adwind / JSocket / AlienSpy cross-platform Java RAT
# Known-bad detection for Java RAT family that uses:
# - Custom ClassLoader with defineClass/loadClass/findClass
# - StringBuilder.reverse() for string deobfuscation
# - javax.crypto.Cipher + SecretKeySpec for payload decryption
# - Encrypted resources (fake PNG, deeply nested paths)
# - Allatori obfuscator (ANY_OTHER_NAME source attribute)

traits:
  - id: internal/rat/adwind/manger-classname
    desc: Adwind MANGER class name reference
    crit: notable
    conf: 0.9
    if:
      type: yara
      source: |
        rule adwind_manger {
          strings:
            $manger = "MANGER" ascii
          condition:
            $manger
        }

  - id: internal/rat/adwind/any-other-name
    desc: Allatori obfuscator ANY_OTHER_NAME marker
    crit: inert
    conf: 0.85
    if:
      type: yara
      source: |
        rule adwind_any_other_name {
          strings:
            $aon = "ANY_OTHER_NAME" ascii
          condition:
            $aon
        }

  - id: internal/rat/adwind/config-loader
    desc: Adwind XML properties config loader
    crit: notable
    conf: 0.85
    if:
      type: yara
      source: |
        rule adwind_config_loader {
          strings:
            $props = "java/util/Properties" ascii
            $xml = "loadFromXML" ascii
            $get = "getProperty" ascii
            $res = "getResourceAsStream" ascii
          condition:
            $props and $xml and $get and $res
        }

  - id: internal/rat/adwind/filename/d-png
    desc: Filename d.png
    if:
      type: basename
      exact: "d.png"

  - id: internal/rat/adwind/header/png
    desc: PNG header
    if:
      type: hex
      pattern: "89 50 4E 47"
      offset: 0

composite_rules:
  - id: internal/rat/adwind/fake-png
    desc: Adwind fake PNG resource
    crit: suspicious
    all:
      - id: internal/rat/adwind/filename/d-png
    none:
      - id: internal/rat/adwind/header/png

  # Adwind detection for the custom ClassLoader class (01.class pattern)
  # This class contains defineClass+loadClass+findClass + reverse() + MANGER reference
  # Complexity: all(3) + any(1) = 4 >= 4 âœ“
  - id: known/malware/rat/adwind
    desc: Adwind / JSocket / AlienSpy Java RAT
    crit: hostile
    conf: 0.95
    platforms: [windows, linux, macos]
    all:
      - id: internal/rat/adwind/manger-classname
      - id: internal/rat/adwind/any-other-name
      - id: obj/c2/java/agent/java-classloader-dropper
    any:
      - id: internal/rat/adwind/fake-png
      - id: cap/exec/dynamic-load/java-string-reversal
      - id: internal/rat/adwind/config-loader
