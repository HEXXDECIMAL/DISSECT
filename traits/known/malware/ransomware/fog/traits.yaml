# Fog Ransomware Detection
# ATT&CK: T1486 (Data Encrypted for Impact)
# MBC: C0027 (Encrypt Files)

traits:
  # Fog ransomware indicators - requires unique Fog identifiers
  # NOTE: Avoid matching ".fog" alone as it triggers on graphics libraries (OpenGL fog effects)
  - id: ransomware/fog/generic
    desc: Fog ransomware patterns
    crit: suspicious
    conf: 0.9
    mbc: "C0027"
    attack: "T1486"
    r#for: [elf, macho, pe, so, dylib, dll]
    if:
      type: yara
      source: |
        rule fog_ransomware {
          strings:
            // Fog ransomware specific identifiers - require these unique markers
            $name1 = "fog ransomware" ascii nocase
            $name2 = "fogpay" ascii nocase
            // Unique ransom note content
            $note1 = "your files have been encrypted" ascii nocase
            $note2 = "fog decryptor" ascii nocase
            // Extension patterns in ransom context (not standalone)
            $ext_note = ".fog extension" ascii nocase
            $ext_flocked = ".flocked" ascii
            // Crypto combined with ransom semantics
            $ransom_demand = "bitcoin" ascii nocase
            $ransom_addr = "wallet" ascii nocase
          condition:
            any of ($name*) or
            any of ($ext_note, $ext_flocked) or
            (any of ($note*) and any of ($ransom_demand, $ransom_addr))
        }

  # Fog Linux/ESXi variant - requires Fog-specific markers plus VM targeting
  # NOTE: Avoid matching ".fog" alone as it triggers on graphics libraries
  - id: ransomware/fog/linux
    desc: Fog ransomware Linux targeting
    crit: suspicious
    conf: 0.9
    mbc: "C0027"
    attack: "T1486"
    r#for: [elf, so]
    if:
      type: yara
      source: |
        rule fog_linux {
          strings:
            // Fog ransomware specific strings - must have these unique markers
            $name1 = "fog ransomware" ascii nocase
            $name2 = "fogpay" ascii nocase
            $name3 = ".flocked" ascii
            // Specific ransom note content (not generic "DECRYPT")
            $ransom1 = "your files have been encrypted" ascii nocase
            $ransom2 = "fog decryptor" ascii nocase
            // Extension patterns in ransom context
            $ext_note = ".fog extension" ascii nocase
            // VM targeting with ransom semantics
            $vm1 = "/vmfs/volumes" ascii
            $vm2 = ".vmdk" ascii
            $vm3 = ".vmx" ascii
            // ESXi commands
            $esxi1 = "esxcli" ascii
            $esxi2 = "vim-cmd" ascii
          condition:
            any of ($name*) or
            any of ($ext_note) or
            ($vm1 and any of ($vm2, $vm3) and any of ($ransom*)) or
            (any of ($esxi*) and any of ($ransom*))
        }

composite_rules:
  - id: ransomware/fog/detected
    desc: Fog ransomware detected
    crit: suspicious
    conf: 0.95
    mbc: "C0027"
    attack: "T1486"
    r#for: [elf, macho, pe, so, dylib, dll]
    any:
      - id: ransomware/fog/generic
      - id: ransomware/fog/linux
