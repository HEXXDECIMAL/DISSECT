# Malware Family - Clapzok Multi-platform Virus
# Reference: https://www.virusbulletin.com/virusbulletin/2013/06/multiplatform-madness
# ATT&CK: T1204 (User Execution)

traits:
  - id: virus/clapzok/sfc-protected
    desc: Clapzok SfcIsFileProtected marker
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1204"
    for: [macho]
    if:
      type: string
      substr: "SfcIsFileProtected"

  - id: virus/clapzok/macho-structure
    desc: Clapzok virus YARA pattern for
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1204"
    mbc: "B0009"
    for: [macho]
    if:
      type: yara
      source: |
        rule clapzok_macho {
          strings:
            $ref = "SfcIsFileProtected"
          condition:
            (uint32(0) == 0xFEEDFACE or uint32(0) == 0xFEEDFACF or
             uint32(0) == 0xCEFAEDFE or uint32(0) == 0xCFFAEDFE or
             uint32(0) == 0xBEBAFECA or uint32(0) == 0xCAFEBABE) and
            filesize < 10MB and $ref in (filesize - 2200..filesize - 100)
        }

composite_rules:
