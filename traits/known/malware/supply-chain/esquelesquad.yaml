# EsqueleSquad Supply Chain Attack Pattern
# Known threat actor targeting PyPI with malicious packages
# ATT&CK: T1195.002 (Supply Chain Compromise)
# MBC: F0004 (Typosquatting)

defaults:
  attack: "T1195.002"
  mbc: "F0004"

traits:
  - id: author-name
    desc: EsqueleSquad author name
    crit: suspicious
    conf: 1.0
    if:
      type: string
      regex: "(?i)EsqueleSquad|Lolip0p"

  - id: author-email
    desc: EsqueleSquad author email
    crit: suspicious
    conf: 1.0
    if:
      type: string
      regex: "(?i)tahgoficial@proton\\.me|lolipopdev@gmail\\.com"

  - id: copyright
    desc: EsqueleSquad copyright string
    crit: suspicious
    conf: 1.0
    if:
      type: string
      regex: "(?i)Copyright \\(c\\) \\d{4} EsqueleSquad"

  - id: tui-summary
    desc: EsqueleSquad fake TUI summary
    crit: suspicious
    conf: 0.9
    if:
      type: string
      substr: "A library for creating a terminal user interface"

composite_rules:
  - id: detected
    desc: EsqueleSquad malicious package
    crit: hostile
    conf: 1.0
    any:
      - id: author-name
      - id: author-email
      - id: copyright

  - id: impersonator
    desc: EsqueleSquad impersonation pattern (TUI summary + urllib3 content)
    crit: hostile
    conf: 1.0
    all:
      - id: tui-summary
      - id: cap/data/text/keywords::urllib3-content

  - id: powershell-dropper
    desc: EsqueleSquad PowerShell dropper behavior
    crit: hostile
    conf: 1.0
    all:
      - id: author-name
      - id: obj/lateral/supply-chain/pypi/install-patterns::powershell-encoded-command-in-string
      - id: cap/exec/background/daemon::powershell-hidden
