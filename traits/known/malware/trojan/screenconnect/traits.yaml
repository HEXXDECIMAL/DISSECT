# ScreenConnect Remote Access Trojan
# Well-known family signature
# Detects ScreenConnect malware by distinctive component names and infrastructure

traits:
  - id: screenconnect-clientservice-dll
    desc: ScreenConnect ClientService
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "ScreenConnect.ClientService.dll"
    notes: "Embedded ScreenConnect ClientService component"
    attack: "T1219"
    mbc: "C0048"

  - id: screenconnect-client-dll
    desc: ScreenConnect Client DLL
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "ScreenConnect.Client.dll"
    notes: "Embedded ScreenConnect Client component"
    attack: "T1219"
    mbc: "C0048"

  - id: screenconnect-core-dll
    desc: ScreenConnect Core DLL
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "ScreenConnect.Core.dll"
    notes: "Embedded ScreenConnect Core component"
    attack: "T1219"
    mbc: "C0048"

  - id: screenconnect-windows-dll
    desc: ScreenConnect Windows DLL
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "ScreenConnect.Windows.dll"
    notes: "Embedded ScreenConnect Windows component"
    attack: "T1219"
    mbc: "C0048"

  - id: screenconnect-client-exe
    desc: ScreenConnect Client exe
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      any:
        - substr: "ScreenConnect.WindowsClient.exe"
        - substr: "ScreenConnect.ClientService.exe"
    notes: "Embedded ScreenConnect executable component"
    attack: "T1219"
    mbc: "C0048"

  - id: screenconnect-backstage-shell
    desc: ScreenConnect BackstageShell
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "ScreenConnect.WindowsBackstageShell.exe"
    notes: "Embedded ScreenConnect UI component"
    attack: "T1219"
    mbc: "C0048"

  - id: screenconnect-file-manager
    desc: ScreenConnect FileManager
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "ScreenConnect.WindowsFileManager.exe"
    notes: "Embedded ScreenConnect file management component"
    attack: "T1219"
    mbc: "C0048"

  - id: screenconnect-auth-package
    desc: ScreenConnect Auth Package
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "ScreenConnect.WindowsAuthenticationPackage.dll"
    notes: "Embedded ScreenConnect authentication component"
    attack: "T1219"
    mbc: "C0048"

  - id: screenconnect-credential-provider
    desc: ScreenConnect Credential Provider
    crit: notable
    conf: 0.95
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "ScreenConnect.WindowsCredentialProvider.dll"
    notes: "Embedded ScreenConnect credential component"
    attack: "T1219"
    mbc: "C0048"

  - id: connectwisecontrol-client-marker
    desc: ConnectWiseControl client ref
    crit: notable
    conf: 0.9
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "connectwisecontrol"
    notes: "References ConnectWiseControl client identifier"
    attack: "T1219"
    mbc: "C0048"

  - id: connectvpn-c2-domain
    desc: ConnectVPN C2 domain
    crit: notable
    conf: 0.9
    platforms: [windows]
    for: [pe]
    if:
      type: string
      substr: "connectvpn.ru"
    notes: "Known ConnectVPN C2 domain"
    attack: "T1219"
    mbc: "C0002"

composite_rules:
  - id: screenconnect-component-detected
    desc: ScreenConnect component
    crit: suspicious
    conf: 0.95
    platforms: [windows]
    for: [pe]
    attack: "T1219"
    mbc: "C0048"
    notes: |
      ScreenConnect malware component detected.

      ScreenConnect is a well-known Remote Access Trojan (RAT) family.
      Detection of embedded ScreenConnect DLLs/executables indicates
      this binary contains or deploys ScreenConnect malware.

      Indicates:
      - Remote access capability
      - Session management
      - Screen sharing functionality
      - Service-based persistence

      Seen in:
      - ScreenConnect RAT variants
      - Remote access malware
      - C2 infrastructure

    count_min: 3
    any:
      - id: screenconnect-clientservice-dll
      - id: screenconnect-client-dll
      - id: screenconnect-core-dll
      - id: screenconnect-windows-dll
      - id: screenconnect-client-exe
      - id: screenconnect-backstage-shell
      - id: screenconnect-file-manager
      - id: screenconnect-auth-package
      - id: screenconnect-credential-provider

  - id: screenconnect-service-persistence
    desc: ScreenConnect service
    crit: hostile
    conf: 0.95
    platforms: [windows]
    for: [pe]
    attack: "T1219"
    mbc: "C0048"
    notes: |
      ScreenConnect malware installing service for persistence.
      Combines component detection with service installation.

      Indicates:
      - Persistent remote access
      - System-level installation
      - Automatic startup on boot
      - Difficult removal without service deletion

      This is professional-grade RAT infrastructure.

    all:
      - id: screenconnect-component-detected
      - id: obj/persist/startup

  - id: screenconnect-family
    desc: ScreenConnect RAT malware
    crit: suspicious
    conf: 0.95
    platforms: [windows]
    for: [pe]
    attack: "T1219"
    mbc: "C0048"
    notes: |
      ScreenConnect Remote Access Trojan malware family.

      ScreenConnect is a sophisticated RAT providing:
      - Remote desktop/screen sharing
      - File management and transfer
      - Process execution and control
      - Session management
      - Persistence via Windows services
      - Anti-analysis and anti-debugging

      Known C2 Infrastructure:
      - connectvpn.ru (port 8041)
      - Other command & control servers

      Family Characteristics:
      - Embedded .NET components
      - Service-based installation
      - Multiple communication channels
      - Self-modifying code
      - Geofencing (blocks certain regions)

    count_min: 2
    any:
      - id: screenconnect-component-detected
      - id: connectwisecontrol-client-marker
      - id: connectvpn-c2-domain

