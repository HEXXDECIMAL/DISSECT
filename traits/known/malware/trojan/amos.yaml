# Atomic Stealer (Amos) Detection
# Detects Atomic Stealer (Amos), a macOS malware that steals crypto wallets,
# passwords, and other sensitive data. It often uses ad-hoc signing,
# packed payloads (RWX sections), and UI manipulation (hiding from dock).
# ATT&CK: T1005 (Data from Local System), T1555 (Credentials from Password Stores)
# MBC: E1082 (System Information Discovery)

defaults:
  for: [macho]
  attack: "T1005"
  mbc: "E1082"

traits:
  - id: amos-bundle-id
    desc: Known Amos Stealer bundle ID (com.livebundle.jp)
    crit: suspicious
    conf: 1.0
    if:
      type: string
      exact: "com.livebundle.jp"

composite_rules:
  - id: amos-stealer-behavior
    desc: Atomic Stealer (Amos) macOS Malware Behavior
    crit: hostile
    conf: 0.95
    all:
      - id: meta/format/magic::macho-64
      - id: cap/mem/protect/modify::rwx-prot-bytes
      - id: obj/impact/ui/manipulation::dock-hide
    any:
      - id: amos-bundle-id
      - id: meta/signed/adhoc::unsigned
      - id: obj/anti-static/obfuscation/payload::low-code-to-data-ratio
