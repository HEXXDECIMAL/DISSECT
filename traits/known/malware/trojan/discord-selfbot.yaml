# Discord Selfbot Malware Family
# Detects the "discord-selfbot-v14" malware family which distributes a large packed file
# containing malicious payload (often a stealer or backdoor) hidden in a fake library structure.
# ATT&CK: T1027 (Obfuscated Files or Information)
# MBC: B0032 (Obfuscated Files or Information)

defaults:
  for: [javascript, typescript]
  attack: "T1027"
  mbc: "B0032"

composite_rules:
  - id: discord-selfbot-v14-packed
    desc: Discord Selfbot v14 Malware (Packed Payload)
    crit: hostile
    conf: 0.98
    needs: 3
    any:
      - id: cap/data/text/keywords/malware::user-get-action-class
      - id: obj/anti-static/obfuscation/packing::excessive-function-arguments
      - id: obj/anti-static/obfuscation/packing::packed-string-decryptor
      - id: meta/file::large-source-file-4mb
      - id: obj/anti-static/obfuscation/code-metrics/structure::very-long-lines

  - id: malicious-packer-excessive-args
    desc: Malicious Packer (Excessive Arguments)
    crit: hostile
    conf: 0.9
    all:
      - id: obj/anti-static/obfuscation/packing::excessive-function-arguments
      - id: meta/file::large-source-file-1mb
    any:
      - id: obj/anti-static/obfuscation/code-metrics/structure::very-long-lines
      - id: obj/anti-static/obfuscation/code-metrics/structure::minified-code