# Known Malware: Chrysalis Installer (update.exe)
# Nullsoft NSIS installer self-extracting archive
# Deploys Chrysalis malware family components

traits:
  # === NSIS Installer Signature ===
  - id: nullsoft-installer
    desc: Nullsoft NSIS installer signature
    crit: inert
    conf: 0.95
    if:
      type: string
      substr: "Nullsoft.NSIS.exehead"

  - id: nsis-version
    desc: NSIS installer version info
    crit: inert
    conf: 0.90
    if:
      type: string
      substr: "Nullsoft Install System"

  - id: nsis-manifest
    desc: NSIS installer manifest
    crit: inert
    conf: 0.85
    if:
      type: string
      substr: "manifestVersion"

  # === 7z Compression ===
  - id: 7z-archive
    desc: 7z compression library reference
    crit: inert
    conf: 0.80
    if:
      type: string
      regex: "7z[xX]"

  # === GUI Components ===
  - id: dialog-resources
    desc: Dialog box resource definitions
    crit: inert
    conf: 0.75
    if:
      type: symbol
      exact: "DialogBoxParamW"

  - id: installer-gui
    desc: Installer GUI window creation
    crit: inert
    conf: 0.80
    if:
      type: symbol
      exact: "CreateDialogParamW"

  # === Installation Capabilities ===
  - id: directory-operations
    desc: Directory creation and management
    crit: suspicious
    conf: 0.70
    if:
      type: symbol
      exact: "CreateDirectoryW"

  - id: file-operations
    desc: File creation and modification
    crit: suspicious
    conf: 0.70
    if:
      type: symbol
      exact: "CreateFileW"

  - id: privilege-elevation
    desc: Token privilege manipulation
    crit: suspicious
    conf: 0.80
    if:
      type: symbol
      exact: "AdjustTokenPrivileges"

  # === Installer Specific ===
  - id: installer-type
    desc: Self-extracting installer executable
    crit: notable
    conf: 0.90
    if:
      type: string
      substr: "SelfExtracting"
