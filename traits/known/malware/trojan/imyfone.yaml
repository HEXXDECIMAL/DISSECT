traits:
  - id: imyfone-bundle-id
    desc: iMyFone bundle identifier
    crit: notable
    conf: 1.0
    for: [all]
    if:
      type: raw
      regex: 'MF\.iMyFone|com\.imyfone'

  - id: imyfone-pid-key
    desc: iMyFone PID configuration key
    crit: notable
    conf: 1.0
    for: [all]
    if:
      type: raw
      regex: '<key>PID</key>\s*<string>p\d+</string>'

  - id: imyfone-first-enter-key
    desc: iMyFone FirstEnter configuration key
    crit: notable
    conf: 1.0
    for: [all]
    if:
      type: raw
      regex: '<key>FirstEnter</key>\s*<string>1</string>'

  - id: qt-framework-id
    desc: Qt Framework Bundle ID
    crit: inert
    conf: 1.0
    for: [all]
    if:
      type: raw
      regex: 'org\.qt-project\.Qt(Core|Gui|Network|PrintSupport|Svg|Widgets|Xml)'

  - id: qt-legacy-version-5-6
    desc: Qt Legacy Version 5.6 (EOL 2019)
    crit: notable
    conf: 1.0
    for: [all]
    if:
      type: raw
      regex: '<string>5\.6\.3?</string>'

  - id: qt-qmake-generator
    desc: Qt/QMake generator string
    crit: inert
    conf: 1.0
    for: [all]
    if:
      type: raw
      regex: 'Created by Qt/QMake'

  - id: apple-build-info
    desc: Apple Build Information (DTPlatformBuild/DTXcode)
    crit: inert
    conf: 1.0
    for: [all]
    if:
      type: raw
      regex: '(DTPlatformBuild|DTXcode)'

composite_rules:
  - id: imyfone-app-detected
    desc: Suspicious iMyFone Application (Riskware/PUA)
    crit: notable
    conf: 0.8
    for: [all]
    any:
      - id: imyfone-bundle-id
      - id: meta/signed/developer::K889Z3PDP3
      - id: imyfone-pid-key

  - id: trojan-qt-framework-signed-imyfone
    desc: Trojanized Qt Framework (Signed by iMyFone)
    crit: suspicious
    conf: 1.0
    for: [macho]
    all:
      - id: qt-framework-id
      - id: meta/signed/developer::K889Z3PDP3

  - id: suspicious-qt-plist-legacy-qmake
    desc: Suspicious Legacy Qt Info.plist (Qt 5.6 + QMake + No Build Info)
    crit: suspicious
    conf: 0.6
    for: [all]
    all:
      - id: qt-framework-id
      - id: qt-legacy-version-5-6
      - id: qt-qmake-generator
    not:
      - id: apple-build-info
