# Detection for specific macOS C++ Stealer family
# Sample: e934c1cbb... (Application.app)

defaults:
  for: [macho]
  platforms: [macos]
  crit: hostile
  conf: 0.95

composite_rules:
  - id: macos-cpp-stealer-copy-logic
    desc: "MacOS C++ Stealer with custom directory copying logic"
    all:
      - id: obj/creds/stealer/native/symbols::copy-directory-with-exclusions
    any:
      - id: cap/exec/command/shell::shell-execution
      - id: obj/persist/daemon/init::unix-daemon-persistence
      - id: obj/lateral/social-engineering/masquerading::generic-bundle-id-pattern
      - id: meta/signed/id::com.utils.application
      - id: meta/entitlements::highly-privileged

  - id: macos-cpp-stealer-masquerade
    desc: "MacOS C++ Stealer masquerading as generic utility"
    all:
      - id: meta/signed/id::com.utils.application
      - id: meta/signed/adhoc::unsigned
      - id: obj/creds/stealer/native/symbols::copy-directory-with-exclusions
