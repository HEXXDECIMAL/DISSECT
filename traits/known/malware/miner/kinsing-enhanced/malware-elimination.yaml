# Kinsing Competing Malware Elimination
# Detects patterns where Kinsing targets and kills competing malware
# Indicates botnet turf wars and exclusive infection strategy
# ATT&CK: T1531 (Account Access Removal)
# MBC: B0025 (Execution)

traits:
  # === Malware Family Identifiers ===
  - id: malware-xmrig-target
    desc: XMRig miner targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "xmrig"
    notes: "Target: XMRig miner (competitor)"

  - id: malware-minerd-target
    desc: Minerd miner targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "minerd"
    notes: "Target: minerd miner (competitor)"

  - id: malware-cpuminer-target
    desc: CPUminer targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "cpuminer"
    notes: "Target: cpuminer (competitor)"

  - id: malware-watchdog-target
    desc: Watchdog botnet targeting
    crit: inert
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      substr: "watchdog"
    notes: "Target: Watchdog botnet (competitor)"

  - id: malware-mirai-target
    desc: Mirai botnet targeting
    crit: inert
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "mirai"
    notes: "Target: Mirai botnet (competitor)"

  - id: malware-update-agent-target
    desc: Update agent/software targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "sysupdate"
    notes: "Target: sysupdate/update agents (possibly competing malware)"

  - id: malware-generic-crypto-target
    desc: Generic crypto malware targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      word: "crypto"
    notes: "Target: Generic cryptocurrency-related processes"

  # === Kill Command Patterns ===
  - id: pkill-9-deleted
    desc: pkill -9 deleted processes
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      substr: "pkill -9 -f '(deleted)'"
    notes: "Kills processes marked as deleted (forensics evasion)"
    attack: "T1531"

  - id: proc-exe-deleted-kill
    desc: Kill deleted /proc/exe processes
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    if:
      type: string
      substr: "ls -l /proc/*/exe"
    notes: "Advanced process hunting - kills competing malware"
    attack: "T1531"

  - id: systemctl-grep-malware
    desc: Systemd service targeting
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl list-units"
    notes: "Enumerates and targets specific service names"
    attack: "T1531"

  # === Systemd Service Targeting ===
  - id: systemd-stop-xmrig
    desc: Systemd stop XMRig service
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl stop"
    notes: "Stops competing XMRig services"
    attack: "T1531"

  - id: systemd-disable-malware
    desc: Systemd disable malware services
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl disable"
    notes: "Disables competing malware services"
    attack: "T1531"

composite_rules:
  - id: malware-target-list
    desc: List of competing malware targets
    for: [elf, shell]
    any:
      - id: malware-xmrig-target
      - id: malware-minerd-target
      - id: malware-cpuminer-target
      - id: malware-watchdog-target
      - id: malware-mirai-target
      - id: malware-update-agent-target
      - id: malware-generic-crypto-target

  - id: process-kill-methods
    desc: Methods for killing processes
    any:
      - id: pkill-9-deleted
      - id: proc-exe-deleted-kill

  - id: systemd-service-targeting
    desc: Systemd service stop/disable patterns
    all:
      - id: systemd-stop-xmrig
      - id: systemd-disable-malware

  - id: kinsing-eliminate-xmrig
    desc: Kinsing killing XMRig/competing miners
    crit: suspicious
    conf: 0.95
    for: [elf, shell]
    attack: "T1531"
    mbc: "B0025"
    notes: |
      Kinsing malware targeting competing cryptocurrency miners.
      Indicates botnet exclusivity and turf war behavior.
      Combined with process killing indicates resource hijacking takeover.
    all:
      - id: kinsing-identifier
      - id: malware-target-list
        count_min: 3
      - id: process-kill-methods

  - id: kinsing-service-elimination
    desc: Kinsing eliminating competing malware services
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1531"
    notes: |
      Kinsing performing systematic service enumeration and termination.
      Targets malware families: xmrig, minerd, watchdog, mirai.
      Pattern indicates competitive malware landscape engagement.
    all:
      - id: systemctl-grep-malware
      - id: malware-target-list
        count_min: 2

  - id: kinsing-aggressive-cleanup
    desc: Kinsing aggressive process cleanup with service targeting
    crit: hostile
    conf: 0.9
    for: [elf, shell]
    attack: "T1531"
    mbc: "B0025"
    notes: |
      Complete malware elimination chain:
      1. Search /proc for deleted processes (competing malware cleanup)
      2. Enumerate systemd services by malware name
      3. Stop and disable services
      4. Kill remaining processes with pkill -9

      Indicates sophisticated botnet competition elimination.
    all:
      - id: kinsing-identifier
      - id: proc-exe-deleted-kill
      - id: systemctl-grep-malware
      - id: malware-target-list
        count_min: 4
