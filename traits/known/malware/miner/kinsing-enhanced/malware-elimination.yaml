# Kinsing Competing Malware Elimination
# Detects patterns where Kinsing targets and kills competing malware
# Indicates botnet turf wars and exclusive infection strategy
# ATT&CK: T1531 (Account Access Removal)
# MBC: B0025 (Execution)

traits:
  # === Malware Family Identifiers ===
  - id: malware-xmrig-target
    desc: XMRig miner targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "xmrig"

  - id: malware-minerd-target
    desc: Minerd miner targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "minerd"

  - id: malware-cpuminer-target
    desc: CPUminer targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "cpuminer"

  - id: malware-watchdog-target
    desc: Watchdog botnet targeting
    crit: inert
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      substr: "watchdog"

  - id: malware-mirai-target
    desc: Mirai botnet targeting
    crit: inert
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "mirai"

  - id: malware-update-agent-target
    desc: Update agent/software targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "sysupdate"

  - id: malware-generic-crypto-target
    desc: Generic crypto malware targeting
    crit: inert
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      word: "crypto"

  # === Kill Command Patterns ===
  - id: pkill-9-deleted
    desc: pkill -9 deleted processes
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      substr: "pkill -9 -f '(deleted)'"
    attack: "T1531"

  - id: proc-exe-deleted-kill
    desc: Kill deleted /proc/exe processes
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    if:
      type: string
      substr: "ls -l /proc/*/exe"
    attack: "T1531"

  - id: systemctl-grep-malware
    desc: Systemd service targeting
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl list-units"
    attack: "T1531"

  # === Systemd Service Targeting ===
  - id: systemd-stop-xmrig
    desc: Systemd stop XMRig service
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl stop"
    attack: "T1531"

  - id: systemd-disable-malware
    desc: Systemd disable malware services
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      substr: "systemctl disable"
    attack: "T1531"

composite_rules:
  - id: malware-target-list
    desc: List of competing malware targets
    for: [elf, shell]
    any:
      - id: malware-xmrig-target
      - id: malware-minerd-target
      - id: malware-cpuminer-target
      - id: malware-watchdog-target
      - id: malware-mirai-target
      - id: malware-update-agent-target
      - id: malware-generic-crypto-target

  - id: process-kill-methods
    desc: Methods for killing processes
    any:
      - id: pkill-9-deleted
      - id: proc-exe-deleted-kill

  - id: systemd-service-targeting
    desc: Systemd service stop/disable patterns
    all:
      - id: systemd-stop-xmrig
      - id: systemd-disable-malware

  - id: kinsing-eliminate-xmrig
    desc: Kinsing killing XMRig/competing miners
    crit: suspicious
    conf: 0.95
    for: [elf, shell]
    attack: "T1531"
    mbc: "B0025"
    all:
      - id: kinsing-identifier
      - id: malware-target-list
        needs: 3
      - id: process-kill-methods

  - id: kinsing-service-elimination
    desc: Kinsing eliminating competing malware services
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1531"
    all:
      - id: systemctl-grep-malware
      - id: malware-target-list
        needs: 2

  - id: kinsing-aggressive-cleanup
    desc: Kinsing aggressive process cleanup with service targeting
    crit: hostile
    conf: 0.9
    for: [elf, shell]
    attack: "T1531"
    mbc: "B0025"
    all:
      - id: kinsing-identifier
      - id: proc-exe-deleted-kill
      - id: systemctl-grep-malware
      - id: malware-target-list
        needs: 4
