traits:
  # === GhostPenguin C2 IP atomic indicators ===
  - id: c2-ip-1
    desc: "GhostPenguin C2 IP 124.221.109.147"
    crit: suspicious
    conf: 1.0
    attack: "T1071"
    for: [elf, pe]
    if:
      type: string
      substr: "124.221.109.147"

  - id: c2-ip-2
    desc: "GhostPenguin C2 IP 65.20.72.101"
    crit: suspicious
    conf: 1.0
    attack: "T1071"
    for: [elf, pe]
    if:
      type: string
      substr: "65.20.72.101"

  - id: ghostpenguin-c2-domain
    desc: "GhostPenguin C2 domain"
    crit: suspicious
    conf: 1.0
    attack: "T1071"
    for: [elf, pe]
    if:
      type: string
      substr: "www.iytest.com"

  - id: string-format
    desc: "GhostPenguin unique format strings"
    crit: suspicious
    conf: 1.0
    attack: "T1082"
    for: [elf, pe]
    if:
      type: string
      regex: 'Bytes == %d\r\n(LanIP|GateWay|OSInfo|MachineName|DomainName|Userame|OSBits):%s'

  # === GhostPenguin class name atomic indicators ===
  - id: class-basicinfo
    desc: "GhostPenguin CBasicInfoGather class"
    crit: notable
    conf: 0.8
    attack: "T1059"
    for: [elf, pe]
    if:
      type: string
      substr: "CBasicInfoGather"

  # NOTE: CTool removed - too generic, causes false positives on lldb-server and other tools
  # Original: exact: "CTool" - matches common C++ class naming convention

  - id: class-rc5
    desc: "GhostPenguin CMyRC5 class"
    crit: notable
    conf: 0.8
    attack: "T1059"
    for: [elf, pe]
    if:
      type: string
      substr: "CMyRC5"

  - id: class-showmessage
    desc: "GhostPenguin CMyShowMessage class"
    crit: notable
    conf: 0.8
    attack: "T1059"
    for: [elf, pe]
    if:
      type: string
      substr: "CMyShowMessage"

composite_rules:
  # GhostPenguin C2 IP composite
  - id: ghostpenguin-c2-ip
    desc: "GhostPenguin C2 IP address"
    crit: suspicious
    conf: 1.0
    attack: "T1071"
    for: [elf, pe]
    any:
      - id: c2-ip-1
      - id: c2-ip-2

  # GhostPenguin class name composite
  # NOTE: Requires at least 2 matches to avoid false positives from generic class names
  - id: class-name
    desc: "GhostPenguin internal class names"
    crit: suspicious
    conf: 0.9
    attack: "T1059"
    for: [elf, pe]
    needs: 2
    any:
      - id: class-basicinfo
      - id: class-rc5
      - id: class-showmessage

  - id: ghostpenguin-detected
    desc: GhostPenguin backdoor detected
    crit: notable
    conf: 0.95
