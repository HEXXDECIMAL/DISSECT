# Malware Family - FontOnLake Backdoor
# Reference: https://www.welivesecurity.com/2021/10/07/fontonlake-previously-unknown-malware-family-targeting-linux/
# ATT&CK: T1059.004 (Unix Shell)

traits:
  - id: backdoor/fontonlake/hidden-proc
    desc: FontOnLake hidden proc path
    crit: suspicious
    conf: 0.9
    family: true
    attack: "T1564.001"
    for: [elf]
    if:
      type: string
      regex: "/proc/\\.\\w{3,5}"

  - id: backdoor/fontonlake/x11-socket
    desc: FontOnLake X11 socket path
    crit: suspicious
    conf: 0.85
    family: true
    attack: "T1071"
    for: [elf]
    if:
      type: string
      substr: "/tmp/.X11-unix/X%u"

  - id: backdoor/fontonlake/insmod
    desc: FontOnLake kernel module loading
    crit: suspicious
    conf: 0.9
    family: true
    attack: "T1547.006"
    for: [elf]
    if:
      type: string
      substr: "/sbin/insmod %s > /dev/null"

  - id: backdoor/fontonlake/ssh-known-hosts
    desc: FontOnLake SSH known_hosts2 access
    crit: suspicious
    conf: 0.85
    family: true
    attack: "T1552.004"
    for: [elf]
    if:
      type: string
      substr: "~/.ssh/known_hosts2"

  - id: backdoor/fontonlake/dmesg-clear
    desc: FontOnLake dmesg clearing
    crit: suspicious
    conf: 0.9
    family: true
    attack: "T1070"
    for: [elf]
    if:
      type: string
      substr: "/bin/dmesg -c"

composite_rules:
  - id: backdoor/fontonlake/detected
    desc: FontOnLake malware
    crit: hostile
    conf: 0.95
    family: true
    reference: "https://www.welivesecurity.com/2021/10/07/fontonlake-previously-unknown-malware-family-targeting-linux/"
    attack: "T1059.004"
    mbc: "B0022"
    for: [elf]
    count_min: 4
    any:
      - id: backdoor/fontonlake/hidden-proc
      - id: backdoor/fontonlake/x11-socket
      - id: backdoor/fontonlake/insmod
      - id: backdoor/fontonlake/ssh-known-hosts
      - id: backdoor/fontonlake/dmesg-clear
