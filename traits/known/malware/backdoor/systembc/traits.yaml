# SystemBC Backdoor Detection
# ATT&CK: T1090.001 (Proxy: Internal Proxy)
# MBC: B0030 (Remote Access)

traits:
  # === SystemBC-specific artifact indicators (ONLY these belong here) ===
  - id: backdoor/systembc/name
    desc: systembc string reference
    crit: notable
    conf: 0.8
    if:
      type: string
      substr: "systembc"

  - id: backdoor/systembc/socks5-proxy
    desc: socks5_proxy SystemBC-specific string
    crit: notable
    conf: 0.8
    if:
      type: string
      substr: "socks5_proxy"

composite_rules:
  # === SystemBC artifact composite ===
  - id: backdoor/systembc/artifact
    desc: SystemBC backdoor identifier
    crit: notable
    conf: 0.8
    any:
      - id: backdoor/systembc/name
      - id: backdoor/systembc/socks5-proxy

  # === Detection composites referencing generic traits ===
  # Helper: shell + pipe execution pattern
  - id: systembc-shell-exec
    desc: Shell execution with pipe functions
    all:
      - id: bin-sh
      - id: c-popen

  # Helper: SOCKS proxy with shell
  - id: systembc-proxy-shell
    desc: SOCKS proxy with shell execution
    all:
      - id: socks5-proto
      - id: systembc-shell-exec

  - id: backdoor/systembc/proxy-shell
    desc: SystemBC proxy shell behavior
    crit: suspicious
    conf: 0.9
    attack: "T1090.001"
    mbc: "B0030"
    r#for: [elf, macho, pe, so, dylib, dll]
    all:
      - id: systembc-proxy-shell
      - id: cap/crypto/symmetric/rc4/rc4-bytecode

  # Full SystemBC detection
  - id: backdoor/systembc/detected
    desc: SystemBC backdoor detected
    crit: suspicious
    conf: 0.95
    attack: "T1090.001"
    mbc: "B0030"
    r#for: [elf, macho, pe, so, dylib, dll]
    count_min: 2
    any:
      - id: backdoor/systembc/artifact
      - id: cap/crypto/symmetric/rc4/rc4-bytecode
      - id: socks5-proto
      - id: backdoor/systembc/proxy-shell
