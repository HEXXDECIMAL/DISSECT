# SystemBC Backdoor Detection
# ATT&CK: T1090.001 (Proxy: Internal Proxy)
# MBC: B0030 (Remote Access)

traits:
  # === SystemBC-specific artifact indicators (ONLY these belong here) ===
  - id: name
    desc: systembc string reference
    crit: notable
    conf: 0.8
    if:
      type: string
      substr: "systembc"

  - id: socks5-proxy
    desc: socks5_proxy SystemBC-specific string
    crit: notable
    conf: 0.8
    if:
      type: string
      substr: "socks5_proxy"

composite_rules:
  # === SystemBC artifact composite ===
  - id: systembc-artifact
    desc: SystemBC backdoor identifier
    crit: notable
    conf: 0.8
    any:
      - id: name
      - id: socks5-proxy

  # === Detection composites referencing generic traits ===
  # Helper: shell + pipe execution pattern
  - id: systembc-shell-exec
    desc: Shell execution with pipe functions
    all:
      - id: cap/exec/command/shell::bin-sh
      - id: cap/exec/command/shell::c-popen

  # Helper: SOCKS proxy with shell
  - id: systembc-proxy-shell
    desc: SOCKS proxy with shell execution
    all:
      - id: cap/comm/proxy/socks::socks5-proto
      - id: systembc-shell-exec

  - id: proxy-shell
    desc: SystemBC proxy shell behavior
    crit: suspicious
    conf: 0.9
    attack: "T1090.001"
    mbc: "B0030"
    for: [elf, macho, pe, so, dylib, dll]
    all:
      - id: systembc-proxy-shell
      - id: cap/crypto/symmetric/stream::rc4-bytecode

  # Full SystemBC detection
  - id: systembc-detected
    desc: SystemBC backdoor detected
    crit: suspicious
    conf: 0.95
    attack: "T1090.001"
    mbc: "B0030"
    for: [elf, macho, pe, so, dylib, dll]
    needs: 2
    any:
      - id: systembc-artifact
      - id: cap/crypto/symmetric/stream::rc4-bytecode
      - id: cap/comm/proxy/socks::socks5-proto
      - id: proxy-shell
