# Malware Family - MessageTap (APT41)
# Reference: https://malpedia.caad.fkie.fraunhofer.de/details/elf.messagetap
# ATT&CK: T1040 (Network Sniffing)

traits:
  - id: backdoor/messagetap/global-code-tag
    desc: MessageTap operation tag
    crit: suspicious
    conf: 0.99
    attack: "T1040"
    for: [elf]
    if:
      type: string
      substr: "Operation_Global_Code_tag"

  - id: backdoor/messagetap/sms-intercept
    desc: MessageTap SMS intercept log
    crit: suspicious
    conf: 0.95
    attack: "T1040"
    for: [elf]
    if:
      type: string
      substr: "send sms from %s imsi:%s"

  - id: backdoor/messagetap/tcap-parse
    desc: MessageTap TCAP dialogue parser
    crit: suspicious
    conf: 0.95
    attack: "T1040"
    for: [elf]
    if:
      type: string
      substr: "tcap parse begin Dialogue"

composite_rules:
  - id: backdoor/messagetap/detected
    desc: MessageTap SMS interception malware
    crit: suspicious
    conf: 0.99
    attack: "T1040"
    mbc: "B0022"
    for: [elf]
    all:
      - id: backdoor/messagetap/global-code-tag
      - id: backdoor/messagetap/sms-intercept
      - id: backdoor/messagetap/tcap-parse
