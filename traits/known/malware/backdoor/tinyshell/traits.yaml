# Malware Family - TinyShell Backdoor
# Open-source backdoor, commonly reused in attacks
# ATT&CK: T1059.004 (Unix Shell)

traits:
  # === Go variant traits ===

  - id: backdoor/tinyshell/go-runshell
    desc: TinyShell Go shell handler
    crit: suspicious
    conf: 0.9
    family: true
    attack: "T1059.004"
    r#for: [elf]
    if:
      type: string
      substr: "handleRunShell"

  - id: backdoor/tinyshell/go-background
    desc: TinyShell Go background execution
    crit: suspicious
    conf: 0.6
    attack: "T1059.004"
    r#for: [elf]
    if:
      type: string
      substr: "RunInBackground"

  - id: backdoor/tinyshell/go-pty-wrapper
    desc: TinyShell Go PTY wrapper
    crit: suspicious
    conf: 0.85
    family: true
    attack: "T1059.004"
    r#for: [elf]
    if:
      type: string
      substr: "LinuxPtyWrapper"

  # === C variant traits ===

  - id: backdoor/tinyshell/c-runshell
    desc: TinyShell C daemon shell function
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1059.004"
    r#for: [elf]
    if:
      type: string
      substr: "_tshd_runshell"

  - id: backdoor/tinyshell/c-getfile
    desc: TinyShell C file transfer function
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1105"
    r#for: [elf]
    if:
      type: string
      substr: "_tshd_get_file"

  - id: backdoor/tinyshell/c-putfile
    desc: TinyShell C file upload function
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1105"
    r#for: [elf]
    if:
      type: string
      substr: "_tshd_put_file"

composite_rules:
  # Go variant detection
  - id: backdoor/tinyshell/go-detected
    desc: TinyShell Go backdoor
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1059.004"
    mbc: "B0022"
    r#for: [elf]
    all:
      - id: backdoor/tinyshell/go-runshell
      - id: backdoor/tinyshell/go-background
      - id: backdoor/tinyshell/go-pty-wrapper

  # C variant detection
  - id: backdoor/tinyshell/c-detected
    desc: TinyShell C backdoor
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1059.004"
    mbc: "B0022"
    r#for: [elf]
    count_min: 2
    any:
      - id: backdoor/tinyshell/c-runshell
      - id: backdoor/tinyshell/c-getfile
      - id: backdoor/tinyshell/c-putfile
