# SILENCELIFT Backdoor Detection
# UNC1069 macOS backdoor with screen lock detection and process control
# Source: Google Threat Intelligence Group (GTIG)

defaults:
  platforms: [macos]
  for: [macho, shell]

traits:
  # Atomic indicators specific to SILENCELIFT
  - id: logs-db-hidden-file
    desc: .Logs.db hidden database file in /Library/Caches
    crit: suspicious
    conf: 0.9
    if:
      type: string
      exact: "/Library/Caches/.Logs.db"

  - id: analyzed-marker-file
    desc: .analyzed marker file in /Library/Fonts
    crit: suspicious
    conf: 0.9
    if:
      type: string
      exact: "/Library/Fonts/.analyzed"

  - id: bot-id-json
    desc: bot_id JSON structure for C2 communication
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: "\\{\\s*\"bot_id\"\\s*:\\s*\""

  - id: status-json-field
    desc: status JSON field for C2 reporting
    crit: inert
    conf: 0.6
    if:
      type: string
      regex: "\",\\s*\"status\"\\s*:"

composite_rules:
  # Strict SILENCELIFT detection
  - id: silencelift-strict
    desc: SILENCELIFT backdoor (exact match)
    crit: hostile
    conf: 1.0
    attack: "T1489"
    all:
      - id: cap/discovery/system/hardware::ioreg-screen-lock
      - id: cap/process/control/signal::pkill-continue
      - id: cap/process/control/signal::pkill-stop
      - id: logs-db-hidden-file
      - id: cap/hw/input/keylog::evt-marker-file
      - id: bot-id-json
      - id: status-json-field
      - id: analyzed-marker-file

  # Generalized SILENCELIFT-like behavior
  - id: silencelift-behavior
    desc: SILENCELIFT-like backdoor with process control
    crit: hostile
    conf: 0.95
    attack: "T1489"
    all:
      - id: cap/process/control/signal::process-suspend-resume
      - id: cap/fs/path/library::hidden-library-caches
      - id: bot-id-json
    any:
      - id: cap/discovery/system/hardware::ioreg-screen-lock
      - id: cap/hw/input/keylog::evt-marker-file
