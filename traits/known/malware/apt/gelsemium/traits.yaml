# Malware Family - Gelsemium/Wolfsbane
# Reference: https://www.welivesecurity.com/en/eset-research/unveiling-wolfsbane-gelsemiums-linux-counterpart-to-gelsevirine/
# ATT&CK: T1071 (Application Layer Protocol)

traits:
  - id: clientpath
    desc: Wolfsbane clientpath config
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    for: [elf]
    if:
      type: content
      substr: "clientpath"

  - id: rc4-key
    desc: Wolfsbane RC4 key functions
    crit: suspicious
    conf: 0.95
    attack: "T1573"
    for: [elf]
    if:
      type: string
      regex: "default_(?:setting|plugin)_rec4_key|rc4key"

  - id: config-yara
    desc: Wolfsbane config strings via YARA
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    mbc: "B0030"
    for: [elf]
    if:
      type: yara
      source: |
        rule wolfsbane_config {
          strings:
            $config_clientpath = "clientpath" wide
            $config_hiderpath = "hiderpath" wide
            $config_pluginkey = "pluginkey" wide
            $config_mainpath = "mainpath" wide
          condition:
            uint32(0) == 0x464C457F and
            filesize < 10MB and all of them
        }

composite_rules:
  - id: gelsemium-detected
    desc: Wolfsbane/Gelsemium (RC4 + config)
    crit: notable
    conf: 0.99
    attack: "T1573"
    mbc: "C0027"
    for: [elf]
    any:
      - id: rc4-key
      - id: config-yara
      - id: clientpath
