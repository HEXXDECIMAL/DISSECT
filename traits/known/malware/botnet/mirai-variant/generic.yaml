# IoT Botnet Indicators
# MBC: OB0004 (Command & Control)
# ATT&CK: T1583.005 (Botnet)

traits:
  - id: gpio-daemon
    desc: GPIO daemon naming (IoT botnet
    crit: suspicious
    conf: 0.75
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    if:
      type: string
      regex: "gpio[a-z]?_daemon"

  # === BusyBox atomic indicators ===
  # Removed busybox-path duplicate - use obj/c2/botnet/iot::busybox

  - id: busybox-cmd
    desc: BusyBox command reference
    crit: inert
    conf: 0.6
    for: [elf, shell]
    if:
      type: string
      regex: "busybox\\s"

  - id: ssdp-discover
    desc: SSDP M-SEARCH discovery (UPnP exploitation/scanning)
    crit: suspicious
    conf: 0.75
    mbc: "E1018"
    attack: "T1046"
    for: [elf]
    if:
      type: string
      regex: "M-SEARCH.{0,50}ssdp:discover"

  # === Telnet default credential atomic indicators ===
  # Removed cred-root-root duplicate - use obj/lateral/brute-force/ssh::root-root-cred

  - id: cred-root-admin
    desc: root:admin default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "root:admin"

  - id: cred-root-toor
    desc: root:toor default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "root:toor"

  - id: cred-root-password
    desc: root:password default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "root:password"

  - id: cred-root-1234
    desc: root:1234 default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "root:1234"

  - id: cred-root-12345
    desc: root:12345 default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "root:12345"

  - id: cred-root-default
    desc: root:default default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "root:default"

  - id: cred-root-123456
    desc: root:123456 default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "root:123456"

  - id: cred-admin-root
    desc: admin:root default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "admin:root"

  # Removed cred-admin-admin duplicate - use obj/lateral/brute-force/ssh::admin-admin-cred
  # Removed cred-admin-password duplicate - use obj/lateral/brute-force/ssh::admin-password-cred
  # Removed cred-admin-1234 duplicate - use obj/lateral/brute-force/ssh::admin-1234-cred

  - id: cred-admin-default
    desc: admin:default default credential
    crit: notable
    conf: 0.6
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    if:
      type: string
      substr: "admin:default"

  # Removed cred-guest-guest duplicate - use obj/lateral/brute-force/ssh::guest-guest-cred

  # === Mirai botnet brand string atomic indicators ===
  - id: mirai-brand-lzrd
    desc: LZRD botnet brand string
    crit: notable
    conf: 0.7
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    if:
      type: string
      exact: "LZRD"

  # NOTE: "SORA" is too generic - appears in OpenGL/graphics contexts (SPIR-V, shaders).
  # Mirai SORA variant detection relies on the iot-botnet/mirai-strings composite
  # which requires additional indicators. Removed standalone SORA matching.
  # - id: mirai-brand-sora (REMOVED - false positives on graphics libraries)

  - id: mirai-brand-owari
    desc: OWARI botnet brand string
    crit: notable
    conf: 0.7
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    if:
      type: string
      substr: "OWARI"

  - id: mirai-brand-mirai
    desc: MIRAI botnet brand string
    crit: notable
    conf: 0.7
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    if:
      type: string
      substr: "MIRAI"

  - id: mirai-brand-bashlite
    desc: BASHLITE botnet brand string
    crit: notable
    conf: 0.7
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    if:
      type: string
      substr: "BASHLITE"

  - id: mirai-brand-qbot
    desc: QBOT botnet brand string
    crit: notable
    conf: 0.7
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    if:
      type: string
      exact: "QBOT"

  - id: mirai-brand-tsunami
    desc: TSUNAMI botnet brand string
    crit: notable
    conf: 0.7
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    if:
      type: string
      substr: "TSUNAMI"

  - id: mirai-brand-gafgyt
    desc: GAFGYT botnet brand string
    crit: notable
    conf: 0.7
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    if:
      type: string
      substr: "GAFGYT"

composite_rules:
  # BusyBox composite
  - id: busybox
    desc: BusyBox reference
    crit: notable
    conf: 0.70
    for: [elf, shell]
    any:
      - id: obj/c2/botnet/iot::busybox
      - id: busybox-cmd

  # Telnet default credentials composite (requires 2+ matches)
  - id: telnet-brute
    desc: Telnet credentials (IoT device compromise)
    crit: suspicious
    conf: 0.8
    mbc: "T1110"
    attack: "T1110.001"
    for: [elf]
    needs: 2
    any:
      - id: obj/lateral/brute-force/ssh
      - id: cred-root-admin
      - id: cred-root-toor
      - id: cred-root-password
      - id: cred-root-1234
      - id: cred-root-12345
      - id: cred-root-default
      - id: cred-root-123456
      - id: cred-admin-root
      - id: cred-admin-default

  # Mirai brand strings composite
  - id: mirai-strings
    desc: Mirai botnet-style brand strings
    crit: suspicious
    conf: 0.8
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    any:
      - id: mirai-brand-lzrd
      # mirai-brand-sora removed - too generic, appears in OpenGL/graphics contexts
      - id: mirai-brand-owari
      - id: mirai-brand-mirai
      - id: mirai-brand-bashlite
      - id: mirai-brand-qbot
      - id: mirai-brand-tsunami
      - id: mirai-brand-gafgyt

  # IoT botnet detection - requires multiple indicators
  - id: iot-botnet-detected
    desc: IoT botnet variant detected (multiple
    crit: suspicious
    conf: 0.95
    mbc: "OB0004"
    attack: "T1583.005"
    for: [elf]
    needs: 3
    any:
      - id: gpio-daemon
      - id: ssdp-discover
      - id: telnet-brute
      - id: mirai-strings
      - id: busybox
