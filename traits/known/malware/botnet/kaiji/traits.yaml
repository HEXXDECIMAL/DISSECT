# Malware Family - Kaiji IoT Botnet
# Chinese Linux/IoT malware written in Go
# Reference: https://intezer.com/blog/research/kaiji-new-chinese-linux-malware-turning-to-golang/
# ATT&CK: T1583.005 (Botnet)

traits:
  # === Atomic Traits (moved from composite_rules) ===

  - id: botnet/kaiji/systemctl-service
    desc: Kaiji systemd service startup
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1543.002"
    r#for: [elf]
    if:
      type: string
      exact: "systemctl start linux.service"

  - id: botnet/kaiji/audit-selinux
    desc: Kaiji SELinux audit bypass
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1562.001"
    r#for: [elf]
    if:
      type: string
      exact: "audit2allow -M my-Systemimgconf"

  - id: botnet/kaiji/chaos-cve
    desc: Kaiji CVE exploitation function
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1190"
    r#for: [elf]
    if:
      type: string
      exact: "chaos_cve_make"

  # === Old variant traits (Go symbols) ===

  - id: botnet/kaiji/beat-heart
    desc: Kaiji heartbeat function (old)
    crit: suspicious
    conf: 0.9
    family: true
    attack: "T1071"
    r#for: [elf]
    if:
      type: string
      exact: "main.BeatHeart"

  - id: botnet/kaiji/make-packet
    desc: Kaiji packet crafting (old)
    crit: suspicious
    conf: 0.9
    family: true
    attack: "T1498"
    r#for: [elf]
    if:
      type: string
      exact: "main.makePacketa"

  - id: botnet/kaiji/decrypt-cfb
    desc: Kaiji CFB decryption (old)
    crit: suspicious
    conf: 0.9
    family: true
    attack: "T1140"
    r#for: [elf]
    if:
      type: string
      exact: "main.DecryptCFB"

composite_rules:
  - id: botnet/kaiji/detected
    desc: Kaiji botnet detected
    crit: suspicious
    conf: 0.95
    attack: "T1071"
    mbc: "B0030"
    for: [elf]
    any:
      - id: botnet/kaiji/brute-force
      - id: botnet/kaiji/ddos-capability
      - id: botnet/kaiji/persistence

  - id: botnet/kaiji/old-variant-detected
    desc: Kaiji botnet old variant detected
    crit: suspicious
    conf: 0.95
