# ChinaZ Botnet Detection
# ATT&CK: T1583.005 (Acquire Infrastructure: Botnet)
# MBC: B0030 (Remote Access)

defaults:
  for: [elf, macho, so, dylib]

traits:
  # ChinaZ botnet identifiers
  - id: botnet/chinaz/identifier
    desc: ChinaZ botnet identifier string
    crit: notable
    conf: 0.7
    if:
      type: yara
      source: |
        rule chinaz_id {
          strings:
            $name1 = "ChinaZ" ascii nocase fullword
            $name2 = "chinaz" ascii fullword
          condition:
            any of them
        }

  - id: obj/c2/botnet/chinaz/commands
    desc: Specific ChinaZ C2 command logic
    crit: suspicious
    conf: 0.95
    attack: "T1583.005"
    if:
      type: yara
      source: |
        rule chinaz_cmds {
          strings:
            $cmd1 = "LOLNOGTFO" ascii
            $cmd2 = "GETLOCALIP" ascii
            $cmd3 = "HTTPFLOOD" ascii
            $cmd4 = "UDPFLOOD" ascii
            $cmd5 = "SYNFLOOD" ascii
          condition:
            2 of them
        }

  # ChinaZ DDoS capability
  - id: cap/comm/attack/flood/raw-sockets
    desc: Raw socket network flood capability
    crit: notable
    conf: 0.8
    if:
      type: yara
      source: |
        rule raw_socket_flood {
          strings:
            $raw1 = "IPPROTO_RAW" ascii
            $raw2 = "IPPROTO_TCP" ascii
            $raw3 = "IPPROTO_UDP" ascii
            $flood1 = "syn_flood" ascii
            $flood2 = "udp_flood" ascii
            $flood3 = "http_flood" ascii
            $flood4 = "tcp_flood" ascii
          condition:
            2 of ($raw*) and any of ($flood*)
        }

  - id: cap/comm/attack/flood/iot-ddos
    desc: IoT-targeted DDoS flood logic
    crit: suspicious
    conf: 0.85
    if:
      type: yara
      source: |
        rule iot_flood {
          strings:
            $flood1 = "syn_flood" ascii
            $flood2 = "udp_flood" ascii
            $flood3 = "http_flood" ascii
            $flood4 = "tcp_flood" ascii
            $iot1 = "/proc/cpuinfo" ascii
            $iot2 = "busybox" ascii
          condition:
            any of ($flood*) and any of ($iot*)
        }

  # ChinaZ spreading mechanism
  - id: botnet/spread/telnet-scanner
    desc: Automated telnet credential scanner
    crit: suspicious
    conf: 0.85
    if:
      type: yara
      source: |
        rule telnet_scanner {
          strings:
            $scan1 = "scanner" ascii
            $scan2 = "telnet" ascii nocase
            $cred1 = "admin:admin" ascii
            $cred2 = "root:root" ascii
            $cred3 = "root:xc3511" ascii
            $cred4 = "root:vizxv" ascii
            $cred5 = "admin:1234" ascii
          condition:
            (any of ($scan*)) and 2 of ($cred*)
        }

composite_rules:
  # ChinaZ botnet detection
  - id: botnet/chinaz/detected
    desc: ChinaZ botnet detected
    crit: suspicious
    conf: 0.95
    attack: "T1583.005"
    mbc: "B0030"
    all:
      - id: botnet/chinaz/identifier
    any:
      - id: obj/c2/botnet/chinaz/commands
      - id: cap/comm/attack/flood/iot-ddos
