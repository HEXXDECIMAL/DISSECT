# Mirai IoT Botnet - Stripped Binary Variant Detection
# Detects Mirai variants without relying on function symbols
# Uses behavioral indicators instead of function names for stripped binaries

defaults:
  crit: suspicious
  for: [elf]
  platforms: [linux]

traits:
  # Network reconnaissance - key Mirai characteristic
  # Removed proc-net-tcp-scan duplicate - use cap/fs/proc/info::proc-net-tcp

  # Process directory enumeration
  - id: proc-directory-ref
    desc: Process directory reference
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: "/proc/?$"

  # Self-identification - common in memory-only malware
  # Removed proc-self-exe-ref duplicate - use cap/fs/proc/info::process-self-exe-path

  # Hidden file in temp - Mirai lock file pattern
  - id: tmp-hidden-file-ref
    desc: Hidden file in /tmp
    crit: notable
    conf: 0.75
    if:
      type: string
      regex: "/tmp/\\.[a-z]+"

  # Backdoor daemon references - multiple services
  - id: backdoor-daemons-ref
    desc: Multiple backdoor daemon references
    crit: notable
    conf: 0.7
    if:
      type: string
      regex: "(telnetd|httpd)"
      count_min: 2

composite_rules:
  # Stripped Mirai behavioral detection
  - id: stripped-mirai-iot-botnet
    desc: Mirai IoT botnet (stripped binary)
    crit: hostile
    conf: 0.90
    mbc: "B0030"
    attack: "T1059.004"
    needs: 3  # Need 3 of 5 behavioral indicators
    all:
      - id: meta/hardening::stripped-binary  # Must be stripped
      - id: cap/fs/proc/info::proc-net-tcp  # Must scan network
    any:
      - id: cap/fs/proc/info::process-self-exe-path
      - id: tmp-hidden-file-ref
      - id: backdoor-daemons-ref
      - id: proc-directory-ref
      - id: obj/c2/botkill/competitor::mirai-competitor-kill-list
    none:
      - id: known/malware/backdoor/redxor::redxor-po1kitd-masquerade

  # Comprehensive Mirai detection (any variant)
  - id: mirai-iot-botnet-comprehensive
    desc: Mirai IoT botnet (comprehensive detection)
    crit: hostile
    conf: 0.95
    mbc: "B0030"
    attack: "T1059.004"
    any:
      - id: known/malware/botnet/mirai::detected  # Function-based
      - id: stripped-mirai-iot-botnet  # Behavioral
      - id: obj/lateral/brute-force/iot-creds::mirai-creds  # Credential-based
