# Malware Family - DarkNexus IoT Botnet
# Reference: https://www.shodan.io/search/darknexus
# ATT&CK: T1583.005 (Botnet), T1190 (Exploit Public-Facing Application)
# MBC: B0030 (Command and Control)

traits:
  # === DarkNexus-Specific Indicators ===
  # DarkNexus targets IoT devices (routers, cameras, DVRs) via SSH/Telnet brute-force
  # Propagates via self-copying and exploitation of default credentials

  - id: darknexus-marker
    desc: DarkNexus botnet identifier string
    crit: suspicious
    conf: 0.85
    attack: "T1583.005"
    for: [elf]
    platforms: [linux]
    if:
      type: string
      regex: "(?i)darknexus|DarkNexus"

  - id: mips-small-dropper
    desc: "MIPS binary under 50KB (IoT dropper pattern)"
    crit: suspicious
    conf: 0.7
    attack: "T1190"
    for: [elf]
    platforms: [linux]
    if:
      type: string
      substr: "PROT_EXEC"

composite_rules:
  # DarkNexus dropper pattern: stager + self-copy + RWX memory + ROP gadgets
  - id: dropper-pattern
    desc: "DarkNexus dropper (shellcode stager with self-propagation)"
    crit: suspicious
    conf: 0.85
    mbc: "B0032"
    attack: "T1105"
    for: [elf]
    platforms: [linux]
    all:
      - id: cap/fs/proc/info::process-self-exe
      - id: obj/anti-analysis/self-modify/runtime::mprotect
      - id: known/tools/offensive/stagers::x64-jmp-register

  # DarkNexus botnet detection: dropper + IoT targeting indicators
  - id: iot-botnet-variant
    desc: "DarkNexus-like IoT botnet (dropper with shellcode injection)"
    crit: suspicious
    conf: 0.9
    mbc: "B0030"
    attack: "T1583.005"
    for: [elf]
    platforms: [linux]
    all:
      - id: dropper-pattern
      - id: obj/anti-static/obfuscation/binary-metrics::few-sections

  # DarkNexus hostile botnet: definitive code injection + propagation
  - id: hostile-botnet-injection
    desc: "Definitive DarkNexus botnet with code injection and propagation"
    crit: hostile
    conf: 0.95
    mbc: "B0030"
    attack: "T1583.005"
    for: [elf]
    platforms: [linux]
    size_max: 100000
    all:
      - id: cap/fs/proc/info::process-self-exe
      - id: cap/mem/protect/modify::rwx-prot-bytes
      - id: known/tools/offensive/stagers::x64-jmp-register
      - id: obj/anti-static/obfuscation/binary-metrics::few-sections