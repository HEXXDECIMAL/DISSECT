# Malware Family - Gafgyt IoT Botnet
# Reference: https://www.trendmicro.com/vinfo/us/threat-encyclopedia/malware/gafgyt
# ATT&CK: T1583.005 (Botnet)

traits:
  - id: botkill-string
    desc: botkill command (process killer)
    crit: notable
    conf: 0.7
    for: [elf]
    if:
      type: string
      substr: "botkill"

  - id: cpu-sysfs-path
    desc: /sys/devices/system/cpu path (CPU enumeration)
    crit: inert
    conf: 0.3
    for: [elf]
    if:
      type: string
      substr: "/sys/devices/system/cpu"

  - id: udp-flood-string
    desc: udp_flood function name
    crit: notable
    conf: 0.7
    for: [elf]
    if:
      type: string
      substr: "udp_flood"

  - id: tcpraw-flood-string
    desc: tcpraw_flood function name (Gafgyt-specific)
    crit: suspicious
    conf: 0.9
    for: [elf]
    attack: T1498
    if:
      type: string
      substr: "tcpraw_flood"

  - id: syn-flood-string
    desc: syn_flood function name
    crit: notable
    conf: 0.7
    for: [elf]
    if:
      type: string
      substr: "syn_flood"

  - id: ack-flood-string
    desc: ack_flood function name
    crit: notable
    conf: 0.7
    for: [elf]
    if:
      type: string
      substr: "ack_flood"

composite_rules:
  - id: flood-functions
    desc: DDoS flood function names
    crit: notable
    conf: 0.7
    for: [elf]
    attack: T1498
    any:
      - id: udp-flood-string
      - id: tcpraw-flood-string
      - id: syn-flood-string
      - id: ack-flood-string

  - id: gafgyt-strings
    desc: Gafgyt botnet string indicators (3+
    crit: suspicious
    conf: 0.8
    for: [elf]
    needs: 3
    any:
      - id: botkill-string
      - id: cap/exec/command/shell/generic/bin-bash
      - id: cpu-sysfs-path
      - id: udp-flood-string
      - id: tcpraw-flood-string
      - id: syn-flood-string
      - id: ack-flood-string

  - id: detected
    desc: Gafgyt IoT botnet detection (botkill
    crit: suspicious
    conf: 0.95
    for: [elf]
    attack: T1583.005
    mbc: OB0004
    all:
      - id: botkill-string
      - id: gafgyt-strings
      - id: meta/format/structural-metrics/small-elf-binary

  - id: ddos-capability
    desc: Gafgyt DDoS capability
    crit: suspicious
    conf: 0.95
    for: [elf]
    attack: T1498
    mbc: B0008
    needs: 2
    any:
      - id: udp-flood-string
      - id: tcpraw-flood-string
      - id: syn-flood-string
      - id: ack-flood-string
