traits:
  - id: rubilyn-bundle-id
    desc: Rubilyn Bundle ID
    crit: inert
    if:
      type: content
      substr: "com.hackerfantastic.rubilyn"

  - id: rubilyn-sysctl-str
    desc: Rubilyn sysctl string
    crit: inert
    if:
      type: content
      substr: "_sysctl_rubilyn_"

  - id: rubilyn-magic-icmp
    desc: Rubilyn Magic ICMP sequence
    crit: inert
    for: [all]
    if:
      type: hex
      pattern: "27 10 03 0b 46 08 1c 10 1e"

  - id: rubilyn-xor-key
    desc: Rubilyn XOR Key
    crit: inert
    if:
      type: content
      substr: "I never seem to have anything that if I lost it"

  - id: rubilyn-str-plain
    desc: Rubilyn string
    crit: inert
    if:
      type: content
      substr: "rubilyn"

  - id: rubilyn-str-debug
    desc: debug.rubilyn string
    crit: inert
    if:
      type: content
      substr: "debug.rubilyn"

  - id: rubilyn-source-smashaslr
    desc: smashASLR function string
    crit: inert
    if:
      type: content
      substr: "smashASLR"

composite_rules:
  - id: rubilyn-kext
    desc: Rubilyn macOS Rootkit (Binary/Kext)
    crit: suspicious
    conf: 1.0
    needs: 1
    any:
      - id: rubilyn-bundle-id
      - id: rubilyn-sysctl-str
      - id: rubilyn-magic-icmp

  - id: rubilyn-indicator
    desc: Rubilyn Rootkit Indicator (Generic)
    crit: suspicious
    conf: 0.9
    needs: 1
    any:
      - id: rubilyn-xor-key
      - id: rubilyn-str-debug

  - id: rubilyn-source
    desc: Rubilyn macOS Rootkit (Source)
    crit: suspicious
    conf: 1.0
    all:
      - id: rubilyn-str-plain
      - id: rubilyn-source-smashaslr