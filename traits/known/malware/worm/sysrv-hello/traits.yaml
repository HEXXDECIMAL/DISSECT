# Sysrv-Hello Worm / Coinminer
# Detects Sysrv-Hello malware (Go binary with embedded PHP payload)
# ATT&CK: T1059 (Command and Scripting Interpreter), T1496 (Resource Hijacking)

defaults:
  attack: "T1059"

traits:
  - id: sysrv-php-remove-tag
    desc: Embedded PHP self-remove tag
    crit: suspicious
    conf: 1.0
    if:
      type: string
      regex: '<!--__REMOVE__<\?php'

  - id: sysrv-php-regex-clean
    desc: Embedded PHP cleanup regex
    crit: suspicious
    conf: 0.95
    if:
      type: string
      regex: 'preg_replace\("/<!--__REM"\."OVE__\[\\s\\S\]\*__REM"\."OVE__-->/"'

  - id: go-runtime
    desc: Go runtime indicator
    crit: inert
    if:
      type: string
      exact: 'runtime.main'

composite_rules:
  - id: sysrv-hello-worm
    desc: Sysrv-Hello worm (Go + Embedded PHP)
    crit: hostile
    conf: 1.0
    mbc: "B0006.002"
    all:
      - id: sysrv-php-remove-tag
    any:
      - id: go-runtime
      - id: cap/data/source/obfuscation/string::math-random-fragment
      - id: obj/impact/ransom/encrypt::go-file-encrypt-yara
