# macOS Information Stealer Detection
# Detects macOS-specific information stealer patterns
# Combines hardware fingerprinting, credential targeting, and network exfiltration

composite_rules:
  # Hardware fingerprint + network = tracking/identification
  - id: fingerprint-with-exfil
    desc: "macOS hardware fingerprinting network exfiltration"
    crit: suspicious
    conf: 0.9
    attack: "T1082"
    mbc: "B0001.009"
    for: [macho]
    all:
      - id: obj/discovery/fingerprint/hardware-uuid-macos
    count_min: 1
    any:
      - id: cap/comm/socket/create
      - id: cap/comm/download/curl

  # Credential targeting + hardware fingerprinting = stealer
  - id: credential-stealer-macos
    desc: "macOS credential stealer"
    crit: hostile
    conf: 0.95
    attack: "T1555"
    mbc: "B0028"
    for: [macho]
    all:
      - id: obj/discovery/fingerprint/hardware-uuid-macos
      - id: obj/creds/macos/validation/csidentity-password-auth
      - id: obj/collect/file-targeting/credential-files
      - id: cap/comm/socket/create

  # Full stealer pattern: fingerprint + targeting + obfuscation + network
  - id: comprehensive-stealer-macos
    desc: "Comprehensive macOS information stealer"
    crit: hostile
    conf: 0.98
    attack: "T1555"
    mbc: "B0028"
    for: [macho]
    all:
      - id: obj/discovery/fingerprint/hardware-uuid-macos
      - id: obj/anti-static/obfuscation/string-decrypt
      - id: obj/creds/macos/validation/csidentity-password-auth
      - id: obj/collect/file-targeting/credential-files
