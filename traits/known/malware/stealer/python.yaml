# Python Infostealer Narratives
# High-confidence rules for identifying stealing behavior
#
# Note: Cross-directory references use directory paths which match ANY trait
# within that directory.

defaults:
  crit: suspicious
  for: [python]

traits:
  # System info collection with credential intent
  - id: system-info-with-browser
    desc: System info with browser targeting
    conf: 0.7
    if:
      type: content
      regex: "(platform|uname).{0,50}(browser|chrome|firefox)"

  - id: system-info-with-wallet
    desc: System info with crypto wallet
    conf: 0.8
    if:
      type: content
      regex: "(platform|uname).{0,50}(wallet|exodus|metamask)"

composite_rules:
  - id: infostealer/python-profiler
    desc: "System profiler with exfiltration"
    crit: suspicious
    conf: 0.90
    mbc: "B0028"
    attack: "T1555"
    r#for: [python]
    count_min: 2
    any:
      - id: system-info-with-browser
      - id: system-info-with-wallet
    all:
      - id: obj/discovery/system
      - id: obj/exfil/http
