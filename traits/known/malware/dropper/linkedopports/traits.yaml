# LinkedOpports Dropper Family
# Identified by exfiltration to linkedopports.com and download from python-release.com
# Often uses "firstbasicpyapp" as a description.

defaults:
  for: [python]
  attack: "T1195.002"

traits:
  - id: linkedopports-domain
    desc: linkedopports.com domain (LinkedOpports family)
    crit: suspicious
    conf: 1.0
    if:
      type: string
      substr: "linkedopports.com"

  - id: python-release-domain
    desc: python-release.com domain (LinkedOpports family)
    crit: suspicious
    conf: 1.0
    if:
      type: string
      substr: "python-release.com"

  - id: exfil-string-kw
    desc: LinkedOpports exfil string marker
    crit: suspicious
    conf: 1.0
    if:
      type: string
      substr: "Installation new c kw"

  - id: firstbasicpyapp-desc
    desc: firstbasicpyapp description marker
    crit: notable
    conf: 0.9
    if:
      type: string
      substr: "firstbasicpyapp"

  - id: python-install-scr-url
    desc: python-release.com/python-install.scr URL (LinkedOpports family)
    crit: suspicious
    conf: 1.0
    if:
      type: string
      substr: "python-release.com/python-install.scr"

  - id: pyp-dropped-exe
    desc: Dropped executable name (LinkedOpports family)
    crit: notable
    conf: 0.9
    if:
      type: string
      regex: "ini_file_pyp_.{0,100}\\.exe"

  - id: pyp-app-keywords
    desc: Specific app keywords (LinkedOpports family)
    crit: notable
    conf: 0.9
    if:
      type: string
      regex: "elevatepyapp|praisepyapp"

  - id: ina-function
    desc: Suspicious ina() function (LinkedOpports family)
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: "def ina\\(\\):"

  - id: win-exec-start
    desc: Windows start command execution
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: "os\\.system\\(['\"]start "

composite_rules:
  - id: linkedopports-dropper
    desc: LinkedOpports supply-chain dropper
    crit: hostile
    conf: 1.0
    all:
      - id: linkedopports-domain
      - id: python-release-domain
    any:
      - id: exfil-string-kw
      - id: python-install-scr-url
      - id: firstbasicpyapp-desc
      - id: pyp-dropped-exe
      - id: pyp-app-keywords
      - id: ina-function
      - id: win-exec-start
      - id: obj/lateral/supply-chain/pypi/install-patterns::pypi-install-dropper
