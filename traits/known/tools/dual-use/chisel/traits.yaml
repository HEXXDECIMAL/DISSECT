# Chisel Tunneling Tool Detection
# ATT&CK: T1090 (Proxy)
# Note: Chisel is a legitimate tool but frequently abused

traits:
  - id: tools/tunnel/chisel/repo
    desc: "Chisel repository URL"
    crit: suspicious
    conf: 1.0
    attack: "T1090"
    if:
      type: string
      substr: "github.com/jpillora/chisel"
      case_insensitive: true

  - id: tools/tunnel/chisel/func
    desc: "Chisel function name"
    crit: suspicious
    conf: 0.9
    attack: "T1090"
    if:
      type: string
      regex: 'Chisel(Client|Server)'

  - id: tools/tunnel/chisel/keyword
    desc: "Chisel keyword"
    crit: notable
    conf: 0.6
    if:
      type: string
      word: "chisel"
      case_insensitive: true

  - id: tools/tunnel/chisel/mode
    desc: "Chisel mode indicators"
    crit: inert
    conf: 0.6
    if:
      type: string
      # Require tunneling context - not just generic words
      regex: '(?i)(?:reverse[_-]?(?:tunnel|proxy|forward)|socks5[_-]?(?:proxy|server|port)|proxy[_-]?(?:tunnel|mode|server))'

composite_rules:
  - id: tools/tunnel/chisel/keyword-with-mode
    desc: "Chisel keyword with tunneling mode"
    crit: suspicious
    conf: 0.8
    attack: "T1090"
    all:
      - id: tools/tunnel/chisel/keyword
      - id: tools/tunnel/chisel/mode

  - id: tools/tunnel/chisel/detected
    desc: "Chisel tunneling tool detected"
    crit: suspicious
    conf: 0.95
    attack: "T1090"
    any:
      - id: tools/tunnel/chisel/repo
      - id: tools/tunnel/chisel/func
      - id: tools/tunnel/chisel/keyword-with-mode
