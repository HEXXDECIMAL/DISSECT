traits:
  - id: process-fork
    description: Process forking syscall (fork, vfork, or clone)
    criticality: notable
    condition:
      type: syscall
      name: ["fork", "vfork", "clone"]

  - id: process-fork-macos
    description: Process forking syscall on macOS
    criticality: notable
    condition:
      type: syscall
      name: ["fork"]

  - id: process-setsid
    description: Create new session and become session leader
    criticality: notable
    condition:
      type: syscall
      name: ["setsid"]

  - id: fd-redirect
    description: File descriptor redirection (dup2 or dup3)
    criticality: notable
    condition:
      type: syscall
      name: ["dup2", "dup3"]

  - id: fd-redirect-multiple
    description: Multiple file descriptor redirections
    criticality: notable
    condition:
      type: syscall
      name: ["dup2", "dup3"]
      min_count: 2

  - id: fd-redirect-macos
    description: File descriptor redirection on macOS (dup2)
    criticality: notable
    condition:
      type: syscall
      name: ["dup2"]
      min_count: 2

composite_rules:
  - id: daemon
    description: Daemon behavior - detaches from controlling terminal
    confidence: 0.85
    criticality: notable
    platforms: [linux]
    file_types: [elf]
    requires_all:
      - type: trait
        id: process-fork
      - type: trait
        id: process-setsid

  - id: daemon-full
    description: Full daemon pattern with stdin/stdout redirection
    confidence: 0.9
    criticality: notable
    platforms: [linux]
    file_types: [elf]
    requires_all:
      - type: trait
        id: process-fork
      - type: trait
        id: process-setsid
      - type: trait
        id: fd-redirect-multiple

  - id: daemon-macos
    description: macOS daemon behavior - detaches from terminal
    confidence: 0.85
    criticality: notable
    platforms: [macos]
    file_types: [macho]
    requires_all:
      - type: trait
        id: process-fork-macos
      - type: trait
        id: process-setsid

  - id: daemon-macos-full
    description: Full macOS daemon pattern with I/O redirection
    confidence: 0.9
    criticality: notable
    platforms: [macos]
    file_types: [macho]
    requires_all:
      - type: trait
        id: process-fork-macos
      - type: trait
        id: process-setsid
      - type: trait
        id: fd-redirect-macos
