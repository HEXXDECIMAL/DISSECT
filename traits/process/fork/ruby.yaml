# Process Lifecycle - Ruby

traits:
  # === Ruby fork atomic indicators ===
  - id: process-fork
    description: Process.fork call
    crit: inert
    confidence: 0.7
    platforms: [all]
    file_types: [ruby]
    condition:
      type: string
      exact: "Process.fork"

  - id: fork-brace-block
    description: fork with brace block
    crit: inert
    confidence: 0.6
    platforms: [all]
    file_types: [ruby]
    condition:
      type: string
      regex: "\\bfork\\s*\\{"

  - id: fork-do-block
    description: fork with do block
    crit: inert
    confidence: 0.6
    platforms: [all]
    file_types: [ruby]
    condition:
      type: string
      regex: "\\bfork\\s*do\\b"

  - id: fork-paren
    description: fork with parenthesis
    crit: inert
    confidence: 0.6
    platforms: [all]
    file_types: [ruby]
    condition:
      type: string
      regex: "\\bfork\\s*\\("

composite_rules:
  # Fork block composite
  - id: fork-block
    description: fork with block/do
    crit: notable
    confidence: 0.7
    platforms: [all]
    file_types: [ruby]
    requires_count: 1
    any:
      - id: fork-brace-block
      - id: fork-do-block
      - id: fork-paren

  - id: ruby-fork
    description: Fork process
    crit: notable
    confidence: 0.88
    platforms: [all]
    file_types: [ruby]
    requires_count: 1
    any:
      - id: process-fork
      - id: fork-block
