traits:
  - id: nodeunit-exports-modulepaths
    desc: Nodeunit exports.modulePaths
    crit: inert
    for: [javascript]
    if:
      type: ast
      language: javascript
      query: |
        (assignment_expression
          left: (member_expression
            object: (identifier) @exp
            property: (property_identifier) @mp
          )
          right: (function_expression)
        )
        (#eq? @exp "exports")
        (#eq? @mp "modulePaths")

  - id: nodeunit-exports-sandbox
    desc: Nodeunit exports.sandbox
    crit: inert
    for: [javascript]
    if:
      type: ast
      language: javascript
      query: |
        (assignment_expression
          left: (member_expression
            object: (identifier) @exp
            property: (property_identifier) @sb
          )
          right: (function_expression)
        )
        (#eq? @exp "exports")
        (#eq? @sb "sandbox")

  - id: nodeunit-exports-httputil
    desc: Nodeunit exports.httputil
    crit: inert
    for: [javascript]
    if:
      type: ast
      language: javascript
      query: |
        (assignment_expression
          left: (member_expression
            object: (identifier) @exp
            property: (property_identifier) @hu
          )
          right: (function_expression)
        )
        (#eq? @exp "exports")
        (#eq? @hu "httputil")

  - id: nodeunit-exports-bettererrors
    desc: Nodeunit exports.betterErrors
    crit: inert
    for: [javascript]
    if:
      type: ast
      language: javascript
      query: |
        (assignment_expression
          left: (member_expression
            object: (identifier) @exp
            property: (property_identifier) @be
          )
          right: (function_expression)
        )
        (#eq? @exp "exports")
        (#eq? @be "betterErrors")

  - id: nodeunit-require
    desc: Requires nodeunit library
    crit: inert
    for: [javascript]
    if:
      type: raw
      regex: "require\\(['\"]([^'\"]{1,120}/)?nodeunit(/[^'\"]{1,120})?['\"]\\)"

composite_rules:
  - id: nodeunit
    desc: Nodeunit test framework
    crit: notable
    for: [javascript]
    any:
      - id: nodeunit-exports-modulepaths
      - id: nodeunit-exports-sandbox
      - id: nodeunit-exports-httputil
      - id: nodeunit-exports-bettererrors
      - id: nodeunit-require