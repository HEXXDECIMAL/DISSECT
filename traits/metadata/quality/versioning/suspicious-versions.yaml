# Suspicious Version Numbers
# GuardDog-inspired: Detects fake, placeholder, or suspicious version numbers
# ATT&CK: T1195.002 (Compromise Software Supply Chain)

defaults:
  for: [all]
  crit: notable
  conf: 0.80
  attack: "T1195.002"

traits:
  # === GuardDog: Release Zero Detection ===

  # npm - Version 0.0.0 or 0.0
  - id: npm-version-0-0-0
    desc: npm package version is 0.0.0
    crit: suspicious
    conf: 0.85
    for: [package.json]
    if:
      type: kv
      path: "version"
      regex: "^0\\.0(\\.0)?$"

  # PyPI - Version 0.0.0 or 0.0
  - id: pypi-version-zero
    desc: PyPI package version is 0.0.0 or 0.0
    crit: suspicious
    conf: 0.85
    for: [python]
    if:
      type: string
      regex: 'version\s*=\s*[''"]0\.0(\.0)?[''"]'

  # RubyGems - Version 0.0.0 or 0.0
  - id: gem-version-zero
    desc: RubyGem version is 0.0.0 or 0.0
    crit: suspicious
    conf: 0.85
    for: [ruby]
    if:
      type: string
      regex: '\.version\s*=\s*[''"]0\.0(\.0)?[''"]'

  # === Fake/Test Versions ===

  # Version 99.99.99 (common test version)
  - id: npm-version-99-99-99
    desc: npm package version is 99.99.99
    crit: suspicious
    conf: 0.90
    for: [package.json]
    if:
      type: kv
      path: "version"
      exact: "99.99.99"

  # Version 9999.x.x (extremely inflated)
  - id: npm-version-9999
    desc: npm package version starts with 9999
    crit: suspicious
    conf: 0.90
    for: [package.json]
    if:
      type: kv
      path: "version"
      regex: "^9999\\."

  # Version 999.x.x (inflated)
  - id: npm-version-999
    desc: npm package version starts with 999
    crit: suspicious
    conf: 0.85
    for: [package.json]
    if:
      type: kv
      path: "version"
      regex: "^999\\."

  # === Placeholder Versions ===

  # Version 1.0.0-test, 1.0.0-dev, etc.
  - id: npm-version-test-suffix-a
    desc: npm version has test/dev suffix (set A)
    crit: notable
    conf: 0.75
    for: [package.json]
    if:
      type: kv
      path: "version"
      regex: "-(test|dev|debug|local)$"
      case_insensitive: true

  - id: npm-version-test-suffix-b
    desc: npm version has test/dev suffix (set B)
    crit: notable
    conf: 0.75
    for: [package.json]
    if:
      type: kv
      path: "version"
      regex: "-(temp|tmp|placeholder)$"
      case_insensitive: true

  # === Suspicious Patterns ===

  # Version with many zeros (0.0.0.0.0)
  - id: npm-version-many-zeros
    desc: npm package version has many zeros
    crit: suspicious
    conf: 0.85
    for: [package.json]
    if:
      type: kv
      path: "version"
      regex: "^0(\\.0){3,}$"

  # Version 1.0.0 exactly (very common for malicious packages)
  - id: npm-version-exactly-1-0-0
    desc: npm package version is exactly 1.0.0
    crit: notable
    conf: 0.60
    for: [package.json]
    if:
      type: kv
      path: "version"
      exact: "1.0.0"

  # Version with suspicious major number (>= 90)
  - id: npm-version-inflated-major
    desc: npm package version has inflated major number
    crit: suspicious
    conf: 0.85
    for: [package.json]
    if:
      type: kv
      path: "version"
      regex: "^9[0-9]\\.[0-9]+\\.[0-9]+"

  # === PyPI Specific ===

  # PyPI placeholder versions
  - id: pypi-version-placeholder
    desc: PyPI package has placeholder version
    crit: suspicious
    conf: 0.85
    for: [python]
    if:
      type: string
      regex: 'version\s*=\s*[''"]9+\.9+\.9+[''"]'

  # === RubyGems Specific ===

  # Gem placeholder versions
  - id: gem-version-placeholder
    desc: RubyGem has placeholder version
    crit: suspicious
    conf: 0.85
    for: [ruby]
    if:
      type: string
      regex: '\.version\s*=\s*[''"]9+\.9+\.9+[''"]'

composite_rules:
  # === GuardDog: Release Zero (any ecosystem) ===
  - id: release-zero
    desc: Package version is 0.0.0 (placeholder)
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    any:
      - id: npm-version-0-0-0
      - id: pypi-version-zero
      - id: gem-version-zero

  # === Test/Development Versions ===
  - id: npm-version-test-suffix
    desc: npm package version has test/dev suffix
    any:
      - id: npm-version-test-suffix-a
      - id: npm-version-test-suffix-b

  # === Fake/Inflated Versions ===
  - id: fake-version-number
    desc: Package has fake or inflated version number
    crit: suspicious
    conf: 0.90
    attack: "T1195.002"
    any:
      - id: npm-version-99-99-99
      - id: npm-version-9999
      - id: npm-version-999
      - id: npm-version-many-zeros
      - id: pypi-version-placeholder
      - id: gem-version-placeholder

  # === Suspicious Version Patterns ===
  - id: suspicious-version-patterns
    desc: Package has suspicious version patterns
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    any:
      - id: release-zero
      - id: fake-version-number
      - id: npm-version-inflated-major

  # === High-Risk: Zero version with install hooks ===
  - id: release-zero-with-hooks
    desc: Version 0.0.0 package with install hooks
    crit: hostile
    conf: 0.95
    attack: "T1195.002"
    for: [package.json]
    all:
      - id: npm-version-0-0-0
      - id: objectives/lateral-movement/supply-chain/npm/metadata::install-hooks
