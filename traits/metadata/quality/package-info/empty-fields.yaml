# Package Information - Empty Fields
# GuardDog-inspired: Detects packages with missing critical metadata
# ATT&CK: T1195.002 (Compromise Software Supply Chain)

defaults:
  crit: notable
  conf: 0.80

traits:
  # === npm package.json ===

  # GuardDog: Empty description
  - id: npm-empty-description
    desc: npm package has empty description
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [package.json]
    if:
      type: kv
      path: "description"
      exact: ""

  - id: npm-no-description
    desc: npm package missing description field
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [package.json]
    if:
      type: kv
      path: "description"
      exists: false

  # GuardDog: Empty author
  - id: npm-empty-author
    desc: npm package has empty author
    crit: notable
    conf: 0.75
    for: [package.json]
    if:
      type: kv
      path: "author"
      exact: ""

  - id: npm-no-author
    desc: npm package missing author field
    crit: notable
    conf: 0.75
    for: [package.json]
    if:
      type: kv
      path: "author"
      exists: false

  # License field
  - id: npm-empty-license
    desc: npm package has empty license
    crit: notable
    conf: 0.70
    for: [package.json]
    if:
      type: kv
      path: "license"
      exact: ""

  - id: npm-no-license
    desc: npm package missing license field
    crit: notable
    conf: 0.70
    for: [package.json]
    if:
      type: kv
      path: "license"
      exists: false

  # Homepage field
  - id: npm-empty-homepage
    desc: npm package has empty homepage
    crit: notable
    conf: 0.60
    for: [package.json]
    if:
      type: kv
      path: "homepage"
      exact: ""

  # Keywords field
  - id: npm-no-keywords
    desc: npm package has no keywords
    crit: notable
    conf: 0.50
    for: [package.json]
    if:
      type: kv
      path: "keywords"
      exists: false

  # === PyPI setup.py / PKG-INFO ===

  # GuardDog: Empty description (PyPI)
  - id: pypi-empty-description
    desc: PyPI package has empty description
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [python]
    if:
      type: string
      regex: 'description\s*=\s*[''"]\s*[''"]'

  - id: pypi-empty-summary
    desc: PyPI package has empty summary
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [python]
    if:
      type: string
      regex: 'summary\s*=\s*[''"]\s*[''"]'

  # GuardDog: Empty author
  - id: pypi-empty-author
    desc: PyPI package has empty author
    crit: notable
    conf: 0.75
    for: [python]
    if:
      type: string
      regex: 'author\s*=\s*[''"]\s*[''"]'

  - id: pypi-empty-author-email
    desc: PyPI package has empty author_email
    crit: notable
    conf: 0.75
    for: [python]
    if:
      type: string
      regex: 'author_email\s*=\s*[''"]\s*[''"]'

  # License
  - id: pypi-empty-license
    desc: PyPI package has empty license
    crit: notable
    conf: 0.70
    for: [python]
    if:
      type: string
      regex: 'license\s*=\s*[''"]\s*[''"]'

  # URL
  - id: pypi-empty-url
    desc: PyPI package has empty url
    crit: notable
    conf: 0.65
    for: [python]
    if:
      type: string
      regex: 'url\s*=\s*[''"]\s*[''"]'

  # === RubyGems gemspec ===

  # GuardDog: Empty description
  - id: gem-empty-description
    desc: RubyGem has empty description
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [ruby]
    if:
      type: string
      regex: '\.description\s*=\s*[''"]\s*[''"]'

  - id: gem-empty-summary
    desc: RubyGem has empty summary
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [ruby]
    if:
      type: string
      regex: '\.summary\s*=\s*[''"]\s*[''"]'

  # Author
  - id: gem-empty-author
    desc: RubyGem has empty author
    crit: notable
    conf: 0.75
    for: [ruby]
    if:
      type: string
      regex: '\.author\s*=\s*[''"]\s*[''"]'

  # Email
  - id: gem-empty-email
    desc: RubyGem has empty email
    crit: notable
    conf: 0.75
    for: [ruby]
    if:
      type: string
      regex: '\.email\s*=\s*[''"]\s*[''"]'

  # License
  - id: gem-empty-license
    desc: RubyGem has empty license
    crit: notable
    conf: 0.70
    for: [ruby]
    if:
      type: string
      regex: '\.license\s*=\s*[''"]\s*[''"]'

  # Homepage
  - id: gem-empty-homepage
    desc: RubyGem has empty homepage
    crit: notable
    conf: 0.65
    for: [ruby]
    if:
      type: string
      regex: '\.homepage\s*=\s*[''"]\s*[''"]'

composite_rules:
  # === npm Composites ===

  # GuardDog: Empty description (any variant)
  - id: npm-empty-description-any
    desc: npm package has empty or missing description
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [package.json]
    any:
      - id: npm-empty-description
      - id: npm-no-description

  # GuardDog: Critical metadata missing
  - id: npm-critical-metadata-missing
    desc: npm package missing critical metadata
    crit: hostile
    conf: 0.90
    attack: "T1195.002"
    for: [package.json]
    needs: 2
    any:
      - id: npm-empty-description-any
      - id: npm-empty-author
      - id: npm-no-author
      - id: npm-empty-license
      - id: npm-no-license

  # Low-quality package (many empty fields)
  - id: npm-low-quality-metadata
    desc: npm package with incomplete metadata
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [package.json]
    needs: 3
    any:
      - id: npm-empty-description-any
      - id: npm-empty-author
      - id: npm-no-author
      - id: npm-empty-license
      - id: npm-no-license
      - id: npm-empty-homepage
      - id: npm-no-keywords

  # === PyPI Composites ===

  # GuardDog: Empty PyPI info
  - id: pypi-empty-info
    desc: PyPI package with empty metadata
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [python]
    needs: 2
    any:
      - id: pypi-empty-description
      - id: pypi-empty-summary
      - id: pypi-empty-author
      - id: pypi-empty-author-email
      - id: pypi-empty-license

  # === RubyGems Composites ===

  # GuardDog: Empty gem info
  - id: gem-empty-info
    desc: RubyGem with empty metadata
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [ruby]
    needs: 2
    any:
      - id: gem-empty-description
      - id: gem-empty-summary
      - id: gem-empty-author
      - id: gem-empty-email
      - id: gem-empty-license
