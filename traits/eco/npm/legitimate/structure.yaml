# Legitimate npm Package Structure Patterns
# These patterns are typically PRESENT in legitimate packages and ABSENT in malware
# Useful for differential ML analysis

traits:
  # Has test script defined
  - id: eco/npm/legitimate/has-test-script
    description: Package has test script (legitimate pattern)
    criticality: inert
    confidence: 0.9
    file_types: [packagejson]
    condition:
      type: string
      regex: '"test":\\s*"[^"]*(?:jest|mocha|ava|tap|vitest|node --test|npm test)'

  # Has TypeScript configuration
  - id: eco/npm/legitimate/has-typescript
    description: Package has TypeScript support
    criticality: inert
    confidence: 0.9
    file_types: [packagejson]
    condition:
      type: string
      regex: '"typescript"|"@types/|"\\.d\\.ts"|"tsconfig"'

  # Has build script
  - id: eco/npm/legitimate/has-build-script
    description: Package has build script (compiled package)
    criticality: inert
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: string
      regex: '"build":\\s*"[^"]*(?:tsc|rollup|webpack|esbuild|babel|vite)'

  # Has lint script
  - id: eco/npm/legitimate/has-lint-script
    description: Package has linting configured
    criticality: inert
    confidence: 0.9
    file_types: [packagejson]
    condition:
      type: string
      regex: '"lint":\\s*"|"eslint"|"prettier"|"biome"'

  # Has prepublishOnly (good practice)
  - id: eco/npm/legitimate/has-prepublish-only
    description: Package has prepublishOnly script (publish safety)
    criticality: inert
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: string
      exact: '"prepublishOnly":'

  # Has repository field
  - id: eco/npm/legitimate/has-repository
    description: Package has repository URL
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      regex: '"repository":\\s*\\{|"repository":\\s*"'

  # Has proper author with email
  - id: eco/npm/legitimate/has-author-email
    description: Package has author with email address
    criticality: inert
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: string
      regex: '"author":\\s*"[^"]*@[^"]*"|"email":\\s*"[^"]*@'

  # Has license field
  - id: eco/npm/legitimate/has-license
    description: Package has license field
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      regex: '"license":\\s*"(?:MIT|ISC|Apache|BSD|GPL|LGPL|MPL|Unlicense)'

  # Has keywords
  - id: eco/npm/legitimate/has-keywords
    description: Package has keywords array
    criticality: inert
    confidence: 0.75
    file_types: [packagejson]
    condition:
      type: string
      regex: '"keywords":\\s*\\['

  # Has engines field
  - id: eco/npm/legitimate/has-engines
    description: Package specifies Node.js engine version
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      regex: '"engines":\\s*\\{[^}]*"node"'

  # Has exports field (modern ESM)
  - id: eco/npm/legitimate/has-exports-field
    description: Package has modern exports field
    criticality: inert
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: string
      regex: '"exports":\\s*\\{'

  # Has peerDependencies (library pattern)
  - id: eco/npm/legitimate/has-peer-deps
    description: Package has peerDependencies (framework plugin pattern)
    criticality: inert
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: string
      exact: '"peerDependencies":'

  # Has devDependencies (development tooling)
  - id: eco/npm/legitimate/has-dev-deps
    description: Package has devDependencies
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      exact: '"devDependencies":'

  # Uses established test framework
  - id: eco/npm/legitimate/uses-test-framework
    description: Package uses established testing framework
    criticality: inert
    confidence: 0.9
    file_types: [packagejson]
    condition:
      type: string
      regex: '"jest"|"mocha"|"ava"|"vitest"|"@testing-library|"chai"|"sinon"|"tap"'

  # Has files field (explicit inclusion)
  - id: eco/npm/legitimate/has-files-field
    description: Package explicitly lists published files
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      regex: '"files":\\s*\\['

  # Mature version (not 0.0.1 or 1.0.0)
  - id: eco/npm/legitimate/mature-version
    description: Package has mature version number
    criticality: inert
    confidence: 0.7
    file_types: [packagejson]
    condition:
      type: string
      regex: '"version":\\s*"[1-9]\\.[1-9]|"version":\\s*"[0-9]+\\.[1-9]+\\.[1-9]'

  # Has meaningful description (> 20 chars)
  - id: eco/npm/legitimate/has-description
    description: Package has meaningful description
    criticality: inert
    confidence: 0.75
    file_types: [packagejson]
    condition:
      type: string
      regex: '"description":\\s*"[^"]{20,}"'

  # Has bin field (CLI tool)
  - id: eco/npm/legitimate/has-bin-field
    description: Package provides CLI binary
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      regex: '"bin":\\s*\\{|"bin":\\s*"'

  # Has funding field
  - id: eco/npm/legitimate/has-funding
    description: Package has funding information
    criticality: inert
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: string
      exact: '"funding":'

  # Has bugs/issues URL
  - id: eco/npm/legitimate/has-bugs-url
    description: Package has bugs/issues URL
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      regex: '"bugs":\\s*\\{|"bugs":\\s*"http'

  # Has homepage
  - id: eco/npm/legitimate/has-homepage
    description: Package has homepage URL
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      regex: '"homepage":\\s*"https?://'

  # Has contributors
  - id: eco/npm/legitimate/has-contributors
    description: Package has contributors list
    criticality: inert
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: string
      exact: '"contributors":'

  # Has workspaces (monorepo)
  - id: eco/npm/legitimate/has-workspaces
    description: Package uses workspaces (monorepo pattern)
    criticality: inert
    confidence: 0.9
    file_types: [packagejson]
    condition:
      type: string
      exact: '"workspaces":'

  # Has private field
  - id: eco/npm/legitimate/is-private
    description: Package marked as private
    criticality: inert
    confidence: 0.8
    file_types: [packagejson]
    condition:
      type: string
      exact: '"private": true'

  # Uses semantic versioning dependencies
  - id: eco/npm/legitimate/semver-deps
    description: Uses semantic versioning for dependencies
    criticality: inert
    confidence: 0.75
    file_types: [packagejson]
    condition:
      type: string
      regex: '"dependencies":\\s*\\{[^}]*"\\^[0-9]|"~[0-9]'

  # Has publishConfig
  - id: eco/npm/legitimate/has-publish-config
    description: Has publish configuration
    criticality: inert
    confidence: 0.85
    file_types: [packagejson]
    condition:
      type: string
      exact: '"publishConfig":'
