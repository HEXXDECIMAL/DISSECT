# .NET Database Access Patterns
# Detected via string matching in compiled assemblies

traits:
  # === SQL connection atomic indicators ===
  - id: sql-connection-class
    desc: SqlConnection class
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "SqlConnection"

  - id: db-connection-class
    desc: DbConnection class
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "DbConnection"

  - id: oledb-connection-class
    desc: OleDbConnection class
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "OleDbConnection"

  - id: odbc-connection-class
    desc: OdbcConnection class
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "OdbcConnection"

  # === SQL command atomic indicators ===
  - id: execute-nonquery
    desc: ExecuteNonQuery method
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "ExecuteNonQuery"

  - id: execute-scalar
    desc: ExecuteScalar method
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "ExecuteScalar"

  - id: execute-reader
    desc: ExecuteReader method
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "ExecuteReader"

  - id: sql-command-class
    desc: SqlCommand class
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "SqlCommand"

  - id: db-command-class
    desc: DbCommand class
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "DbCommand"

  # === Connection string atomic indicators ===
  - id: connection-string-singular
    desc: ConnectionString property
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "ConnectionString"

  - id: connection-strings-plural
    desc: ConnectionStrings property
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "ConnectionStrings"

  # === SQL parameter atomic indicators ===
  - id: sql-parameter-class
    desc: SqlParameter class
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: "SqlParameter"

  - id: db-parameter-class
    desc: DbParameter class
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: "DbParameter"

  - id: add-with-value
    desc: AddWithValue method
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: "AddWithValue"

  # === Data adapter atomic indicators ===
  - id: sql-data-adapter-class
    desc: SqlDataAdapter class
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: "SqlDataAdapter"

  - id: data-adapter-class
    desc: DataAdapter class
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: "DataAdapter"

  - id: fill-method
    desc: Fill method
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "Fill\\("

composite_rules:
  # SQL connection composite
  - id: sql-connection
    desc: SQL database connection capability
    crit: notable
    conf: 0.85
    count_min: 1
    any:
      - id: sql-connection-class
      - id: db-connection-class
      - id: oledb-connection-class
      - id: odbc-connection-class

  # SQL command composite
  - id: sql-command
    desc: SQL command execution
    crit: notable
    conf: 0.85
    count_min: 1
    any:
      - id: execute-nonquery
      - id: execute-scalar
      - id: execute-reader
      - id: sql-command-class
      - id: db-command-class

  # Connection string composite
  - id: connection-string
    desc: Database connection string handling
    crit: notable
    conf: 0.80
    count_min: 1
    any:
      - id: connection-string-singular
      - id: connection-strings-plural

  # SQL parameter composite
  - id: sql-parameter
    desc: Parameterized SQL queries (good practice)
    crit: notable
    conf: 0.75
    count_min: 1
    any:
      - id: sql-parameter-class
      - id: db-parameter-class
      - id: add-with-value

  # Data adapter composite
  - id: data-adapter
    desc: ADO.NET data adapter usage
    crit: notable
    conf: 0.75
    count_min: 1
    any:
      - id: sql-data-adapter-class
      - id: data-adapter-class
      - id: fill-method
