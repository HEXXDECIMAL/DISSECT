# IP Address Parsing
# MBC: C0001 (Socket Communication)
# ATT&CK: T1071

defaults:
  for: [elf, macho, so, dylib, c]

traits:
  - id: inet-pton-symbol
    desc: Parse IP with inet_pton
    crit: inert
    conf: 0.66
    if:
      type: symbol
      exact: inet_pton

  - id: inet-ntop-symbol
    desc: Parse IP with inet_ntop
    crit: inert
    conf: 0.66
    if:
      type: symbol
      exact: inet_ntop

  - id: inet-addr-symbol
    desc: Parse IP with inet_addr
    crit: inert
    conf: 0.66
    if:
      type: symbol
      exact: inet_addr

  - id: inet-aton-symbol
    desc: Parse IP with inet_aton
    crit: inert
    conf: 0.66
    if:
      type: symbol
      exact: inet_aton

  - id: parse-string
    desc: IP address string patterns
    crit: inert
    conf: 0.66
    if:
      type: string
      regex: "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}"

  - id: htons-symbol
    desc: Converts host to network short
    crit: inert
    conf: 0.66
    if:
      type: symbol
      exact: htons

  - id: htonl-symbol
    desc: Converts host to network long
    crit: inert
    conf: 0.66
    if:
      type: symbol
      exact: htonl

  - id: ntohs-symbol
    desc: Converts network to host short
    crit: inert
    conf: 0.66
    if:
      type: symbol
      exact: ntohs

  - id: ntohl-symbol
    desc: Converts network to host long
    crit: inert
    conf: 0.66
    if:
      type: symbol
      exact: ntohl

composite_rules:
  - id: parse
    desc: Parse IP addresses
    crit: inert
    conf: 0.66
    any:
      - id: inet-pton-symbol
      - id: inet-ntop-symbol
      - id: inet-addr-symbol
      - id: inet-aton-symbol

  - id: byte-order
    desc: Network byte order conversion
    crit: inert
    conf: 0.66
    any:
      - id: htons-symbol
      - id: htonl-symbol
      - id: ntohs-symbol
      - id: ntohl-symbol
