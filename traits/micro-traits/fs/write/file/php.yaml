# PHP Filesystem Write Traits
# MBC: C0052 (Write File)
# ATT&CK: T1105 (Ingress Tool Transfer)

traits:
  - id: file-put-contents
    desc: File write via file_put_contents
    crit: notable
    conf: 0.8
    mbc: "C0052"
    attack: "T1105"
    for: [php]
    if:
      type: string
      substr: file_put_contents

  - id: fwrite
    desc: File write via fwrite
    crit: notable
    conf: 0.8
    mbc: "C0052"
    for: [php]
    if:
      type: string
      regex: "\\bfwrite\\s*\\("

  - id: fputs
    desc: File write via fputs
    crit: notable
    conf: 0.8
    mbc: "C0052"
    for: [php]
    if:
      type: string
      regex: "\\bfputs\\s*\\("

  - id: dropper-pattern
    desc: File dropper pattern (base64 decode
    crit: suspicious
    conf: 0.95
    mbc: "B0030"
    attack: "T1105"
    for: [php]
    if:
      type: string
      regex: "file_put_contents\\s*\\([^,]{1,120},\\s*base64_decode"

  - id: move-uploaded-file
    desc: Move uploaded file to destination
    crit: suspicious
    conf: 0.85
    mbc: "C0052"
    attack: "T1105"
    for: [php]
    if:
      type: string
      substr: move_uploaded_file
