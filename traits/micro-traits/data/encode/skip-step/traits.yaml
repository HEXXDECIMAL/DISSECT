traits:
- id: js-concat-chain
  desc: JavaScript massive string concatenation chain
  crit: suspicious
  conf: 0.7
  for:
  - javascript
  - typescript
  if:
    type: raw
    regex: =\s*(?:[\w"'\.]+\s*\+\s*){5,}
- id: js-loop-string-concat
  desc: String concatenation in loop body using array
  crit: notable
  conf: 0.6
  for:
  - javascript
  - typescript
  if:
    type: raw
    regex: '[\w$]+\s*=\s*[\w$]+\s*\+\s*[\w$]+\s*\[[^\]]{1,120}\]'
- id: js-loop-string-plus-equals
  desc: += string concatenation from array access
  crit: notable
  conf: 0.6
  for:
  - javascript
  - typescript
  if:
    type: raw
    regex: '[\w$]+\s*\+=\s*[\w$]+\s*\[[^\]]{1,120}\]'
- id: js-skip-step-loop
  desc: JavaScript loop with non-standard increment (skip-step)
  crit: notable
  conf: 0.8
  for:
  - javascript
  - typescript
  if:
    type: raw
    regex: 'for\s*\([^;]{1,120};[^;]{1,120};\s*[\w$]+\s*\+=\s*[3-9]\)'
- id: js-skip-step-loop-large
  desc: JavaScript loop with large numeric increment
  crit: notable
  conf: 0.8
  for:
  - javascript
  - typescript
  if:
    type: raw
    regex: 'for\s*\([^;]{1,120};[^;]{1,120};\s*[\w$]+\s*\+=\s*[1-9]\d+\)'
- id: js-skip-step-loop-variable
  desc: JavaScript loop with variable increment
  crit: notable
  conf: 0.8
  for:
  - javascript
  - typescript
  if:
    type: raw
    regex: 'for\s*\([^;]{1,120};[^;]{1,120};\s*[\w$]+\s*\+=\s*[a-zA-Z_$][\w$]*\)'
composite_rules:
- id: js-loop-string-concat-any
  desc: String concatenation in loop body using array
  crit: notable
  conf: 0.6
  any:
  - id: js-loop-string-concat
  - id: js-loop-string-plus-equals
- id: js-skip-step-loop-any
  desc: JavaScript loop with non-standard increment (skip-step)
  crit: notable
  conf: 0.8
  any:
  - id: js-skip-step-loop
  - id: js-skip-step-loop-large
  - id: js-skip-step-loop-variable
