defaults:
  for: [javascript, typescript]

traits:
  - id: tostring-base64
    desc: Base64 encoding via toString
    crit: inert
    conf: 0.8
    if:
      type: ast
      language: javascript
      query: |
        (call_expression
          function: (member_expression
            property: (property_identifier) @tostr
          )
          arguments: (arguments
            (string) @enc
          )
          (#eq? @tostr "toString")
          (#match? @enc "base64")
        )

  - id: buffer-from-base64
    desc: Base64 decoding/usage via Buffer.from
    crit: inert
    conf: 0.8
    if:
      type: ast
      language: javascript
      query: |
        (call_expression
          function: (member_expression
            object: (identifier) @buf
            property: (property_identifier) @from
          )
          arguments: (arguments
            (_)
            (string) @enc
          )
          (#eq? @buf "Buffer")
          (#eq? @from "from")
          (#match? @enc "base64")
        )

