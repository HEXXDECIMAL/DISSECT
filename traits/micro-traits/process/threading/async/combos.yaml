# Process Threading Patterns
# Local thread-based execution (not cross-process injection)
# Example: Chrysalis loader2 thread coordination

composite_rules:
  # === Thread Message Queue ===
  - id: thread-message-sync
    desc: Thread synchronization via message queue
    crit: notable
    conf: 0.80
    for: ["pe", "dll"]
    all:
      - id: micro-traits/process/thread/create::create-thread
      - id: micro-traits/os/message/queue::peek-message-a

  # === Threaded Worker Pool ===
  - id: worker-pool
    desc: Worker threads with synchronization
    crit: notable
    conf: 0.75
    for: ["pe", "dll"]
    all:
      - id: micro-traits/process/thread/create::create-thread
      - id: micro-traits/mem/protect/modify::virtual-alloc
      - id: micro-traits/os/exception/handler::capture-context

  # === Background Executor ===
  - id: background-execution
    desc: Background thread with exception handling
    crit: notable
    conf: 0.80
    for: ["pe", "dll"]
    all:
      - id: micro-traits/process/thread/create::create-thread
      - id: micro-traits/os/exception/register::rtl-add-function-table
      - id: micro-traits/os/exception/handler::virtual-unwind
