defaults:
  for: [all]

traits:
  - id: process-fork
    desc: Process forking syscall (fork, vfork, clone)
    crit: notable
    conf: 0.7
    if:
      type: syscall
      name: ["fork", "vfork", "clone"]

  - id: process-fork-macos
    desc: Process forking syscall on macOS
    crit: notable
    conf: 0.7
    if:
      type: syscall
      name: ["fork"]

  - id: process-setsid
    desc: Create new session and become session leader
    crit: notable
    conf: 0.7
    if:
      type: syscall
      name: ["setsid"]

  - id: fd-redirect-multiple
    desc: Multiple file descriptor redirections
    crit: notable
    conf: 0.7
    if:
      type: syscall
      name: ["dup2", "dup3"]
      count_min: 2

  - id: fd-redirect-macos
    desc: File descriptor redirection on macOS
    crit: notable
    conf: 0.7
    if:
      type: syscall
      name: ["dup2"]
      count_min: 2

composite_rules:
  - id: daemon
    desc: Daemon behavior - detaches from terminal
    conf: 0.85
    crit: notable
    platforms: [linux]
    for: [elf]
    all:
      - id: process-fork
      - id: process-setsid

  - id: daemon-full
    desc: Full daemon pattern with stdin/stdout
    conf: 0.9
    crit: notable
    platforms: [linux]
    for: [elf]
    all:
      - id: process-fork
      - id: process-setsid
      - id: fd-redirect-multiple

  - id: daemon-macos
    desc: macOS daemon behavior - detaches from terminal
    conf: 0.85
    crit: notable
    platforms: [macos]
    for: [macho]
    all:
      - id: process-fork-macos
      - id: process-setsid

  - id: daemon-macos-full
    desc: Full macOS daemon pattern with FD redirection
    conf: 0.9
    crit: notable
    platforms: [macos]
    for: [macho]
    all:
      - id: process-fork-macos
      - id: process-setsid
      - id: fd-redirect-macos
