# Downloaded Script Execution
# Detects patterns where scripts are downloaded and executed
# ATT&CK: T1059 (Command and Scripting Interpreter)

traits:
  - id: exec/script/download/perl-execute
    description: Perl script execution
    criticality: notable
    confidence: 0.75
    mbc: "C0059"
    attack: "T1059.006"
    file_types: [all]
    condition:
      type: string
      regex: "perl\\s+[/\\w.-]+"
      search_raw: true

  - id: exec/script/download/python-execute
    description: Python script execution
    criticality: notable
    confidence: 0.7
    mbc: "C0059"
    attack: "T1059.006"
    file_types: [all]
    condition:
      type: string
      regex: "python[23]?\\s+[/\\w.-]+"
      search_raw: true

  - id: exec/script/download/ruby-execute
    description: Ruby script execution
    criticality: notable
    confidence: 0.7
    mbc: "C0059"
    attack: "T1059.005"
    file_types: [all]
    condition:
      type: string
      regex: "ruby\\s+[/\\w.-]+"
      search_raw: true

  - id: exec/script/download/node-execute
    description: Node.js script execution
    criticality: notable
    confidence: 0.7
    mbc: "C0059"
    attack: "T1059.007"
    file_types: [all]
    condition:
      type: string
      regex: "node\\s+[/\\w.-]+"
      search_raw: true

  - id: exec/script/download/sh-execute
    description: Shell script execution
    criticality: notable
    confidence: 0.7
    mbc: "C0059"
    attack: "T1059.004"
    file_types: [all]
    condition:
      type: string
      regex: "(sh|bash|zsh)\\s+[/\\w.-]+"
      search_raw: true

  - id: exec/script/download/pipe-to-shell
    description: Pipe to shell execution (very suspicious)
    criticality: suspicious
    confidence: 0.95
    mbc: "B0024"
    attack: "T1059.004"
    # Exclude JS - syntax highlighters have keyword lists with |bash that trigger false positives
    file_types: [shell, elf, macho, pe]
    condition:
      type: string
      regex: "\\|\\s*(sh|bash|zsh|perl|python|ruby|node)"
      search_raw: true

  - id: exec/script/download/download-pipe-execute
    description: Download and pipe to interpreter
    criticality: suspicious
    confidence: 0.95
    mbc: "B0024"
    attack: "T1059"
    # Exclude JS - syntax highlighters have keyword lists that trigger false positives
    file_types: [shell, elf, macho, pe]
    condition:
      type: string
      regex: "(curl|wget).*(\\||&&).*(sh|bash|perl|python|ruby|node)"
      search_raw: true
