# Stealth execution patterns (output hiding, process detachment)
# MBC: F0003 (Process Detach), F0005 (Hide Output)
# NOTE: os.setsid and preexec_fn= traits are defined in exec/command/setsid/traits.yaml

traits:
  - id: devnull
    description: "subprocess.DEVNULL to hide output"
    criticality: notable
    confidence: 0.75
    mbc: "F0005"
    file_types: [python]
    condition:
      type: string
      exact: "subprocess.DEVNULL"

  - id: close-fds
    description: "close_fds=True for file descriptor isolation"
    criticality: notable
    confidence: 0.7
    file_types: [python]
    condition:
      type: string
      exact: "close_fds=True"

  - id: subprocess-popen
    description: "subprocess.Popen call"
    criticality: notable
    confidence: 0.6
    file_types: [python]
    condition:
      type: string
      regex: "subprocess\\.Popen\\("

composite_rules:
  - id: python
    description: "Process execution with output hiding and detachment"
    confidence: 0.92
    criticality: suspicious
    mbc: "F0003"
    attack: "T1036"
    file_types: [python]
    requires_count: 3
    conditions:
      - type: trait
        id: subprocess-popen
      - type: trait
        id: devnull
      - type: trait
        id: exec/command/setsid/python
      - type: trait
        id: close-fds
      - type: trait
        id: exec/command/setsid/preexec-fn
