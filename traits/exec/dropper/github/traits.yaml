# GitHub blob API dropper (unusual download pattern)
# ATT&CK: T1195.002 (Supply Chain Compromise: Compromise Software Supply Chain)

traits:
  - id: blob-api
    desc: "GitHub blob API download (unusual pattern)"
    crit: suspicious
    conf: 0.85
    if:
      type: string
      regex: "api\\.github\\.com.{0,50}/git/blobs"

  # === Python exec/chmod atomic indicators ===
  - id: python-os-chmod
    desc: "Python os.chmod call"
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "os.chmod("

  - id: python-subprocess-popen
    desc: "Python subprocess.Popen call"
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "subprocess.Popen("

  - id: python-subprocess-run
    desc: "Python subprocess.run call"
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "subprocess.run("

  - id: python-subprocess-call
    desc: "Python subprocess.call call"
    crit: inert
    conf: 0.7
    if:
      type: string
      exact: "subprocess.call("

composite_rules:
  # Python exec/chmod composite
  - id: python-exec-chmod
    desc: "Python subprocess execution or chmod"
    crit: notable
    conf: 0.8
    requires_count: 1
    any:
      - id: python-os-chmod
      - id: python-subprocess-popen
      - id: python-subprocess-run
      - id: python-subprocess-call

  - id: execute
    desc: "Download from GitHub blob API and execute"
    conf: 0.95
    crit: suspicious
    mbc: "B0024"
    attack: "T1195.002"
    requires_all:
      - id: blob-api
      - id: python-exec-chmod
