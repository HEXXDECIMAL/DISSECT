# Stager Detection
# Detects minimal stagers and shellcode wrappers
# ATT&CK: T1105 (Ingress Tool Transfer)

defaults:
  for: [elf]
  crit: hostile
  mbc: "B0024" # Software Stager
  attack: "T1105"

composite_rules:
  # Helper: Network syscalls
  - id: arm-network-syscalls
    desc: ARM direct network syscalls
    crit: suspicious
    any:
      - id: comm/syscall/arm/svc-socket
      - id: comm/syscall/arm/svc-connect

  # Helper: Structural anomalies
  - id: structural-anomalies
    desc: Suspicious binary structure
    crit: suspicious
    any:
      - id: feat/binary/tiny/dominant-text-section
      - id: anti-static/hardening/detection

  - id: tiny-network-stager
    desc: "Tiny network stager"
    crit: hostile
    all:
      - id: feat/binary/tiny/tiny-elf
      - id: arm-network-syscalls
      - id: structural-anomalies

  - id: arm-direct-network-shellcode
    desc: "ARM direct network syscalls"
    crit: suspicious
    count_min: 2
    any:
      - id: comm/syscall/arm/svc-socket
      - id: comm/syscall/arm/svc-connect
