---
# Ruby command execution patterns

traits:
  # POSIX symbols that appear across multiple languages and binaries
  - id: ruby-system
    desc: system() command execution
    crit: notable
    conf: 0.95
    attack: "T1059"
    if:
      type: symbol
      exact: "system"

  - id: ruby-exec
    desc: exec() replaces current process
    crit: notable
    conf: 0.95
    platforms: [all]
    for: [ruby, elf, macho, pe, dll, so, dylib]
    if:
      type: symbol
      regex: "^(_)?exec$"

  - id: ruby-spawn
    desc: spawn() creates new process
    crit: notable
    conf: 0.90
    platforms: [all]
    for: [ruby, elf, macho, pe, dll, so, dylib]
    if:
      type: symbol
      regex: "^(_)?spawn$"

  - id: ruby-popen
    desc: popen pipes to/from command
    crit: notable
    conf: 0.92
    platforms: [all]
    for: [ruby, elf, macho, pe, dll, so, dylib]
    if:
      type: symbol
      regex: "^(_)?(IO\\.)?popen$"

  - id: ruby-backtick
    desc: Backtick command execution
    crit: notable
    conf: 0.93
    platforms: [all]
    for: [ruby]
    if:
      type: symbol
      regex: "`|%x"

  - id: ruby-eval
    desc: eval() dynamic code execution
    crit: notable
    conf: 0.90
    platforms: [all]
    for: [ruby]
    if:
      type: symbol
      regex: "^eval$"

  - id: ruby-instance-eval
    desc: instance_eval dynamic execution
    crit: notable
    conf: 0.93
    platforms: [all]
    for: [ruby]
    if:
      type: symbol
      regex: "instance_eval"

  - id: ruby-class-eval
    desc: class/module_eval dynamic execution
    crit: notable
    conf: 0.93
    platforms: [all]
    for: [ruby]
    if:
      type: symbol
      regex: "(class|module)_eval"

  - id: ruby-shell-exec
    desc: Shell execution via exec
    crit: notable
    conf: 0.85
    platforms: [all]
    for: [ruby]
    if:
      type: string
      regex: 'exec.{0,50}bin/sh|exec.{0,50}bin/bash'
