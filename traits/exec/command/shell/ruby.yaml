---
# Ruby command execution patterns

traits:
  # POSIX symbols that appear across multiple languages and binaries
  - id: ruby-system
    desc: system() command execution
    crit: suspicious
    conf: 0.95
    platforms: [all]
    for: [ruby, elf, macho, pe, dll, so, dylib]
    if:
      type: symbol
      regex: "system"

  - id: ruby-exec
    desc: exec() replaces current process
    crit: suspicious
    conf: 0.95
    platforms: [all]
    for: [ruby, elf, macho, pe, dll, so, dylib]
    if:
      type: symbol
      regex: "exec"

  - id: ruby-spawn
    desc: spawn() creates new process
    crit: notable
    conf: 0.90
    platforms: [all]
    for: [ruby, elf, macho, pe, dll, so, dylib]
    if:
      type: symbol
      regex: "spawn"

  - id: ruby-popen
    desc: popen pipes to/from command
    crit: notable
    conf: 0.92
    platforms: [all]
    for: [ruby, elf, macho, pe, dll, so, dylib]
    if:
      type: symbol
      regex: "(IO\\.)?popen"

  - id: ruby-backtick
    desc: Backtick command execution
    crit: notable
    conf: 0.93
    platforms: [all]
    for: [ruby]
    if:
      type: symbol
      regex: "`|%x"

  - id: ruby-eval
    desc: eval() dynamic code execution
    crit: notable
    conf: 0.90
    platforms: [all]
    for: [ruby]
    if:
      type: symbol
      regex: "^eval$"

  - id: ruby-instance-eval
    desc: instance_eval dynamic execution
    crit: notable
    conf: 0.93
    platforms: [all]
    for: [ruby]
    if:
      type: symbol
      regex: "instance_eval"

  - id: ruby-class-eval
    desc: class/module_eval dynamic execution
    crit: notable
    conf: 0.93
    platforms: [all]
    for: [ruby]
    if:
      type: symbol
      regex: "(class|module)_eval"
