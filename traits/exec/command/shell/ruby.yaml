---
# Ruby command execution patterns
traits:
  - id: ruby-system
    desc: "system() command execution"
    crit: suspicious
    conf: 0.95
    platforms:
      - all
    for:
      - ruby
    if:
      type: symbol_or_string
      any:
        - system(
    requires_all:
      - type: file_type
        for: [ruby]

  - id: ruby-exec
    desc: "exec() replaces current process"
    crit: suspicious
    conf: 0.95
    platforms:
      - all
    for:
      - ruby
    if:
      type: symbol_or_string
      any:
        - exec(
        - exec

  - id: ruby-spawn
    desc: "spawn() creates new process"
    crit: notable
    conf: 0.90
    platforms:
      - all
    for:
      - ruby
    if:
      type: symbol_or_string
      any:
        - spawn(
        - spawn

  - id: ruby-popen
    desc: "popen pipes to/from command"
    crit: notable
    conf: 0.92
    platforms:
      - all
    for:
      - ruby
    if:
      type: symbol_or_string
      any:
        - IO.popen
        - popen

  - id: ruby-backtick
    desc: "Backtick command execution"
    crit: notable
    conf: 0.93
    platforms:
      - all
    for:
      - ruby
    if:
      type: symbol_or_string
      any:
        - "`"
        - "%x"

  - id: ruby-eval
    desc: "eval() dynamic code execution"
    crit: notable
    conf: 0.90
    platforms:
      - all
    for:
      - ruby
    if:
      type: symbol_or_string
      any:
        - eval(
        - eval

  - id: ruby-instance-eval
    desc: "instance_eval dynamic execution"
    crit: notable
    conf: 0.93
    platforms:
      - all
    for:
      - ruby
    if:
      type: symbol_or_string
      any:
        - instance_eval

  - id: ruby-class-eval
    desc: "class/module_eval dynamic execution"
    crit: notable
    conf: 0.93
    platforms:
      - all
    for:
      - ruby
    if:
      type: symbol_or_string
      any:
        - class_eval
        - module_eval
