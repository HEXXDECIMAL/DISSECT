# Command Execution Detection
# MBC: OB0009 (Execution) â†’ E1059 (Command and Scripting Interpreter)
# ATT&CK: T1059 (Command and Scripting Interpreter)

traits:
  # C/C++ - Unix
  - id: c-system
    desc: Executes shell commands via C
    crit: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    conf: 0.9
    language: c
    if:
      type: symbol
      pattern: system
    platforms: [unix, linux, macos]
    for: [pe, elf, macho, dll, so, dylib]

  - id: c-popen
    desc: Executes command and captures output
    crit: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    conf: 0.9
    language: c
    if:
      type: symbol
      pattern: popen
    platforms: [unix, linux, macos]
    for: [pe, elf, macho, dll, so, dylib]

  - id: c-execve
    desc: Executes program directly via C
    crit: notable
    mbc: "E1059"
    attack: "T1059"
    conf: 0.95
    language: c
    if:
      type: symbol
      pattern: execve
    platforms: [unix, linux, macos]
    for: [pe, elf, macho, dll, so, dylib]

  # Windows
  - id: win-createprocess
    desc: Creates new process via Windows
    crit: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    conf: 0.9
    language: c
    if:
      type: symbol
      pattern: CreateProcessA|CreateProcessW
    platforms: [windows]
    for: [pe, dll]

  - id: win-shellexecute
    desc: Executes file or program via
    crit: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    conf: 0.9
    language: c
    if:
      type: symbol
      pattern: ShellExecuteA|ShellExecuteW|ShellExecuteExA|ShellExecuteExW
    platforms: [windows]
    for: [pe, dll]

  # Go
  - id: go-os-exec
    desc: Executes commands via Go os/exec
    crit: notable
    mbc: "E1059"
    attack: "T1059"
    conf: 0.9
    language: go
    if:
      type: string
      exact: '"os/exec"'

  # Python
  - id: python-os-system
    desc: Executes shell commands via Python
    crit: notable
    mbc: "E1059.006"
    attack: "T1059.006"
    conf: 0.95
    language: python
    if:
      type: string
      regex: "os\\.system\\("

  # JavaScript
  - id: js-child-process
    desc: Executes commands via Node.js child_process
    crit: notable
    mbc: "E1059"
    attack: "T1059"
    conf: 0.9
    language: javascript
    if:
      type: string
      regex: "require\\(['\"]child_process['\"]\\)|from ['\"]child_process['\"]"

  # Ruby
  - id: ruby-system
    desc: Executes commands via Ruby system()
    crit: notable
    mbc: "E1059"
    attack: "T1059"
    conf: 0.9
    language: ruby
    if:
      type: string
      regex: "\\bsystem\\(['\"]"

  # Rust
  - id: rust-command
    desc: Executes process via Rust std::process::Command
    crit: notable
    mbc: "E1059"
    attack: "T1059"
    conf: 0.9
    language: rust
    if:
      type: string
      regex: "use std::process::Command|Command::new"

  # Shell references
  - id: bin-sh
    desc: References /bin/sh (Bourne shell)
    crit: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    conf: 0.6
    if:
      type: string
      exact: "/bin/sh"
    platforms: [unix, linux, macos]
    for: [pe, elf, macho, dll, so, dylib]

  - id: bin-bash
    desc: References /bin/bash (Bash shell)
    crit: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    conf: 0.6
    if:
      type: string
      exact: "/bin/bash"
    platforms: [unix, linux, macos]
    for: [pe, elf, macho, dll, so, dylib]

  - id: cmd-exe
    desc: References cmd.exe (Windows Command Prompt)
    crit: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    conf: 0.6
    if:
      type: string
      regex: "cmd\\.exe|cmd /c"
      case_insensitive: true
    platforms: [windows]
