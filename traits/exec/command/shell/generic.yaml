# Command Execution Detection
# MBC: OB0009 (Execution) â†’ E1059 (Command and Scripting Interpreter)
# ATT&CK: T1059 (Command and Scripting Interpreter)

traits:
  # C/C++ - Unix
  - id: exec/command/shell/c-system
    description: Executes shell commands via C system()
    criticality: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    confidence: 0.9
    language: c
    condition:
      type: symbol
      pattern: system
    platforms: [unix, linux, macos]
    file_types: [pe, elf, macho, dll, so, dylib]

  - id: exec/command/shell/c-popen
    description: Executes command and captures output via C popen()
    criticality: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    confidence: 0.9
    language: c
    condition:
      type: symbol
      pattern: popen
    platforms: [unix, linux, macos]
    file_types: [pe, elf, macho, dll, so, dylib]

  - id: exec/command/shell/c-execve
    description: Executes program directly via C execve()
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.95
    language: c
    condition:
      type: symbol
      pattern: execve
    platforms: [unix, linux, macos]
    file_types: [pe, elf, macho, dll, so, dylib]

  # Windows
  - id: exec/command/shell/win-createprocess
    description: Creates new process via Windows CreateProcess API
    criticality: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    confidence: 0.9
    language: c
    condition:
      type: symbol
      pattern: CreateProcessA|CreateProcessW
    platforms: [windows]
    file_types: [pe, dll]

  - id: exec/command/shell/win-shellexecute
    description: Executes file or program via Windows ShellExecute API
    criticality: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    confidence: 0.9
    language: c
    condition:
      type: symbol
      pattern: ShellExecuteA|ShellExecuteW|ShellExecuteExA|ShellExecuteExW
    platforms: [windows]

  # Go
  - id: exec/command/shell/go-os-exec
    description: Executes commands via Go os/exec package
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.9
    language: go
    condition:
      type: string
      exact: '"os/exec"'

  # Python
  - id: exec/command/shell/python-os-system
    description: Executes shell commands via Python os.system()
    criticality: notable
    mbc: "E1059.006"
    attack: "T1059.006"
    confidence: 0.95
    language: python
    condition:
      type: string
      regex: "os\\.system\\("

  - id: exec/command/shell/python-subprocess
    description: Executes process via Python subprocess module
    criticality: notable
    mbc: "E1059.006"
    attack: "T1059.006"
    confidence: 0.9
    language: python
    condition:
      type: string
      regex: "import subprocess|from subprocess"

  # JavaScript
  - id: exec/command/shell/js-child-process
    description: Executes commands via Node.js child_process
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.9
    language: javascript
    condition:
      type: string
      regex: "require\\(['\"]child_process['\"]\\)|from ['\"]child_process['\"]"

  # Ruby
  - id: exec/command/shell/ruby-system
    description: Executes commands via Ruby system()
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.9
    language: ruby
    condition:
      type: string
      regex: "\\bsystem\\(['\"]"

  # Rust
  - id: exec/command/shell/rust-command
    description: Executes process via Rust std::process::Command
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.9
    language: rust
    condition:
      type: string
      regex: "use std::process::Command|Command::new"

  # Shell references
  - id: exec/command/shell/bin-sh
    description: References /bin/sh (Bourne shell)
    criticality: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    confidence: 0.6
    condition:
      type: string
      exact: "/bin/sh"
    platforms: [unix, linux, macos]
    file_types: [pe, elf, macho, dll, so, dylib]

  - id: exec/command/shell/cmd-exe
    description: References cmd.exe (Windows Command Prompt)
    criticality: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    confidence: 0.6
    condition:
      type: string
      regex: "cmd\\.exe|cmd /c"
      case_insensitive: true
    platforms: [windows]
