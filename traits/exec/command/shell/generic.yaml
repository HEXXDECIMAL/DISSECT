# Command Execution Detection
# MBC: OB0009 (Execution) â†’ E1059 (Command and Scripting Interpreter)
# ATT&CK: T1059 (Command and Scripting Interpreter)

traits:
  # C/C++ - Unix
  - id: exec/command/shell/c-system
    description: C system() function for shell command execution
    criticality: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    confidence: 0.9
    language: c
    condition:
      type: symbol
      pattern: system
    platforms: [unix, linux, macos]

  - id: exec/command/shell/c-popen
    description: C popen() for command execution with output capture
    criticality: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    confidence: 0.9
    language: c
    condition:
      type: symbol
      pattern: popen
    platforms: [unix, linux, macos]

  - id: exec/command/shell/c-execve
    description: C execve() direct program execution
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.95
    language: c
    condition:
      type: symbol
      pattern: execve
    platforms: [unix, linux, macos]

  # Windows
  - id: exec/command/shell/win-createprocess
    description: Windows CreateProcess API for process creation
    criticality: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    confidence: 0.9
    language: c
    condition:
      type: symbol
      pattern: CreateProcessA|CreateProcessW
    platforms: [windows]
    file_types: [pe, dll]

  - id: exec/command/shell/win-shellexecute
    description: Windows ShellExecute API for file/program execution
    criticality: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    confidence: 0.9
    language: c
    condition:
      type: symbol
      pattern: ShellExecuteA|ShellExecuteW|ShellExecuteExA|ShellExecuteExW
    platforms: [windows]

  # Go
  - id: exec/command/shell/go-os-exec
    description: Go os/exec package for command execution
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.9
    language: go
    condition:
      type: string
      exact: '"os/exec"'

  # Python
  - id: exec/command/shell/python-os-system
    description: Python os.system() command execution
    criticality: notable
    mbc: "E1059.006"
    attack: "T1059.006"
    confidence: 0.95
    language: python
    condition:
      type: string
      regex: "os\\.system\\("

  - id: exec/command/shell/python-subprocess
    description: Python subprocess module for process execution
    criticality: notable
    mbc: "E1059.006"
    attack: "T1059.006"
    confidence: 0.9
    language: python
    condition:
      type: string
      regex: "import subprocess|from subprocess"

  # JavaScript
  - id: exec/command/shell/js-child-process
    description: Node.js child_process module for command execution
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.9
    language: javascript
    condition:
      type: string
      regex: "require\\(['\"]child_process['\"]\\)|from ['\"]child_process['\"]"

  # Ruby
  - id: exec/command/shell/ruby-system
    description: Ruby system() command execution
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.9
    language: ruby
    condition:
      type: string
      regex: "\\bsystem\\(['\"]"

  # Rust
  - id: exec/command/shell/rust-command
    description: Rust std::process::Command for process execution
    criticality: notable
    mbc: "E1059"
    attack: "T1059"
    confidence: 0.9
    language: rust
    condition:
      type: string
      regex: "use std::process::Command|Command::new"

  # Shell references
  - id: exec/command/shell/bin-sh
    description: References /bin/sh (Bourne shell)
    criticality: notable
    mbc: "E1059.004"
    attack: "T1059.004"
    confidence: 0.6
    condition:
      type: string
      exact: "/bin/sh"
    platforms: [unix, linux, macos]

  - id: exec/command/shell/cmd-exe
    description: References cmd.exe (Windows Command Prompt)
    criticality: notable
    mbc: "E1059.003"
    attack: "T1059.003"
    confidence: 0.6
    condition:
      type: string
      regex: "cmd\\.exe|cmd /c"
      case_insensitive: true
    platforms: [windows]
