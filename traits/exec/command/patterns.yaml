# Malicious Command and Script Patterns
# Detects complex construction and execution logic

traits:
  - id: string-assign
    desc: "Constructs command or URL via"
    crit: inert
    conf: 0.6
    for: [python]
    if:
      type: ast
      language: python
      query: |
        (assignment
          left: (identifier) @var
          right: (string) @val)
        (#match? @var "^(cmd|command|url|payload|data|msg|body)$")

composite_rules:
  - id: command-spreading
    desc: "Command spreading (String construction +"
    crit: suspicious
    conf: 0.85
    near_lines: 10
    all:
      - id: exec/command/construction/string-assign
      - id: exec/command/subprocess/run
