# Go Command Execution Detection
# Metrics-based detection of command execution patterns in Go code

defaults:
  for: [go]
  attack: "T1059"

traits:
  - id: go-exec-command
    desc: Executes shell commands via exec.Command
    crit: notable
    conf: 0.85
    if:
      type: metrics
      field: go_metrics.exec_command_count
      min: 1

  - id: go-many-exec-calls
    desc: Multiple shell command executions
    crit: suspicious
    conf: 0.9
    if:
      type: metrics
      field: go_metrics.exec_command_count
      min: 3

  - id: go-direct-syscall
    desc: Uses syscall package for direct system calls
    crit: notable
    conf: 0.8
    if:
      type: metrics
      field: go_metrics.syscall_direct
      min: 1

  - id: go-os-startprocess
    desc: Uses os.StartProcess for low-level process creation
    crit: notable
    conf: 0.85
    if:
      type: metrics
      field: go_metrics.os_startprocess_count
      min: 1

  # === Binary (compiled Go) ===
  - id: cmd-run
    desc: Go os/exec.Cmd.Run
    crit: notable
    conf: 0.5
    platforms: [all]
    for: [elf, macho, pe]
    if:
      type: string
      exact: "os/exec.(*Cmd).Run"
