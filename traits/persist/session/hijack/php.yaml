# PHP Session Persistence Traits
# MBC: B0028 (Persistence)
# ATT&CK: T1071

traits:
  - id: start
    description: PHP session initialization for state persistence
    crit: notable
    confidence: 0.7
    mbc: "B0028"
    file_types: [php]
    condition:
      type: string
      exact: session_start

  - id: destroy
    description: PHP session destruction
    crit: notable
    confidence: 0.7
    file_types: [php]
    condition:
      type: string
      exact: session_destroy

  - id: regenerate
    description: PHP session ID regeneration
    crit: notable
    confidence: 0.75
    file_types: [php]
    condition:
      type: string
      exact: session_regenerate_id

  - id: id-access
    description: Direct session ID manipulation
    crit: suspicious
    confidence: 0.8
    mbc: "B0028"
    file_types: [php]
    condition:
      type: string
      regex: "session_id\\s*\\("

  - id: no-time-limit
    description: Disables PHP script time limit (webshell indicator)
    crit: notable
    confidence: 0.85
    condition:
      type: ast_pattern
      node_type: function_call_expression
      pattern: "set_time_limit"

  - id: ignore-abort
    description: Ignores client abort (webshell indicator)
    crit: notable
    confidence: 0.85
    condition:
      type: ast_pattern
      node_type: function_call_expression
      pattern: "ignore_user_abort"

  - id: output-buffering
    description: Uses output buffering (potential evasion)
    crit: notable
    confidence: 0.7
    condition:
      type: ast_pattern
      node_type: function_call_expression
      pattern: "ob_start"

  - id: error-reporting-off
    description: Disables error reporting (stealth)
    crit: notable
    confidence: 0.8
    condition:
      type: ast_pattern
      node_type: function_call_expression
      pattern: "error_reporting"

  - id: display-errors-off
    description: Disables error display (stealth)
    crit: notable
    confidence: 0.8
    condition:
      type: ast_pattern
      node_type: member_call_expression
      pattern: "ini_set"
