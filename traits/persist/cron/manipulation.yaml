# Crontab Manipulation Patterns
# ATT&CK: T1053.003

defaults:
  attack: "T1053.003"

traits:
  # Crontab commands
  - id: crontab-l
    desc: crontab -l list command
    crit: inert
    conf: 0.6
    if:
      type: string
      word: "crontab"

  - id: pipe-crontab
    desc: Pipe to crontab stdin
    crit: inert
    conf: 0.6
    if:
      type: string
      regex: "\\|\\s*crontab\\s+-"

  - id: echo-command
    desc: echo command
    crit: inert
    conf: 0.5
    if:
      type: string
      word: "echo"

  - id: grep-v
    desc: grep -v (inverse match/filter)
    crit: inert
    conf: 0.6
    if:
      type: string
      regex: "grep\\s+-v"

composite_rules:
  # Blind append pattern: echo | crontab -
  - id: blind_append
    desc: Appends to crontab by piping echo to crontab -
    crit: suspicious
    conf: 0.9
    all:
      - id: crontab-l
      - id: echo-command
      - id: pipe-crontab

  # Filtered rewrite: crontab -l | grep -v | crontab -
  - id: filtered_rewrite
    desc: Rewrites crontab by filtering output of crontab -l
    crit: suspicious
    conf: 0.9
    all:
      - id: crontab-l
      - id: grep-v
      - id: pipe-crontab
