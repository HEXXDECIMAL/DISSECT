# Malware Family - Conti Ransomware
# Reference: https://www.zscaler.com/blogs/security-research/conti-ransomware-attacks-persist-updated-version-despite-leaks
# ATT&CK: T1486 (Data Encrypted for Impact)

traits:
  # === Brand/Name Markers ===

  - id: malware/ransomware/conti/brand-name
    description: Conti ransomware brand string
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "CONTI"

  # === Ransom Note Phrases ===

  - id: malware/ransomware/conti/files-encrypted
    description: Conti encryption notification
    criticality: hostile
    confidence: 0.8
    family: true
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "All of your files are currently"

  - id: malware/ransomware/conti/encrypted-by
    description: Conti encrypted by phrase
    criticality: hostile
    confidence: 0.75
    family: true
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "currently encrypted by"

  - id: malware/ransomware/conti/no-recovery
    description: Conti recovery warning
    criticality: hostile
    confidence: 0.7
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "It cannot be recovered"

  - id: malware/ransomware/conti/dont-try-recover
    description: Conti recovery prevention message
    criticality: hostile
    confidence: 0.8
    family: true
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "DON'T TRY TO RECOVER"

  - id: malware/ransomware/conti/contact-team
    description: Conti team contact message
    criticality: suspicious
    confidence: 0.6
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "without contacting our team"

  - id: malware/ransomware/conti/publication-threat
    description: Conti data publication threat
    criticality: hostile
    confidence: 0.8
    family: true
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "initiate the publication"

  - id: malware/ransomware/conti/compromised-data
    description: Conti compromised data reference
    criticality: suspicious
    confidence: 0.65
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "compromised data"

  - id: malware/ransomware/conti/tor-install
    description: Conti Tor browser instruction
    criticality: suspicious
    confidence: 0.7
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "install TOR browser"

  - id: malware/ransomware/conti/tor-url
    description: Tor project URL reference
    criticality: suspicious
    confidence: 0.5
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "torproject.org"

  - id: malware/ransomware/conti/be-aware
    description: Conti awareness warning
    criticality: hostile
    confidence: 0.75
    family: true
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "YOU SHOULD BE AWARE"

  - id: malware/ransomware/conti/dont-ignore
    description: Conti ignore warning
    criticality: hostile
    confidence: 0.75
    family: true
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "DON'T TRY TO IGNORE"

  - id: malware/ransomware/conti/dont-contact
    description: Conti unauthorized contact warning
    criticality: hostile
    confidence: 0.75
    family: true
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "DON'T CONTACT US"

  - id: malware/ransomware/conti/authorized-person
    description: Conti authorized person requirement
    criticality: suspicious
    confidence: 0.6
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "an authorized person"

  - id: malware/ransomware/conti/ceo-reference
    description: Conti CEO/management reference
    criticality: suspicious
    confidence: 0.6
    attack: "T1486"
    file_types: [all]
    condition:
      type: string
      exact: "CEO, top management"

composite_rules:
  # Conti detection with brand name
  - id: malware/ransomware/conti/brand-detected
    description: Conti ransomware (brand identified)
    criticality: hostile
    confidence: 0.95
    family: true
    reference: "https://www.zscaler.com/blogs/security-research/conti-ransomware-attacks-persist-updated-version-despite-leaks"
    attack: "T1486"
    mbc: "B0031"
    file_types: [all]
    requires_all:
      - type: trait
        id: malware/ransomware/conti/brand-name
    requires_count: 2
    conditions:
      - type: trait
        id: malware/ransomware/conti/files-encrypted
      - type: trait
        id: malware/ransomware/conti/dont-try-recover
      - type: trait
        id: malware/ransomware/conti/publication-threat
      - type: trait
        id: malware/ransomware/conti/be-aware
      - type: trait
        id: malware/ransomware/conti/dont-ignore

  # Conti detection via ransom note phrases (no brand)
  - id: malware/ransomware/conti/note-detected
    description: Conti ransomware (ransom note detected)
    criticality: hostile
    confidence: 0.9
    family: true
    attack: "T1486"
    mbc: "B0031"
    file_types: [all]
    condition:
      type: yara
      source: |
        rule conti_ransom_note {
          strings:
            $a = "All of your files are currently"
            $b = "currently encrypted by"
            $c = "If you don't know who we are"
            $d = "It cannot be recovered"
            $e = "recovered by any means"
            $f = "without contacting our team"
            $g = "DON'T TRY TO RECOVER"
            $h = "choosing the data of the lowtest"
            $i = "contact us as soon as possible"
            $j = "DON'T TRY TO IGNORE"
            $k = "DON'T TRY TO CONTACT"
            $l = "any recovery companies"
            $m = "ready to publi"
            $n = "on our news website"
            $o = "initiate the publication"
            $p = "compromised data"
            $q = "install TOR browser"
            $r = "torproject.org"
            $s = "YOU SHOULD BE AWARE"
            $t = "an authorized person"
            $u = "CEO, top management"
            $v = "DON'T CONTACT US"
            $conti = "CONTI" fullword
          condition:
            filesize < 1MB and (($conti and 2 of them) or (4 of them))
        }
