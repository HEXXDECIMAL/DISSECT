# P2P Botnet Detection
# Detects peer-to-peer botnets (IPStorm, Mozi, etc.)
# ATT&CK: T1090.003 (Multi-hop Proxy)

traits:
  # IPStorm botnet
  - id: malware/p2p-botnet/ipstorm
    description: IPStorm P2P botnet indicators
    criticality: hostile
    confidence: 0.95
    condition:
      type: yara
      source: |
        rule ipstorm {
          strings:
            $ipfs = "ipfs" ascii nocase
            $libp2p = "libp2p" ascii
            $storm = "storm" ascii nocase
            $dht = "github.com/libp2p/go-libp2p-kad-dht" ascii
            $peer = "peer.ID" ascii
          condition:
            ($ipfs and $libp2p) or ($storm and $dht) or ($libp2p and $peer)
        }

  # Mozi botnet
  - id: malware/p2p-botnet/mozi
    description: Mozi IoT botnet indicators
    criticality: hostile
    confidence: 0.95
    condition:
      type: yara
      source: |
        rule mozi {
          strings:
            $mozi = "mozi" ascii nocase
            $dht_node = "dht_node" ascii
            $bootstrap = "bootstrap" ascii
            $netgear = "netgear" ascii nocase
            $huawei = "huawei" ascii nocase
          condition:
            $mozi or ($dht_node and $bootstrap and ($netgear or $huawei))
        }

  # Generic DHT-based botnet
  - id: malware/p2p-botnet/dht-botnet
    description: DHT-based P2P botnet patterns
    criticality: suspicious
    confidence: 0.8
    condition:
      type: yara
      source: |
        rule dht_botnet {
          strings:
            $kademlia = "kademlia" ascii nocase
            $dht = "dht" ascii nocase
            $bootstrap = "bootstrap" ascii
            $find_node = "find_node" ascii
          condition:
            ($kademlia or $dht) and ($bootstrap or $find_node)
        }

  # FritzFrog SSH worm
  - id: malware/p2p-botnet/fritzfrog
    description: FritzFrog P2P SSH worm
    criticality: hostile
    confidence: 0.95
    condition:
      type: yara
      source: |
        rule fritzfrog {
          strings:
            $fritzfrog = "fritzfrog" ascii nocase
            $p2p_ssh = "P2P" ascii
            $ssh_brute = "authorized_keys" ascii
            $ifrit = "ifrit" ascii
          condition:
            $fritzfrog or $ifrit or ($p2p_ssh and $ssh_brute)
        }
