# ChinaZ Botnet Detection
# ATT&CK: T1583.005 (Acquire Infrastructure: Botnet)
# MBC: B0030 (Remote Access)

traits:
  # ChinaZ botnet indicators
  - id: malware/botnet/chinaz/generic
    description: ChinaZ IoT botnet patterns
    criticality: hostile
    confidence: 0.9
    mbc: "B0030"
    attack: "T1583.005"
    condition:
      type: yara
      source: |
        rule chinaz_botnet {
          strings:
            $name1 = "ChinaZ" ascii nocase
            $name2 = "chinaz" ascii
            // ChinaZ-specific C2 patterns
            $c2_1 = "cnc.chinaz" ascii nocase
            $c2_2 = "bot.chinaz" ascii nocase
            // ChinaZ attack commands
            $cmd1 = "LOLNOGTFO" ascii
            $cmd2 = "GETLOCALIP" ascii
            $cmd3 = "HTTPFLOOD" ascii
            $cmd4 = "UDPFLOOD" ascii
            $cmd5 = "SYNFLOOD" ascii
          condition:
            any of ($name*) or any of ($c2_*) or 2 of ($cmd*)
        }

  # ChinaZ DDoS capability
  - id: malware/botnet/chinaz/ddos
    description: ChinaZ DDoS attack capabilities
    criticality: hostile
    confidence: 0.85
    mbc: "B0030"
    attack: "T1498"
    condition:
      type: yara
      source: |
        rule chinaz_ddos {
          strings:
            // Raw socket flood patterns
            $raw1 = "IPPROTO_RAW" ascii
            $raw2 = "IPPROTO_TCP" ascii
            $raw3 = "IPPROTO_UDP" ascii
            // Flood functions
            $flood1 = "syn_flood" ascii
            $flood2 = "udp_flood" ascii
            $flood3 = "http_flood" ascii
            $flood4 = "tcp_flood" ascii
            // Attack markers
            $atk1 = "attack_" ascii
            $atk2 = "flood_" ascii
            // IoT targeting
            $iot1 = "/proc/cpuinfo" ascii
            $iot2 = "busybox" ascii
          condition:
            (2 of ($raw*) and any of ($flood*, $atk*)) or
            (any of ($flood*) and any of ($iot*))
        }

  # ChinaZ spreading mechanism
  - id: malware/botnet/chinaz/spreading
    description: ChinaZ IoT spreading patterns
    criticality: suspicious
    confidence: 0.8
    mbc: "B0030"
    attack: "T1021"
    condition:
      type: yara
      source: |
        rule chinaz_spread {
          strings:
            // Scanner patterns
            $scan1 = "scanner" ascii
            $scan2 = "telnet" ascii nocase
            // Default credentials
            $cred1 = "admin:admin" ascii
            $cred2 = "root:root" ascii
            $cred3 = "root:xc3511" ascii
            $cred4 = "root:vizxv" ascii
            $cred5 = "admin:1234" ascii
            // Port scanning
            $port1 = ":23" ascii
            $port2 = ":2323" ascii
            $port3 = "/proc/self/exe" ascii
          condition:
            ($scan2 and 2 of ($cred*)) or
            (any of ($scan*) and $port3 and any of ($port1, $port2))
        }

composite_rules:
  # ChinaZ botnet detection
  - id: malware/botnet/chinaz/detected
    description: ChinaZ botnet detected
    criticality: hostile
    confidence: 0.95
    requires_any:
      - type: trait
        id: malware/botnet/chinaz/generic
      - type: trait
        id: malware/botnet/chinaz/ddos
