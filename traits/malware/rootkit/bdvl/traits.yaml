# Malware Family - BDVL Rootkit
# Reference: https://github.com/Error996/bdvl
# ATT&CK: T1014 (Rootkit)

traits:
  # === Atomic Traits (decomposed for ML) ===

  - id: malware/rootkit/bdvl/locate-dlsym
    description: BDVL dlsym locator function
    criticality: hostile
    confidence: 0.9
    family: true
    attack: "T1574.006"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: string
      exact: "locate_dlsym"

  - id: malware/rootkit/bdvl/libpam-symbol
    description: BDVL PAM symbol hijacking
    criticality: hostile
    confidence: 0.9
    family: true
    attack: "T1556.003"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: string
      exact: "get_libpam_symbol"

  - id: malware/rootkit/bdvl/magic-user
    description: BDVL magic user backdoor
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1078"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: string
      exact: "magicusr"

  - id: malware/rootkit/bdvl/interesting-dir
    description: BDVL interesting directory function
    criticality: suspicious
    confidence: 0.8
    family: true
    attack: "T1083"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: string
      exact: "interestingdir"

  - id: malware/rootkit/bdvl/secret-connection
    description: BDVL secret connection function
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1071"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: string
      exact: "secret_connection"

  - id: malware/rootkit/bdvl/forge-procnet
    description: BDVL /proc/net forgery
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1014"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: string
      exact: "forge_procnet"

  - id: malware/rootkit/bdvl/utility
    description: BDVL utility function
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1014"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: string
      exact: "dobdvutil"

  - id: malware/rootkit/bdvl/clean-stolen
    description: BDVL credential cleanup function
    criticality: hostile
    confidence: 0.9
    family: true
    attack: "T1070"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: string
      exact: "cleanstolen"

composite_rules:
  - id: malware/rootkit/bdvl/detected
    description: BDVL userland rootkit
    criticality: hostile
    confidence: 0.95
    family: true
    reference: "https://github.com/Error996/bdvl"
    attack: "T1014"
    mbc: "E1014"
    platforms: [linux]
    file_types: [elf]
    condition:
      type: yara
      source: |
        rule bdvl_rootkit {
          strings:
            $locate_dlsym = "locate_dlsym"
            $libpam = "get_libpam_symbol"
            $magicusr = "magicusr"
            $interesting = "interestingdir"
            $secret_connection = "secret_connection"
            $forge_procnet = "forge_procnet"
            $dobdvutil = "dobdvutil"
            $cleanstolen = "cleanstolen"
          condition:
            filesize < 1MB and uint32(0) == 1179403647 and 75% of them
        }
