# Malware Family - Diamorphine Linux Kernel Rootkit
# Reference: https://github.com/m0nad/Diamorphine
# ATT&CK: T1014 (Rootkit)

traits:
  # === Family Signature (Atomic) ===
  # These are Diamorphine-specific strings, not generic behaviors

  - id: malware/family/diamorphine-hacked-getdents
    description: Diamorphine hacked_getdents function
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1014"
    file_types: [elf]
    condition:
      type: string
      exact: "hacked_getdents"

  - id: malware/family/diamorphine-original-getdents
    description: Diamorphine original_getdents pointer
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1014"
    file_types: [elf]
    condition:
      type: string
      exact: "original_getdents"

  - id: malware/family/diamorphine-give-root
    description: Diamorphine give_root function
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1548"
    file_types: [elf]
    condition:
      type: string
      exact: "give_root"

  - id: malware/family/diamorphine-hacked-kill
    description: Diamorphine hacked_kill function
    criticality: hostile
    confidence: 0.9
    family: true
    attack: "T1014"
    file_types: [elf]
    condition:
      type: string
      exact: "hacked_kill"

  - id: malware/family/diamorphine-module-show
    description: Diamorphine module_show function
    criticality: hostile
    confidence: 0.9
    family: true
    attack: "T1014"
    file_types: [elf]
    condition:
      type: string
      exact: "module_show"

  - id: malware/family/diamorphine-is-invisible
    description: Diamorphine is_invisible state
    criticality: hostile
    confidence: 0.85
    family: true
    attack: "T1014"
    file_types: [elf]
    condition:
      type: string
      exact: "is_invisible"

composite_rules:
  - id: malware/family/diamorphine
    description: Diamorphine Linux kernel rootkit
    criticality: hostile
    confidence: 0.98
    family: true
    reference: "https://github.com/m0nad/Diamorphine"
    attack: "T1014"
    mbc: "B0003"
    file_types: [elf]
    # Requires 4 of 6 Diamorphine-specific indicators
    requires_count: 4
    conditions:
      - type: trait
        id: malware/family/diamorphine-hacked-getdents
      - type: trait
        id: malware/family/diamorphine-original-getdents
      - type: trait
        id: malware/family/diamorphine-give-root
      - type: trait
        id: malware/family/diamorphine-hacked-kill
      - type: trait
        id: malware/family/diamorphine-module-show
      - type: trait
        id: malware/family/diamorphine-is-invisible
