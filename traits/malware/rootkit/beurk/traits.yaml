# Malware Family - BEURK Userland Rootkit
# Reference: https://github.com/unix-thrust/beurk
# ATT&CK: T1574.006 (Hijack Execution Flow: LD_PRELOAD)

traits:
  - id: malware/rootkit/beurk/non-hooked-symbols
    description: BEURK non-hooked symbols list
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1574.006"
    file_types: [elf, so]
    condition:
      type: string
      exact: "__non_hooked_symbols"

  - id: malware/rootkit/beurk/hidden-literals
    description: BEURK hidden literals marker
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1574.006"
    file_types: [elf, so]
    condition:
      type: string
      exact: "__hidden_literals"

composite_rules:
  - id: malware/rootkit/beurk/detected
    description: BEURK userland rootkit
    criticality: hostile
    confidence: 0.95
    family: true
    reference: "https://github.com/unix-thrust/beurk"
    attack: "T1574.006"
    mbc: "E1014"
    file_types: [elf, so]
    condition:
      type: yara
      source: |
        rule beurk_rootkit {
          strings:
            $dlsym = "dlsym" fullword
            $non_hooked = "__non_hooked_symbols"
            $hidden = "__hidden_literals"
            $readdir = "readdir"
          condition:
            uint32(0) == 0x464C457F and
            filesize < 2MB and 3 of them
        }

  - id: malware/rootkit/beurk/xor-detected
    description: BEURK rootkit (XOR obfuscated)
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1574.006"
    mbc: "E1014"
    file_types: [elf, so]
    condition:
      type: yara
      source: |
        rule beurk_xor {
          strings:
            $x_BEURK = "BEURK" xor(1-31) fullword
            $x_BEURK2 = "BEURK" xor(33-255) fullword
            $x_b3urkR0cks = "b3urkR0cks" xor(1-31)
            $x_b3urkR0cks2 = "b3urkR0cks" xor(33-255)
            $dlsym = "dlsym" fullword
          condition:
            uint32(0) == 0x464C457F and
            filesize < 2MB and $dlsym and any of ($x*)
        }
