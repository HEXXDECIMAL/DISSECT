# Merlin C2 Agent Detection
# Go-based post-exploitation agent
# Reference: https://github.com/Ne0nd0g/merlin

traits:
  - id: malware/c2-framework/merlin
    description: Merlin C2 agent indicators
    criticality: hostile
    confidence: 0.95
    file_types: [elf, macho, pe, so, dylib, dll, go]
    condition:
      type: yara
      source: |
        rule merlin_c2 {
          meta:
            description = "Merlin C2 agent"
            reference = "https://github.com/Ne0nd0g/merlin"
          strings:
            $merlin1 = "github.com/Ne0nd0g/merlin" ascii
            $merlin2 = "merlin-agent" ascii
            $merlin3 = "MerlinAgent" ascii
            $merlin4 = "merlin/pkg/messages" ascii
            $execute_shellcode = "execute-shellcode" ascii
            $execute_assembly = "execute-assembly" ascii
          condition:
            2 of ($merlin*) or ($execute_shellcode and $execute_assembly)
        }

  - id: malware/c2-framework/merlin-http2
    description: Merlin HTTP/2 C2 communication
    criticality: hostile
    confidence: 0.9
    file_types: [elf, macho, pe, so, dylib, dll, go]
    condition:
      type: yara
      source: |
        rule merlin_http2 {
          strings:
            $h2 = "HTTP/2" ascii
            $merlin = "merlin" ascii nocase
            $proto = "application/octet-stream" ascii
            $jwt = "eyJ" ascii
          condition:
            $h2 and $merlin and ($proto or $jwt)
        }