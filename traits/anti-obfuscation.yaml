# Anti-Obfuscation and Static Analysis Evasion Capabilities
# Migrated from malcontent/rules/anti-static/
#
# This file covers techniques used to evade static analysis, including:
# - Code obfuscation (bitwise, hex, base64, XOR)
# - String construction and manipulation
# - Language-specific obfuscation (Python, JavaScript, PHP, etc.)
# - Binary packing
# - High entropy indicators

simple_rules: []

composite_rules:
  # ============================================================================
  # BITWISE OBFUSCATION
  # ============================================================================

  # Python bitwise obfuscation with exec/eval (Critical)
  - capability: anti-analysis/obfuscation/bitwise-exec
    description: Creates and executes strings using bitwise math (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: '"".join\(chr\(\w{1,4} >> \w{1,3}\) for \w{1,16} in'

      - type: symbol_or_string
        any:
          - 'exec('
          - 'eval('

  # Excessive bitwise math (general)
  - capability: anti-analysis/obfuscation/bitwise-excessive
    description: Excessive use of bitwise math operations (>64 ops)
    confidence: 0.85
    platforms: [all]
    file_types: [python, javascript]

    requires_count: 1
    conditions:
      # Python/generic pattern
      - type: string
        regex: '-{0,1}[\da-z]{1,8} << -{0,1}\d{1,8}'
        min_count: 64

      # JavaScript unsigned bitwise
      - type: string
        regex: '[a-z]>>>\d{1,3}'
        min_count: 50

  # JavaScript charAt + bitwise
  - capability: anti-analysis/obfuscation/bitwise-charAt
    description: Converts manipulated numbers into characters (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        exact: 'function('

      - type: string
        regex: 'charAt\([a-z]>>>\d'

  # PHP bitwise obfuscation
  - capability: anti-analysis/obfuscation/bitwise-php
    description: Uses bitwise math to obfuscate code (PHP)
    confidence: 0.95
    platforms: [all]
    file_types: [python, javascript]

    requires_all:
      - type: string
        exact: '<?php'

      - type: string
        regex: '-{0,1}[\da-z]{1,8} << -{0,1}\d{1,8}'

      - type: string
        regex: '-{0,1}[\da-z]{1,8} >> -{0,1}\d{1,8}'

      - type: symbol_or_string
        any:
          - 'implode('
          - 'charAt('
          - 'substr('
          - 'ord('

  # ============================================================================
  # HEX ENCODING
  # ============================================================================

  # Excessive hex references
  - capability: anti-analysis/obfuscation/hex-excessive
    description: Contains many hexadecimal value references
    confidence: 0.85
    platforms: [all]

    requires_count: 1
    conditions:
      - type: string
        regex: '0x[\dabcdefABCDEF]{2,8}'
        min_count: 64

      - type: string
        regex: '\\x[\dabcdefABCDEF]{2,8}'
        min_count: 256

  # Python mega hex string
  - capability: anti-analysis/obfuscation/hex-mega-string
    description: Python script with large hexadecimal string
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        exact: 'unhexlify'

      - type: string
        regex: "= {0,2}['\"][\\/\\da-fA-F]{1024}"

  # Long hex variables (multiple)
  - capability: anti-analysis/obfuscation/hex-long-vars
    description: Contains multiple large hexadecimal string variables
    confidence: 0.9
    platforms: [all]

    requires_count: 1
    conditions:
      - type: string
        regex: '\w{0,16}=["''][a-z0-9]{1024}'
        min_count: 3

  # Hex + base64 conversion
  - capability: anti-analysis/obfuscation/hex-base64
    description: Converts base64 hex data to ASCII
    confidence: 0.85
    platforms: [all]
    file_types: [python, javascript]

    requires_all:
      - type: symbol_or_string
        any:
          - 'Buffer.from'
          - '.unhexlify('

      - type: symbol_or_string
        any:
          - 'base64'
          - 'b64decode'

  # ============================================================================
  # BASE64 OBFUSCATION
  # ============================================================================

  # JavaScript eval + base64
  - capability: anti-analysis/obfuscation/base64-eval-js
    description: Evaluates base64 content (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        regex: 'eval\(.{0,256}base64'

  # Ruby eval + base64
  - capability: anti-analysis/obfuscation/base64-eval-ruby
    description: Evaluates base64 content (Ruby)
    confidence: 0.95
    platforms: [all]
    file_types: [ruby]

    requires_count: 1
    conditions:
      - type: string
        exact: 'eval(Base64.'

      - type: string
        exact: 'eval(b64decode'

  # Python exec + compressed base64
  - capability: anti-analysis/obfuscation/base64-exec-compressed
    description: Executes compressed base64 content (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: '\.decompress\(.{0,96}\.b64decode\(.{0,64}\Wexec\('

  # Python exec + base64 (proximity)
  - capability: anti-analysis/obfuscation/base64-exec-python
    description: Likely executes base64 content (Python)
    confidence: 0.85
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        exact: 'exec('

      - type: string
        exact: 'b64decode'

  # ============================================================================
  # XOR OBFUSCATION
  # ============================================================================

  # XOR'd eval
  - capability: anti-analysis/obfuscation/xor-eval
    description: XOR-encoded eval call
    confidence: 0.85
    platforms: [all]

    requires_count: 1
    conditions:
      - type: string
        regex: 'eval\('
        # Note: YARA's xor(1-31) modifier isn't directly portable

  # ============================================================================
  # STRING CONSTRUCTION OBFUSCATION
  # ============================================================================

  # Python join + map + chr
  - capability: anti-analysis/obfuscation/string-chr-array
    description: Assembles strings from character code constants (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_count: 1
    conditions:
      - type: string
        regex: 'join\(map\(chr,\[\d{1,3}, {0,2}\d{1,3}'

      - type: string
        regex: 'join\(chr\([a-z]{1,5}\) for [a-z]{1,5} in \[\d{1,3}'

  # Python join + chr + exec
  - capability: anti-analysis/obfuscation/string-chr-exec
    description: Joins obfuscated character array and executes code (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: '[a-z]{1,64}\s{0,2}=\s{0,2}\[\d{1,5},\s{0,2}\d{1,5}'

      - type: string
        exact: 'chr(int('

      - type: string
        regex: 'exec\(\w{1,32}\)'

  # Python for + join + ord
  - capability: anti-analysis/obfuscation/string-ord-decode
    description: Decodes numbers from obfuscated string (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: "for [\\w]{1,10} in [\"']{2}\\.join\\(chr\\(ord\\("

  # urllib hidden as int array
  - capability: anti-analysis/obfuscation/string-urllib-array
    description: Hides urllib code as integer array
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_count: 1
    conditions:
      - type: string
        exact: '117,114,108,108,105,98,46'

      - type: string
        exact: '117, 114, 108, 108, 105, 98, 46'

  # JavaScript character obfuscation
  - capability: anti-analysis/obfuscation/string-char-js
    description: JavaScript character manipulation obfuscation
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: symbol_or_string
        any:
          - charCodeAt
          - charAt
          - toString
          - fromCharCode

      - type: string
        exact: 'function('

  # ============================================================================
  # PYTHON-SPECIFIC OBFUSCATION
  # ============================================================================

  # Indirect builtins access
  - capability: anti-analysis/obfuscation/python-indirect-builtins
    description: Indirectly refers to Python builtins
    confidence: 0.75
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: 'getattr\(__builtins__,[ \w\.\)\)]{0,64}'

  # Python exec/eval + decrypt (one line)
  - capability: anti-analysis/obfuscation/python-exec-decrypt
    description: Evaluates code from encrypted content (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_count: 1
    conditions:
      - type: string
        regex: 'eval\s{0,32}\(.{0,32}decrypt'

      - type: string
        regex: 'exec\s{0,32}\(.{0,32}decrypt'

  # Dynamic require
  - capability: anti-analysis/obfuscation/python-dynamic-require
    description: Imports library dynamically (Python)
    confidence: 0.85
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        exact: 'import'

      - type: string
        regex: 'require\(\w{2,16}\('

  # Python eval + hex
  - capability: anti-analysis/obfuscation/python-eval-hex
    description: Evaluates code from hex-encoded data stream (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_count: 1
    conditions:
      - type: string
        regex: 'eval\("\\x\d{1,3}'

      - type: string
        regex: 'eval\("\\\d{1,3}'

  # Python eval + marshal
  - capability: anti-analysis/obfuscation/python-eval-marshal
    description: Evaluates code from marshalled data (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_count: 1
    conditions:
      - type: string
        exact: 'eval(marshal.loads'

      - type: string
        exact: 'eval(json.loads'

  # Python eval + gzip
  - capability: anti-analysis/obfuscation/python-eval-gzip
    description: Evaluates code from gzip content (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: 'eval\(.{0,32}\(gzip\.decompress\(b'

  # Fernet + base64
  - capability: anti-analysis/obfuscation/python-fernet-base64
    description: Uses Fernet encryption with base64 decoding (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: symbol_or_string
        any:
          - Fernet
          - fernet

      - type: symbol_or_string
        any:
          - b64decode
          - b32decode

      - type: symbol_or_string
        any:
          - 'decrypt('
          - 'exec('
          - 'eval('

  # Multi-level decoding (3+)
  - capability: anti-analysis/obfuscation/python-multi-decode-3
    description: Multiple (3+) levels of decoding (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        exact: 'return'

      - type: string
        regex: '\.[b64]{0,3}decode\(.{0,256}\.[b64]{0,3}decode\(.{0,256}\.[b64]{0,3}decode'

  # Multi-level decoding (2)
  - capability: anti-analysis/obfuscation/python-multi-decode-2
    description: Multiple (2) levels of decoding (Python)
    confidence: 0.85
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        exact: 'return'

      - type: string
        regex: '\.[b64]{0,3}decode\(.{0,32}\.[b64]{0,3}decode\('

  # Rename requests library
  - capability: anti-analysis/obfuscation/python-rename-requests
    description: Imports 'requests' library with alternate name (Python)
    confidence: 0.8
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: 'import requests as \w{1,2}'

  # Rename marshal library (Critical)
  - capability: anti-analysis/obfuscation/python-rename-marshal
    description: Imports 'marshal' library with alternate name (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: 'import marshal as \w{0,64}'

  # Rename base64 library (Critical)
  - capability: anti-analysis/obfuscation/python-rename-base64
    description: Imports 'base64' library with alternate name (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: 'import base64 as \w{0,64}'

  # Rename os library
  - capability: anti-analysis/obfuscation/python-rename-os
    description: Imports 'os' library with alternate name (Python)
    confidence: 0.85
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: 'import os as \w{0,64}'

  # Lambda obfuscation (excessive)
  - capability: anti-analysis/obfuscation/python-lambda-excessive
    description: Lambda-based obfuscation (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_count: 1
    conditions:
      - type: string
        regex: 'lambda \W: \W [\+\-\*]'
        min_count: 30

  # Lambda + decode + builtins
  - capability: anti-analysis/obfuscation/python-lambda-funk
    description: Obfuscated with lambda expressions and builtins (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_count: 4
    conditions:
      - type: string
        exact: '__builtins__.__dict__'

      - type: string
        exact: '(lambda'

      - type: string
        exact: '.decode(bytes('

      - type: string
        exact: 'b64decode('

      - type: string
        exact: '.decompress('

  # Confusing function names (Il only)
  - capability: anti-analysis/obfuscation/python-confusing-names
    description: Obfuscated with confusing function names (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_count: 1
    conditions:
      - type: string
        regex: 'def [Il]{6,64}'

      - type: string
        regex: '[Il]{6,64} = '

      - type: string
        regex: 'return [Il]{6,64}\('

  # Import manipulator
  - capability: anti-analysis/obfuscation/python-import-manipulator
    description: Manipulates globals and imports to execute obfuscated code (Python)
    confidence: 0.95
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        exact: '__import__('

      - type: string
        exact: 'getattr('

      - type: symbol_or_string
        any:
          - 'globals'
          - '__dict__'

      - type: string
        regex: 'chr\(\w{1,8}\)'

  # Bloated hex Python
  - capability: anti-analysis/obfuscation/python-bloated-hex
    description: Python script bloated with obfuscated content
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_count: 8
    conditions:
      - type: string
        exact: 'unhexlify'

      - type: string
        exact: 'join('

      - type: string
        exact: 'split'

      - type: string
        exact: 'lambda'

      - type: string
        exact: 'ord'

      - type: string
        exact: 'def'

      - type: string
        exact: 'decode'

      - type: string
        exact: 'exec'

      - type: string
        exact: 'eval'

  # Decompress + base64 + entropy
  - capability: anti-analysis/obfuscation/python-decompress-base64
    description: Hidden base64-encoded compressed content (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: symbol_or_string
        any:
          - lzma
          - gzip
          - zlib

      - type: string
        regex: 'b64decode\("[\+\=\w\/]{96}'

      - type: symbol_or_string
        any:
          - 'decompress('
          - 'eval('
          - 'exec('

  # Codecs decode
  - capability: anti-analysis/obfuscation/python-codecs-decode
    description: Decodes text with arbitrary codec (Python)
    confidence: 0.85
    platforms: [all]
    file_types: [python]

    requires_all:
      - type: string
        regex: '[\w\= ]{0,16}codecs\.decode\('

  # ============================================================================
  # JAVASCRIPT-SPECIFIC OBFUSCATION
  # ============================================================================

  # Variable misdirection
  - capability: anti-analysis/obfuscation/js-var-misdirection
    description: Multiple layers of variable misdirection (JavaScript)
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_count: 3
    conditions:
      - type: string
        regex: 'var [a-z]{0,2}[A-Z]{1,2}[a-z]\w{1,2}\s{0,2}=\s{0,2}\w{0,2}[A-Z]\w{1,2}[\;\(\[]'

      - type: string
        regex: 'var [a-z]{1,3}[A-Z][a-z]{0,2}\s{0,2}=\s{0,2}"";'

  # JavaScript charCodeAt substitution
  - capability: anti-analysis/obfuscation/js-charcode-substitution
    description: Converts integers to strings with substitution map (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        exact: 'charCodeAt'

      - type: string
        exact: 'fghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012345'

  # eBe obfuscation
  - capability: anti-analysis/obfuscation/js-ebe
    description: Highly obfuscated JavaScript (eBe pattern)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        exact: 'function('

      - type: string
        exact: 'charCodeAt'

      - type: string
        regex: 'eBe\([-]?\d{1,3}\)'
        min_count: 10

  # JavaScript eval + console.log (Critical)
  - capability: anti-analysis/obfuscation/js-exec-console-log
    description: Evaluates the return of console.log() (JavaScript)
    confidence: 0.95
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        exact: '.exec(console.log('

  # JavaScript const/function obfuscation
  - capability: anti-analysis/obfuscation/js-const-func-excessive
    description: JavaScript obfuscation (excessive const functions)
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        exact: 'const '
        min_count: 32

      - type: string
        exact: 'function('
        min_count: 48

      - type: string
        exact: '{return'
        min_count: 64

  # JavaScript hex eval obfuscation
  - capability: anti-analysis/obfuscation/js-hex-eval
    description: JavaScript eval obfuscation with hex (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        regex: '\(eval, _{0,4}0x[\w]{0,32}[\(\[]'

  # JavaScript hex function obfuscation
  - capability: anti-analysis/obfuscation/js-hex-function
    description: JavaScript function obfuscation with hex (JavaScript)
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_count: 1
    conditions:
      - type: string
        regex: 'return _{0,4}0x[\w]{0,32}[\(\w]{0,32}'

      - type: string
        regex: 'const _{0,4}0x[\w]{0,32}\s*=[\w]{0,32}'

  # JavaScript parseInt obfuscation
  - capability: anti-analysis/obfuscation/js-parseint-excessive
    description: JavaScript obfuscation (integer parsing)
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        exact: 'const '
        min_count: 16

      - type: string
        exact: 'function('
        min_count: 32

      - type: string
        exact: 'parseInt'
        min_count: 8

  # Powered arrays
  - capability: anti-analysis/obfuscation/js-powered-arrays
    description: Uses many powered array elements (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        regex: 'function\(\w,'

      - type: string
        regex: 'charAt\([a-zA-Z]'

      - type: string
        regex: '\w\[\d{1,4}\]\^\w\[\d{1,4}\]'
        min_count: 25

  # String prototype function
  - capability: anti-analysis/obfuscation/js-string-prototype
    description: Obfuscates function calls via string prototypes (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_count: 1
    conditions:
      - type: string
        regex: 'String\["prototype"\].{1,32} = function\(\) \{ eval\(this\.toString\(\)\)\;'

      - type: string
        regex: 'String\["prototype"\]\[".{4,64}"\] = function\(\w{1,2}, \w{1,2}\)'

  # Unicode prototype (Critical)
  - capability: anti-analysis/obfuscation/js-unicode-prototype
    description: Sets obfuscated Array.prototype attribute (JavaScript)
    confidence: 0.95
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        regex: 'Array\.prototype\.\\[\w\\]{2,256}\s{0,2}='

  # Variable filler
  - capability: anti-analysis/obfuscation/js-var-filler
    description: Header filled with excessive variable declarations (JavaScript)
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_count: 1
    conditions:
      - type: string
        regex: '[a-z]{2,8}\d{1,5} = "[a-z]{2,8}\d{1,5}"'
        min_count: 25

  # Large random variables
  - capability: anti-analysis/obfuscation/js-large-random-vars
    description: Contains large random variable names (JavaScript)
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_count: 1
    conditions:
      - type: string
        regex: 'var [a-zA-Z_]{32,256} = '
        min_count: 1

  # Complex variables (excessive)
  - capability: anti-analysis/obfuscation/js-complex-vars-excessive
    description: Excessive complex variable declarations (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_count: 1
    conditions:
      - type: string
        regex: 'var [a-zA-Z_]{1,256} = \('
        min_count: 400

  # Large obfuscated array
  - capability: anti-analysis/obfuscation/js-large-array
    description: Contains large obfuscated arrays (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: string
        regex: '[a-z]{32,256}=\[\]'

      - type: string
        regex: "[a-z]{1,256}\\['\\w{32,2048}'\\]"

  # Obfuscated require
  - capability: anti-analysis/obfuscation/js-obfuscated-require
    description: Sets variable to the 'require' keyword (JavaScript)
    confidence: 0.9
    platforms: [all]
    file_types: [javascript]

    requires_count: 1
    conditions:
      - type: string
        regex: 'global\["\w{1,16}"\]\s{0,2}=\s{0,2}require;'

      - type: string
        regex: 'var \w{1,16}\s{0,2}=\s{0,2}require;'

  # ============================================================================
  # ENTROPY-BASED DETECTION
  # ============================================================================

  # High entropy (Python/JavaScript)
  - capability: anti-analysis/obfuscation/high-entropy
    description: High entropy indicating obfuscation (>6.0)
    confidence: 0.75
    platforms: [all]
    file_types: [python, javascript]

    requires_count: 1
    conditions:
      - type: structure
        feature: 'entropy/high'

  # Very high entropy (JavaScript)
  - capability: anti-analysis/obfuscation/very-high-entropy
    description: Very high entropy indicating heavy obfuscation (>7.0)
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_count: 1
    conditions:
      - type: structure
        feature: 'entropy/very-high'

  # High entropy + charAt/substr/join
  - capability: anti-analysis/obfuscation/high-entropy-charAt
    description: High entropy with charAt/substr/join patterns
    confidence: 0.85
    platforms: [all]
    file_types: [javascript]

    requires_all:
      - type: structure
        feature: 'entropy/high'

      - type: symbol_or_string
        any:
          - 'charAt('
          - 'substr('
          - 'join('

      - type: string
        regex: 'function\s{0,2}\('

  # ============================================================================
  # PACKERS AND COMPILERS
  # ============================================================================

  # UPX packer
  - capability: anti-analysis/packer/upx
    description: Packed with UPX
    confidence: 0.95
    platforms: [all]
    file_types: [elf, pe, macho]

    requires_count: 1
    conditions:
      - type: string
        exact: 'UPX!'

      - type: structure
        feature: 'packer/upx'

  # Python compiled (Nuitka)
  - capability: anti-analysis/packer/nuitka
    description: Compiled with Nuitka (Python compiler)
    confidence: 0.9
    platforms: [all]
    file_types: [elf, pe]

    requires_count: 1
    conditions:
      - type: string
        regex: '(nuitka|Nuitka_.*_version)'

  # Python frozen (cx_Freeze)
  - capability: anti-analysis/packer/cx-freeze
    description: Frozen with cx_Freeze (Python)
    confidence: 0.9
    platforms: [all]
    file_types: [elf, pe]

    requires_count: 1
    conditions:
      - type: string
        exact: 'cx_Freeze'

  # Python obfuscator (PyObfuscate)
  - capability: anti-analysis/packer/pyobfuscate
    description: Obfuscated with PyObfuscate
    confidence: 0.9
    platforms: [all]
    file_types: [python]

    requires_count: 1
    conditions:
      - type: string
        regex: '(pyobfuscate|PyObfuscate)'

  # Shell script compiler (shc)
  - capability: anti-analysis/packer/shc
    description: Compiled with SHC (shell script compiler)
    confidence: 0.95
    platforms: [linux, unix]
    file_types: [elf]

    requires_count: 1
    conditions:
      - type: string
        exact: 'shc_'

  # Java obfuscator (Allatori)
  - capability: anti-analysis/packer/allatori-java
    description: Obfuscated with Allatori (Java)
    confidence: 0.9
    platforms: [all]
    file_types: [java]

    requires_count: 1
    conditions:
      - type: string
        regex: '(Allatori|allatori)'

  # ELF packer (Ezuri)
  - capability: anti-analysis/packer/ezuri
    description: Packed with Ezuri (ELF packer/crypter)
    confidence: 0.95
    platforms: [linux]
    file_types: [elf]

    requires_count: 1
    conditions:
      - type: string
        regex: '(ezuri|Ezuri)'
