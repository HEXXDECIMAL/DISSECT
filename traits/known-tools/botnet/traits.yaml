# P2P Botnet Detection
# Detects peer-to-peer botnet artifacts and behaviors
# ATT&CK: T1090.003 (Multi-hop Proxy)

defaults:
  file_types: [elf]

traits:
  # IPStorm botnet
  - id: p2p-botnet/ipstorm
    description: IPStorm P2P botnet indicators
    crit: suspicious
    conf: 0.95
    attack: "T1090.003"
    condition:
      type: yara
      source: |
        rule ipstorm {
          strings:
            $ipfs = "ipfs" ascii nocase
            $libp2p = "libp2p" ascii
            $storm = "storm" ascii nocase
            $dht = "github.com/libp2p/go-libp2p-kad-dht" ascii
            $peer = "peer.ID" ascii
          condition:
            ($ipfs and $libp2p) or ($storm and $dht) or ($libp2p and $peer)
        }

  # Mozi botnet
  - id: p2p-botnet/mozi-artifact
    description: Mozi botnet identifier string
    crit: notable
    conf: 0.7
    condition:
      type: yara
      source: |
        rule mozi_artifact {
          strings:
            $mozi = "mozi" ascii nocase fullword
          condition:
            $mozi
        }

  - id: p2p-botnet/dht-iot-bootstrap
    description: P2P DHT bootstrapping for IoT devices
    crit: suspicious
    conf: 0.8
    attack: "T1090.003"
    condition:
      type: yara
      source: |
        rule dht_iot_bootstrap {
          strings:
            $dht_node = "dht_node" ascii
            $bootstrap = "bootstrap" ascii
            $netgear = "netgear" ascii nocase
            $huawei = "huawei" ascii nocase
          condition:
            $dht_node and $bootstrap and ($netgear or $huawei)
        }

  # Generic DHT-based botnet
  - id: comm/p2p/dht-network
    description: Kademlia DHT networking
    crit: notable
    conf: 0.8
    condition:
      type: yara
      source: |
        rule dht_botnet {
          strings:
            $kademlia = "kademlia" ascii nocase
            $dht = "dht" ascii nocase
            $bootstrap = "bootstrap" ascii
            $find_node = "find_node" ascii
          condition:
            ($kademlia or $dht) and ($bootstrap or $find_node)
        }

  # FritzFrog SSH worm
  - id: p2p-botnet/fritzfrog
    description: FritzFrog P2P SSH worm
    crit: suspicious
    conf: 0.95
    attack: "T1110"
    condition:
      type: yara
      source: |
        rule fritzfrog {
          strings:
            $fritzfrog = "fritzfrog" ascii nocase
            $p2p_ssh = "P2P" ascii
            $ssh_brute = "authorized_keys" ascii
            $ifrit = "ifrit" ascii
          condition:
            $fritzfrog or $ifrit or ($p2p_ssh and $ssh_brute)
        }