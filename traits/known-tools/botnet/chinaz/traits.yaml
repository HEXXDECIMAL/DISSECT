# ChinaZ Botnet Detection
# ATT&CK: T1583.005 (Acquire Infrastructure: Botnet)
# MBC: B0030 (Remote Access)

defaults:
  file_types: [elf, macho, so, dylib]

traits:
  # ChinaZ botnet identifiers
  - id: botnet/chinaz/identifier
    description: ChinaZ botnet identifier string
    criticality: notable
    confidence: 0.7
    condition:
      type: yara
      source: |
        rule chinaz_id {
          strings:
            $name1 = "ChinaZ" ascii nocase fullword
            $name2 = "chinaz" ascii fullword
          condition:
            any of them
        }

  - id: c2/botnet/chinaz/commands
    description: Specific ChinaZ C2 command logic
    criticality: suspicious
    confidence: 0.95
    attack: "T1583.005"
    condition:
      type: yara
      source: |
        rule chinaz_cmds {
          strings:
            $cmd1 = "LOLNOGTFO" ascii
            $cmd2 = "GETLOCALIP" ascii
            $cmd3 = "HTTPFLOOD" ascii
            $cmd4 = "UDPFLOOD" ascii
            $cmd5 = "SYNFLOOD" ascii
          condition:
            2 of them
        }

  # ChinaZ DDoS capability
  - id: comm/attack/flood/raw-sockets
    description: Raw socket network flood capability
    criticality: notable
    confidence: 0.8
    condition:
      type: yara
      source: |
        rule raw_socket_flood {
          strings:
            $raw1 = "IPPROTO_RAW" ascii
            $raw2 = "IPPROTO_TCP" ascii
            $raw3 = "IPPROTO_UDP" ascii
            $flood1 = "syn_flood" ascii
            $flood2 = "udp_flood" ascii
            $flood3 = "http_flood" ascii
            $flood4 = "tcp_flood" ascii
          condition:
            2 of ($raw*) and any of ($flood*)
        }

  - id: comm/attack/flood/iot-ddos
    description: IoT-targeted DDoS flood logic
    criticality: suspicious
    confidence: 0.85
    condition:
      type: yara
      source: |
        rule iot_flood {
          strings:
            $flood1 = "syn_flood" ascii
            $flood2 = "udp_flood" ascii
            $flood3 = "http_flood" ascii
            $flood4 = "tcp_flood" ascii
            $iot1 = "/proc/cpuinfo" ascii
            $iot2 = "busybox" ascii
          condition:
            any of ($flood*) and any of ($iot*)
        }

  # ChinaZ spreading mechanism
  - id: botnet/spread/telnet-scanner
    description: Automated telnet credential scanner
    criticality: suspicious
    confidence: 0.85
    condition:
      type: yara
      source: |
        rule telnet_scanner {
          strings:
            $scan1 = "scanner" ascii
            $scan2 = "telnet" ascii nocase
            $cred1 = "admin:admin" ascii
            $cred2 = "root:root" ascii
            $cred3 = "root:xc3511" ascii
            $cred4 = "root:vizxv" ascii
            $cred5 = "admin:1234" ascii
          condition:
            (any of ($scan*)) and 2 of ($cred*)
        }

composite_rules:
  # ChinaZ botnet detection
  - id: botnet/chinaz/detected
    description: ChinaZ botnet detected
    criticality: hostile
    confidence: 0.95
    attack: "T1583.005"
    mbc: "B0030"
    requires_all:
      - id: botnet/chinaz/identifier
    requires_any:
      - id: c2/botnet/chinaz/commands
      - id: comm/attack/flood/iot-ddos
