# Hadooken Malware Detection
# ATT&CK: T1059 (Command and Scripting Interpreter)
# MBC: B0030 (Remote Access)

traits:
  # Hadooken dropper
  - id: dropper/hadooken/generic
    description: Hadooken malware dropper patterns
    criticality: suspicious
    confidence: 0.9
    mbc: "B0030"
    attack: "T1059"
    file_types: [elf, macho, pe, so, dylib, dll, shell]
    condition:
      type: yara
      source: |
        rule hadooken_dropper {
          strings:
            // Hadooken name variants
            $name1 = "hadooken" ascii nocase
            $name2 = "hadouken" ascii nocase
            // Street Fighter reference used by malware
            $sf1 = "shoryuken" ascii nocase
            $sf2 = "tatsumaki" ascii nocase
            // Dropper patterns
            $drop1 = "download_and_execute" ascii
            $drop2 = "wget -O" ascii
            $drop3 = "curl -o" ascii
          condition:
            any of ($name*) or
            (any of ($sf*) and any of ($drop*))
        }

  # Hadooken cryptominer deployment
  - id: dropper/hadooken/miner
    description: Hadooken cryptominer deployment
    criticality: suspicious
    confidence: 0.85
    mbc: "B0030"
    attack: "T1496"
    file_types: [elf, macho, pe, so, dylib, dll, shell]
    condition:
      type: yara
      source: |
        rule hadooken_miner {
          strings:
            // Hadooken identifier
            $name1 = "hadooken" ascii nocase
            // Mining deployment
            $mine1 = "xmrig" ascii nocase
            $mine2 = "minerd" ascii
            $mine3 = "cpuminer" ascii
            // Pool configuration
            $pool1 = "stratum+" ascii
            $pool2 = "pool." ascii
            // Persistence
            $persist1 = "crontab" ascii
            $persist2 = "/etc/cron" ascii
          condition:
            $name1 or
            (any of ($mine*) and any of ($pool*) and any of ($persist*))
        }

  # Hadooken webshell component
  - id: dropper/hadooken/webshell
    description: Hadooken webshell deployment
    criticality: suspicious
    confidence: 0.85
    mbc: "B0030"
    attack: "T1505.003"
    file_types: [elf, macho, pe, so, dylib, dll, shell]
    condition:
      type: yara
      source: |
        rule hadooken_webshell {
          strings:
            // Hadooken webshell patterns
            $name1 = "hadooken" ascii nocase
            // Tsunami/Kaiten IRC bot
            $irc1 = "PRIVMSG" ascii
            $irc2 = "NICK " ascii
            $irc3 = "JOIN #" ascii
            // Shell commands
            $cmd1 = "system(" ascii
            $cmd2 = "exec(" ascii
            $cmd3 = "popen(" ascii
          condition:
            $name1 or
            (2 of ($irc*) and any of ($cmd*))
        }

composite_rules:
  # Hadooken detection
  - id: dropper/hadooken/detected
    description: Hadooken malware detected
    criticality: hostile
    confidence: 0.95
    mbc: "B0030"
    attack: "T1059"
    file_types: [elf, macho, pe, so, dylib, dll, shell]
    requires_any:
      - id: dropper/hadooken/generic
      - id: dropper/hadooken/miner
      - id: dropper/hadooken/webshell
