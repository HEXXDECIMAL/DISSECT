# Malware Family - Beaver Tail Infostealer
# Reference: https://objective-see.org/blog/blog_0x7A.html
# ATT&CK: T1555 (Credentials from Password Stores)

traits:
  - id: stealer/beaver-tail/pdown
    description: Beaver Tail download endpoint
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1105"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "/pdown"

  - id: stealer/beaver-tail/upload-ldb
    description: Beaver Tail LDB upload marker
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1041"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "Upload LDB Finshed"

  - id: stealer/beaver-tail/python-download
    description: Beaver Tail Python download success
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1105"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "Download Python Success!"

  - id: stealer/beaver-tail/pyp-python
    description: Beaver Tail hidden Python path
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1059.006"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "/.pyp/python.exe"

  - id: stealer/beaver-tail/keychain-log
    description: Beaver Tail keychain logging
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1555.001"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "logkc_db"

  - id: stealer/beaver-tail/client-99
    description: Beaver Tail client endpoint
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1071"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "/client/99"

  - id: stealer/beaver-tail/ldb-glob
    description: Beaver Tail LDB file glob
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1555.003"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "*.ldb"

  - id: stealer/beaver-tail/pdown-finished
    description: Beaver Tail pDown callback
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1105"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "pDownFinished"

  - id: stealer/beaver-tail/browser-url
    description: Beaver Tail browser URL setter
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1555.003"
    file_types: [elf, macho]
    condition:
      type: string
      exact: "setBaseBrowserUrl"

composite_rules:
  - id: stealer/beaver-tail/detected
    description: Beaver Tail Infostealer
    criticality: hostile
    confidence: 0.95
    family: true
    reference: "https://objective-see.org/blog/blog_0x7A.html"
    attack: "T1555"
    mbc: "B0028"
    file_types: [elf, macho]
    requires_count: 3
    conditions:
      - id: stealer/beaver-tail/pdown
      - id: stealer/beaver-tail/upload-ldb
      - id: stealer/beaver-tail/python-download
      - id: stealer/beaver-tail/keychain-log
      - id: stealer/beaver-tail/pdown-finished
      - id: stealer/beaver-tail/browser-url
