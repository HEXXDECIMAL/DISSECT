# Malware Family - Gelsemium/Wolfsbane
# Reference: https://www.welivesecurity.com/en/eset-research/unveiling-wolfsbane-gelsemiums-linux-counterpart-to-gelsevirine/
# ATT&CK: T1071 (Application Layer Protocol)

traits:
  - id: apt/gelsemium/clientpath
    description: Wolfsbane clientpath config
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1071"
    for: [elf]
    condition:
      type: content


  - id: apt/gelsemium/config-yara
    description: Wolfsbane config strings via YARA
    crit: suspicious
    conf: 0.95
    family: true
    attack: "T1071"
    mbc: "B0030"
    for: [elf]
    condition:
      type: yara
      source: |
        rule wolfsbane_config {
          strings:
            $config_clientpath = "clientpath" wide
            $config_hiderpath = "hiderpath" wide
            $config_pluginkey = "pluginkey" wide
            $config_mainpath = "mainpath" wide
          condition:
            uint32(0) == 0x464C457F and
            filesize < 10MB and all of them
        }

composite_rules:
  - id: apt/gelsemium/detected
    description: Wolfsbane/Gelsemium (RC4 + config)
    crit: suspicious
    conf: 0.99
    family: true
    attack: "T1573"
    mbc: "C0027"
    for: [elf]
    count_min: 1
    any:
      - id: apt/gelsemium/rc4-key
      - id: apt/gelsemium/config-yara
