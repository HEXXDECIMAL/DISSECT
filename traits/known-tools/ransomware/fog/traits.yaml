# Fog Ransomware Detection
# ATT&CK: T1486 (Data Encrypted for Impact)
# MBC: C0027 (Encrypt Files)

traits:
  # Fog ransomware indicators
  - id: ransomware/fog/generic
    description: Fog ransomware patterns
    crit: suspicious
    conf: 0.9
    mbc: "C0027"
    attack: "T1486"
    file_types: [elf, macho, pe, so, dylib, dll]
    condition:
      type: yara
      source: |
        rule fog_ransomware {
          strings:
            // Fog ransomware specific identifiers
            $name1 = "fog ransomware" ascii nocase
            $name2 = "fogpay" ascii nocase
            // Fog extension (unique to this ransomware)
            $ext1 = ".fog" ascii
            $ext2 = ".flocked" ascii
            // Ransom note patterns combined with encryption
            $note1 = "DECRYPT" ascii
            $note2 = "your files have been encrypted" ascii nocase
            $enc1 = "AES-256" ascii
            $enc2 = "RSA-2048" ascii
          condition:
            any of ($name*) or
            any of ($ext*) or
            (any of ($note*) and any of ($enc*))
        }

  # Fog Linux/ESXi variant
  - id: ransomware/fog/linux
    description: Fog ransomware Linux targeting
    crit: suspicious
    conf: 0.9
    mbc: "C0027"
    attack: "T1486"
    file_types: [elf, so]
    condition:
      type: yara
      source: |
        rule fog_linux {
          strings:
            // Fog ransomware specific strings
            $name1 = "fog ransomware" ascii nocase
            $name2 = "fogpay" ascii nocase
            $name3 = ".fog" ascii
            // Ransom note with Fog branding
            $ransom1 = "readme.txt" ascii nocase
            $ransom2 = "DECRYPT" ascii
            // VM targeting
            $vm1 = "/vmfs/volumes" ascii
            $vm2 = ".vmdk" ascii
            $vm3 = ".vmx" ascii
            // ESXi commands
            $esxi1 = "esxcli" ascii
            $esxi2 = "vim-cmd" ascii
            // File walking
            $walk1 = "filepath.Walk" ascii
            $walk2 = "ReadDir" ascii
          condition:
            any of ($name*) or
            ($vm1 and any of ($vm2, $vm3) and any of ($ransom*)) or
            (any of ($esxi*) and any of ($walk*) and any of ($ransom*))
        }

composite_rules:
  - id: ransomware/fog/detected
    description: Fog ransomware detected
    crit: suspicious
    conf: 0.95
    mbc: "C0027"
    attack: "T1486"
    file_types: [elf, macho, pe, so, dylib, dll]
    any:
      - id: ransomware/fog/generic
      - id: ransomware/fog/linux
