# Malware Family - Kubo Injector
# Reference: https://github.com/kubo/injector
# ATT&CK: T1055 (Process Injection)

traits:
  - id: injector/kubo/cloned-thread
    description: Kubo cloned thread injection
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1055"
    file_types: [elf]
    condition:
      type: string
      exact: "inject_in_cloned_thread"

  - id: injector/kubo/arch2name
    description: Kubo architecture name resolver
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1055"
    file_types: [elf]
    condition:
      type: string
      exact: "arch2name"

  - id: injector/kubo/remote-vcall
    description: Kubo remote virtual call
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1055"
    file_types: [elf]
    condition:
      type: string
      exact: "remote_vcall"

  - id: injector/kubo/libc-info
    description: Kubo libc information collector
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1055"
    file_types: [elf]
    condition:
      type: string
      exact: "collect_libc_info"

  - id: injector/kubo/shellcode-size
    description: Kubo shellcode size marker
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1055"
    file_types: [elf]
    condition:
      type: string
      exact: "shellcode_size"

composite_rules:
  - id: injector/kubo/detected
    description: Kubo process injector
    criticality: suspicious
    confidence: 0.95
    family: true
    reference: "https://github.com/kubo/injector"
    attack: "T1055"
    mbc: "E1055"
    file_types: [elf]
    condition:
      type: yara
      source: |
        rule kubo_injector {
          strings:
            $cloned_thread = "inject_in_cloned_thread"
            $arch2name = "arch2name"
            $remote_vcall = "remote_vcall"
            $libc_info = "collect_libc_info"
            $shellcode = "shellcode_size"
          condition:
            uint32(0) == 0x464C457F and
            filesize < 200KB and 3 of them
        }
