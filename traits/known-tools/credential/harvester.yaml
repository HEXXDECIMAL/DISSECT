# Security Tools - Credential Extraction
# Used for both legitimate security testing and malicious purposes

traits:
  - id: mimikatz-logonpasswords
    description: Mimikatz logonpasswords command
    criticality: suspicious
    confidence: 0.98
    attack: "T1003.001"
    platforms: [windows]
    file_types: [pe, dll, shell, python]
    condition:
      type: string
      regex: "sekurlsa::logonpasswords"
      case_insensitive: true

  - id: mimikatz-error
    description: Mimikatz error string signature
    criticality: suspicious
    confidence: 0.95
    attack: "T1003.001"
    platforms: [windows]
    file_types: [pe, dll]
    condition:
      type: string
      exact: "ERROR kuhl"

  - id: backtrack-keylogger-yara
    description: BackTrack keylogger (macOS) via YARA
    criticality: suspicious
    confidence: 0.9
    attack: "T1056.001"
    platforms: [macos]
    file_types: [macho, dylib]
    condition:
      type: yara
      source: |
        rule backtrack_keylogger {
          strings:
            $modesitt = "Modesitt Software"
            $modesitt_web = "www.modesittsoftware"
            $backtrack = "BackTrack"
          condition:
            $backtrack and ($modesitt or $modesitt_web)
        }

composite_rules:
  - id: backtrack-keylogger
    description: BackTrack keylogger (macOS)
    criticality: suspicious
    confidence: 0.9
    attack: "T1056.001"
    platforms: [macos]
    file_types: [macho, dylib]
    requires_all:
      - id: backtrack-keylogger-yara

  - id: mimikatz
    description: Mimikatz credential extraction tool
    criticality: suspicious
    confidence: 0.98
    attack: "T1003.001"
    mbc: "E1003"
    platforms: [windows]
    file_types: [pe, dll, shell, python]
    requires_count: 1
    conditions:
      - id: mimikatz-logonpasswords
      - id: mimikatz-error
