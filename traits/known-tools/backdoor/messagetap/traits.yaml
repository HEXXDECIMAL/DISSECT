# Malware Family - MessageTap (APT41)
# Reference: https://malpedia.caad.fkie.fraunhofer.de/details/elf.messagetap
# ATT&CK: T1040 (Network Sniffing)

traits:
  - id: backdoor/messagetap/global-code-tag
    description: MessageTap operation tag
    criticality: suspicious
    confidence: 0.99
    family: true
    attack: "T1040"
    file_types: [elf]
    condition:
      type: string
      exact: "Operation_Global_Code_tag"

  - id: backdoor/messagetap/sms-intercept
    description: MessageTap SMS intercept log
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1040"
    file_types: [elf]
    condition:
      type: string
      exact: "send sms from %s imsi:%s"

  - id: backdoor/messagetap/tcap-parse
    description: MessageTap TCAP dialogue parser
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1040"
    file_types: [elf]
    condition:
      type: string
      exact: "tcap parse begin Dialogue"

composite_rules:
  - id: backdoor/messagetap/detected
    description: MessageTap SMS interception malware
    criticality: hostile
    confidence: 0.99
    family: true
    reference: "https://malpedia.caad.fkie.fraunhofer.de/details/elf.messagetap"
    attack: "T1040"
    mbc: "B0022"
    file_types: [elf]
    requires_all:
      - type: trait
        id: backdoor/messagetap/global-code-tag
      - type: trait
        id: backdoor/messagetap/sms-intercept
      - type: trait
        id: backdoor/messagetap/tcap-parse
