# Malware Family - TinyShell Backdoor
# Open-source backdoor, commonly reused in attacks
# ATT&CK: T1059.004 (Unix Shell)

traits:
  # === Go variant traits ===

  - id: backdoor/tinyshell/go-runshell
    description: TinyShell Go shell handler
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1059.004"
    file_types: [elf]
    condition:
      type: string
      exact: "handleRunShell"

  - id: backdoor/tinyshell/go-background
    description: TinyShell Go background execution
    criticality: suspicious
    confidence: 0.6
    attack: "T1059.004"
    file_types: [elf]
    condition:
      type: string
      exact: "RunInBackground"

  - id: backdoor/tinyshell/go-pty-wrapper
    description: TinyShell Go PTY wrapper
    criticality: suspicious
    confidence: 0.85
    family: true
    attack: "T1059.004"
    file_types: [elf]
    condition:
      type: string
      exact: "LinuxPtyWrapper"

  # === C variant traits ===

  - id: backdoor/tinyshell/c-runshell
    description: TinyShell C daemon shell function
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1059.004"
    file_types: [elf]
    condition:
      type: string
      exact: "_tshd_runshell"

  - id: backdoor/tinyshell/c-getfile
    description: TinyShell C file transfer function
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1105"
    file_types: [elf]
    condition:
      type: string
      exact: "_tshd_get_file"

  - id: backdoor/tinyshell/c-putfile
    description: TinyShell C file upload function
    criticality: suspicious
    confidence: 0.95
    family: true
    attack: "T1105"
    file_types: [elf]
    condition:
      type: string
      exact: "_tshd_put_file"

composite_rules:
  # Go variant detection
  - id: backdoor/tinyshell/go-detected
    description: TinyShell Go backdoor
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1059.004"
    mbc: "B0022"
    file_types: [elf]
    requires_all:
      - id: backdoor/tinyshell/go-runshell
      - id: backdoor/tinyshell/go-background
      - id: backdoor/tinyshell/go-pty-wrapper

  # C variant detection
  - id: backdoor/tinyshell/c-detected
    description: TinyShell C backdoor
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1059.004"
    mbc: "B0022"
    file_types: [elf]
    requires_count: 2
    conditions:
      - id: backdoor/tinyshell/c-runshell
      - id: backdoor/tinyshell/c-getfile
      - id: backdoor/tinyshell/c-putfile
