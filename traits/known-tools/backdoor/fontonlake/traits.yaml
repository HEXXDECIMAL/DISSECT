# Malware Family - FontOnLake Backdoor
# Reference: https://www.welivesecurity.com/2021/10/07/fontonlake-previously-unknown-malware-family-targeting-linux/
# ATT&CK: T1059.004 (Unix Shell)

traits:
  - id: backdoor/fontonlake/hidden-proc
    description: FontOnLake hidden proc path
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1564.001"
    file_types: [elf]
    condition:
      type: string
      regex: "/proc/\\.\\w{3,5}"

  - id: backdoor/fontonlake/x11-socket
    description: FontOnLake X11 socket path
    criticality: suspicious
    confidence: 0.85
    family: true
    attack: "T1071"
    file_types: [elf]
    condition:
      type: string
      exact: "/tmp/.X11-unix/X%u"

  - id: backdoor/fontonlake/insmod
    description: FontOnLake kernel module loading
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1547.006"
    file_types: [elf]
    condition:
      type: string
      exact: "/sbin/insmod %s > /dev/null"

  - id: backdoor/fontonlake/ssh-known-hosts
    description: FontOnLake SSH known_hosts2 access
    criticality: suspicious
    confidence: 0.85
    family: true
    attack: "T1552.004"
    file_types: [elf]
    condition:
      type: string
      exact: "~/.ssh/known_hosts2"

  - id: backdoor/fontonlake/dmesg-clear
    description: FontOnLake dmesg clearing
    criticality: suspicious
    confidence: 0.9
    family: true
    attack: "T1070"
    file_types: [elf]
    condition:
      type: string
      exact: "/bin/dmesg -c"

composite_rules:
  - id: backdoor/fontonlake/detected
    description: FontOnLake malware
    criticality: hostile
    confidence: 0.95
    family: true
    reference: "https://www.welivesecurity.com/2021/10/07/fontonlake-previously-unknown-malware-family-targeting-linux/"
    attack: "T1059.004"
    mbc: "B0022"
    file_types: [elf]
    requires_count: 4
    conditions:
      - type: trait
        id: backdoor/fontonlake/hidden-proc
      - type: trait
        id: backdoor/fontonlake/x11-socket
      - type: trait
        id: backdoor/fontonlake/insmod
      - type: trait
        id: backdoor/fontonlake/ssh-known-hosts
      - type: trait
        id: backdoor/fontonlake/dmesg-clear
