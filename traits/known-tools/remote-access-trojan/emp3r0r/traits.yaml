# Malware Family - emp3r0r Post-Exploitation Framework
# Linux/macOS post-exploitation framework
# Reference: https://github.com/jm33-m0/emp3r0r
# ATT&CK: T1071 (Application Layer Protocol)

traits:
  # === Atomic Traits ===

  - id: c2-framework/emp3r0r/brand-name
    description: emp3r0r brand string
    criticality: hostile
    confidence: 0.9
    family: true
    attack: "T1071"
    platforms: [linux, macos]
    file_types: [elf, macho]
    condition:
      type: string
      exact: "emp3r0r"

  - id: c2-framework/emp3r0r/shadowsocks-c2
    description: emp3r0r Shadowsocks C2 client
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1090.003"
    platforms: [linux, macos]
    file_types: [elf, macho]
    condition:
      type: string
      exact: "ShadowsocksC2Client"

  - id: c2-framework/emp3r0r/vaccine-handler
    description: emp3r0r vaccine handler (anti-AV)
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1562.001"
    platforms: [linux, macos]
    file_types: [elf, macho]
    condition:
      type: string
      exact: "VaccineHandler"

  - id: c2-framework/emp3r0r/guardian-shellcode
    description: emp3r0r guardian shellcode
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1055"
    platforms: [linux, macos]
    file_types: [elf, macho]
    condition:
      type: string
      exact: "GuardianShellcode"

  - id: c2-framework/emp3r0r/magic-bytes
    description: emp3r0r one-time magic bytes
    criticality: hostile
    confidence: 0.9
    family: true
    attack: "T1071"
    platforms: [linux, macos]
    file_types: [elf, macho]
    condition:
      type: string
      exact: "OneTimeMagicBytes"

composite_rules:
  - id: c2-framework/emp3r0r/detected
    description: emp3r0r post-exploitation agent
    criticality: hostile
    confidence: 0.95
    family: true
    reference: "https://github.com/jm33-m0/emp3r0r"
    attack: "T1071"
    mbc: "B0030"
    platforms: [linux, macos]
    file_types: [elf, macho]
    condition:
      type: yara
      source: |
        rule emp3r0r_agent {
          strings:
            $emp3r0r = "emp3r0r" fullword
            $shadowSocks = "ShadowsocksC2Client" fullword
            $vaccine = "VaccineHandler" fullword
            $guardian = "GuardianShellcode" fullword
            $magic = "OneTimeMagicBytes" fullword
          condition:
            filesize > 20MB and filesize < 45MB and 4 of them
        }
