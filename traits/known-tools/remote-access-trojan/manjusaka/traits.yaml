# Manjusaka C2 Framework Detection
# Chinese attack framework similar to Cobalt Strike/Sliver
# Reference: https://www.cisco.com/c/en/us/products/security/talos/manjusaka.html

defaults:
  file_types: [elf, macho, pe, so, dylib, dll]
  mbc: "B0030"
  attack: "T1071"

traits:
  - id: brand
    description: Manjusaka brand string
    crit: suspicious
    conf: 0.95
    condition:
      type: string
      regex: "(?i)manjusaka"

  - id: prefix
    description: Manjusaka function prefix
    crit: suspicious
    conf: 0.9
    condition:
      type: string
      exact: "mjs_"

  - id: rust-panic
    description: Manjusaka Rust panic handler
    crit: suspicious
    conf: 0.7
    condition:
      type: string
      exact: "rust_panic"

composite_rules:
  # Detected via brand string or prefix+rust-panic combination
  - id: detected
    description: Manjusaka C2 framework detected
    crit: suspicious
    conf: 0.95
    family: true
    reference: "https://blog.talosintelligence.com/manjusaka-offensive-framework/"
    requires_count: 2
    any:
      - id: known-tools/remote-access-trojan/manjusaka/brand
      - id: known-tools/remote-access-trojan/manjusaka/prefix
      - id: known-tools/remote-access-trojan/manjusaka/rust-panic
