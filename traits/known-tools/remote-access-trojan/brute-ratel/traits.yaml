# Malware Family - Brute Ratel C4
# Commercial adversary simulation framework
# ATT&CK: T1059 (Command and Scripting Interpreter)

traits:
  - id: c2-framework/brute-ratel/shellcode-xor
    description: Brute Ratel XOR'ed shellcode pattern
    criticality: suspicious
    confidence: 0.95
    family: true
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    file_types: [pe, dll]
    condition:
      type: yara
      source: |
        rule brute_ratel_shellcode {
          strings:
            $ref = "\x48\x83\xec\x50\x4d\x63\x68\x3c\x48\x89\x4d\x10" xor
          condition:
            any of them
        }

  - id: c2-framework/brute-ratel/badger-ref
    description: Brute Ratel badger reference
    criticality: suspicious
    confidence: 0.9
    family: true
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    file_types: [pe, dll]
    condition:
      type: string
      regex: "(?i)brute.*ratel|brc4|badger"

  - id: c2-framework/brute-ratel/c4-config
    description: Brute Ratel C4 configuration patterns
    criticality: suspicious
    confidence: 0.85
    family: true
    mbc: "B0030"
    attack: "T1059"
    platforms: [windows]
    file_types: [pe, dll]
    condition:
      type: yara
      source: |
        rule brute_ratel_config {
          strings:
            $cfg1 = "badger_config" ascii nocase
            $cfg2 = "brc4" ascii nocase
            $cfg3 = "bruteratel" ascii nocase
          condition:
            any of them
        }

composite_rules:
  - id: c2-framework/brute-ratel/detected
    description: Brute Ratel C4 framework
    criticality: hostile
    confidence: 0.95
    family: true
    attack: "T1059"
    mbc: "B0030"
    platforms: [windows]
    file_types: [pe, dll]
    requires_any:
      - type: trait
        id: c2-framework/brute-ratel/shellcode-xor
      - type: trait
        id: c2-framework/brute-ratel/badger-ref
      - type: trait
        id: c2-framework/brute-ratel/c4-config
