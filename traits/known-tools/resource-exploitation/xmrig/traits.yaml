# XMRig cryptocurrency miner detection
# ATT&CK: T1496 (Resource Hijacking)

traits:
  - id: cryptominer/xmrig/user-flag
    description: "XMRig -u flag (wallet/user)"
    criticality: suspicious
    confidence: 0.8
    attack: "T1496"
    file_types: [elf, macho, pe, so, dylib, dll, shell]
    condition:
      type: string
      regex: "'-u'|'-user'"

  - id: cryptominer/xmrig/pool-flag
    description: "XMRig -o flag (pool address)"
    criticality: suspicious
    confidence: 0.8
    attack: "T1496"
    file_types: [elf, macho, pe, so, dylib, dll, shell]
    condition:
      type: string
      regex: "'-o'|'--url'"

  - id: cryptominer/xmrig/mining-port
    description: "Common cryptocurrency mining pool ports"
    criticality: notable
    confidence: 0.7
    attack: "T1496"
    file_types: [elf, macho, pe, so, dylib, dll, shell]
    condition:
      type: string
      regex: ":\\d*(3333|8080|14444|5555|7777|45700)"

composite_rules:
  - id: cryptominer/xmrig/invocation
    description: "XMRig-style miner invocation"
    confidence: 0.95
    criticality: suspicious
    mbc: "B0036"
    attack: "T1496"
    file_types: [elf, macho, pe, so, dylib, dll, shell]
    requires_count: 2
    conditions:
      - id: cryptominer/xmrig/user-flag
      - id: cryptominer/xmrig/pool-flag
      - id: cryptominer/xmrig/mining-port
