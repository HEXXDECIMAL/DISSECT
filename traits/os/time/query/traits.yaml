# Time and Date Operation Traits
# MBC: OB0009 (Operating System) â†’ Various time-related operations
# ATT&CK: T1124 (System Time Discovery), T1070.006 (Timestomp)

defaults:
  file_types: [elf, macho, so, dylib, c]

traits:
  # Time retrieval
  - id: time
    description: Get current calendar time (seconds since epoch)
    crit: inert
    mbc: "T1124"
    attack: "T1124"
    confidence: 0.3
    condition:
      type: symbol
      pattern: time
    platforms: [unix, linux, macos, windows]

  - id: gettimeofday
    description: Get current time with microsecond precision
    crit: inert
    mbc: "T1124"
    attack: "T1124"
    confidence: 0.3
    condition:
      type: symbol
      pattern: gettimeofday
    platforms: [unix, linux, macos]

  - id: clock_gettime
    description: Get time from specified clock
    crit: inert
    mbc: "T1124"
    attack: "T1124"
    confidence: 0.3
    condition:
      type: symbol
      pattern: clock_gettime
    platforms: [unix, linux, macos]

  # Time formatting and conversion
  - id: localtime
    description: Convert time to local time structure
    crit: inert
    confidence: 0.2
    condition:
      type: symbol
      pattern: localtime
    platforms: [unix, linux, macos, windows]

  - id: gmtime
    description: Convert time to UTC time structure
    crit: inert
    confidence: 0.2
    condition:
      type: symbol
      pattern: gmtime
    platforms: [unix, linux, macos, windows]

  - id: strftime
    description: Format time as string
    crit: inert
    confidence: 0.2
    condition:
      type: symbol
      pattern: strftime
    platforms: [unix, linux, macos, windows]

  - id: strptime
    description: Parse time string into time structure
    crit: inert
    confidence: 0.2
    condition:
      type: symbol
      pattern: strptime
    platforms: [unix, linux, macos]

  # Time manipulation (suspicious for timestomping)
  - id: settimeofday
    description: Set system time (requires privileges)
    crit: suspicious
    mbc: "F0005"
    attack: "T1070.006"
    confidence: 0.9
    condition:
      type: symbol
      pattern: settimeofday
    platforms: [unix, linux, macos]

  - id: clock_settime
    description: Set time for specified clock (requires privileges)
    crit: suspicious
    mbc: "F0005"
    attack: "T1070.006"
    confidence: 0.9
    condition:
      type: symbol
      pattern: clock_settime
    platforms: [unix, linux, macos]

  - id: utimes
    description: Change file access and modification times
    crit: notable
    mbc: "F0005"
    attack: "T1070.006"
    confidence: 0.7
    condition:
      type: symbol
      pattern: utimes|utimensat|futimens
    platforms: [unix, linux, macos]

  # Sleep/delay functions
  - id: sleep
    description: Suspend execution for interval
    crit: inert
    confidence: 0.4
    condition:
      type: symbol
      pattern: sleep|usleep|nanosleep
    platforms: [unix, linux, macos]
