# JavaScript Dynamic Code Execution
# Detects obfuscated code execution patterns in JavaScript
# ATT&CK: T1059.007 (JavaScript)

composite_rules:
  - id: obfuscated-function-constructor
    desc: Obfuscated Function constructor usage
    crit: hostile
    conf: 0.95
    for: [javascript]
    mbc: "B0032"
    attack: "T1059.007"
    all:
      - id: obj/anti-static/obfuscation/require::function-constructor
      - id: cap/data/source/metrics/obfuscation::high-entropy-strings

  - id: dynamic-code-execution
    desc: Dynamic code execution with obfuscation
    crit: hostile
    conf: 0.93
    for: [javascript]
    attack: "T1059.007"
    all:
      - id: obj/exec/interpreter/eval/dynamic::eval-call-js
    any:
      - id: cap/data/source/metrics/obfuscation::high-entropy-identifiers
      - id: cap/data/source/metrics/obfuscation::high-entropy-strings
    downgrade:
      any:
        - id: obj/exec/interpreter/eval/dynamic::eval-function-definition
