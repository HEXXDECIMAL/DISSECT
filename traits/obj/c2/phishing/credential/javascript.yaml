# Phishing / Credential Harvesting - JavaScript
# Detects phishing pages and credential harvesting scripts
# ATT&CK: T1566.002 (Phishing: Spearphishing Link), T1056 (Input Capture)

traits:
  - id: js-microsoft-branding
    desc: Microsoft branding/logo
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: 'Microsoft_logo\.svg|Microsoft'

  - id: js-fake-login
    desc: Fake login form logic
    crit: suspicious
    conf: 0.85
    if:
      type: string
      regex: 'Sign in|Authentication required|id="emailInput"|id="passwordInput"'

  - id: js-bot-detection
    desc: Browser bot detection logic
    crit: suspicious
    conf: 0.9
    if:
      type: raw
      regex: 'navigator\.webdriver|headless|HeadlessChrome'

  - id: js-honeypot-field
    desc: Honeypot form field (anti-bot)
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: 'honeypot-field|class="honeypot"'

  - id: js-document-lure
    desc: Document sharing/preview lure
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: 'securely shared|Specification\.pdf|Project descriptions'

composite_rules:
  - id: js-microsoft-phishing-page
    desc: Microsoft credential phishing page
    crit: hostile
    conf: 0.98
    attack: "T1566.002"
    all:
      - id: js-microsoft-branding
      - id: js-fake-login
    any:
      - id: js-bot-detection
      - id: js-document-lure
      - id: js-honeypot-field
