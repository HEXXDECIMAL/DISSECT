# Java Network C2 Infrastructure Detection
# MBC: C0002 (HTTP Communication), C0001 (Socket Communication)
# ATT&CK: T1071.001 (Application Layer Protocol), T1095 (Non-Application Layer Protocol)

traits:
  - id: java-c2-nonstandard-ports
    desc: Java hardcoded C2 endpoints with non-standard ports
    crit: suspicious
    conf: 0.85
    mbc: "C0002"
    attack: "T1071.001"
    for: [java, class]
    if:
      type: string
      regex: "[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}:[0-9]{4,5}"
      count_min: 2

  - id: java-base64-network-endpoints
    desc: Base64-encoded network endpoints in Java bytecode
    crit: suspicious
    conf: 0.9
    mbc: "B0032"
    attack: "T1140"
    for: [java, class]
    if:
      type: base64
      regex: "[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}:[0-9]{4,5}"
      count_min: 1

  - id: java-multiple-c2-endpoints
    desc: Java application with multiple hardcoded C2 endpoints
    crit: suspicious
    conf: 0.8
    mbc: "C0002"
    attack: "T1071.001"
    for: [java, class]
    if:
      type: string
      regex: "[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}:[0-9]+"
      count_min: 3

composite_rules:
  - id: java-adwind-c2-infrastructure
    desc: Java Adwind RAT C2 infrastructure pattern
    crit: hostile
    conf: 0.92
    mbc: "C0002"
    attack: "T1071.001"
    for: [java, class]
    any:
      - id: java-base64-network-endpoints
    all:
      - id: java-multiple-c2-endpoints