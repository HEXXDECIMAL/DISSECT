# Java RAT Behavior Detection
# Composite rules that combine traits to detect RAT capabilities

traits:
  - id: allatori-demo
    desc: Allatori obfuscator demo marker
    crit: notable
    conf: 0.9
    for: [class]
    if:
      type: string
      substr: "ALLATORIxDEMO"

composite_rules:
  # Full-featured Java RAT (STRRat-style)
  - id: java-rat-comprehensive
    desc: Comprehensive Java RAT with multiple
    crit: suspicious
    mbc: "B0022"
    attack: "T1219"
    conf: 0.98
    for: [class]
    needs: 4
    any:
      # Credential access
      - id: chrome-pass-string
      - id: firefox-pass-string
      - id: keylogger-string
      - id: all-pass-string
      # C2 commands
      - id: remote-cmd-string
      - id: power-shell-string
      - id: down-n-exec-string
      - id: up-n-exec-string
      - id: remote-screen-string
      # Impact
      - id: reboot-string
      - id: uninstall-string

  # Java credential stealer
  - id: java-credential-stealer
    desc: Java-based credential stealing capability
    crit: suspicious
    mbc: "T1555"
    attack: "T1555"
    conf: 0.95
    for: [class]
    needs: 2
    any:
      - id: chrome-pass-string
      - id: firefox-pass-string
      - id: ie-pass-string
      - id: outlook-pass-string
      - id: thunderbird-pass-string
      - id: foxmail-pass-string
      - id: all-pass-string
      - id: save-all-pass-string

  # Java keylogger
  - id: java-keylogger
    desc: Java keylogging capability
    crit: suspicious
    mbc: "T1056.001"
    attack: "T1056.001"
    conf: 0.95
    for: [class]
    needs: 1
    any:
      - id: keylogger-string
      - id: o-keylogger-string

  # Java remote access
  - id: java-remote-access
    desc: Java remote access capability
    crit: suspicious
    mbc: "B0022"
    attack: "T1021"
    conf: 0.95
    for: [class]
    needs: 2
    any:
      - id: remote-screen-string
      - id: hrdp-new-string
      - id: hrdp-res-string
      - id: remote-cmd-string
      - id: power-shell-string

  # Java dropper/downloader
  - id: java-dropper
    desc: Java download and execute capability
    crit: suspicious
    mbc: "B0025"
    attack: "T1105"
    conf: 0.95
    for: [class]
    needs: 1
    any:
      - id: down-n-exec-string
      - id: up-n-exec-string

  # Java ransomware indicators
  - id: java-ransomware
    desc: Java ransomware capability
    crit: suspicious
    mbc: "B0031"
    attack: "T1486"
    conf: 0.95
    for: [class]
    all:
      - id: rw-encrypt-string
      - id: rw-decrypt-string
