traits:
  - id: hex-subdomain-concat
    desc: Appends hex-encoded data to domain string
    crit: notable
    if:
      type: string
      substr: "IMPOSSIBLE_MATCH_XYZZY_DNS_CONCAT"

  - id: hex-subdomain-plus
    desc: Concatenates hex strings with dots
    crit: notable
    if:
      type: string
      substr: "IMPOSSIBLE_MATCH_XYZZY_DNS_PLUS"
composite_rules:
  - id: js-dns-tunneling-construction
    desc: JavaScript DNS tunneling payload construction (hex-encoded subdomains)
    crit: suspicious
    conf: 0.85
    attack: "T1071.004"
    for: [javascript]
    any:
      - id: obj/c2/dns/tunneling::hex-chunk-concat-loop
      - id: obj/c2/dns/tunneling::hex-path-chunk-split
      - id: obj/c2/dns/tunneling::hex-path-p-wrapping
      - id: obj/c2/dns/tunneling::hex-subdomain-concat
      - id: obj/c2/dns/tunneling::hex-subdomain-plus
