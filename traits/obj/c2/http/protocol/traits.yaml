# HTTP C2 Protocol Detection - Composites
# Detects suspicious HTTP patterns that may indicate C2 communication
# ATT&CK: T1071.001 (Application Layer Protocol: Web Protocols)

defaults:
  for: [elf, pe, macho]
  attack: "T1071.001"
  crit: suspicious

traits:
  - id: http-method-get
    desc: Hardcoded GET method string
    crit: inert
    conf: 0.6
    if:
      type: string
      substr: "GET "

  - id: http-method-post
    desc: Hardcoded POST method string
    crit: notable
    conf: 0.65
    if:
      type: string
      substr: "POST "

  - id: http-delimiter
    desc: HTTP header delimiter
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "\r\n\r\n"

  - id: http-user-agent
    desc: User-Agent header string
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "User-Agent:"

  - id: http-content-type
    desc: Content-Type header string
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "Content-Type:"

composite_rules:
  - id: hardcoded-request
    desc: "Hardcoded HTTP request in binary"
    crit: suspicious
    conf: 0.7
    all:
      - id: cap/exec/vm/sandbox::http-protocol-string
    any:
      - id: http-method-get
      - id: http-method-post

  - id: custom-client
    desc: "Custom HTTP client implementation"
    crit: suspicious
    conf: 0.65
    all:
      - id: cap/exec/vm/sandbox::http-protocol-string
      - id: http-delimiter
    any:
      - id: http-user-agent
      - id: http-content-type
