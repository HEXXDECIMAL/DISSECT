# Reverse Shell Detection - Generic
# MBC: B0033 (Adversary-in-the-Middle)
# ATT&CK: T1059

traits:
  # === Reverse shell string patterns ===
  - id: reverse-shell-string
    desc: reverse shell string pattern
    crit: suspicious
    conf: 0.7
    attack: "T1059"
    if:
      type: string
      regex: "(?i)(r[e3]v[e3]rs[e3]|w[3e]b)\\s*sh[e3]ll"

  - id: revshell-string
    desc: revshell string
    crit: suspicious
    conf: 0.7
    attack: "T1059"
    if:
      type: string
      substr: "revshell"

  # === Exclusion patterns ===
  - id: elastic-license
    desc: Elastic License v2 (detection rule
    crit: inert
    conf: 0.3
    if:
      type: string
      substr: '"license": "Elastic License v2"'

composite_rules:
  # Reverse shell string match
  - id: reverse-shell-match
    desc: Matches reverse shell string patterns
    crit: suspicious
    conf: 0.7
    attack: "T1059"
    needs: 1
    any:
      - id: reverse-shell-string
      - id: revshell-string

  # Reverse shell composite (migrated from YARA)
  - id: reverse-shell
    desc: References a reverse shell
    crit: suspicious
    conf: 0.66
    attack: "T1059"
    all:
      - id: reverse-shell-match
    none:
      - id: elastic-license
