# Ruby obfuscation and encoding techniques

traits:
  - id: base64-decode
    desc: "Base64 decode (potential obfuscation)"
    crit: notable
    conf: 0.88
    attack: "T1027"
    for: [ruby]
    if:
      type: content
      regex: "Base64\\.decode64|Base64\\.strict_decode64"

  - id: base64-decode-symbol
    desc: "Base64 decode64 call"
    crit: notable
    conf: 0.88
    attack: "T1027"
    for: [ruby]
    if:
      type: symbol
      exact: "decode64"

  - id: base64-encode
    desc: "Base64 encode"
    crit: notable
    conf: 0.88
    attack: "T1027"
    for: [ruby]
    if:
      type: string
      regex: "Base64\\.encode64|Base64\\.strict_encode64"

  - id: marshal-load
    desc: "Marshal deserialization (RCE risk)"
    crit: suspicious
    conf: 0.93
    attack: "T1059"
    for: [ruby]
    if:
      type: string
      regex: "Marshal\\.load|Marshal\\.restore"

  - id: yaml-unsafe-load
    desc: "YAML unsafe deserialization"
    crit: suspicious
    conf: 0.90
    attack: "T1059"
    for: [ruby]
    if:
      type: string
      regex: "YAML\\.load"

  - id: reflection-send
    desc: "Dynamic method invocation"
    crit: notable
    conf: 0.85
    attack: "T1027"
    for: [ruby]
    if:
      type: string
      regex: "\\.send\\(|\\.send"

  - id: const-get
    desc: "Dynamic constant access"
    crit: notable
    conf: 0.90
    attack: "T1027"
    for: [ruby]
    if:
      type: string
      regex: "const_get"

  - id: const-set
    desc: "Dynamic constant definition"
    crit: notable
    conf: 0.90
    attack: "T1027"
    for: [ruby]
    if:
      type: string
      regex: "const_set"

  - id: define-method
    desc: "Dynamic method definition"
    crit: notable
    conf: 0.90
    attack: "T1027"
    for: [ruby]
    if:
      type: string
      regex: "define_method"
