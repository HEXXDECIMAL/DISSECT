# JavaScript Logic Obfuscation
# Detects obfuscated logic flow and arithmetic patterns
# ATT&CK: T1027 (Obfuscated Files or Information)

traits:
  - id: js-mixed-hex-octal-math
    desc: Mixed hex and octal arithmetic (obfuscation)
    crit: suspicious
    conf: 0.95
    for: [javascript]
    if:
      type: raw
      regex: '0[oO][0-7]+\s*[\+\-\*\/&\|\^%]\s*0x[0-9a-fA-F]+|0x[0-9a-fA-F]+\s*[\+\-\*\/&\|\^%]\s*0[oO][0-7]+'

  - id: js-eval-self-string
    desc: Eval executing function with self-toString check
    crit: suspicious
    conf: 0.9
    for: [javascript]
    if:
      type: raw
      regex: 'eval\s*\(\s*["'']\(function\s+\w+\([^)]{0,120}\)\s*\{.{0,200}\.toString\(\)'

composite_rules:
  - id: js-complex-obfuscation
    desc: Complex JavaScript obfuscation (hex/octal math + eval)
    crit: hostile
    conf: 0.95
    attack: "T1027"
    for: [javascript]
    all:
      - id: js-mixed-hex-octal-math
      - id: obj/exec/interpreter/eval/dynamic::eval-call-js
