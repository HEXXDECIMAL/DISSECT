# String Obfuscation Detection - Rust
# MBC: B0032 (Obfuscated Files or Information)
# ATT&CK: T1027

traits:
  - id: strings-vector-obfuscation
    desc: Byte vector obfuscation
    crit: suspicious
    conf: 0.8
    mbc: "B0032"
    attack: "T1027"
    for: [rust]
    if:
      type: ast
      kind: array
      regex: 'vec!\[\s*[0-9,\s]{10,}'

  - id: strings-parse-fn-pattern
    desc: String parse function
    crit: suspicious
    conf: 0.85
    mbc: "B0032"
    attack: "T1027"
    for: [rust]
    if:
      type: ast
      kind: call
      regex: 'parse_fn\s*\(\s*&vec!\['

  - id: strings-hardcoded-bytes
    desc: Hardcoded byte arrays
    crit: notable
    conf: 0.7
    mbc: "B0032"
    attack: "T1027"
    for: [rust]
    if:
      type: ast
      kind: array
      regex: '\[([0-9]{1,3},\s*){5,}\d{1,3}\]'

composite_rules:
  - id: obfuscated-string-decode
    desc: Obfuscated string decoding in Rust
    crit: suspicious
    conf: 0.85
    mbc: "B0032"
    for: [rust]
    needs: 1
    any:
      - id: strings-parse-fn-pattern
      - id: strings-vector-obfuscation
