# Python Packing Patterns
# Detects common Python packing/obfuscation techniques
# MBC: B0032 (Obfuscated Files or Information)
# ATT&CK: T1027 (Obfuscated Files or Information)

traits:
  # === Specific Packing Indicators ===
  # (Empty for now, using composite rules based on capabilities)

composite_rules:
  # Executing marshal-deserialized zlib-compressed payload
  # Pattern: exec(marshal.loads(zlib.decompress(base64.b85decode(...))))
  # This is a very specific and high-signal hostile pattern used by Python packers/droppers.
  - id: exec-marshal-zlib
    desc: Executing marshal-deserialized zlib-compressed payload
    crit: hostile
    conf: 0.99
    mbc: "B0032"
    attack: "T1027"
    for: [python]
    all:
      - id: obj/anti-static/obfuscation/payload::exec-function-call
      - id: cap/data/serialization/unsafe::marshal-loads
      - id: cap/data/compression/library::zlib-decompress
    any:
      - id: cap/data/encode/base64::b85decode-call
      - id: cap/data/encode/base64::b64decode-call
