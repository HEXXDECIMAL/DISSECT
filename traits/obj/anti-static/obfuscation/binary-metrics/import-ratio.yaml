# Import-to-size ratio anomalies
# Detects binaries with suspiciously few imports relative to file size
# Indicates embedded payloads, overlay data, or statically compiled malware

traits:
  - id: max-30-imports
    desc: Binary has 30 or fewer imports
    crit: notable
    conf: 0.7
    for: [pe, elf, macho]
    if:
      type: import_combination
      max_total: 30

  - id: max-25-imports
    desc: Binary has 25 or fewer imports
    crit: notable
    conf: 0.75
    for: [pe, elf, macho]
    if:
      type: import_combination
      max_total: 25

  - id: max-50-imports
    desc: Binary has 50 or fewer imports
    crit: inert
    conf: 0.7
    for: [pe, elf, macho]
    if:
      type: import_combination
      max_total: 50

composite_rules:
  # === Extreme size-to-import ratio ===

  - id: massive-file-minimal-imports
    desc: Large binary with minimal imports
    crit: suspicious
    conf: 0.9
    for: [pe, elf, macho]
    attack: "T1027"
    mbc: "B0032"
    size_min: 5242880  # 5MB
    all:
      - id: max-30-imports
    any:
      # Has dynamic loading (hiding real imports)
      - id: cap/dylib/load::load-library-a
      - id: cap/dylib/lookup::get-proc-address
      - id: cap/dylib/load::dlopen
      - id: cap/dylib/lookup::dlsym-symbol

  - id: huge-file-tiny-imports
    desc: Huge binary with minimal imports
    crit: hostile
    conf: 0.95
    for: [pe, elf, macho]
    attack: "T1027"
    mbc: "B0032"
    size_min: 10485760  # 10MB
    all:
      - id: max-25-imports
    needs: 2
    any:
      - id: cap/dylib/load::load-library-a
      - id: cap/dylib/lookup::get-proc-address
      - id: cap/crypto
      - id: cap/process/create/shell

  - id: embedded-payload-binary
    desc: Binary with suspected embedded payload
    crit: suspicious
    conf: 0.85
    for: [pe, elf, macho]
    attack: "T1027.009"
    size_min: 1048576  # 1MB
    all:
      - id: max-50-imports
    needs: 2
    any:
      - id: obj/anti-analysis/packing/entropy::high-entropy-section
      - id: obj/anti-static/obfuscation/binary-metrics::dominant-section
      - id: cap/process/create/shell
      - id: cap/crypto
    downgrade:
      any:
        - id: obj/exec/reflection/invoke::namespace-import
        - id: obj/exec/reflection/invoke::method-info
        - id: obj/exec/reflection/invoke::property-info
