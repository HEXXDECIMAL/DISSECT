# Quarantine attribute removal (Gatekeeper bypass)
# Removes macOS quarantine xattr to bypass Gatekeeper security check
# ATT&CK: T1562.001 (Impair Defenses), T1562.004 (Disable Cloud Logs)
# MBC: B0047 (Defense Evasion)

traits:
  - id: xattr-quarantine-remove
    desc: xattr removes quarantine attribute
    crit: suspicious
    conf: 0.90
    mbc: "B0047"
    attack: "T1562.001"
    platforms: [macos]
    if:
      type: string
      regex: '[fx]?xattr\s+.*?(-d|delete|--delete).*?com\.apple\.quarantine'

composite_rules:
  - id: quarantine-bypass
    desc: Remove macOS Gatekeeper quarantine marking
    crit: suspicious
    conf: 0.90
    platforms: [macos]
    for: [macho, shell, python, ruby, javascript, go, perl]
    needs: 1
    any:
      - id: xattr-quarantine-remove
