# Self-Deletion Detection - Shell
# MBC: F0007 (Self Deletion)
# ATT&CK: T1070.004

traits:
  # === Self-deletion patterns ===
  - id: rm-dollar-zero
    desc: rm $0 self-deletion
    crit: suspicious
    conf: 0.8
    mbc: "F0007"
    attack: "T1070.004"
    if:
      type: string
      substr: "rm $0"

  - id: rm-dollar-zero-quoted
    desc: 'rm "$0" self-deletion (quoted)'
    crit: suspicious
    conf: 0.8
    mbc: "F0007"
    attack: "T1070.004"
    if:
      type: string
      substr: 'rm "$0"'

  - id: shred-dollar-zero
    desc: shred $0 self-deletion
    crit: suspicious
    conf: 0.85
    mbc: "F0007"
    attack: "T1070.004"
    if:
      type: string
      regex: 'shred\s+(-[a-z]+\s+)?["'']?\$0["'']?'

  - id: rm-install-artifacts
    desc: Delete installer/setup artifacts
    crit: suspicious
    conf: 0.75
    mbc: "F0007"
    attack: "T1070.004"
    if:
      type: string
      regex: 'rm\s+(-[rf]+\s+)+(install|setup|\.install|INSTALL|\.tar|\.tar\.gz|\.zip)'

composite_rules:
  # Self-deleting shell script (migrated from YARA)
  - id: self-delete-shell
    desc: Self-deleting shell script
    crit: suspicious
    conf: 0.66
    mbc: "F0007"
    attack: "T1070.004"
    needs: 1
    any:
      - id: rm-dollar-zero
      - id: rm-dollar-zero-quoted
      - id: shred-dollar-zero
      - id: rm-install-artifacts
