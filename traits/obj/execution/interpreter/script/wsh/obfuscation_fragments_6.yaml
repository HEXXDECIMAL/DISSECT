# Obfuscated WSH String Fragments (MSXML2/WScript)
# Detects tiny fragmented strings for MSXML2 and WScript.Shell, often seen in Nemucod

defaults:
  crit: notable
  conf: 0.8
  for: [javascript]

traits:
  - id: wsh-tiny-fragment-msxml2
    desc: "Assignment of MSXML2/XMLHTTP fragments (L2., XML, TP)"
    if:
      type: raw
      # var x = "L2."; var y = "XML"; var z = "TP";
      # Matches: L2., XML, TP (from MSXML2.XMLHTTP)
      regex: 'var\s+[\w$]+\s*=\s*["''](L2\.|XML|TP|Res|pon|seB|ody)["'']'
      count_min: 1

  - id: wsh-tiny-fragment-response-body
    desc: "Assignment of ResponseBody fragments (Res, pon, seB, ody)"
    if:
      type: raw
      # Matches: Res, pon, seB, ody (from ResponseBody)
      regex: 'var\s+[\w$]+\s*=\s*["''](Res|pon|seB|ody)["'']'
      count_min: 1
