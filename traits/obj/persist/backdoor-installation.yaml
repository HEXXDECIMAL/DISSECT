# Remote Shell Backdoor Installation
# Detects installation of telnet and SSH backdoors for persistent access
# ATT&CK: T1021.004 (Remote Services: SSH)
# MBC: E1037 (Communication)

traits:
  # === Telnet Backdoor ===
  - id: telnet-service
    desc: "Telnet service for remote access"
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      word: "telnet"
    notes: "Telnet service for remote access"
    attack: "T1021.004"

  - id: telnetd-daemon
    desc: "Telnet daemon for remote access"
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "telnetd"
    notes: "Telnet daemon installation"
    attack: "T1021.004"

  # === SSH Backdoor ===
  - id: sshd-service
    desc: "SSH daemon encrypted remote access"
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "sshd"
    notes: "SSH daemon for encrypted remote access"
    attack: "T1021.004"

  - id: dropbear-lightweight-ssh
    desc: "Dropbear SSH server"
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "dropbear"
    notes: "Lightweight SSH server (common on IoT/embedded)"
    attack: "T1021.004"

  # === Shell Access ===
  - id: bash-shell
    desc: "Bash shell"
    crit: inert
    conf: 0.7
    for: [elf, shell]
    if:
      type: string
      word: "bash"
    notes: "Shell binary reference"

  - id: system-call
    desc: "System call"
    crit: inert
    conf: 0.7
    for: [elf, shell]
    if:
      type: string
      word: "system"
    notes: "System function for command execution"

composite_rules:
  - id: telnet-backdoor-setup
    desc: "Telnet backdoor setup"
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1021.004"
    mbc: "E1037"
    notes: "Telnet service installation for remote shell access"
    any:
      - id: telnet-service
      - id: telnetd-daemon

  - id: ssh-backdoor-setup
    desc: "SSH backdoor setup"
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1021.004"
    mbc: "E1037"
    notes: "SSH/Dropbear installation for encrypted remote access"
    any:
      - id: sshd-service
      - id: dropbear-lightweight-ssh

  - id: remote-shell-backdoor
    desc: "Remote shell backdoor"
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1021.004"
    mbc: "E1037"
    notes: |
      Remote shell backdoor installation pattern.
      Indicates:
      - Persistent remote access capability
      - Telnet (unencrypted) and/or SSH (encrypted) access
      - Enables attacker shell execution on compromised device
    all:
      - id: telnet-backdoor-setup
      - id: ssh-backdoor-setup

  - id: mirai-telnet-ssh-backdoor
    desc: "Mirai remote shell backdoor"
    crit: hostile
    conf: 0.95
    for: [elf, shell]
    attack: "T1021.004"
    mbc: "E1037"
    notes: |
      Mirai botnet installing remote shell backdoors.
      Enables:
      - Remote command execution via telnet/SSH
      - Persistent C2 access independent of botnet process
      - Interactive shell for attacker operations
    all:
      - id: known/malware/botnet/mirai
      - id: remote-shell-backdoor
