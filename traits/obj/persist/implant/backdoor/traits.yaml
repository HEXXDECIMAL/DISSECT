# Remote Shell Backdoor Installation
# Detects installation of telnet and SSH backdoors for persistent access
# ATT&CK: T1021.004 (Remote Services: SSH)
# MBC: E1037 (Communication)

traits:
  # === Telnet Backdoor ===
  - id: telnet-service
    desc: "Telnet service for remote access"
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      word: "telnet"
    attack: "T1021.004"

  - id: telnetd-daemon
    desc: "Telnet daemon for remote access"
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "telnetd"
    attack: "T1021.004"

  # === SSH Backdoor ===
  - id: sshd-service
    desc: "SSH daemon encrypted remote access"
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "sshd"
    attack: "T1021.004"

  - id: dropbear-lightweight-ssh
    desc: "Dropbear SSH server"
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      word: "dropbear"
    attack: "T1021.004"

  # === Shell Access ===
  - id: bash-shell
    desc: "Bash shell"
    crit: inert
    conf: 0.7
    for: [elf, shell]
    if:
      type: string
      word: "bash"

  - id: system-call
    desc: "System call"
    crit: inert
    conf: 0.7
    for: [elf, shell]
    if:
      type: string
      word: "system"

composite_rules:
  - id: telnet-backdoor-setup
    desc: "Telnet backdoor setup"
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1021.004"
    mbc: "E1037"
    any:
      - id: telnet-service
      - id: telnetd-daemon

  - id: ssh-backdoor-setup
    desc: "SSH backdoor setup"
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1021.004"
    mbc: "E1037"
    any:
      - id: sshd-service
      - id: dropbear-lightweight-ssh

  - id: remote-shell-backdoor
    desc: "Remote shell backdoor"
    crit: suspicious
    conf: 0.9
    for: [elf, shell]
    attack: "T1021.004"
    mbc: "E1037"
    all:
      - id: telnet-backdoor-setup
      - id: ssh-backdoor-setup

  - id: mirai-telnet-ssh-backdoor
    desc: "Mirai remote shell backdoor"
    crit: hostile
    conf: 0.95
    for: [elf, shell]
    attack: "T1021.004"
    mbc: "E1037"
    all:
      - id: known/malware/botnet/mirai
      - id: remote-shell-backdoor
