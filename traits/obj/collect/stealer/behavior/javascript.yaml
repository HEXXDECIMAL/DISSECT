# Stealer / Spyware - JavaScript
# ATT&CK: T1005, T1056, T1113

composite_rules:
  # === Helpers ===
  - id: js-defanged-c2
    desc: Defanged C2 IP address
    crit: suspicious
    conf: 0.9
    any:
      - id: cap/comm/ip/parse::ip-defanged-brackets
      - id: cap/comm/ip/parse::ip-defanged-parentheses

  - id: js-browser-target
    desc: Targets browser data paths
    crit: notable
    conf: 0.8
    any:
      - id: obj/creds/browser/chromium

  # === Hostile Rules ===

  - id: js-spyware-bundle
    desc: JavaScript spyware bundle (Keylogging + Screenshots + Network)
    crit: hostile
    conf: 0.95
    attack: "T1056"
    for: [javascript]
    all:
      - id: cap/hw/input/keyboard::global-keyboard-listener
      - id: cap/hw/display/screen::import-node-screenshots
      - id: cap/comm/http/request::axios

  - id: js-file-stealer-recursive
    desc: Recursive file stealer targeting sensitive data
    crit: hostile
    conf: 0.90
    attack: "T1005"
    for: [javascript]
    all:
      - id: cap/fs/enumerate/directory::fs-readdir-recursive
      - id: cap/fs/enumerate/directory::file-search-exclude-common
      - id: cap/comm/http/request::axios

  - id: js-browser-stealer-c2
    desc: Browser data stealer with defanged C2 IP
    crit: hostile
    conf: 0.95
    attack: "T1555.003"
    for: [javascript]
    all:
      - id: cap/comm/http/request::axios
      - id: js-defanged-c2
      - id: js-browser-target

  - id: obfuscated-browser-stealer
    desc: Obfuscated browser/credential stealer
    crit: hostile
    conf: 0.95
    attack: "T1555.003"
    for: [javascript]
    all:
      - id: obj/discovery/host/browser::browser-names
      - id: obj/anti-static/obfuscation/packing::packed-string-decryptor
    any:
      - id: obj/creds/discord/token::appdata-ref
      - id: obj/collect/messaging/app::discord-ldb-ext
      - id: obj/impact/ransomware/behavior::writefile-fn