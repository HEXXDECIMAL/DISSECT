# Competing Malware Elimination Patterns
# Detects techniques for killing and disabling other malware
# Generic indicator for botnet dominance and exclusivity

traits:
  - id: xmrig-targeting
    desc: XMRig miner targeting
    crit: notable
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      any:
        - substr: "xmrig"
        - substr: "xmrigCC"
        - substr: "xmrig-proxy"
    notes: "XMRig cryptocurrency miner targeting"
    attack: "T1561"

  - id: cryptonight-targeting
    desc: CryptoNight/mining process targeting
    crit: notable
    conf: 0.75
    for: [elf, shell]
    if:
      type: string
      any:
        - substr: "minerd"
        - substr: "cpuminer"
        - substr: "cryptonight"
    notes: "Generic mining daemon targeting"
    attack: "T1561"

  - id: mirai-targeting
    desc: Mirai botnet targeting
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      any:
        - substr: "mirai"
        - substr: "mirai-variant"
    notes: "Mirai botnet targeting (competing botnet)"
    attack: "T1561"

  - id: watchdog-targeting
    desc: Watchdog malware targeting
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      any:
        - substr: "watchdog"
        - substr: "wd_watchdog"
    notes: "Watchdog malware/rootkit targeting"
    attack: "T1561"

  - id: update-process-targeting
    desc: Fake update process targeting
    crit: notable
    conf: 0.7
    for: [elf, shell]
    if:
      type: string
      any:
        - substr: "update"
        - substr: "updater"
    notes: "Generic update/updater process targeting"

  - id: pkill-process-targeting
    desc: pkill force kill pattern
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    if:
      type: string
      any:
        - substr: "pkill -9 -f"
        - substr: "pkill -9 -f '%s'"
    notes: "Force process termination via pkill"
    attack: "T1070.003"

  - id: ps-grep-targeting
    desc: ps/grep process targeting
    crit: notable
    conf: 0.7
    for: [elf, shell]
    if:
      type: string
      any:
        - substr: "ps -eo"
        - substr: "ps aux | grep"
        - regex: "ps\\s+[a-z]*\\s*\\|\\s*grep"
    notes: "Process discovery via ps/grep"
    attack: "T1057"

  - id: deleted-process-targeting
    desc: Target deleted/hidden processes
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    if:
      type: string
      any:
        - substr: "grep deleted"
        - substr: "| grep -E '/tmp/|/dev/shm/'"
    notes: "Targeting processes in temp/shm (fileless execution)"
    attack: "T1070.003"

composite_rules:
  - id: competing-miner-targeting
    desc: Competing cryptocurrency miner targeting
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    attack: "T1561"
    notes: |
      Competing cryptocurrency miner targeting detected.
      Indicates:
      - Botnet exclusivity enforcement
      - Resource monopoly establishment
    count_min: 2
    any:
      - id: xmrig-targeting
      - id: cryptonight-targeting

  - id: competing-botnet-targeting
    desc: Competing botnet targeting
    crit: suspicious
    conf: 0.85
    for: [elf, shell]
    attack: "T1561"
    notes: |
      Competing botnet targeting detected.
      Indicates:
      - Botnet dominance establishment
      - System resource monopoly
    any:
      - id: mirai-targeting
      - id: watchdog-targeting

  - id: malware-killing-activity
    desc: Generic malware killing activity
    crit: suspicious
    conf: 0.8
    for: [elf, shell]
    attack: "T1070.003"
    notes: |
      Process termination and deletion patterns.
      Indicates:
      - Removing competing malware
      - Covering tracks
    count_min: 2
    any:
      - id: pkill-process-targeting
      - id: deleted-process-targeting

  - id: comprehensive-malware-elimination
    desc: Comprehensive competing malware elimination
    crit: hostile
    conf: 0.9
    for: [elf, shell]
    attack: "T1561"
    mbc: "E1001"
    notes: |
      Complete malware elimination pattern detected.
      Combines:
      - Process discovery (ps, grep)
      - Competing miner targeting
      - Competing botnet targeting
      - Process termination

      This indicates:
      - Sophisticated botnet with exclusivity enforcement
      - Professional malware operations
      - System resource monopolization
    count_min: 3
    any:
      - id: ps-grep-targeting
      - id: competing-miner-targeting
      - id: competing-botnet-targeting
      - id: malware-killing-activity

