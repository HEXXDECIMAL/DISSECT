# File Enumeration Pattern
# Detects malware searching files for encryption/infection
# Generic indicator for ransomware, worms, data exfiltration

traits:
  - id: file-find-api
    desc: File enumeration API (FindFirstFileExW)
    crit: notable
    conf: 0.75
    platforms: [windows]
    for: [pe]
    if:
      type: symbol
      exact: "FindFirstFileExW"
    attack: "T1083"
    mbc: "C0000"

  - id: file-iterate-api
    desc: File iteration API (FindNextFileW)
    crit: notable
    conf: 0.75
    platforms: [windows]
    for: [pe]
    if:
      type: symbol
      exact: "FindNextFileW"
    attack: "T1083"
    mbc: "C0000"

  - id: file-close-api
    desc: File search termination (FindClose)
    crit: inert
    conf: 0.6
    platforms: [windows]
    for: [pe]
    if:
      type: symbol
      exact: "FindClose"

composite_rules:
  - id: file-enumeration-targeting
    desc: File system enumeration pattern
    crit: suspicious
    conf: 0.85
    platforms: [windows]
    for: [pe]
    attack: "T1083"
    mbc: "C0000"
    all:
      - id: file-find-api
      - id: file-iterate-api

  - id: file-enumeration-with-access
    desc: File enumeration + access combination
    crit: hostile
    conf: 0.9
    platforms: [windows]
    for: [pe]
    attack: "T1083"
    mbc: "C0000"
    all:
      - id: file-enumeration-targeting
      - id: cap/fs/file/open

