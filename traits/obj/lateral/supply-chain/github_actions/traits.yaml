# GitHub Actions Supply Chain Attack Patterns

traits:
  - id: github-actions-targeting-shell
    desc: Targets GitHub Actions (Shell)
    crit: notable
    conf: 0.9
    for: [shell]
    if:
      type: string
      regex: 'isSecret":true'

  - id: python-sudo-execution
    desc: Executes python via sudo
    crit: notable
    conf: 0.9
    for: [shell, python]
    if:
      type: content
      regex: 'sudo python3?'

  - id: double-base64-encode
    desc: Double base64 encoding pattern
    crit: suspicious
    conf: 0.8
    for: [shell]
    if:
      type: content
      regex: 'base64.{0,50}\|.{0,50}base64'

composite_rules:
  - id: github-actions-targeting
    desc: Targets GitHub Actions environment
    crit: notable
    conf: 0.9
    any:
      - id: meta/builder/github-actions
      - id: meta/builder/github-runner-worker
      - id: meta/builder/github-runner-listener
      - id: github-actions-targeting-shell

  - id: github-runner-memory-dumper
    desc: Dumps GitHub Actions Runner memory
    crit: hostile
    conf: 0.95
    file_types: [python, javascript, shell, rust, go]
    all:
      - id: github-actions-targeting
      - id: cap/fs/proc/process/process-pid-mem
      - id: cap/fs/proc/process/process-pid-maps

  - id: github-actions-secret-marker-helper
    desc: Helper for secret or memory access
    any:
      - id: meta/intent/secret
      - id: cap/fs/proc/process/process-pid-mem
      - id: github-actions-targeting-shell

  - id: github-actions-secret-harvest
    desc: Harvests secrets from GitHub Actions
    crit: hostile
    conf: 0.95
    file_types: [shell, python, javascript]
    all:
      - id: github-actions-targeting
      - id: github-actions-secret-marker-helper
      - id: cap/exec/command/shell/shell-platform-check
    any:
      - id: cap/exec/command/shell/curl-pipe-exec
      - id: cap/exec/command/shell/sudo-piped-exec
      - id: double-base64-encode
      - id: python-sudo-execution
