# Description Field Patterns
# Suspicious or minimal description content in PyPI packages

defaults:
  crit: notable
  attack: "T1036.005"
  mbc: "F0004"
  for: [python]

traits:
  - id: minimal-description
    desc: Minimal package description
    crit: notable
    conf: 0.65
    if:
      type: string
      regex: 'description.{0,50}=.{0,50}[''"](Yes|No|Ok|Test|Demo|Sample|.)[''"]'

  - id: single-word-description
    desc: Single word description
    crit: notable
    conf: 0.60
    if:
      type: string
      regex: "description.{0,50}=.{0,50}['\"][a-zA-Z]{1,30}['\"][,\n]"

  - id: unknown-description
    desc: PKG-INFO has UNKNOWN description
    crit: notable
    conf: 0.75
    for: [all]
    if:
      type: kv
      path: description
      exact: "UNKNOWN"

  - id: pkginfo-no-description-body
    desc: PKG-INFO with no description body
    crit: notable
    conf: 0.75
    for: [all]
    if:
      type: kv
      path: description
      regex: "^\\s*$"

  - id: pkginfo-missing-description
    desc: PKG-INFO with no description body at all
    crit: notable
    conf: 0.70
    for: [all]
    if:
      type: kv
      path: metadata-version
    unless:
      - type: kv
        path: description

  - id: pyproject-placeholder-description
    desc: pyproject.toml description contains placeholder text (test, example, TODO)
    crit: notable
    conf: 0.80
    for: [all]
    if:
      type: content
      regex: "description\\s*=\\s*[\"'].{0,30}\\b(?:test(?:\\s+package)?|example(?:\\s+package)?|placeholder|my\\s+package|TODO|FIXME|nothing|empty|temp|dummy)\\b"
      case_insensitive: true

  - id: pyproject-boilerplate-description
    desc: pyproject.toml with boilerplate library description
    crit: notable
    conf: 0.75
    for: [all]
    if:
      type: kv
      path: "project.description"
      regex: "^A (?:library|package|module) for (?:creating|building|making) (?:a |an )?(?:terminal|beautiful|simple|modern|command.?line)"
      case_insensitive: true

  - id: desc-mentions-victim
    desc: Description string explicitly mentions victims
    crit: suspicious
    conf: 0.90
    attack: "T1195.002"
    for: [python]
    if:
      type: string
      substr: victim
      case_insensitive: true

  - id: desc-poc-research
    desc: Description claims proof of concept or research
    crit: notable
    conf: 0.65
    attack: "T1195.002"
    for: [python]
    if:
      type: string
      regex: "(?:proof.of.concept|\\bpoc\\b|security.research|bug.bounty|dependency.confusion)"
      case_insensitive: true

  - id: desc-confirms-install
    desc: Description mentions confirming installation
    crit: suspicious
    conf: 0.90
    attack: "T1195.002"
    for: [python]
    if:
      type: string
      regex: "confirm.{0,30}install"
      case_insensitive: true
