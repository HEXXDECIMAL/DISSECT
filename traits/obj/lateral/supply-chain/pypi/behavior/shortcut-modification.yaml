# PyPI Shortcut Modification Behavior
# Detects PyPI setup.py scripts attempting to modify Windows shortcuts
# This is a specific TTP for browser extension droppers and hijackers.

defaults:
  crit: hostile
  attack: "T1547.009"
  mbc: "E1204"
  for: [python]

composite_rules:
  - id: pypi-shortcut-modification
    desc: PyPI setup.py attempts to modify Windows shortcut properties
    crit: hostile
    conf: 0.95
    all:
      - id: obj/lateral/supply-chain/pypi/install-patterns::robust-setup-py
      - id: obj/anti-static/obfuscation/code::com-dispatch-usage
    any:
      - id: obj/persist/startup/registry::shortcut-arguments
      - id: obj/persist/startup/registry::shortcut-target-path
      - id: obj/persist/startup/registry::shortcut-save
      - id: cap/comm/ipc/win32com::wscript-shell-python
