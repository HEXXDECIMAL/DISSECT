# Version Field Patterns
# Suspicious version numbers in PyPI packages

defaults:
  crit: notable
  attack: "T1195.002"
  mbc: "F0004"

traits:
  - id: suspicious-version-pattern
    desc: Suspicious version number
    crit: suspicious
    conf: 0.55
    for: [python]
    if:
      type: string
      regex: "version.{0,50}=.{0,50}['\"]0\\.[0-9]{1,2}['\"]"

  - id: pkginfo-lowest-version
    desc: PKG-INFO with lowest possible version
    crit: notable
    conf: 0.65
    for: [all]
    if:
      type: kv
      path: version
      regex: "^0\\.0(?:\\.[0-9]+)?$"

  - id: depconf-high-version
    desc: PKG-INFO version with abnormally high major number
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [all]
    if:
      type: kv
      path: version
      regex: "^(?:[1-9][0-9]{2}|1[0-9]{3}|2[1-9][0-9]{2}|[3-9][0-9]{3}|[1-9][0-9]{4,})\\."

  - id: setup-py-high-version
    desc: setup.py with abnormally high version number
    crit: suspicious
    conf: 0.85
    attack: "T1195.002"
    for: [python]
    if:
      type: raw
      regex: "(?:^|[\\s(,])version.{0,30}=.{0,30}['\"](?:[1-9][0-9]{2}|[1-9][0-9]{3,})\\."

  - id: pkginfo-dev-version
    desc: PKG-INFO with development version string
    crit: notable
    conf: 0.80
    for: [all]
    if:
      type: kv
      path: version
      regex: "(?:dev|alpha|beta|\\brc\\d|pre|post)"
      case_insensitive: true

  - id: pkginfo-inflated-version
    desc: PKG-INFO with inflated version number
    crit: notable
    conf: 0.75
    attack: "T1195.002"
    for: [all]
    if:
      type: kv
      path: version
      regex: "^(?:[5-9]|[1-9][0-9]+)\\."

  - id: pyproject-inflated-version
    desc: pyproject.toml with inflated version number
    crit: notable
    conf: 0.75
    attack: "T1195.002"
    for: [all]
    if:
      type: kv
      path: "project.version"
      regex: "^(?:[5-9]|[1-9][0-9]+)\\."
