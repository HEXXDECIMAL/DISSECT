# Summary Field Patterns
# Suspicious summary text in PyPI package metadata

defaults:
  crit: notable
  attack: "T1036.005"
  mbc: "F0004"
  for: [all]

traits:
  - id: unknown-summary
    desc: PKG-INFO has UNKNOWN summary
    crit: notable
    conf: 0.75
    if:
      type: kv
      path: summary
      exact: "UNKNOWN"

  - id: pkginfo-placeholder-summary
    desc: PKG-INFO summary contains placeholder text
    crit: notable
    conf: 0.80
    if:
      type: kv
      path: summary
      regex: "^\\s*(?:test(?:\\s+package)?|example(?:\\s+package)?|placeholder|my\\s+package|TODO|FIXME|description|nothing|empty|temp|dummy)\\s*$"
      case_insensitive: true

  - id: pkginfo-low-effort-summary
    desc: PKG-INFO summary contains minimal-effort description
    crit: notable
    conf: 0.80
    if:
      type: kv
      path: summary
      regex: "(?i)(?:(?:a |my )?very basic \\w+|\\w+pyapp\\b)"

  - id: pkginfo-single-word-summary
    desc: PKG-INFO with single-word summary
    crit: notable
    conf: 0.75
    if:
      type: kv
      path: summary
      regex: "^\\S{1,30}$"

  - id: pkginfo-security-claim
    desc: PKG-INFO summary claims security functionality
    crit: notable
    conf: 0.50
    if:
      type: kv
      path: summary
      regex: "(?:secur|protect|antivirus|anti-virus|malware.scanner)"
      case_insensitive: true

  - id: summary-requests-admin
    desc: Summary requests admin privileges for install
    crit: suspicious
    conf: 0.90
    attack: "T1204.001"
    if:
      type: kv
      path: summary
      regex: "(?:admin|root|sudo|elevat).{0,40}(?:install|permiss)"
      case_insensitive: true

  - id: summary-misspelled-privilege-request
    desc: Misspelled social engineering in PKG-INFO summary
    crit: suspicious
    conf: 0.90
    attack: "T1204.001"
    if:
      type: kv
      path: summary
      regex: "(?:evoid|administative|permisions|adminstrat|privileg|instaling|elavat)"
      case_insensitive: true

  - id: pkginfo-non-latin-summary
    desc: PKG-INFO summary in non-Latin script
    crit: notable
    conf: 0.75
    attack: "T1204.001"
    if:
      type: kv
      path: summary
      regex: "[А-яЁёÀ-ÖØ-öø-ÿ\u0600-\u06FF\u4E00-\u9FFF\u3040-\u309F\u30A0-\u30FF\uAC00-\uD7AF]"

  - id: pkginfo-no-summary
    desc: PKG-INFO missing Summary field
    crit: notable
    conf: 0.75
    if:
      type: kv
      path: metadata-version
    unless:
      - type: kv
        path: summary
