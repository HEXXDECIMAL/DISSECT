# Go Supply Chain Attack Indicators
# Metrics-based detection of supply chain attack patterns in Go code

defaults:
  file_types: [go]

traits:
  - id: many-init-functions
    description: Multiple init() functions (auto-execute on
    crit: suspicious
    confidence: 0.85
    attack: "T1195.001"
    condition:
      type: metrics
      field: go_metrics.init_function_count
      min: 3

  - id: blank-imports
    description: Uses blank imports for side
    crit: notable
    confidence: 0.7
    condition:
      type: metrics
      field: go_metrics.blank_import_count
      min: 1

  - id: many-blank-imports
    description: Many blank imports (suspicious side-effect
    crit: suspicious
    confidence: 0.85
    condition:
      type: metrics
      field: go_metrics.blank_import_count
      min: 3

  - id: cgo-usage
    description: Uses CGo for C interoperability
    crit: notable
    confidence: 0.75
    condition:
      type: metrics
      field: go_metrics.cgo_usage
      min: 1

  - id: embed-directive
    description: Embeds files via //go:embed (payload
    crit: notable
    confidence: 0.7
    condition:
      type: metrics
      field: go_metrics.embed_directive_count
      min: 1

composite_rules:
  # Detect potential backdoor patterns
  - id: backdoor-indicators
    description: Go code with backdoor-like characteristics
    crit: hostile
    confidence: 0.9
    attack: "T1195.001"
    mbc: "B0024"
    file_types: [go]
    all:
      - id: cap/exec/command/go-exec-command
      - id: cap/comm/socket/go-network-dial
      - id: many-init-functions

  # Detect supply chain attack patterns
  - id: suspicious-init
    desc: "Suspicious Go init function"
    crit: suspicious
    conf: 0.95
    attack: "T1195.001"
    mbc: "B0024"
    file_types: [go]
    all:
      - id: many-init-functions
    any:
      - id: cap/exec/command/go-exec-command
      - id: cap/comm/socket/go-network-dial
      - id: cap/comm/socket/go-http-operations
