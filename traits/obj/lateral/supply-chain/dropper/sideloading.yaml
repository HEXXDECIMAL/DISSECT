# DLL Side-Loading Patterns
# Detects processes frequently used as hosts for DLL side-loading
# ATT&CK: T1574.002

traits:
  - id: sideloading-host-bugreport
    desc: Common side-loading host binary (BugReport.exe)
    crit: notable
    conf: 0.8
    if:
      type: basename
      exact: "BugReport.exe"

  - id: sideloading-host-generic
    desc: Potential side-loading host binary name
    crit: notable
    conf: 0.6
    if:
      type: basename
      regex: '(?i)^(BugReport|CrashReport|Update|Setup|Install|OneDriveStandaloneUpdater)\.exe$'

composite_rules:
  - id: minimalist-hostile-dll
    desc: Hostile DLL with minimal imports and high entropy
    crit: suspicious
    conf: 0.8
    all:
      - id: meta/format::few-functions
      - id: obj/anti-analysis/packing/entropy::high-entropy-section
      - id: cap/dylib/lookup::get-proc-address
    unless:
      - id: meta/sign/certificate::verified # Legitimate stagers are usually signed
      - id: file/archive/self-extracting # SFX archives are minimalist by design

  - id: suspicious-sideloading-host
    desc: Suspicious side-loading host with minimal logic
    crit: suspicious
    conf: 0.8
    all:
      - id: sideloading-host-generic
      - id: obj/anti-analysis/vm/detect::sparse-logic-density
