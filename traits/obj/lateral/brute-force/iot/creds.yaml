# IoT Default Credential Brute-Force Detection
# Detects hardcoded default credentials commonly used by IoT botnets (Mirai, Gafgyt, etc.)
# ATT&CK: T1110.001 (Brute Force: Password Guessing)
# MBC: B0028 (Credential Access)

defaults:
  crit: suspicious
  attack: "T1110.001"
  mbc: "B0028"
  for: [elf, macho, shell, python, go]

traits:
  # === Default Router/Gateway Credentials ===
  - id: router-default-admin
    desc: Default router admin credentials
    crit: notable
    conf: 0.85
    # Small binaries with hardcoded default creds are more suspicious
    size_max: 10000
    if:
      type: string
      # Common router admin passwords - remove "password" as it's too common as a keyword/option name
      regex: "^(admin123|admin1234|root123|1234567890|123456)$"
    not:
      - id: meta/signed/platform::apple
    unless:
      - type: content
        regex: "pandas|pytest|def test_"

  - id: iot-vendor-creds
    desc: IoT vendor default credentials
    crit: suspicious
    conf: 0.90
    if:
      type: string
      # Specific IoT device vendor passwords (hikvision, cisco, zte, etc.)
      regex: "^(hikvision|cisco123|Zte521|vstarcam2015|xmhdipc|icatch99|hslwificam|dreambox|telnetadmin|telecomadmin|e8telnet|e8ehome|juantech|ipcam_rt5350|GM8182|hi3518|hg2x0|xc3511|xc12345|oelinux123|grouter|solokey|instar|OxhlwSG8|S2fGqNFs|tlJwpbo6|7ujMko0admin|7ujMko0vizxv|antslq|fiberinst)$"

  - id: mirai-style-creds
    desc: Mirai-style credential patterns
    crit: suspicious
    conf: 0.95
    if:
      type: string
      # Mirai-specific hardcoded patterns (not generic words)
      regex: "^(ubnt|root621|root123|admin1234|888888|666666|7ujMko0)$"

  # === Network Scanning Indicators ===
  - id: proc-net-tcp
    desc: Access /proc/net/tcp for scanning
    crit: notable
    conf: 0.95
    if:
      type: string
      substr: "/proc/net/tcp"

  # === Shell execution in static binaries ===
  - id: bin-sh-string
    desc: Shell path string /bin/sh
    crit: inert
    conf: 0.95
    for: [elf, macho, python, go]
    if:
      type: string
      substr: "/bin/sh"

  # === Telnet/SSH Brute-Force Indicators ===
  - id: busybox-command-injection
    desc: Busybox command injection pattern
    crit: suspicious
    conf: 0.95
    if:
      type: string
      # Mirai uses "FASTCAT" or echoes busybox commands
      regex: "/bin/busybox\\s+(FASTCAT|ECCHI|MIRAI|wget|tftp)"

  - id: shell-injection-pattern
    desc: Shell injection via service prompt
    crit: suspicious
    conf: 0.90
    if:
      type: string
      # Common shell injection in telnet sessions
      regex: "^(ping; sh|; sh|/bin/sh;|enable\\nshell|system\\nshell|linuxshell)$"

composite_rules:
  # IoT Botnet Scanner with vendor creds: combines default creds + network scanning + busybox + shell
  # Complexity: all(4) = 4 >= 4 ✓ HOSTILE
  - id: iot-botnet-scanner-vendor
    desc: IoT botnet scanner (vendor creds)
    crit: hostile
    conf: 0.95
    attack: "T1110.001"
    all:
      - id: iot-vendor-creds
      - id: proc-net-tcp
      - id: busybox-command-injection
      - id: bin-sh-string

  # IoT Botnet Scanner with mirai creds: combines default creds + network scanning + busybox + shell
  # Complexity: all(4) = 4 >= 4 ✓ HOSTILE
  - id: iot-botnet-scanner-mirai
    desc: IoT botnet scanner (mirai creds)
    crit: hostile
    conf: 0.95
    attack: "T1110.001"
    all:
      - id: mirai-style-creds
      - id: proc-net-tcp
      - id: busybox-command-injection
      - id: bin-sh-string

  # IoT Botnet Scanner with shell injection pattern
  # Complexity: all(4) = 4 >= 4 ✓ HOSTILE
  - id: iot-botnet-scanner-shell-inject
    desc: IoT botnet scanner (shell inject)
    crit: hostile
    conf: 0.95
    attack: "T1110.001"
    all:
      - id: iot-vendor-creds
      - id: proc-net-tcp
      - id: shell-injection-pattern
      - id: bin-sh-string

  # Credential spray: many default creds without all scanning indicators
  # Complexity: all(2) = 2 < 4, stays SUSPICIOUS
  - id: iot-credential-spray
    desc: IoT default credential collection
    crit: suspicious
    conf: 0.90
    attack: "T1110.001"
    all:
      - id: iot-vendor-creds
      - id: proc-net-tcp
