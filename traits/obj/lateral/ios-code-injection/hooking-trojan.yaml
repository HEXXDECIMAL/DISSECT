# iOS Code Injection Trojan
# Detects iOS apps that embed Cydia Substrate or other code hooking frameworks
# Indicates capability to inject code into other iOS applications
# ATT&CK: T1546 (Event Triggered Execution), T1574 (Hijack Execution Flow)
# MBC: C0041 (Code Injection)

traits:

composite_rules:
  - id: ios-cydia-substrate-trojan
    desc: Cydia Substrate trojan
    crit: hostile
    conf: 0.95
    attack: "T1546"
    mbc: "C0041"
    for: [ipa]
    all:
      - id: cap/exec/inject/ios-framework/cydia-substrate-detected
      - id: cap/discovery/ios-bundle-obfuscation/obfuscated-bundle-identity
      - id: cap/exec/inject/ios-framework/runtime-code-injection

  - id: ios-reverse-engineering-instrumented
    desc: Reverse engineering tool
    crit: suspicious
    conf: 0.85
    attack: "T1564"
    for: [ipa]
    needs: 1
    any:
      - id: cap/exec/inject/ios-framework/reveal-server-framework
      - id: cap/exec/inject/ios-framework/cbinjection-framework

  - id: ios-obfuscated-trojan
    desc: Obfuscated injection
    crit: hostile
    conf: 0.9
    attack: "T1546"
    mbc: "C0041"
    for: [ipa]
    all:
      - id: cap/discovery/ios-bundle-obfuscation/suspicious-bundle-masquerading
      - id: cap/exec/inject/ios-framework/runtime-code-injection
      - id: cap/exec/inject/ios-framework/cydia-substrate-detected
