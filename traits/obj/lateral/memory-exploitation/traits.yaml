# Memory Exploitation Chain
# Detects complete memory exploitation patterns
# Generic indicator across all advanced malware families

composite_rules:
  - id: executable-memory-allocation
    desc: Allocate executable memory
    crit: suspicious
    conf: 0.85
    platforms: [windows]
    for: [pe]
    any:
      - id: cap/mem/allocate/executable/windows

  - id: memory-protection-evasion
    desc: Modify memory protection for execution
    crit: suspicious
    conf: 0.85
    platforms: [windows]
    for: [pe]
    any:
      - id: cap/mem/protect/modify/virtual-protect
      - id: cap/mem/protect/modify/virtual-protect-ex
    downgrade:
      any:
        - id: meta/quality/versioned

  - id: memory-exploitation-chain
    desc: Complete memory exploitation sequence
    crit: hostile
    conf: 0.92
    platforms: [windows]
    for: [pe]
    attack: "T1055"
    mbc: "B0033"
    all:
      - id: executable-memory-allocation
      - id: memory-protection-evasion
      - id: cap/process/inject/memory

  - id: memory-injection-pattern
    desc: Memory protection+injection exploitation pattern
    crit: suspicious
    conf: 0.85
    platforms: [windows]
    for: [pe]
    attack: "T1055"
    mbc: "B0033"
    all:
      - id: obj/lateral/memory-exploitation/memory-protection-evasion
      - id: cap/process/inject/memory
    downgrade:
      any:
        - id: meta/vendor/valve/valve-corp-binary

