# Phishing Kit Detection Traits
# These patterns detect credential harvesting pages and phishing kits

# === ATOMIC TRAITS ===
traits:
  # === Anti-copy mechanism patterns ===
  - id: oncopy-false
    desc: 'oncopy="return false" HTML attribute'
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: 'oncopy="return false"'
      case_insensitive: true

  - id: oncut-false
    desc: 'oncut="return false" HTML attribute'
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: 'oncut="return false"'
      case_insensitive: true

  - id: onpaste-false
    desc: 'onpaste="return false" HTML attribute'
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: 'onpaste="return false"'
      case_insensitive: true

  - id: oncontextmenu-false
    desc: 'oncontextmenu="return false" HTML attribute'
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: 'oncontextmenu="return false"'
      case_insensitive: true

  - id: ondragstart-false
    desc: 'ondragstart="return false" HTML attribute'
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: 'ondragstart="return false"'
      case_insensitive: true

  - id: onselectstart-false
    desc: 'onselectstart="return false" HTML attribute'
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: 'onselectstart="return false"'
      case_insensitive: true

  - id: js-copy-listener
    desc: addEventListener('copy') JavaScript pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "addEventListener('copy'"

  - id: js-cut-listener
    desc: addEventListener('cut') JavaScript pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "addEventListener('cut'"

  - id: js-paste-listener
    desc: addEventListener('paste') JavaScript pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "addEventListener('paste'"

  - id: js-contextmenu-listener
    desc: addEventListener('contextmenu') JavaScript pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "addEventListener('contextmenu'"

  # === Honeypot field pattern (complex regex - keep as-is) ===
  - id: honeypot-field-pattern
    desc: Honeypot form field for bot
    crit: suspicious
    conf: 0.9
    for: [html, javascript]
    if:
      type: string
      regex: "class=['\"]honeypot|honeypot-field['\"]|display:\\s*none.{0,50}name=['\"]|name=['\"][^'\"]{0,30}honeypot"

  # === Human interaction event listeners ===
  - id: mousemove-listener
    desc: addEventListener('mousemove') pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "addEventListener('mousemove'"

  - id: touchstart-listener
    desc: addEventListener('touchstart') pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "addEventListener('touchstart'"

  - id: scroll-listener
    desc: addEventListener('scroll') pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "addEventListener('scroll'"

  - id: disabled-class
    desc: .disabled CSS class reference
    crit: inert
    conf: 0.6
    for: [javascript, html]
    if:
      type: string
      substr: ".disabled"

  - id: disabled-false
    desc: "disabled=false assignment"
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "disabled=false"

  - id: disabled-false-spaced
    desc: "disabled = false assignment (with"
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "disabled = false"

  - id: remove-disabled-attr
    desc: removeAttribute('disabled') call
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "removeAttribute('disabled')"

  # === Microsoft brand impersonation patterns ===
  - id: microsoft-logo-ref
    desc: Microsoft_logo reference
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "Microsoft_logo"
      case_insensitive: true

  - id: microsoft-svg
    desc: microsoft.svg file reference
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "microsoft.svg"
      case_insensitive: true

  - id: microsoft-span
    desc: Microsoft</span> HTML pattern
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "Microsoft</span>"
      case_insensitive: true

  - id: microsoft-tag
    desc: ">Microsoft< HTML pattern"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: ">Microsoft<"
      case_insensitive: true

  - id: sign-in-text
    desc: "Sign in text"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "Sign in"

  - id: sign-in-hyphen
    desc: Sign-in text (hyphenated)
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "Sign-in"

  - id: ms-email-placeholder
    desc: "Email, phone, or Skype placeholder"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "Email, phone, or Skype"

  # === Google brand impersonation patterns ===
  - id: google-logo-ref
    desc: Google_logo reference
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "Google_logo"
      case_insensitive: true

  - id: google-svg
    desc: google.svg file reference
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "google.svg"
      case_insensitive: true

  - id: google-span
    desc: Google</span> HTML pattern
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "Google</span>"
      case_insensitive: true

  - id: google-tag
    desc: ">Google< HTML pattern"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: ">Google<"
      case_insensitive: true

  # === Generic login form patterns ===
  - id: login-word-lower
    desc: Login word (lowercase)
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "login"

  - id: login-word-title
    desc: Login word (title case)
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "Login"

  - id: login-word-upper
    desc: LOGIN word (uppercase)
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "LOGIN"

  - id: log-in-phrase-lower
    desc: "Log in phrase (lowercase)"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "log in"

  - id: log-in-phrase-title
    desc: "Log in phrase (title case)"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "Log in"

  - id: password-input-double
    desc: 'type="password" HTML input'
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: 'type="password"'
      case_insensitive: true

  - id: password-input-single
    desc: "type='password' HTML input"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "type='password'"
      case_insensitive: true

  - id: email-input-double
    desc: 'type="email" HTML input'
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: 'type="email"'
      case_insensitive: true

  - id: email-input-single
    desc: "type='email' HTML input"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "type='email'"
      case_insensitive: true

  - id: email-placeholder-double
    desc: 'placeholder="Email" attribute'
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: 'placeholder="Email"'
      case_insensitive: true

  - id: password-placeholder-double
    desc: 'placeholder="Password" attribute'
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: 'placeholder="Password"'
      case_insensitive: true

  # === Document sharing lure patterns ===
  - id: shared-with-phrase
    desc: "shared with phrase"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "shared with"
      case_insensitive: true

  - id: document-word
    desc: document word
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "document"
      case_insensitive: true

  - id: securely-shared-phrase
    desc: "securely shared phrase"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "securely shared"
      case_insensitive: true

  - id: file-sharing-phrase
    desc: "file sharing phrase"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "file sharing"
      case_insensitive: true

  - id: pdf-extension
    desc: .pdf file extension
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      exact: ".pdf"
      case_insensitive: true

  - id: pdf-icon-text
    desc: "PDF Icon text"
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "PDF Icon"
      case_insensitive: true

  - id: doc-extension
    desc: .doc file extension
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      exact: ".doc"
      case_insensitive: true

  - id: xls-extension
    desc: .xls file extension
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      exact: ".xls"
      case_insensitive: true

  - id: download-word
    desc: Download word
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "download"
      case_insensitive: true

  - id: verify-word
    desc: verify word
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "verify"
      case_insensitive: true

  # === External form submission patterns ===
  - id: window-location-href-assign
    desc: window.location.href= assignment
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "window.location.href="

  - id: location-href-assign
    desc: location.href= assignment
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "location.href="

  - id: submit-listener-double
    desc: 'addEventListener("submit") pattern'
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: 'addEventListener("submit"'

  - id: submit-listener-single
    desc: addEventListener('submit') pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "addEventListener('submit'"

  # === Suspicious TLD patterns ===
  - id: icu-tld
    desc: .icu TLD (commonly abused)
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      exact: ".icu"

  - id: xyz-tld
    desc: .xyz TLD (commonly abused)
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      exact: ".xyz"

  - id: tk-tld
    desc: .tk TLD (free domain, commonly
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      exact: ".tk"

  - id: ml-tld
    desc: .ml TLD (free domain, commonly
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      exact: ".ml"

  - id: ga-tld
    desc: .ga TLD (free domain, commonly
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      exact: ".ga"

  - id: cf-tld
    desc: .cf TLD (free domain, commonly
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      exact: ".cf"

  - id: gq-tld
    desc: .gq TLD (free domain, commonly
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      exact: ".gq"

  - id: top-tld
    desc: .top TLD (commonly abused)
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      exact: ".top"

  - id: work-tld
    desc: .work TLD (commonly abused)
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: ".work"

  - id: click-tld
    desc: .click TLD (commonly abused)
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: ".click"

  # === Typosquatting patterns ===
  - id: siemensergy-typo
    desc: siemensergy typosquat (Siemens)
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      word: "siemensergy"
      case_insensitive: true

  - id: siemans-typo
    desc: siemans typosquat (Siemens)
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      word: "siemans"
      case_insensitive: true

  - id: siemnes-typo
    desc: siemnes typosquat (Siemens)
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      word: "siemnes"
      case_insensitive: true

  - id: microsoft-typo-capital-f
    desc: microsoFt typosquat in URL/domain (Microsoft)
    crit: inert
    conf: 0.8
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)(https?://|www\\.|@)[^\\s\"']*microso[Ff]t"
      case_insensitive: true

  - id: micorsoft-typo
    desc: micorsoft typosquat in URL/domain (Microsoft)
    crit: inert
    conf: 0.8
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)(https?://|www\\.|@|//)[^\\s\"']*micorsoft"
      case_insensitive: true

  - id: micosoft-typo
    desc: micosoft typosquat in URL/domain (Microsoft)
    crit: inert
    conf: 0.8
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)(https?://|www\\.|@|//)[^\\s\"']*micosoft"
      case_insensitive: true

  - id: microsft-typo
    desc: microsft typosquat in URL/domain (Microsoft)
    crit: inert
    conf: 0.8
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)(https?://|www\\.|@|//)[^\\s\"']*microsft"
      case_insensitive: true

  - id: gooogle-typo
    desc: gooogle typosquat in URL/domain (Google)
    crit: inert
    conf: 0.8
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)(https?://|www\\.|@|//)[^\\s\"']*gooogle"
      case_insensitive: true

  - id: goggle-typo
    desc: goggle typosquat in URL/domain (Google)
    crit: inert
    conf: 0.8
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)(https?://|www\\.|@|//)[^\\s\"']*goggle"
      case_insensitive: true

  - id: gogle-typo
    desc: gogle typosquat in URL/domain (Google)
    crit: inert
    conf: 0.8
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)(https?://|www\\.|@|//)[^\\s\"']*gogle"
      case_insensitive: true

  - id: login-prefix-lower
    desc: "login. subdomain prefix (lowercase)"
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: "login."

  - id: login-prefix-title
    desc: "Login. subdomain prefix (title case)"
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: "Login."

  - id: signin-prefix-lower
    desc: "signin. subdomain prefix (lowercase)"
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: "signin."

  - id: signin-prefix-title
    desc: "Signin. subdomain prefix (title case)"
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      substr: "Signin."

  # === Bot detection patterns ===
  - id: navigator-webdriver
    desc: navigator.webdriver property access
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "navigator.webdriver"

  - id: navigator-plugins-length
    desc: navigator.plugins.length property access
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "navigator.plugins.length"

  - id: screen-width
    desc: screen.width property access
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "screen.width"

  - id: screen-height
    desc: screen.height property access
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "screen.height"

  - id: headless-chrome-string
    desc: HeadlessChrome user agent string
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "HeadlessChrome"

  - id: phantomjs-string
    desc: PhantomJS user agent string
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "PhantomJS"

  - id: selenium-string
    desc: Selenium detection string
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      substr: "Selenium"

  - id: puppeteer-string
    desc: puppeteer detection string
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      word: "puppeteer"
      case_insensitive: true

  - id: bot-user-agent-pattern
    desc: Bot/crawler/spider user agent pattern
    crit: inert
    conf: 0.6
    for: [javascript]
    if:
      type: string
      regex: "bot|crawl|spider|headless"
      case_insensitive: true

  # === Brand CDN icon patterns ===
  - id: flaticon-cdn
    desc: flaticon.com CDN reference
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "flaticon.com"

  - id: wikimedia-cdn
    desc: wikimedia.org CDN reference
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "wikimedia.org"

  - id: wikipedia-cdn
    desc: wikipedia.org reference
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "wikipedia.org"

  - id: logo-keyword
    desc: logo keyword
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "logo"
      case_insensitive: true

  - id: icon-keyword
    desc: icon keyword
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "icon"
      case_insensitive: true

  - id: brand-names-pattern
    desc: Major brand names pattern
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      regex: "Microsoft|Google|Apple|Amazon|PayPal|Netflix|Adobe"

  # === Targeted email patterns (complex regex - keep as-is) ===
  - id: pre-filled-email-value
    desc: Pre-filled email value attribute with
    crit: suspicious
    conf: 0.9
    for: [html]
    if:
      type: string
      regex: "value=[\"'][a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}[\"']"

  - id: readonly-attr
    desc: readonly HTML attribute
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      word: "readonly"

  - id: email-placeholder-ref
    desc: recipient_email_placeholder reference
    crit: inert
    conf: 0.6
    for: [html]
    if:
      type: string
      substr: "recipient_email_placeholder"

  - id: multiple-email-addresses
    desc: Multiple email addresses in quotes
    crit: suspicious
    conf: 0.85
    for: [html]
    if:
      type: string
      regex: "[\"'][a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}[\"']"
      needs: 2
  # === Auth lure atomic indicators ===
  - id: auth-required-phrase
    desc: Authentication required phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)authentication\\s+required"

  - id: auth-needed-phrase
    desc: Authentication needed phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)authentication\\s+needed"

  - id: verification-required-phrase
    desc: Verification required phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)verification\\s+required"

  - id: verification-needed-phrase
    desc: Verification needed phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)verification\\s+needed"

  - id: verify-email-phrase
    desc: Verify your email phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)verify\\s+your\\s+email"

  - id: verify-identity-phrase
    desc: Verify your identity phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)verify\\s+your\\s+identity"

  - id: verify-account-phrase
    desc: Verify your account phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)verify\\s+your\\s+account"

  - id: confirm-email-phrase
    desc: Confirm your email phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)confirm\\s+your\\s+email"

  - id: confirm-identity-phrase
    desc: Confirm your identity phrase
    crit: inert
    conf: 0.6
    for: [html, javascript]
    if:
      type: string
      regex: "(?i)confirm\\s+your\\s+identity"

# === COMPOSITE RULES ===
composite_rules:
  # Anti-copy mechanism detection
  - id: anti-copy
    desc: Anti-copy mechanism (prevents text selection/copying)
    crit: suspicious
    conf: 0.85
    attack: T1566
    for: [html, javascript]
    needs: 2
    any:
      - { id: oncopy-false }
      - { id: oncut-false }
      - { id: onpaste-false }
      - { id: oncontextmenu-false }
      - { id: ondragstart-false }
      - { id: onselectstart-false }
      - { id: js-copy-listener }
      - { id: js-cut-listener }
      - { id: js-paste-listener }
      - { id: js-contextmenu-listener }

  # Human verification interaction
  - id: human-interaction-events
    desc: Human interaction event listeners
    for: [javascript]
    any:
      - { id: mousemove-listener }
      - { id: touchstart-listener }
      - { id: scroll-listener }

  - id: disabled-manipulation
    desc: Disabled state manipulation patterns
    for: [javascript, html]
    any:
      - { id: disabled-class }
      - { id: disabled-false }
      - { id: disabled-false-spaced }
      - { id: remove-disabled-attr }

  - id: human-verification
    desc: Requires human interaction before enabling
    crit: notable
    conf: 0.8
    for: [javascript, html]
    all:
      - { id: human-interaction-events }
      - { id: disabled-manipulation }

  # Microsoft brand impersonation
  - id: microsoft-logo
    desc: Microsoft logo references
    for: [html]
    any:
      - { id: microsoft-logo-ref }
      - { id: microsoft-svg }

  - id: microsoft-brand
    desc: Microsoft brand text references
    for: [html]
    any:
      - { id: microsoft-span }
      - { id: microsoft-tag }

  - id: signin-text
    desc: Sign in text patterns
    for: [html]
    any:
      - { id: sign-in-text }
      - { id: sign-in-hyphen }

  - id: microsoft-logo-or-brand
    desc: Microsoft logo or brand references
    for: [html]
    any:
      - { id: microsoft-logo }
      - { id: microsoft-brand }

  - id: microsoft-signin-or-email
    desc: Microsoft signin text or email
    for: [html]
    any:
      - { id: signin-text }
      - { id: ms-email-placeholder }

  - id: microsoft-impersonation
    desc: Microsoft brand impersonation
    crit: suspicious
    conf: 0.9
    attack: T1566.002
    for: [html, javascript]
    all:
      - { id: microsoft-logo-or-brand }
      - { id: microsoft-signin-or-email }

  # Google brand impersonation
  - id: google-logo
    desc: Google logo references
    for: [html]
    any:
      - { id: google-logo-ref }
      - { id: google-svg }

  - id: google-brand
    desc: Google brand text references
    for: [html]
    any:
      - { id: google-span }
      - { id: google-tag }

  - id: google-logo-or-brand
    desc: Google logo or brand references
    for: [html]
    any:
      - { id: google-logo }
      - { id: google-brand }

  - id: google-impersonation
    desc: Google brand impersonation
    crit: suspicious
    conf: 0.9
    attack: T1566.002
    for: [html, javascript]
    all:
      - { id: google-logo-or-brand }
      - { id: signin-text }

  # Generic login form
  - id: login-text
    desc: Login/sign in text patterns
    for: [html]
    any:
      - { id: login-word-lower }
      - { id: login-word-title }
      - { id: login-word-upper }
      - { id: log-in-phrase-lower }
      - { id: log-in-phrase-title }
      - { id: sign-in-text }
      - { id: sign-in-hyphen }

  - id: password-input
    desc: Password input fields
    for: [html]
    any:
      - { id: password-input-double }
      - { id: password-input-single }

  - id: email-input
    desc: Email input fields
    for: [html]
    any:
      - { id: email-input-double }
      - { id: email-input-single }

  - id: credential-placeholders
    desc: Credential input placeholders
    for: [html]
    any:
      - { id: email-placeholder-double }
      - { id: password-placeholder-double }

  - id: credential-inputs
    desc: Password or email input fields
    for: [html]
    any:
      - { id: password-input }
      - { id: email-input }
      - { id: credential-placeholders }

  - id: login-form
    desc: Suspicious login form with credential
    crit: suspicious
    conf: 0.85
    attack: T1566
    for: [html, javascript]
    all:
      - { id: login-text }
      - { id: credential-inputs }

  # Document sharing lure
  - id: sharing-phrases
    desc: Document sharing phrases
    for: [html]
    any:
      - { id: shared-with-phrase }
      - { id: document-word }
      - { id: securely-shared-phrase }
      - { id: file-sharing-phrase }

  - id: document-extensions
    desc: Document file extensions
    for: [html]
    any:
      - { id: pdf-extension }
      - { id: pdf-icon-text }
      - { id: doc-extension }
      - { id: xls-extension }

  - id: document-actions
    desc: Document action keywords
    for: [html]
    any:
      - { id: download-word }
      - { id: verify-word }

  - id: document-indicators
    desc: Document file extensions or action
    for: [html]
    any:
      - { id: document-extensions }
      - { id: document-actions }

  - id: document-lure
    desc: Fake document sharing lure
    crit: suspicious
    conf: 0.85
    attack: T1566.002
    for: [html, javascript]
    all:
      - { id: sharing-phrases }
      - { id: document-indicators }

  # External form action with suspicious TLD
  - id: location-redirect
    desc: Window location redirect patterns
    for: [javascript]
    any:
      - { id: window-location-href-assign }
      - { id: location-href-assign }

  - id: submit-listener
    desc: Form submit event listeners
    for: [javascript]
    any:
      - { id: submit-listener-double }
      - { id: submit-listener-single }

  - id: suspicious-tlds
    desc: Suspicious/commonly abused TLDs
    for: [html, javascript]
    any:
      - { id: icu-tld }
      - { id: xyz-tld }
      - { id: tk-tld }
      - { id: ml-tld }
      - { id: ga-tld }
      - { id: cf-tld }
      - { id: gq-tld }
      - { id: top-tld }
      - { id: work-tld }
      - { id: click-tld }

  - id: form-submission-patterns
    desc: Form submission or location redirect
    for: [javascript]
    any:
      - { id: location-redirect }
      - { id: submit-listener }

  - id: external-form-action
    desc: Form submits to suspicious external
    crit: suspicious
    conf: 0.85
    attack: T1566
    for: [html, javascript]
    all:
      - { id: form-submission-patterns }
      - { id: suspicious-tlds }

  # Typosquatting domain detection
  - id: siemens-typosquats
    desc: Siemens brand typosquats
    for: [html, javascript]
    any:
      - { id: siemensergy-typo }
      - { id: siemans-typo }
      - { id: siemnes-typo }

  - id: microsoft-typosquats
    desc: Microsoft brand typosquats
    for: [html, javascript]
    any:
      - { id: microsoft-typo-capital-f }
      - { id: micorsoft-typo }
      - { id: micosoft-typo }
      - { id: microsft-typo }

  - id: google-typosquats
    desc: Google brand typosquats
    for: [html, javascript]
    any:
      - { id: gooogle-typo }
      - { id: goggle-typo }
      - { id: gogle-typo }

  - id: login-subdomain-prefix
    desc: Login subdomain prefix patterns
    for: [html, javascript]
    any:
      - { id: login-prefix-lower }
      - { id: login-prefix-title }
      - { id: signin-prefix-lower }
      - { id: signin-prefix-title }

  - id: login-subdomain-with-suspicious-tld
    desc: Login subdomain with suspicious TLD
    for: [html, javascript]
    all:
      - { id: login-subdomain-prefix }
      - { id: suspicious-tlds }

  - id: typosquat-domain
    desc: Typosquatting domain pattern (brand impersonation)
    crit: suspicious
    conf: 0.85
    attack: T1566.002
    for: [html, javascript]
    any:
      - { id: siemens-typosquats }
      - { id: microsoft-typosquats }
      - { id: google-typosquats }
      - { id: login-subdomain-with-suspicious-tld }

  # Bot detection evasion
  - id: bot-detection
    desc: Bot/automation detection for phishing evasion
    crit: suspicious
    conf: 0.85
    attack: T1566
    for: [javascript, html]
    needs: 2
    any:
      - { id: navigator-webdriver }
      - { id: navigator-plugins-length }
      - { id: screen-width }
      - { id: screen-height }
      - { id: headless-chrome-string }
      - { id: phantomjs-string }
      - { id: selenium-string }
      - { id: puppeteer-string }
      - { id: bot-user-agent-pattern }

  # Brand CDN icon impersonation
  - id: external-cdn
    desc: External CDN references
    for: [html]
    any:
      - { id: flaticon-cdn }
      - { id: wikimedia-cdn }
      - { id: wikipedia-cdn }

  - id: logo-icon-keywords
    desc: Logo or icon keywords
    for: [html]
    any:
      - { id: logo-keyword }
      - { id: icon-keyword }

  - id: brand-cdn-icons
    desc: External CDN icons for brand
    crit: notable
    conf: 0.8
    attack: T1566.002
    for: [html, javascript]
    all:
      - { id: external-cdn }
      - { id: logo-icon-keywords }
      - { id: brand-names-pattern }

  # Targeted email pre-filling
  - id: readonly-email-value
    desc: Pre-filled email value with readonly
    for: [html]
    all:
      - { id: pre-filled-email-value }
      - { id: readonly-attr }

  - id: targeted-email
    desc: Pre-filled target email address
    crit: suspicious
    conf: 0.9
    attack: T1566.001
    for: [html, javascript]
    any:
      - { id: readonly-email-value }
      - { id: email-placeholder-ref }
      - { id: multiple-email-addresses }

  # Auth required lure
  - id: auth-required-lure
    desc: Fake authentication required message
    crit: suspicious
    conf: 0.85
    attack: T1566
    for: [html, javascript]
    any:
      - { id: auth-required-phrase }
      - { id: auth-needed-phrase }
      - { id: verification-required-phrase }
      - { id: verification-needed-phrase }
      - { id: verify-email-phrase }
      - { id: verify-identity-phrase }
      - { id: verify-account-phrase }
      - { id: confirm-email-phrase }
      - { id: confirm-identity-phrase }
