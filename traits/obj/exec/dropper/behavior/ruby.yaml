# Ruby Dropper Composite Rules
defaults:
  for: [ruby]

composite_rules:
  # === Dropper Behavior via AST ===
  - id: ruby-ast-dropper-behavior
    desc: Dropper download write execute
    crit: suspicious
    conf: 0.93
    attack: "T1059"
    needs: 3
    any:
      - id: obj/exec/dropper/script::ruby-ast-http-in-method
      - id: obj/exec/dropper/script::ruby-ast-file-binmode-write
      - id: obj/exec/dropper/script::ruby-ast-system-in-method

  # === Obfuscated C2 via AST ===
  - id: ruby-ast-obfuscated-c2
    desc: Base64 obfuscated C2 endpoint
    crit: suspicious
    conf: 0.91
    attack: "T1027"
    all:
      - id: obj/exec/dropper/script::ruby-ast-base64-dns
      - id: cap/comm/dns/lookup::dns-resolve

  # === Windows Dropper (New) ===
  - id: ruby-windows-dropper
    desc: Detects Windows-specific dropper behavior (OS check + Rename + Exec)
    crit: hostile
    conf: 0.95
    attack: "T1059"
    all:
      - id: obj/exec/dropper/script::ruby-ast-check-windows-regex
      - id: obj/exec/dropper/script::ruby-ast-rename-img-to-exe
      - id: obj/exec/dropper/script::ruby-ast-exec-in-method