defaults:
  for: [javascript, typescript]

composite_rules:
  - id: local-dropper
    desc: Writes a file and executes it locally
    crit: suspicious
    conf: 0.85
    attack: "T1105"
    all:
      - id: cap/fs/write/file::js-file-write
    any:
      - id: cap/process/create/shell/lang::js-exec
      - id: cap/process/create/shell/lang::js-execsync
      - id: cap/process/create/shell/lang::js-spawn
    unless:
      - id: meta/dev/testing::node-common-require
    downgrade:
      any:
        - id: meta/dev/testing::node-common-require
        - id: obj/lateral/supply-chain/npm/testing::assert-word

  - id: obfuscated-local-dropper
    desc: Obfuscated local dropper (Hostile)
    crit: hostile
    conf: 0.95
    attack: "T1027"
    mbc: "B0032"
    all:
      - id: local-dropper
      - id: obj/anti-static/obfuscation/strings/encoding::js-strong-obfuscation

  - id: js-malware-hosting-powershell
    desc: References PowerShell script on known malware hosting (Dropper)
    crit: hostile
    conf: 0.95
    attack: "T1105"
    all:
      - id: obj/c2/infrastructure/domain::malware-hosting
      - id: cap/process/create/script::powershell-script-execution
