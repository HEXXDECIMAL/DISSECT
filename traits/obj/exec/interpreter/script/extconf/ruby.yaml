defaults:
  for: [ruby]

traits:
  - id: calls-create-makefile
    desc: Calls create_makefile (standard extconf behavior)
    crit: notable
    conf: 0.8
    if:
      type: string
      regex: "create_makefile|create_header|mkmf"

  - id: ast-httparty-get
    desc: HTTParty GET request invocation
    crit: notable
    conf: 0.9
    if:
      type: ast
      query: |
        ((call
          receiver: (constant) @recv
          method: (identifier) @method
          arguments: (argument_list (_) @arg))
         (#eq? @recv "HTTParty")
         (#eq? @method "get"))

composite_rules:
  - id: extconf-http-fetch
    desc: extconf.rb performs HTTParty fetch during build
    crit: suspicious
    conf: 0.95
    all:
      - id: obj/execution/dropper/script::filename-extconf
      - id: ast-httparty-get
