# Dynamic Execution Patterns in JScript
# Detects obfuscated execution methods

defaults:
  crit: suspicious
  conf: 0.8
  for: [javascript]

traits:
  - id: dynamic-this-execution-computed
    desc: Dynamic execution via this[func()+func()]
    crit: notable
    if:
      type: raw
      # Regex fallback for AST issues
      # Matches this[...] (function call)
      regex: 'this\[[a-zA-Z0-9_\(\)\+\s]+\]\('
    downgrade:
      any:
        - id: meta/library/jquery::domain
        - id: meta/library/jquery::version-string
        - id: meta/library/jquery::copyright
        - id: meta/library/jquery::fn-extend
        - id: meta/library/prototype::copyright
        - id: meta/library/prototype::version-string
        - id: meta/library/prototype::header-x
    unless:
      - id: meta/library/jquery::domain
      - id: meta/library/jquery::version-string
      - id: meta/library/jquery::copyright
      - id: meta/library/jquery::fn-extend
      - id: meta/library/prototype::copyright
      - id: meta/library/prototype::version-string
      - id: meta/library/prototype::header-x
