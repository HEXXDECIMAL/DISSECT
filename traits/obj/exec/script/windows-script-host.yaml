# Windows Script Host Execution Patterns
# Detects VBScript/JScript execution via WScript object
# Generic indicator for script-based malware

traits:
  - id: wscript-sleep
    desc: WScript.Sleep timing
    crit: inert
    conf: 0.5
    platforms: [windows]
    for: [javascript]
    if:
      type: string
      substr: "WScript.Sleep"
    attack: "T1060"

  - id: wscript-echo
    desc: WScript.Echo output
    crit: inert
    conf: 0.5
    platforms: [windows]
    for: [javascript]
    if:
      type: string
      substr: "WScript.Echo"

  - id: wscript-createobject
    desc: WScript.CreateObject
    crit: notable
    conf: 0.7
    platforms: [windows]
    for: [javascript]
    if:
      type: string
      substr: "WScript.CreateObject"
    attack: "T1202"

  - id: wscript-getobject
    desc: WScript.GetObject
    crit: notable
    conf: 0.7
    platforms: [windows]
    for: [javascript]
    if:
      type: string
      substr: "WScript.GetObject"
    attack: "T1202"

  - id: wscript-arguments
    desc: WScript.Arguments access
    crit: notable
    conf: 0.65
    platforms: [windows]
    for: [javascript]
    if:
      type: string
      substr: "WScript.Arguments"

  - id: wscript-scriptfullname
    desc: WScript.ScriptFullName
    crit: inert
    conf: 0.5
    platforms: [windows]
    for: [javascript]
    if:
      type: string
      substr: "WScript.ScriptFullName"

composite_rules:
  - id: wscript-shell
    desc: Reference to WScript.Shell (Windows Script Host)
    crit: notable
    conf: 0.8
    attack: "T1059.005"
    any:
      - id: cap/exec/activex/activex-wshell

  - id: activexobject-shell
    desc: Reference to Shell.Application (Windows Script Host)
    crit: notable
    conf: 0.8
    attack: "T1059.005"
    any:
      - id: cap/exec/activex/activex-shell-app

  - id: activexobject-filesystem
    desc: Reference to FileSystemObject (Windows Script Host)
    crit: notable
    conf: 0.8
    attack: "T1566"
    any:
      - id: cap/exec/activex/activex-filesystem

  - id: wscript-execution
    desc: Windows Script Host execution
    crit: suspicious
    conf: 0.75
    platforms: [windows]
    for: [javascript]
    attack: "T1202"
    needs: 2
    any:
      - id: wscript-createobject
      - id: wscript-getobject
      - id: wscript-shell
      - id: wscript-sleep
      - id: activexobject-shell
      - id: activexobject-filesystem

  - id: wscript-com-objects
    desc: WScript COM object usage
    crit: suspicious
    conf: 0.8
    platforms: [windows]
    for: [javascript]
    attack: "T1202"
    mbc: "E1243"
    any:
      - id: wscript-shell
      - id: activexobject-shell
      - id: activexobject-filesystem

  - id: wscript-process-execution
    desc: WScript process execution
    crit: hostile
    conf: 0.85
    platforms: [windows]
    for: [javascript]
    attack: "T1202"
    mbc: "E1243"
    all:
      - id: wscript-execution
      - id: cap/exec/process/spawn

  - id: script-based-malware
    desc: Script-based malware framework
    crit: hostile
    conf: 0.9
    platforms: [windows]
    for: [javascript]
    attack: "T1202"
    mbc: "E1243"
    needs: 3
    any:
      - id: wscript-shell
      - id: activexobject-shell
      - id: activexobject-filesystem
      - id: wscript-createobject
      - id: wscript-sleep