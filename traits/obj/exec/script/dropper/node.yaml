# Node.js Dropper / Downloader & Execute
# ATT&CK: T1105 (Ingress Tool Transfer), T1059.007 (Command and Scripting Interpreter: JavaScript)

defaults:
  attack: "T1105"
  mbc: "E1059"

traits:
  # (No atomic traits needed here yet)

composite_rules:
  # Network Request + Eval = Hostile
  - id: node-net-eval
    desc: Node.js network request followed by eval (dropper)
    crit: hostile
    conf: 0.95
    for: [javascript]
    all:
      - id: cap/comm/http/request::node-http
      - id: cap/exec/eval/dynamic::eval-call

  # Network Request + Eval + Decoding = Hostile (Very High Conf)
  - id: node-net-eval-decode
    desc: Node.js network request, decoding, and eval (dropper)
    crit: hostile
    conf: 0.98
    for: [javascript]
    all:
      - id: cap/comm/http/request::node-http
      - id: cap/exec/eval/dynamic::eval-call
      - id: obj/anti-static/obfuscation/strings::js-buffer-from-base64
