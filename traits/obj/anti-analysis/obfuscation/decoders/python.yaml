# Python Decoders and Obfuscation Tools
# Detects scripts used to decode malware payloads or strings
# ATT&CK: T1027 (Obfuscated Files or Information)

composite_rules:
  - id: python-xor-string-decoder
    desc: "Python script implementing XOR string decryption"
    crit: suspicious
    conf: 0.95
    attack: "T1027"
    for: [python]
    all:
      - id: obj/anti-static/obfuscation/source::python-xor-byte-loop
      - id: obj/anti-static/obfuscation/source::python-printable-char-check
    any:
      - id: obj/anti-static/obfuscation/source::python-sliding-key-loop
      - id: cap/data/encode/xor::xor-key-null-pattern

  - id: python-bruteforce-string-dumper
    desc: "Python script that brute-forces XOR keys to dump strings"
    crit: suspicious
    conf: 1.0
    attack: "T1027"
    for: [python]
    all:
      - id: obj/anti-static/obfuscation/source::python-rolling-xor-loop
      - id: cap/io/console/logging::hacker-tool-log-marker
    any:
      - id: cap/data/analysis/string-quality::alphanumeric-ratio-check
      - id: obj/anti-static/obfuscation/source::python-printable-char-check
