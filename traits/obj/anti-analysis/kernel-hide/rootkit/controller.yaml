# Rootkit Controller Detection
# Detects CLI tools designed to control kernel-mode rootkits
# ATT&CK: T1014 (Rootkit), T1068 (Privilege Escalation)

composite_rules:
  - id: cli-controller
    desc: Rootkit control interface with privilege escalation
    crit: hostile
    conf: 0.95
    attack: "T1014"
    all:
      - id: cap/fs/device/ioctl::ioctl
      - id: rootkit-hiding-ops
      - id: privilege-ops

  - id: rootkit-hiding-ops
    desc: Rootkit hiding operations
    crit: notable
    conf: 0.8
    any:
      - id: cap/os/process/hide/message::hide-pid-msg
      - id: cap/os/network/hide/message::hide-port-msg
      - id: cap/fs/hide/message::hide-file-msg

  - id: privilege-ops
    desc: Rootkit privilege operations
    crit: notable
    conf: 0.8
    any:
      - id: cap/os/privilege/escalation::root-shell-msg
      - id: cap/os/privilege/escalation::root-privileges-msg

  - id: generic-hider
    desc: Generic hiding tool (potential rootkit)
    crit: suspicious
    conf: 0.8
    all:
      - id: cap/fs/device/ioctl::ioctl
      - id: rootkit-hiding-ops