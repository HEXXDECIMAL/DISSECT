traits:
- id: timing-check-api
  desc: Timing API sandbox detection
  crit: inert
  conf: 0.3
  platforms:
  - all
  for:
  - pe
  - elf
  - macho
  if:
    type: symbol
    regex: (^QueryPerformanceCounter$|^gettimeofday$|^clock_gettime$)
  mbc: C0025
# Removed cpu-feature-check duplicate - use obj/exec/native/runtime::processor-feature-check
composite_rules:
- id: evasion-aware-malware
  desc: Malware with multiple anti-analysis awareness checks
  crit: suspicious
  conf: 0.85
  attack: T1497
  mbc: B0001
  platforms:
  - all
  for:
  - pe
  - elf
  - macho
  all:
  - id: obj/anti-analysis/debugger/detect::win-comprehensive
  any:
  - id: timing-check-api
  - id: obj/exec/native/runtime::processor-feature-check
  - id: obj/anti-analysis/emulator/detect::comprehensive
  downgrade:
    any:
    - id: meta/quality/versioned
- id: anti-forensics-defensive
  desc: Malware with both anti-analysis AND anti-forensics capabilities
  crit: hostile
  conf: 0.9
  attack: T1562
  mbc: B0005
  platforms:
  - all
  for:
  - pe
  - elf
  - macho
  all:
  - id: evasion-aware-malware
  any:
  - id: obj/anti-forensics/log-clear
  - id: obj/anti-forensics/self-delete
