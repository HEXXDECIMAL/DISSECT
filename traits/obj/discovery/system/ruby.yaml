---
# Ruby system information gathering

defaults:
  for: [ruby]
  platforms: [all]

traits:
  # DNS resolution
  - id: resolv-getaddress
    desc: Resolv.getaddress method
    crit: inert
    conf: 0.7
    if:
      type: string
      regex: 'Resolv\.getaddress'

  - id: resolv-getname
    desc: Resolv.getname method
    crit: inert
    conf: 0.7
    if:
      type: string
      regex: 'Resolv\.getname'

  # Environment variables
  - id: env-bracket-access
    desc: ENV bracket access
    crit: inert
    conf: 0.6
    if:
      type: string
      exact: "ENV["

  - id: env-fetch
    desc: ENV.fetch method
    crit: inert
    conf: 0.6
    if:
      type: symbol
      regex: "ENV.{0,50}fetch"

  # Process info
  - id: process-pid
    desc: Process.pid method
    crit: inert
    conf: 0.6
    if:
      type: symbol
      regex: "Process.{0,50}pid"

  - id: process-ppid
    desc: Process.ppid method
    crit: inert
    conf: 0.6
    if:
      type: symbol
      regex: "Process.{0,50}ppid"

  - id: process-uid
    desc: Process.uid method
    crit: inert
    conf: 0.6
    if:
      type: symbol
      regex: "Process.{0,50}uid"

  - id: process-gid
    desc: Process.gid method
    crit: inert
    conf: 0.6
    if:
      type: symbol
      regex: "Process.{0,50}gid"

composite_rules:
  - id: ruby-dns-resolve
    desc: DNS hostname resolution
    crit: notable
    conf: 0.85
    any:
      - id: resolv-getaddress
      - id: resolv-getname

  - id: ruby-env-read
    desc: Read environment variables
    crit: notable
    conf: 0.75
    any:
      - id: env-bracket-access
      - id: env-fetch

  - id: ruby-process-info
    desc: Process information access
    crit: notable
    conf: 0.75
    any:
      - id: process-pid
      - id: process-ppid
      - id: process-uid
      - id: process-gid
