composite_rules:
  - id: dns-recursion-check
    desc: Detects DNS recursion flags
    crit: notable
    any:
      - id: "cap/comm/dns/client::recursion-desired-set"
      - id: "cap/comm/dns/client::recursion-available-check"

  - id: dns-amplification-scanner
    desc: Detects DNS amplification scanning tools (manual header + raw sockets)
    crit: hostile
    all:
      - id: "cap/comm/dns/struct::dns-header-struct-def"
      - id: "cap/comm/dns/struct::dns-header-rd-field"
      - id: "obj/discovery/network/scan/dns::dns-recursion-check"
      - id: "cap/comm/socket/raw::raw-socket-creation-regex"

  - id: dns-amplification-scanner-weak
    desc: Detects potential DNS scanning behavior (recursion flags + scanning loop)
    crit: suspicious
    all:
      - id: "obj/discovery/network/scan/dns::dns-recursion-check"
    any:
      - id: "cap/comm/socket/send::sendto-struct-usage"
      - id: "cap/comm/socket/raw::raw-socket-creation-regex"
