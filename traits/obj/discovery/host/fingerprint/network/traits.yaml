# Network Interface Fingerprinting (MAC addresses)
# ATT&CK: T1082 (System Information Discovery)

defaults:
  attack: "T1082"

traits:
  # === Network interface micro-traits ===
  - id: sys-class-net
    desc: /sys/class/net/ path
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "/sys/class/net/"

  - id: hwaddr
    desc: HWaddr MAC prefix
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "HWaddr"

  - id: ether-prefix
    desc: '"ether " MAC prefix'
    crit: notable
    conf: 0.6
    for: [shell, python, ruby, perl, go]
    if:
      type: string
      regex: "ether\\s+[0-9a-fA-F]{2}[:-][0-9a-fA-F]{2}[:-][0-9a-fA-F]{2}"

  - id: getifaddrs-func
    desc: getifaddrs function
    crit: notable
    conf: 0.6
    if:
      type: symbol
      regex: "getifaddrs"

  - id: siocgifhwaddr
    desc: SIOCGIFHWADDR ioctl
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "SIOCGIFHWADDR"

composite_rules:
  # Network interface composite
  - id: network-interfaces
    desc: Network interface fingerprinting (MAC address)
    crit: notable
    conf: 0.75
    any:
      - id: sys-class-net
      - id: hwaddr
      - id: ether-prefix
      - id: getifaddrs-func
      - id: siocgifhwaddr
      - id: cap/os/network/interface::ip-link
      - id: cap/os/network/interface::ifconfig
