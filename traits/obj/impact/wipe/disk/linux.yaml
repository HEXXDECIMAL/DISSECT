# Disk Wiper Detection - Linux
# MBC: E1561 (Disk Wipe)
# ATT&CK: T1561

traits:
  # NOTE: "shred" alone is too generic - it's present in glibc
  # Require command-line context or disk device patterns to reduce false positives
  - id: dd-zero
    desc: dd if=/dev/zero command
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "dd if=/dev/zero"

  - id: dd-random
    desc: dd if=/dev/urandom command
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "dd if=/dev/urandom"

  - id: shred-flag
    desc: shred command with flag
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "shred -"

  - id: shred-dev
    desc: shred with /dev/ path
    crit: notable
    conf: 0.6
    if:
      type: string
      regex: "shred.{0,20}/dev/"

  - id: shred-force
    desc: shred --force command
    crit: notable
    conf: 0.6
    if:
      type: string
      substr: "shred --force"

  # === Disk device atomic indicators ===
  - id: dev-sda
    desc: /dev/sda device access
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "/dev/sda"

  - id: dev-hda
    desc: /dev/hda device access
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "/dev/hda"

  - id: dev-nvme
    desc: /dev/nvme device access
    crit: inert
    conf: 0.5
    if:
      type: string
      regex: "/dev/nvme"

  - id: dev-vda
    desc: /dev/vda device access
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "/dev/vda"

composite_rules:
  - id: disk
    desc: Disk wiper patterns
    crit: suspicious
    conf: 0.66
    mbc: "E1561"
    attack: "T1561"
    count_min: 1
    any:
      - id: dd-zero
      - id: dd-random
      - id: shred-flag
      - id: shred-dev
      - id: shred-force

  - id: disk-device
    desc: Direct disk device access
    crit: suspicious
    conf: 0.66
    count_min: 1
    any:
      - id: dev-sda
      - id: dev-hda
      - id: dev-nvme
      - id: dev-vda
