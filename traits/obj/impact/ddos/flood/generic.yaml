# DDoS Detection
# MBC: B0042 (Denial of Service)
# ATT&CK: T1499

traits:
  - id: ddos-reference
    description: References DDoS attack
    crit: suspicious
    conf: 0.7
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      regex: "(?i)ddos|dd0s"

  - id: syn-flood
    description: SYN flood attack reference
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      regex: "(?i)syn.?flood"

  - id: ack-flood
    description: ACK flood attack reference
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      regex: "(?i)ack.?flood"

  - id: udp-flood
    description: UDP flood attack function
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "udp_flood"

  - id: tcp-flood
    description: TCP flood attack function
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "tcp_flood"

  - id: tcpraw-flood
    description: TCP raw flood attack function
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "tcpraw_flood"

  - id: flooder
    description: Flooder tool reference
    crit: suspicious
    conf: 0.85
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      regex: "(?i)flooder"

  - id: stresser
    description: Stresser tool reference
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "stresser"

  - id: tsource-engine
    description: TSource Engine Query (DDoS amplification)
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "TSource Engine Query"

  - id: icmp-flood
    description: ICMP flood attack
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "ICMPFLOOD"

  - id: blacknurse
    description: BlackNurse ICMP attack
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "BLACKNURSE"

  - id: hydrasyn
    description: HYDRASYN DDoS attack
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "HYDRASYN"

  - id: flood-operation
    description: Flood operation message
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "Flood operation"

  - id: starting-flood
    description: Starting flood message
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      exact: "Starting Flood"

composite_rules:
  - id: syn-ack-flood-combo
    description: SYN and ACK flood attack
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    all:
      - id: syn-flood
      - id: ack-flood

  - id: tcp-flood-combo
    description: Multiple TCP flood functions detected
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    count_min: 2
    any:
      - id: udp-flood
      - id: tcp-flood
      - id: tcpraw-flood

  - id: amplification-attack
    description: DDoS amplification attack detected
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    any:
      - id: tsource-engine
      - id: icmp-flood
      - id: blacknurse
      - id: hydrasyn

  - id: flood-messaging
    description: Flood operation messaging detected
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    any:
      - id: flood-operation
      - id: starting-flood
