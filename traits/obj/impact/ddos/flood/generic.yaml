# DDoS Detection
# MBC: B0042 (Denial of Service)
# ATT&CK: T1499

traits:
  # NOTE: The ddos-reference trait is intentionally specific to avoid false positives on:
  # - Debuggers with "DDos" in debug output/documentation
  # - Anti-DDoS protection software
  # - Network monitoring tools
  # Match only when "ddos" appears in attack-specific context
  - id: ddos-reference
    desc: References DDoS attack
    crit: suspicious
    conf: 0.7
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      regex: "(?i)ddos\\s*(?:attack|flood|tool|bot|module|method|type)|(?:launch|start|run|execute)\\s*ddos|dd0s"
    not:
      - regex: "(?i)anti.?ddos|ddos.?protect|ddos.?mitiga"

  - id: syn-flood
    desc: SYN flood attack reference
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      regex: "(?i)syn.?flood"

  - id: ack-flood
    desc: ACK flood attack reference
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      regex: "(?i)ack.?flood"

  - id: udp-flood
    desc: UDP flood attack function
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "udp_flood"

  - id: tcp-flood
    desc: TCP flood attack function
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "tcp_flood"

  - id: tcpraw-flood
    desc: TCP raw flood attack function
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "tcpraw_flood"

  - id: flooder
    desc: Flooder tool reference
    crit: suspicious
    conf: 0.85
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      regex: "(?i)flooder"

  - id: stresser
    desc: Stresser tool reference
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "stresser"

  - id: tsource-engine
    desc: TSource Engine Query (DDoS amplification)
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "TSource Engine Query"

  - id: icmp-flood
    desc: ICMP flood attack
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "ICMPFLOOD"

  - id: blacknurse
    desc: BlackNurse ICMP attack
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "BLACKNURSE"

  - id: hydrasyn
    desc: HYDRASYN DDoS attack
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "HYDRASYN"

  - id: flood-operation
    desc: Flood operation message
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "Flood operation"

  - id: starting-flood
    desc: Starting flood message
    crit: suspicious
    conf: 0.9
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    if:
      type: string
      substr: "Starting Flood"

composite_rules:
  - id: syn-ack-flood-combo
    desc: SYN and ACK flood attack
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    all:
      - id: syn-flood
      - id: ack-flood

  - id: tcp-flood-combo
    desc: Multiple TCP flood functions detected
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    needs: 2
    any:
      - id: udp-flood
      - id: tcp-flood
      - id: tcpraw-flood

  - id: amplification-attack
    desc: DDoS amplification attack detected
    crit: notable
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    any:
      - id: tsource-engine
      - id: icmp-flood
      - id: blacknurse
      - id: hydrasyn

  - id: flood-messaging
    desc: Flood operation messaging detected
    crit: suspicious
    conf: 0.95
    mbc: "B0042"
    attack: "T1499"
    for: [all]
    any:
      - id: flood-operation
      - id: starting-flood
