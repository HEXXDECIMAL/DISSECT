# Root Privilege Escalation Traits
# Detects behavioral and structural patterns for becoming root

traits:
  # Become Root Pattern (AST Structural)
  - id: credential-manipulation
    desc: Structural pattern of resetting multiple
    crit: suspicious
    conf: 0.99
    attack: "T1068"
    for: [c]
    platforms: [linux]
    if:
      type: ast
      language: c
      query: |
        ((assignment_expression
          left: (field_expression
            field: (field_identifier) @field)
          right: (number_literal) @val)
         (#eq? @val "0")
         (#match? @field "^(uid|gid|euid|egid|suid|sgid|fsuid|fsgid|val)$"))

  - id: prepare-creds-string
    desc: "Reference to prepare_creds kernel function"
    crit: notable
    conf: 0.8
    for: [c]
    platforms: [linux]
    if:
      type: string
      substr: "prepare_creds"

composite_rules:
  # Dummy Test Rule
  - id: test-dummy-rule
    desc: "Dummy test rule for validation"
    crit: suspicious
    conf: 1.0
    all:
      - id: obj/impact/root/prepare-creds-string

  # Become Root Flow
  - id: my-become-root
    desc: Complete 'become root' flow (prepare_creds
    crit: suspicious
    conf: 1.0
    attack: "T1068"
    all:
      - id: obj/impact/root/prepare-creds-string
      - id: kernel/rootkit/prepare-creds-call
      - id: kernel/rootkit/commit-creds-call
      - id: obj/impact/root/credential-manipulation
