# Go file encryption patterns (ransomware)
# Note: Go package/function names persist in compiled binaries as strings
defaults:
  for: [go, elf, macho, pe]

traits:
  - id: crypto-aes
    desc: crypto/aes import
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "crypto/aes"

  - id: crypto-cipher
    desc: crypto/cipher import
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "crypto/cipher"

  - id: crypto-rsa
    desc: crypto/rsa import
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "crypto/rsa"

  - id: filepath-walk
    desc: filepath.Walk call
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "filepath.Walk"

  - id: filepath-walkdir
    desc: filepath.WalkDir call
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "filepath.WalkDir"

  - id: ioutil-writefile
    desc: ioutil.WriteFile call
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "ioutil.WriteFile"

  - id: os-writefile
    desc: os.WriteFile call
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: "os.WriteFile"

  - id: encrypted-ext
    desc: .encrypted extension
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: ".encrypted"

  - id: locked-ext
    desc: .locked extension
    crit: inert
    conf: 0.5
    if:
      type: string
      substr: ".locked"

composite_rules:
  - id: crypto-import
    desc: Cryptographic imports
    crit: notable
    conf: 0.6
    needs: 1
    any:
      - id: crypto-aes
      - id: crypto-cipher
      - id: crypto-rsa

  - id: walk-func
    desc: Filesystem walk function
    crit: notable
    conf: 0.6
    needs: 1
    any:
      - id: filepath-walk
      - id: filepath-walkdir

  - id: write-func
    desc: File write function
    crit: notable
    conf: 0.6
    needs: 1
    any:
      - id: ioutil-writefile
      - id: os-writefile

  - id: encrypt-ext
    desc: Encryption-related extension
    crit: notable
    conf: 0.6
    needs: 1
    any:
      - id: encrypted-ext
      - id: locked-ext

  - id: file-encrypt
    desc: Go file encryption patterns (potential
    crit: suspicious
    conf: 0.8
    all:
      - id: crypto-import
      - id: walk-func
    any:
      - id: write-func
      - id: encrypt-ext
