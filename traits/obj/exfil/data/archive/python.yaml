# Python Archive Exfiltration
# Detects Python scripts that archive files and upload them
# ATT&CK: T1560.001 (Archive Collected Data: Archive via Utility)

composite_rules:
  - id: zip-upload
    desc: "Python script archives files and uploads them (exfiltration)"
    crit: hostile
    conf: 0.9
    attack: "T1048.003"
    for: [python]
    all:
      - id: meta/import/python/zipfile
      - id: cap/fs/directory/traverse::traverse-walk
      - id: cap/fs/file/write::py-write
    any:
      - id: cap/comm/http/request::py-post-generic
      - id: cap/comm/http/request::post