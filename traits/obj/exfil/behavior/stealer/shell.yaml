# Shell Stealer Behavior
# Detects shell script patterns indicating data theft
# ATT&CK: T1048.003 (Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol)

defaults:
  for: [shell]

composite_rules:
  - id: shell-dns-exfil
    desc: Shell script exfiltrating system info via DNS/subdomain
    crit: hostile
    conf: 0.95
    attack: "T1048.003"
    needs: 1
    any:
      - id: cap/data/encode/hex::hex-encode-xxd
      - id: cap/data/encode/hex::hex-dump-od
    all:
      - id: obj/execution/dropper/script::curl-download
      - id: obj/discovery/host/user::whoami