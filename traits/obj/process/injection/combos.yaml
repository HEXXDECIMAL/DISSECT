# Process Injection Patterns
# Composite rules for code injection into other processes

composite_rules:
  # === Remote Thread Injection ===
  - id: remote-thread-pattern
    desc: Remote thread creation for injection
    crit: hostile
    conf: 0.95
    attack: "T1055.001"
    for: ["pe", "dll"]
    all:
      - id: cap/exec/inject/create-remote-thread
      - id: cap/exec/inject/write-process-memory

  # === Suspended Process Injection ===
  - id: suspended-process-inject
    desc: Suspend process and modify context
    crit: hostile
    conf: 0.90
    attack: "T1055"
    for: ["pe", "dll"]
    all:
      - id: cap/exec/inject/suspend-thread
      - id: cap/exec/inject/get-thread-context
      - id: cap/exec/inject/set-thread-context

  # === APC Queue Injection ===
  - id: apc-injection
    desc: Asynchronous procedure call injection
    crit: hostile
    conf: 0.95
    attack: "T1055.004"
    for: ["pe", "dll"]
    all:
      - id: cap/exec/inject/queue-user-apc
      - id: cap/exec/inject/write-process-memory

  # === Process Hollowing Pattern ===
  - id: process-hollowing
    desc: Suspend + memory write + context modify
    crit: hostile
    conf: 0.90
    attack: "T1055.012"
    for: ["pe", "dll"]
    all:
      - id: cap/process/create/create-process-a
      - id: cap/exec/inject/suspend-thread
      - id: cap/exec/inject/write-process-memory
      - id: cap/exec/inject/set-thread-context

  # === Shared Library Injection ===
  - id: dll-injection
    desc: DLL injection into process
    crit: hostile
    conf: 0.90
    attack: "T1055.001"
    for: ["pe", "dll"]
    all:
      - id: cap/exec/inject/create-remote-thread
      - id: cap/exec/native/load-library-a

  # === Complete Injection Framework ===
  - id: full-injection-capability
    desc: Complete process injection toolkit
    crit: suspicious
    conf: 0.85
    attack: "T1055"
    for: ["pe", "dll"]
    any:
      - id: remote-thread-pattern
      - id: suspended-process-inject
      - id: apc-injection
