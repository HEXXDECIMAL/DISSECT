{
  "type": "file",
  "id": 0,
  "path": "/Users/t/data/dissect/malware/c_linux/2024.evilBPF/ssl_sniffer/ebpf/main.bpf.c",
  "depth": 0,
  "file_type": "c",
  "sha256": "998ce5e55ce7c64482d6abefe879c8056eb5f159f48f7525406e644db3811cb3",
  "size": 3157,
  "risk": "suspicious",
  "counts": {
    "suspicious": 1,
    "notable": 17
  },
  "findings": [
    {
      "id": "metadata/quality/license::gpl-word",
      "kind": "capability",
      "desc": "GPL license reference",
      "conf": 0.7,
      "crit": "inert",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "GPL",
          "location": "0xc4f"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "GPL",
          "location": "0xc50"
        }
      ],
      "source_file": "metadata/quality/license/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/maps::bpf-map-update",
      "kind": "capability",
      "desc": "BPF map update helper",
      "conf": 0.7,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 occurrences of bpf_map_update_elem",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/maps/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/ssl::ssl-op-string",
      "kind": "capability",
      "desc": "SSL operation indicator",
      "conf": 0.75,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 2 SSL_OP_WRITE",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/ssl/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/loader::bpf-helpers-h",
      "kind": "capability",
      "desc": "bpf/bpf_helpers.h include",
      "conf": 0.85,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 occurrences of bpf/bpf_helpers.h",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/loader/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/ssl::ssl-hook-target",
      "kind": "capability",
      "desc": "SSL function as hook target",
      "conf": 0.8,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "ssl_read",
          "location": "0xb42"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "ssl_read",
          "location": "0xb43"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "ssl_write",
          "location": "0xbb9"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "ssl_write",
          "location": "0xbba"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/ssl/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/loader::data-event-struct",
      "kind": "capability",
      "desc": "eBPF data event structure",
      "conf": 0.75,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 2 data_event",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/loader/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/loader::vmlinux-h",
      "kind": "capability",
      "desc": "vmlinux.h CO-RE eBPF header",
      "conf": 0.8,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "<vmlinux.h>",
          "location": "0x31"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/loader/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/tracing::bpf-core-read-user",
      "kind": "capability",
      "desc": "eBPF read from user memory",
      "conf": 0.8,
      "crit": "notable",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_core_read_user",
          "location": "import"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/tracing/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/loader::sec-license",
      "kind": "capability",
      "desc": "eBPF license section declaration",
      "conf": 0.8,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 SEC(\"license",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/loader/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/maps::bpf-map-lookup",
      "kind": "capability",
      "desc": "BPF map lookup helper",
      "conf": 0.7,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 occurrences of bpf_map_lookup_elem",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/maps/traits.yaml"
    },
    {
      "id": "micro-behaviors/fs/file/write::write",
      "kind": "capability",
      "desc": "Write files",
      "conf": 0.66,
      "crit": "notable",
      "evidence": [
        {
          "method": "symbol",
          "source": "tree-sitter-c",
          "value": "handle_rw_exit(struct pt_regs *ctx, int is_write)",
          "location": "0x45b"
        },
        {
          "method": "symbol",
          "source": "tree-sitter-c",
          "value": "probe_ssl_write_return(struct pt_regs *ctx)",
          "location": "0xbd4"
        }
      ],
      "source_file": "micro-behaviors/fs/file/write/unix.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/tracing::uprobe-sec",
      "kind": "capability",
      "desc": "eBPF uprobe SEC declaration",
      "conf": 0.85,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/fd_attach_ssl",
          "location": "0x99a"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/fd_attach_ssl",
          "location": "0x99b"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_rw_enter",
          "location": "0xa19"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_rw_enter",
          "location": "0xa1a"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_read_return",
          "location": "0xb42"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_read_return",
          "location": "0xb43"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_write_return",
          "location": "0xbb9"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_write_return",
          "location": "0xbba"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/tracing/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/loader::bpf-ringbuf",
      "kind": "capability",
      "desc": "eBPF ringbuf helpers",
      "conf": 0.7,
      "crit": "notable",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_ringbuf_reserve",
          "location": "import"
        },
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_ringbuf_submit",
          "location": "import"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/loader/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/maps::bpf-map-hash",
      "kind": "capability",
      "desc": "BPF hash map",
      "conf": 0.5,
      "crit": "inert",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 occurrences of BPF_MAP_TYPE_HASH",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/maps/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/loader::ebpf-core-header",
      "kind": "capability",
      "desc": "eBPF CO-RE development header",
      "conf": 0.85,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "<vmlinux.h>",
          "location": "0x31"
        },
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 occurrences of bpf/bpf_helpers.h",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/loader/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/loader::ebpf-program-header",
      "kind": "capability",
      "desc": "eBPF program with license section",
      "conf": 0.8,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "<vmlinux.h>",
          "location": "0x31"
        },
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 occurrences of bpf/bpf_helpers.h",
          "location": "file"
        },
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 SEC(\"license",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/loader/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/ssl::ssl-sniffer-header",
      "kind": "capability",
      "desc": "eBPF SSL sniffer header pattern",
      "conf": 0.85,
      "crit": "suspicious",
      "attack": "T1557",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 2 SSL_OP_WRITE",
          "location": "file"
        },
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 2 data_event",
          "location": "file"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/ssl/traits.yaml"
    },
    {
      "id": "metadata/quality::licensed",
      "kind": "capability",
      "desc": "Contains license information",
      "conf": 0.9,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "GPL",
          "location": "0xc4f"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "GPL",
          "location": "0xc50"
        }
      ],
      "source_file": "metadata/quality/traits.yaml"
    },
    {
      "id": "objectives/collection/network/ssl-intercept::ebpf-uprobe-hook",
      "kind": "capability",
      "desc": "eBPF uprobe hooking",
      "conf": 0.8,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/fd_attach_ssl",
          "location": "0x99a"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/fd_attach_ssl",
          "location": "0x99b"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_rw_enter",
          "location": "0xa19"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_rw_enter",
          "location": "0xa1a"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_read_return",
          "location": "0xb42"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_read_return",
          "location": "0xb43"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_write_return",
          "location": "0xbb9"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "uprobe/ssl_write_return",
          "location": "0xbba"
        }
      ],
      "source_file": "objectives/collection/network/ssl-intercept/traits.yaml"
    },
    {
      "id": "micro-behaviors/os/bpf/program/ssl::ebpf-data-buffer",
      "kind": "capability",
      "desc": "eBPF data buffer maps",
      "conf": 0.7,
      "crit": "notable",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_ringbuf_reserve",
          "location": "import"
        },
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_ringbuf_submit",
          "location": "import"
        }
      ],
      "source_file": "micro-behaviors/os/bpf/program/ssl/traits.yaml"
    },
    {
      "id": "metadata/internal/imported::handle_rw_exit",
      "kind": "structural",
      "desc": "calls handle_rw_exit",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "handle_rw_exit"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::pt_regs_rc_core",
      "kind": "structural",
      "desc": "calls PT_REGS_RC_CORE",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "PT_REGS_RC_CORE"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_get_current_comm",
      "kind": "structural",
      "desc": "calls bpf_get_current_comm",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_get_current_comm"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_core_read_user",
      "kind": "structural",
      "desc": "calls bpf_core_read_user",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_core_read_user"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::sec",
      "kind": "structural",
      "desc": "calls SEC",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "SEC"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_ktime_get_ns",
      "kind": "structural",
      "desc": "calls bpf_ktime_get_ns",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_ktime_get_ns"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_printk",
      "kind": "structural",
      "desc": "calls bpf_printk",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_printk"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_map_update_elem",
      "kind": "structural",
      "desc": "calls bpf_map_update_elem",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_map_update_elem"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_core_read",
      "kind": "structural",
      "desc": "calls bpf_core_read",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_core_read"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_ringbuf_reserve",
      "kind": "structural",
      "desc": "calls bpf_ringbuf_reserve",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_ringbuf_reserve"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::min",
      "kind": "structural",
      "desc": "calls min",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "min"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_get_current_pid_tgid",
      "kind": "structural",
      "desc": "calls bpf_get_current_pid_tgid",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_get_current_pid_tgid"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_map_lookup_elem",
      "kind": "structural",
      "desc": "calls bpf_map_lookup_elem",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_map_lookup_elem"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::pt_regs_parm2_core",
      "kind": "structural",
      "desc": "calls PT_REGS_PARM2_CORE",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "PT_REGS_PARM2_CORE"
        }
      ]
    },
    {
      "id": "metadata/internal/imported::bpf_ringbuf_submit",
      "kind": "structural",
      "desc": "calls bpf_ringbuf_submit",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_ringbuf_submit"
        }
      ]
    }
  ]
}
