{
  "type": "file",
  "id": 0,
  "path": "/Users/t/data/dissect/malware/c_linux/2024.evilBPF/hide_pid/hider.c",
  "depth": 0,
  "file_type": "c",
  "sha256": "3b693f3d1f104de0a82be53a7c542031f882522cbd4ef24be3c32756dedf1728",
  "size": 2779,
  "risk": "hostile",
  "counts": {
    "hostile": 1,
    "suspicious": 7,
    "notable": 11
  },
  "findings": [
    {
      "id": "obj/anti-analysis/kernel-hide/userspace::hide-pid",
      "kind": "capability",
      "desc": "hide_pid function",
      "conf": 0.85,
      "crit": "suspicious",
      "mbc": "B0003",
      "attack": "T1014",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f8"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f9"
        }
      ],
      "source_file": "obj/anti-analysis/kernel-hide/userspace/linux.yaml"
    },
    {
      "id": "cap/os/bpf/trace-frameworks::libbpf",
      "kind": "capability",
      "desc": "libbpf library",
      "conf": 0.85,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "<bpf/libbpf.h>",
          "location": "0x6e"
        }
      ],
      "source_file": "cap/os/bpf/trace-frameworks/traits.yaml"
    },
    {
      "id": "cap/os/bpf/program/network::bpf-skeleton-include",
      "kind": "capability",
      "desc": "BPF skeleton header include",
      "conf": 0.9,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 #include \"hider.skel.h\"",
          "location": "file"
        }
      ],
      "source_file": "cap/os/bpf/program/network/traits.yaml"
    },
    {
      "id": "cap/fs/file/open::open",
      "kind": "capability",
      "desc": "Open files",
      "conf": 0.66,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "hider_bpf__open",
          "location": "import"
        }
      ],
      "source_file": "cap/fs/file/open/unix.yaml"
    },
    {
      "id": "obj/anti-analysis/kernel-hide/userspace::hide-pid-string",
      "kind": "capability",
      "desc": "hide_pid string reference",
      "conf": 0.9,
      "crit": "suspicious",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f8"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f9"
        }
      ],
      "source_file": "obj/anti-analysis/kernel-hide/userspace/ld-preload.yaml"
    },
    {
      "id": "cap/fs/file/delete::delete",
      "kind": "capability",
      "desc": "Delete files",
      "conf": 0.3,
      "crit": "notable",
      "evidence": [
        {
          "method": "symbol",
          "source": "tree-sitter-c",
          "value": "remove_blacklist_file(char *to_hide_name)",
          "location": "0x81a"
        }
      ],
      "source_file": "cap/fs/file/delete/unix.yaml"
    },
    {
      "id": "cap/process/terminate/signal::exit",
      "kind": "capability",
      "desc": "Terminate process with status code",
      "conf": 0.3,
      "crit": "inert",
      "mbc": "E1562",
      "attack": "T1562",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "exit",
          "location": "import"
        }
      ],
      "source_file": "cap/process/terminate/signal/traits.yaml"
    },
    {
      "id": "known/malware/rootkit::hide-pid-prog",
      "kind": "capability",
      "desc": "evilBPF hide_pid program name",
      "conf": 1.0,
      "crit": "suspicious",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 2 hide_pid_exit",
          "location": "file"
        }
      ],
      "source_file": "known/malware/rootkit/evilbpf.yaml"
    },
    {
      "id": "obj/anti-analysis/kernel-hide/lkm/hiding::hiding-mention-comment",
      "kind": "capability",
      "desc": "Code mentions hiding/hidden",
      "conf": 0.9,
      "crit": "suspicious",
      "evidence": [
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "// if to_hide_name > 31, we will have a problem",
          "location": "58:5"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "// Hiding a PID is the same as hiding any files (in this case, a folder named after my ID)",
          "location": "99:37"
        }
      ],
      "source_file": "obj/anti-analysis/kernel-hide/lkm/hiding/traits.yaml"
    },
    {
      "id": "cap/os/time/query::sleep",
      "kind": "capability",
      "desc": "Suspend execution for interval",
      "conf": 0.4,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "sleep",
          "location": "import"
        }
      ],
      "source_file": "cap/os/time/query/traits.yaml"
    },
    {
      "id": "obj/anti-analysis/sandbox/detect::sleep-accel",
      "kind": "capability",
      "desc": "Sleep acceleration detection (sandbox evasion)",
      "conf": 0.5,
      "crit": "notable",
      "mbc": "B0007",
      "attack": "T1497.003",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "sleep",
          "location": "import"
        }
      ],
      "source_file": "obj/anti-analysis/sandbox/detect/traits.yaml"
    },
    {
      "id": "cap/os/bpf/network-infra::bpf-program",
      "kind": "capability",
      "desc": "bpf_program struct",
      "conf": 0.6,
      "crit": "notable",
      "evidence": [
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "bpf_program__fd"
        }
      ],
      "source_file": "cap/os/bpf/network-infra/traits.yaml"
    },
    {
      "id": "cap/process/identity/query::get-pid",
      "kind": "capability",
      "desc": "Get process ID",
      "conf": 0.3,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "getpid",
          "location": "import"
        }
      ],
      "source_file": "cap/process/identity/query/unix.yaml"
    },
    {
      "id": "cap/os/bpf/program/loader::bpf-skeleton",
      "kind": "capability",
      "desc": "BPF skeleton pattern",
      "conf": 0.6,
      "crit": "inert",
      "evidence": [
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__open"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__attach"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__destroy"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__load"
        }
      ],
      "source_file": "cap/os/bpf/program/loader/traits.yaml"
    },
    {
      "id": "obj/anti-analysis/kernel-hide/lkm/hiding::hide-function-name",
      "kind": "capability",
      "desc": "Function name suggests hiding capability",
      "conf": 0.85,
      "crit": "suspicious",
      "evidence": [
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "void cleanup(int sig)\n{\n    printf(\"Detaching...\\n\");\n    hider_bpf__destroy(skel);\n    exit(0);\n}",
          "location": "14:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int init_bpf(void)\n{\n    int err = 0;\n    skel = hider_bpf__open();\n    if (!skel) {\n        fprintf...",
          "location": "21:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int blacklist_file(char *to_hide_name, int action)\n{\n    int mapfd, err = 0;\n    char filename[32];\n...",
          "location": "51:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int add_blacklist_file(char *to_hide_name)\n{\n    return blacklist_file(to_hide_name, 1);\n}",
          "location": "80:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int remove_blacklist_file(char *to_hide_name)\n{\n    return blacklist_file(to_hide_name, 0);\n}",
          "location": "85:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int main(int argc, char *argv[])\n{\n    int my_pid = getpid();\n    char my_pid_str[10];\n\n    init_bpf...",
          "location": "90:1"
        }
      ],
      "source_file": "obj/anti-analysis/kernel-hide/lkm/hiding/traits.yaml"
    },
    {
      "id": "cap/os/bpf/program/maps::bpf-map-update",
      "kind": "capability",
      "desc": "BPF map update helper",
      "conf": 0.7,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 3 occurrences of bpf_map_update_elem",
          "location": "file"
        }
      ],
      "source_file": "cap/os/bpf/program/maps/traits.yaml"
    },
    {
      "id": "cap/os/bpf/program/maps::bpf-map-delete",
      "kind": "capability",
      "desc": "BPF map delete helper",
      "conf": 0.7,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 occurrences of bpf_map_delete_elem",
          "location": "file"
        }
      ],
      "source_file": "cap/os/bpf/program/maps/traits.yaml"
    },
    {
      "id": "known/malware/rootkit::pid-hider",
      "kind": "capability",
      "desc": "evilBPF PID hider",
      "conf": 1.0,
      "crit": "suspicious",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 2 hide_pid_exit",
          "location": "file"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__open"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__attach"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__destroy"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__load"
        }
      ],
      "source_file": "known/malware/rootkit/evilbpf.yaml"
    },
    {
      "id": "cap/os/bpf/program/ssl::bpf-packet-inspection",
      "kind": "capability",
      "desc": "BPF packet inspection components",
      "conf": 0.6,
      "crit": "notable",
      "evidence": [
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "bpf_program__fd"
        },
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 #include \"hider.skel.h\"",
          "location": "file"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__open"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__attach"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__destroy"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__load"
        }
      ],
      "source_file": "cap/os/bpf/program/ssl/traits.yaml"
    },
    {
      "id": "obj/privesc/security-framework/auth::auth-privesc-api-combo",
      "kind": "capability",
      "desc": "Authorization APIs for privilege escalation",
      "conf": 0.9,
      "crit": "notable",
      "attack": "T1548.004",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "getpid",
          "location": "import"
        }
      ],
      "source_file": "obj/privesc/security-framework/auth/macos.yaml"
    },
    {
      "id": "cap/os/bpf/program/ssl::tracing-frameworks",
      "kind": "capability",
      "desc": "eBPF tracing frameworks",
      "conf": 0.85,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "<bpf/libbpf.h>",
          "location": "0x6e"
        }
      ],
      "source_file": "cap/os/bpf/program/ssl/traits.yaml"
    },
    {
      "id": "obj/anti-analysis/kernel-hide/userspace::proc-hiding",
      "kind": "capability",
      "desc": "Patterns for hiding processes via",
      "conf": 0.9,
      "crit": "suspicious",
      "mbc": "F0015",
      "attack": "T1574.006",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f8"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f9"
        }
      ],
      "source_file": "obj/anti-analysis/kernel-hide/userspace/ld-preload.yaml"
    },
    {
      "id": "cap/os/bpf/program/ssl::tracing",
      "kind": "capability",
      "desc": "Legitimate eBPF tracing/observability",
      "conf": 0.85,
      "crit": "notable",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "<bpf/libbpf.h>",
          "location": "0x6e"
        }
      ],
      "source_file": "cap/os/bpf/program/ssl/traits.yaml"
    },
    {
      "id": "known/malware/rootkit::evilbpf",
      "kind": "capability",
      "desc": "evilBPF eBPF rootkit framework",
      "conf": 1.0,
      "crit": "hostile",
      "mbc": "B0006",
      "attack": "T1014",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 2 hide_pid_exit",
          "location": "file"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__open"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__attach"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__destroy"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__load"
        }
      ],
      "source_file": "known/malware/rootkit/evilbpf.yaml"
    },
    {
      "id": "meta/internal/imported::sleep",
      "kind": "structural",
      "desc": "calls sleep",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "sleep"
        }
      ]
    },
    {
      "id": "meta/internal/imported::bpf_map_delete_elem",
      "kind": "structural",
      "desc": "calls bpf_map_delete_elem",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_map_delete_elem"
        }
      ]
    },
    {
      "id": "meta/internal/imported::bpf_map_update_elem",
      "kind": "structural",
      "desc": "calls bpf_map_update_elem",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_map_update_elem"
        }
      ]
    },
    {
      "id": "meta/internal/imported::strcpy",
      "kind": "structural",
      "desc": "calls strcpy",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "strcpy"
        }
      ]
    },
    {
      "id": "meta/internal/imported::printf",
      "kind": "structural",
      "desc": "calls printf",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "printf"
        }
      ]
    },
    {
      "id": "meta/internal/imported::bpf_map__fd",
      "kind": "structural",
      "desc": "calls bpf_map__fd",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_map__fd"
        }
      ]
    },
    {
      "id": "meta/internal/imported::memset",
      "kind": "structural",
      "desc": "calls memset",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "memset"
        }
      ]
    },
    {
      "id": "meta/internal/imported::hider_bpf__open",
      "kind": "structural",
      "desc": "calls hider_bpf__open",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "hider_bpf__open"
        }
      ]
    },
    {
      "id": "meta/internal/imported::init_bpf",
      "kind": "structural",
      "desc": "calls init_bpf",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "init_bpf"
        }
      ]
    },
    {
      "id": "meta/internal/imported::signal",
      "kind": "structural",
      "desc": "calls signal",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "signal"
        }
      ]
    },
    {
      "id": "meta/internal/imported::add_blacklist_file",
      "kind": "structural",
      "desc": "calls add_blacklist_file",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "add_blacklist_file"
        }
      ]
    },
    {
      "id": "meta/internal/imported::strlen",
      "kind": "structural",
      "desc": "calls strlen",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "strlen"
        }
      ]
    },
    {
      "id": "meta/internal/imported::hider_bpf__attach",
      "kind": "structural",
      "desc": "calls hider_bpf__attach",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "hider_bpf__attach"
        }
      ]
    },
    {
      "id": "meta/internal/imported::blacklist_file",
      "kind": "structural",
      "desc": "calls blacklist_file",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "blacklist_file"
        }
      ]
    },
    {
      "id": "meta/internal/imported::getpid",
      "kind": "structural",
      "desc": "calls getpid",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "getpid"
        }
      ]
    },
    {
      "id": "meta/internal/imported::fprintf",
      "kind": "structural",
      "desc": "calls fprintf",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "fprintf"
        }
      ]
    },
    {
      "id": "meta/internal/imported::bpf_program__fd",
      "kind": "structural",
      "desc": "calls bpf_program__fd",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "bpf_program__fd"
        }
      ]
    },
    {
      "id": "meta/internal/imported::hider_bpf__destroy",
      "kind": "structural",
      "desc": "calls hider_bpf__destroy",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "hider_bpf__destroy"
        }
      ]
    },
    {
      "id": "meta/internal/imported::exit",
      "kind": "structural",
      "desc": "calls exit",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "exit"
        }
      ]
    },
    {
      "id": "meta/internal/imported::hider_bpf__load",
      "kind": "structural",
      "desc": "calls hider_bpf__load",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "hider_bpf__load"
        }
      ]
    },
    {
      "id": "meta/internal/imported::sprintf",
      "kind": "structural",
      "desc": "calls sprintf",
      "conf": 0.95,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "sprintf"
        }
      ]
    }
  ]
}