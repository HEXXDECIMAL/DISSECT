{
  "type": "file",
  "id": 0,
  "path": "/Users/t/data/dissect/malware/c_linux/2024.evilBPF/hide_pid/hider.c",
  "depth": 0,
  "file_type": "c",
  "sha256": "3b693f3d1f104de0a82be53a7c542031f882522cbd4ef24be3c32756dedf1728",
  "size": 2779,
  "risk": "suspicious",
  "counts": {
    "suspicious": 5,
    "notable": 6
  },
  "findings": [
    {
      "id": "cap/data/control-flow/for-loop",
      "kind": "capability",
      "desc": "for loop pattern",
      "conf": 0.3,
      "crit": "inert",
      "evidence": [
        {
          "method": "string",
          "source": "raw_content",
          "value": "for",
          "location": "file"
        }
      ]
    },
    {
      "id": "cap/data/control-flow/while-loop",
      "kind": "capability",
      "desc": "while loop pattern",
      "conf": 0.3,
      "crit": "inert",
      "evidence": [
        {
          "method": "string",
          "source": "raw_content",
          "value": "while",
          "location": "file"
        }
      ]
    },
    {
      "id": "cap/os/bpf/libbpf",
      "kind": "capability",
      "desc": "libbpf library",
      "conf": 0.85,
      "crit": "inert",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "libbpf",
          "location": "0x6e"
        }
      ]
    },
    {
      "id": "obj/anti-analysis/kernel-hide/ebpf/hide-string",
      "kind": "capability",
      "desc": "Hide string reference",
      "conf": 0.6,
      "crit": "inert",
      "evidence": [
        {
          "method": "string",
          "source": "raw_content",
          "value": "hide",
          "location": "file"
        }
      ]
    },
    {
      "id": "obj/anti-analysis/kernel-hide/userspace/hide-pid",
      "kind": "capability",
      "desc": "hide_pid function",
      "conf": 0.85,
      "crit": "suspicious",
      "mbc": "B0003",
      "attack": "T1014",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f8"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f9"
        }
      ]
    },
    {
      "id": "cap/fs/file/delete/delete",
      "kind": "capability",
      "desc": "Delete files",
      "conf": 0.3,
      "crit": "notable",
      "evidence": [
        {
          "method": "symbol",
          "source": "tree-sitter-c",
          "value": "remove_blacklist_file(char *to_hide_name)",
          "location": "0x81a"
        }
      ]
    },
    {
      "id": "cap/fs/file/open/open",
      "kind": "capability",
      "desc": "Open files",
      "conf": 0.66,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "hider_bpf__open",
          "location": "import"
        }
      ]
    },
    {
      "id": "cap/os/bpf/bpf-program",
      "kind": "capability",
      "desc": "bpf_program struct",
      "conf": 0.6,
      "crit": "notable",
      "evidence": [
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "bpf_program"
        }
      ]
    },
    {
      "id": "cap/os/bpf/bpf-skeleton-include",
      "kind": "capability",
      "desc": "BPF skeleton header include",
      "conf": 0.9,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 #include \"hider.skel.h\"",
          "location": "file"
        }
      ]
    },
    {
      "id": "cap/os/bpf/bpf-map-update",
      "kind": "capability",
      "desc": "BPF map update helper",
      "conf": 0.7,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 3 occurrences of bpf_map_update_elem",
          "location": "file"
        }
      ]
    },
    {
      "id": "cap/os/bpf/bpf-map-delete",
      "kind": "capability",
      "desc": "BPF map delete helper",
      "conf": 0.7,
      "crit": "notable",
      "evidence": [
        {
          "method": "raw",
          "source": "raw_content",
          "value": "Found 1 occurrences of bpf_map_delete_elem",
          "location": "file"
        }
      ]
    },
    {
      "id": "cap/os/bpf/bpf-skeleton",
      "kind": "capability",
      "desc": "BPF skeleton pattern",
      "conf": 0.6,
      "crit": "inert",
      "evidence": [
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__destroy"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__load"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__open"
        },
        {
          "method": "import_symbol",
          "source": "ast",
          "value": "hider_bpf__attach"
        }
      ]
    },
    {
      "id": "cap/os/time/query/sleep",
      "kind": "capability",
      "desc": "Suspend execution for interval",
      "conf": 0.4,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "sleep",
          "location": "import"
        }
      ]
    },
    {
      "id": "cap/process/identity/query/get-pid",
      "kind": "capability",
      "desc": "Get process ID",
      "conf": 0.3,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "getpid",
          "location": "import"
        }
      ]
    },
    {
      "id": "cap/process/info/getpid",
      "kind": "capability",
      "desc": "Get current process identifier",
      "conf": 0.5,
      "crit": "inert",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "getpid",
          "location": "import"
        }
      ]
    },
    {
      "id": "cap/process/terminate/signal/signal",
      "kind": "capability",
      "desc": "Install signal handler",
      "conf": 0.6,
      "crit": "notable",
      "mbc": "F0004",
      "attack": "T1562.001",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "signal",
          "location": "import"
        }
      ]
    },
    {
      "id": "cap/process/terminate/signal/exit",
      "kind": "capability",
      "desc": "Terminate process with status code",
      "conf": 0.3,
      "crit": "inert",
      "mbc": "E1562",
      "attack": "T1562",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "exit",
          "location": "import"
        }
      ]
    },
    {
      "id": "obj/anti-analysis/kernel-hide/lkm/hide-function-name",
      "kind": "capability",
      "desc": "Function name suggests hiding capability",
      "conf": 0.85,
      "crit": "suspicious",
      "evidence": [
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "void cleanup(int sig)\n{\n    printf(\"Detaching...\\n\");\n    hider_bpf__destroy(skel);\n    exit(0);\n}",
          "location": "14:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int init_bpf(void)\n{\n    int err = 0;\n    skel = hider_bpf__open();\n    if (!skel) {\n        fprintf...",
          "location": "21:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int blacklist_file(char *to_hide_name, int action)\n{\n    int mapfd, err = 0;\n    char filename[32];\n...",
          "location": "51:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int add_blacklist_file(char *to_hide_name)\n{\n    return blacklist_file(to_hide_name, 1);\n}",
          "location": "80:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int remove_blacklist_file(char *to_hide_name)\n{\n    return blacklist_file(to_hide_name, 0);\n}",
          "location": "85:1"
        },
        {
          "method": "ast",
          "source": "tree-sitter",
          "value": "int main(int argc, char *argv[])\n{\n    int my_pid = getpid();\n    char my_pid_str[10];\n\n    init_bpf...",
          "location": "90:1"
        }
      ]
    },
    {
      "id": "obj/anti-analysis/kernel-hide/userspace/hide-pid-string",
      "kind": "capability",
      "desc": "hide_pid string reference",
      "conf": 0.9,
      "crit": "suspicious",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f8"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f9"
        }
      ]
    },
    {
      "id": "obj/anti-analysis/sandbox/detect/sleep-accel",
      "kind": "capability",
      "desc": "Sleep acceleration detection (sandbox evasion)",
      "conf": 0.5,
      "crit": "inert",
      "mbc": "B0007",
      "attack": "T1497.003",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "sleep",
          "location": "import"
        }
      ]
    },
    {
      "id": "obj/discovery/process/getpid",
      "kind": "capability",
      "desc": "Get process ID of calling",
      "conf": 0.5,
      "crit": "inert",
      "mbc": "E1057",
      "attack": "T1057",
      "evidence": [
        {
          "method": "symbol",
          "source": "ast",
          "value": "getpid",
          "location": "import"
        }
      ]
    },
    {
      "id": "cap/data/control-flow/iteration-loop-pattern",
      "kind": "capability",
      "desc": "Iteration or loop pattern",
      "conf": 0.5,
      "crit": "inert",
      "evidence": [
        {
          "method": "string",
          "source": "raw_content",
          "value": "for",
          "location": "file"
        },
        {
          "method": "string",
          "source": "raw_content",
          "value": "while",
          "location": "file"
        }
      ]
    },
    {
      "id": "cap/os/bpf/tracing-frameworks",
      "kind": "capability",
      "desc": "eBPF tracing frameworks",
      "conf": 0.85,
      "crit": "inert",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "libbpf",
          "location": "0x6e"
        }
      ]
    },
    {
      "id": "obj/anti-analysis/kernel-hide/kernel/macos-kext-rootkit-hiding",
      "kind": "capability",
      "desc": "macOS kext rootkit hiding patterns",
      "conf": 0.9,
      "crit": "suspicious",
      "evidence": [
        {
          "method": "string",
          "source": "raw_content",
          "value": "hide",
          "location": "file"
        }
      ]
    },
    {
      "id": "obj/anti-analysis/kernel-hide/userspace/proc-hiding",
      "kind": "capability",
      "desc": "Patterns for hiding processes via",
      "conf": 0.9,
      "crit": "suspicious",
      "mbc": "F0015",
      "attack": "T1574.006",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f8"
        },
        {
          "method": "string",
          "source": "string_extractor",
          "value": "hide_pid",
          "location": "0x8f9"
        }
      ]
    },
    {
      "id": "cap/os/bpf/tracing",
      "kind": "capability",
      "desc": "Legitimate eBPF tracing/observability",
      "conf": 0.85,
      "crit": "inert",
      "evidence": [
        {
          "method": "string",
          "source": "string_extractor",
          "value": "libbpf",
          "location": "0x6e"
        }
      ]
    }
  ]
}